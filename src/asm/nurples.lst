PC     Output      Line
040000             0001        assume adl=1
040000             0002        org 0x040000
040000 C3 45 00 04 0003        jp start
040004 FF FF FF FF 0004        align 64
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
040040 4D 4F 53    0005        db "MOS"
040043 00          0006        db 00h
040044 01          0007        db 01h
040045             0008    
040045             0009    start:
040045 F5          0010        push af
040046 C5          0011        push bc
040047 D5          0012        push de
040048 DD E5       0013        push ix
04004A FD E5       0014        push iy
04004C             0015    
04004C CD 00 A0 04 0016        call main
040050             0017    
040050             0018    exit:
040050 FD E1       0019        pop iy
040052 DD E1       0020        pop ix
040054 D1          0021        pop de
040055 C1          0022        pop bc
040056 F1          0023        pop af
040057 21 00 00 00 0024        ld hl,0
04005B             0025    
04005B C9          0026        ret
04005C             0027    
04005C             0028    ; API INCLUDES
04005C             0029        include "mos_api.inc"
04005C             0001*   ; https://github.com/envenomator/Agon/blob/master/ez80asm%20examples%20(annotated)/mos_api.inc
04005C             0002*   ; Title:	AGON MOS - API for user projects
04005C             0003*   ; Author:	Dean Belfield
04005C             0004*   ;			Adapted for agon-ez80asm by Jeroen Venema
04005C             0005*   ;			Added MOS error codes for return in HL
04005C             0006*   ; Created:	03/08/2022
04005C             0007*   ; Last Updated:	10/08/2023
04005C             0008*   ;
04005C             0009*   ; Modinfo:
04005C             0010*   ; 05/08/2022:	Added mos_feof
04005C             0011*   ; 09/08/2022:	Added system variables: cursorX, cursorY
04005C             0012*   ; 18/08/2022:	Added system variables: scrchar, scrpixel, audioChannel, audioSuccess, vpd_pflags
04005C             0013*   ; 05/09/2022:	Added mos_ren, vdp_pflag_mode
04005C             0014*   ; 24/09/2022:	Added mos_getError, mos_mkdir
04005C             0015*   ; 13/10/2022:	Added mos_oscli
04005C             0016*   ; 23/02/2023:	Added more sysvars, fixed typo in sysvar_audioSuccess, offsets for sysvar_scrCols, sysvar_scrRows
04005C             0017*   ; 04/03/2023:	Added sysvar_scrpixelIndex
04005C             0018*   ; 08/03/2023:	Renamed sysvar_keycode to sysvar_keyascii, added sysvar_vkeycode
04005C             0019*   ; 15/03/2023:	Added mos_copy, mos_getrtc, mos_setrtc, rtc, vdp_pflag_rtc
04005C             0020*   ; 21/03/2023:	Added mos_setintvector, sysvars for keyboard status, vdu codes for vdp
04005C             0021*   ; 22/03/2023:	The VDP commands are now indexed from 0x80
04005C             0022*   ; 29/03/2023:	Added mos_uopen, mos_uclose, mos_ugetc, mos_uputc
04005C             0023*   ; 13/04/2023:	Added FatFS file structures (FFOBJID, FIL, DIR, FILINFO)
04005C             0024*   ; 15/04/2023:	Added mos_getfil, mos_fread, mos_fwrite and mos_flseek
04005C             0025*   ; 19/05/2023:	Added sysvar_scrMode
04005C             0026*   ; 05/06/2023:	Added sysvar_rtcEnable
04005C             0027*   ; 03/08/2023:	Added mos_setkbvector
04005C             0028*   ; 10/08/2023:	Added mos_getkbmap
04005C             0029*   
04005C             0030*   ; VDP control (VDU 23, 0, n)
04005C             0031*   ;
04005C             0032*   vdp_gp:				EQU 80h
04005C             0033*   vdp_keycode:		EQU 81h
04005C             0034*   vdp_cursor:			EQU	82h
04005C             0035*   vdp_scrchar:		EQU	83h
04005C             0036*   vdp_scrpixel:		EQU	84h
04005C             0037*   vdp_audio:			EQU	85h
04005C             0038*   vdp_mode:			EQU	86h
04005C             0039*   vdp_rtc:			EQU	87h
04005C             0040*   vdp_keystate:		EQU	88h
04005C             0041*   vdp_logicalcoords:	EQU	C0h
04005C             0042*   vdp_terminalmode:	EQU	FFh
04005C             0043*   
04005C             0044*   ; MOS high level functions
04005C             0045*   ;
04005C             0046*   mos_getkey:			EQU	00h
04005C             0047*   mos_load:			EQU	01h
04005C             0048*   mos_save:			EQU	02h
04005C             0049*   mos_cd:				EQU	03h
04005C             0050*   mos_dir:			EQU	04h
04005C             0051*   mos_del:			EQU	05h
04005C             0052*   mos_ren:			EQU	06h
04005C             0053*   mos_mkdir:			EQU	07h
04005C             0054*   mos_sysvars:		EQU	08h
04005C             0055*   mos_editline:		EQU	09h
04005C             0056*   mos_fopen:			EQU	0Ah
04005C             0057*   mos_fclose:			EQU	0Bh
04005C             0058*   mos_fgetc:			EQU	0Ch
04005C             0059*   mos_fputc:			EQU	0Dh
04005C             0060*   mos_feof:			EQU	0Eh
04005C             0061*   mos_getError:		EQU	0Fh
04005C             0062*   mos_oscli:			EQU	10h
04005C             0063*   mos_copy:			EQU	11h
04005C             0064*   mos_getrtc:			EQU	12h
04005C             0065*   mos_setrtc:			EQU	13h
04005C             0066*   mos_setintvector:	EQU	14h
04005C             0067*   mos_uopen:			EQU	15h
04005C             0068*   mos_uclose:			EQU	16h
04005C             0069*   mos_ugetc:			EQU	17h
04005C             0070*   mos_uputc:			EQU	18h
04005C             0071*   mos_getfil:			EQU	19h
04005C             0072*   mos_fread:			EQU	1Ah
04005C             0073*   mos_fwrite:			EQU	1Bh
04005C             0074*   mos_flseek:			EQU	1Ch
04005C             0075*   mos_setkbvector:	EQU	1Dh
04005C             0076*   mos_getkbmap:		EQU	1Eh
04005C             0077*   
04005C             0078*   ; MOS program exit codes
04005C             0079*   ;
04005C             0080*   EXIT_OK:				EQU  0;	"OK",
04005C             0081*   EXIT_ERROR_SD_ACCESS:	EQU	 1;	"Error accessing SD card",
04005C             0082*   EXIT_ERROR_ASSERTION:	EQU  2;	"Assertion failed",
04005C             0083*   EXIT_SD_CARDFAILURE:	EQU  3;	"SD card failure",
04005C             0084*   EXIT_FILENOTFOUND:		EQU  4;	"Could not find file",
04005C             0085*   EXIT_PATHNOTFOUND:		EQU  5;	"Could not find path",
04005C             0086*   EXIT_INVALIDPATHNAME:	EQU  6;	"Invalid path name",
04005C             0087*   EXIT_ACCESSDENIED_FULL:	EQU  7;	"Access denied or directory full",
04005C             0088*   EXIT_ACCESSDENIED:		EQU  8;	"Access denied",
04005C             0089*   EXIT_INVALIDOBJECT:		EQU  9;	"Invalid file/directory object",
04005C             0090*   EXIT_SD_WRITEPROTECTED:	EQU 10;	"SD card is write protected",
04005C             0091*   EXIT_INVALIDDRIVENUMBER:EQU 11;	"Logical drive number is invalid",
04005C             0092*   EXIT_NOVOLUMEWORKAREA:	EQU 12;	"Volume has no work area",
04005C             0093*   EXIT_NOVALIDFATVOLUME:	EQU 13;	"No valid FAT volume",
04005C             0094*   EXIT_ERRORMKFS:			EQU 14;	"Error occurred during mkfs",
04005C             0095*   EXIT_VOLUMETIMEOUT:		EQU 15;	"Volume timeout",
04005C             0096*   EXIT_VOLUMELOCKED:		EQU 16;	"Volume locked",
04005C             0097*   EXIT_LFNALLOCATION:		EQU 17;	"LFN working buffer could not be allocated",
04005C             0098*   EXIT_MAXOPENFILES:		EQU 18;	"Too many open files",
04005C             0099*   EXIT_INVALIDPARAMETER:	EQU 19;	"Invalid parameter",
04005C             0100*   EXIT_INVALIDCOMMAND:	EQU 20;	"Invalid command",
04005C             0101*   EXIT_INVALIDEXECUTABLE:	EQU 21;	"Invalid executable",
04005C             0102*   ; FatFS file access functions
04005C             0103*   ;
04005C             0104*   ffs_fopen:			EQU	80h
04005C             0105*   ffs_fclose:			EQU	81h
04005C             0106*   ffs_fread:			EQU	82h
04005C             0107*   ffs_fwrite:			EQU	83h
04005C             0108*   ffs_flseek:			EQU	84h
04005C             0109*   ffs_ftruncate:		EQU	85h
04005C             0110*   ffs_fsync:			EQU	86h
04005C             0111*   ffs_fforward:		EQU	87h
04005C             0112*   ffs_fexpand:		EQU	88h
04005C             0113*   ffs_fgets:			EQU	89h
04005C             0114*   ffs_fputc:			EQU	8Ah
04005C             0115*   ffs_fputs:			EQU	8Bh
04005C             0116*   ffs_fprintf:		EQU	8Ch
04005C             0117*   ffs_ftell:			EQU	8Dh
04005C             0118*   ffs_feof:			EQU	8Eh
04005C             0119*   ffs_fsize:			EQU	8Fh
04005C             0120*   ffs_ferror:			EQU	90h
04005C             0121*   
04005C             0122*   ; FatFS directory access functions
04005C             0123*   ;
04005C             0124*   ffs_dopen:			EQU	91h
04005C             0125*   ffs_dclose:			EQU	92h
04005C             0126*   ffs_dread:			EQU	93h
04005C             0127*   ffs_dfindfirst:		EQU	94h
04005C             0128*   ffs_dfindnext:		EQU	95h
04005C             0129*   
04005C             0130*   ; FatFS file and directory management functions
04005C             0131*   ;
04005C             0132*   ffs_stat:			EQU	96h
04005C             0133*   ffs_unlink:			EQU	97h
04005C             0134*   ffs_rename:			EQU	98h
04005C             0135*   ffs_chmod:			EQU	99h
04005C             0136*   ffs_utime:			EQU	9Ah
04005C             0137*   ffs_mkdir:			EQU	9Bh
04005C             0138*   ffs_chdir:			EQU	9Ch
04005C             0139*   ffs_chdrive:		EQU	9Dh
04005C             0140*   ffs_getcwd:			EQU	9Eh
04005C             0141*   
04005C             0142*   ; FatFS volume management and system configuration functions
04005C             0143*   ;
04005C             0144*   ffs_mount:			EQU	9Fh
04005C             0145*   ffs_mkfs:			EQU	A0h
04005C             0146*   ffs_fdisk:			EQU	A1h
04005C             0147*   ffs_getfree:		EQU	A2h
04005C             0148*   ffs_getlabel:		EQU	A3h
04005C             0149*   ffs_setlabel:		EQU	A4h
04005C             0150*   ffs_setcp:			EQU	A5h
04005C             0151*   
04005C             0152*   ; File access modes
04005C             0153*   ;
04005C             0154*   fa_read:			EQU	01h
04005C             0155*   fa_write:			EQU	02h
04005C             0156*   fa_open_existing:	EQU	00h
04005C             0157*   fa_create_new:		EQU	04h
04005C             0158*   fa_create_always:	EQU	08h
04005C             0159*   fa_open_always:		EQU	10h
04005C             0160*   fa_open_append:		EQU	30h
04005C             0161*   
04005C             0162*   ; System variable indexes for api_sysvars
04005C             0163*   ; Index into _sysvars in globals.inc
04005C             0164*   ;
04005C             0165*   sysvar_time:			EQU	00h	; 4: Clock timer in centiseconds (incremented by 2 every VBLANK)
04005C             0166*   sysvar_vpd_pflags:		EQU	04h	; 1: Flags to indicate completion of VDP commands
04005C             0167*   sysvar_keyascii:		EQU	05h	; 1: ASCII keycode, or 0 if no key is pressed
04005C             0168*   sysvar_keymods:			EQU	06h	; 1: Keycode modifiers
04005C             0169*   sysvar_cursorX:			EQU	07h	; 1: Cursor X position
04005C             0170*   sysvar_cursorY:			EQU	08h	; 1: Cursor Y position
04005C             0171*   sysvar_scrchar:			EQU	09h	; 1: Character read from screen
04005C             0172*   sysvar_scrpixel:		EQU	0Ah	; 3: Pixel data read from screen (R,B,G)
04005C             0173*   sysvar_audioChannel:	EQU	0Dh	; 1: Audio channel
04005C             0174*   sysvar_audioSuccess:	EQU	0Eh	; 1: Audio channel note queued (0 = no, 1 = yes)
04005C             0175*   sysvar_scrWidth:		EQU	0Fh	; 2: Screen width in pixels
04005C             0176*   sysvar_scrHeight:		EQU	11h	; 2: Screen height in pixels
04005C             0177*   sysvar_scrCols:			EQU	13h	; 1: Screen columns in characters
04005C             0178*   sysvar_scrRows:			EQU	14h	; 1: Screen rows in characters
04005C             0179*   sysvar_scrColours:		EQU	15h	; 1: Number of colours displayed
04005C             0180*   sysvar_scrpixelIndex:	EQU	16h	; 1: Index of pixel data read from screen
04005C             0181*   sysvar_vkeycode:		EQU	17h	; 1: Virtual key code from FabGL
04005C             0182*   sysvar_vkeydown:		EQU	18h	; 1: Virtual key state from FabGL (0=up, 1=down)
04005C             0183*   sysvar_vkeycount:		EQU	19h	; 1: Incremented every time a key packet is received
04005C             0184*   sysvar_rtc:				EQU	1Ah	; 6: Real time clock data
04005C             0185*   sysvar_spare:			EQU	20h	; 2: Spare, previously used by rtc
04005C             0186*   sysvar_keydelay:		EQU	22h	; 2: Keyboard repeat delay
04005C             0187*   sysvar_keyrate:			EQU	24h	; 2: Keyboard repeat reat
04005C             0188*   sysvar_keyled:			EQU	26h	; 1: Keyboard LED status
04005C             0189*   sysvar_scrMode:			EQU	27h	; 1: Screen mode
04005C             0190*   sysvar_rtcEnable:		EQU	28h	; 1: RTC enable flag (0: disabled, 1: use ESP32 RTC)
04005C             0191*   
04005C             0192*   ; Flags for the VPD protocol
04005C             0193*   ;
04005C             0194*   vdp_pflag_cursor:		EQU	00000001b
04005C             0195*   vdp_pflag_scrchar:		EQU	00000010b
04005C             0196*   vdp_pflag_point:		EQU	00000100b
04005C             0197*   vdp_pflag_audio:		EQU	00001000b
04005C             0198*   vdp_pflag_mode:			EQU	00010000b
04005C             0199*   vdp_pflag_rtc:			EQU	00100000b
04005C             0200*   
04005C             0201*   ;
04005C             0202*   ; FatFS structures
04005C             0203*   ; These mirror the structures contained in src_fatfs/ff.h in the MOS project
04005C             0204*   ;
04005C             0205*   ; Object ID and allocation information (FFOBJID)
04005C             0206*   ;
04005C             0207*   ; Indexes into FFOBJID structure
04005C             0208*   ffobjid_fs:			EQU	0	; 3: Pointer to the hosting volume of this object
04005C             0209*   ffobjid_id:			EQU	3	; 2: Hosting volume mount ID
04005C             0210*   ffobjid_attr:		EQU	5	; 1: Object attribute
04005C             0211*   ffobjid_stat:		EQU	6	; 1: Object chain status (b1-0: =0:not contiguous, =2:contiguous, =3:fragmented in this session, b2:sub-directory stretched)
04005C             0212*   ffobjid_sclust:		EQU	7	; 4: Object data start cluster (0:no cluster or root directory)
04005C             0213*   ffobjid_objsize:	EQU	11	; 4: Object size (valid when sclust != 0)
04005C             0214*   ;
04005C             0215*   ; File object structure (FIL)
04005C             0216*   ;
04005C             0217*   ; Indexes into FIL structure
04005C             0218*   fil_obj:		EQU 0	; 15: Object identifier
04005C             0219*   fil_flag:		EQU	15 	;  1: File status flags
04005C             0220*   fil_err:		EQU	16	;  1: Abort flag (error code)
04005C             0221*   fil_fptr:		EQU	17	;  4: File read/write pointer (Zeroed on file open)
04005C             0222*   fil_clust:		EQU	21	;  4: Current cluster of fpter (invalid when fptr is 0)
04005C             0223*   fil_sect:		EQU	25	;  4: Sector number appearing in buf[] (0:invalid)
04005C             0224*   fil_dir_sect:	EQU	29	;  4: Sector number containing the directory entry
04005C             0225*   fil_dir_ptr:	EQU	33	;  3: Pointer to the directory entry in the win[]
04005C             0226*   ;
04005C             0227*   ; Directory object structure (DIR)
04005C             0228*   ; Indexes into DIR structure
04005C             0229*   dir_obj:		EQU  0	; 15: Object identifier
04005C             0230*   dir_dptr:		EQU	15	;  4: Current read/write offset
04005C             0231*   dir_clust:		EQU	19	;  4: Current cluster
04005C             0232*   dir_sect:		EQU	23	;  4: Current sector (0:Read operation has terminated)
04005C             0233*   dir_dir:		EQU	27	;  3: Pointer to the directory item in the win[]
04005C             0234*   dir_fn:			EQU	30	; 12: SFN (in/out) {body[8],ext[3],status[1]}
04005C             0235*   dir_blk_ofs:	EQU	42	;  4: Offset of current entry block being processed (0xFFFFFFFF:Invalid)
04005C             0236*   ;
04005C             0237*   ; File information structure (FILINFO)
04005C             0238*   ;
04005C             0239*   ; Indexes into FILINFO structure
04005C             0240*   filinfo_fsize:		EQU 0	;   4: File size
04005C             0241*   filinfo_fdate:		EQU	4	;   2: Modified date
04005C             0242*   filinfo_ftime:		EQU	6	;   2: Modified time
04005C             0243*   filinfo_fattrib:	EQU	8	;   1: File attribute
04005C             0244*   filinfo_altname:	EQU	9	;  13: Alternative file name
04005C             0245*   filinfo_fname:		EQU	22	; 256: Primary file name
04005C             0246*   ;
04005C             0247*   ; Macro for calling the API
04005C             0248*   ; Parameters:
04005C             0249*   ; - function: One of the function numbers listed above
04005C             0250*   ;
04005C             0251*   	MACRO	MOSCALL	function
04005C             0252*   			LD	A, function
04005C             0253*   			RST.LIL	08h
04005C             0254*   	ENDMACRO
04005C             0030        include "macros.inc"
04005C             0001*   
04005C             0002*   ; test the sign of HL
04005C             0003*   ; inputs: HL obviously
04005C             0004*   ; outputs: sign flag set if HL is negative, zero flag set if HL is zero
04005C             0005*   ; destroys: flags
04005C             0006*       MACRO SIGN_HLU
04005C             0007*       add hl,de ; 1 cycle
04005C             0008*       or a ; clear flags ; 1 cycle
04005C             0009*       sbc hl,de ; 2 cycles
04005C             0010*       ; 4 cycles total
04005C             0011*       ENDMACRO
04005C             0012*   
04005C             0013*   ; put the value in A into HLU
04005C             0014*   ; affects: HLU
04005C             0015*   ; destroys: nothing
04005C             0016*   ; note: $ instead of @@ b/c anon labels deprecated in ez80asm
04005C             0017*       MACRO A_TO_HLU
04005C             0018*       xor a ; 1 cycle
04005C             0019*       ld ($+8+1),hl ; 7 cycles
04005C             0020*       ld ($+4+3),a ; 5 cycles
04005C             0021*       ld hl,0x000000 ; 4 cycles
04005C             0022*       ; 17 cycles total
04005C             0023*       ENDMACRO
04005C             0024*   
04005C             0025*   ; alternative: https://discord.com/channels/1158535358624039014/1282290921815408681/1318315567102300220
04005C             0026*   ; one cycle less but burns flags
04005C             0027*       MACRO A_TO_HLU_ALT
04005C             0028*       push hl ; 4 cycles
04005C             0029*       ld hl,2 ; 4 cycles
04005C             0030*       add hl,sp ; 1 cycle
04005C             0031*       ld (hl),a ; 2 cycles
04005C             0032*       pop hl ; 4 cycles
04005C             0033*       ; 15 cycles total
04005C             0034*       ENDMACRO
04005C             0035*   
04005C             0036*       MACRO hlu_mul256
04005C             0037*       add hl,hl ; * 2
04005C             0038*       add hl,hl ; * 4
04005C             0039*       add hl,hl ; * 8
04005C             0040*       add hl,hl ; * 16
04005C             0041*       add hl,hl ; * 32
04005C             0042*       add hl,hl ; * 64
04005C             0043*       add hl,hl ; * 128
04005C             0044*       add hl,hl ; * 256
04005C             0045*       ENDMACRO
04005C             0046*   
04005C             0047*   ; https://discord.com/channels/1158535358624039014/1282290921815408681/1317793870070812715
04005C             0048*       MACRO SRL_UHL
04005C             0049*       dec sp ; 1 cycle
04005C             0050*       push hl ; 4 cycles
04005C             0051*       inc sp ; 1 cycle
04005C             0052*       pop hl ; 4 cycles
04005C             0053*       inc hl ; 1 cycle
04005C             0054*       dec.s hl ; 2 cycles <-- the .s sets hlu to zero (undocumented)
04005C             0055*       ; 13 cycles total
04005C             0056*       ENDMACRO
04005C             0057*   
04005C             0058*       MACRO printChar char
04005C             0059*       LD A, char
04005C             0060*       RST.LIL 10h
04005C             0061*       ENDMACRO
04005C             0062*   
04005C             0063*   ; Simulated call to subroutine at HL
04005C             0064*   ; inputs: HL pointing to the subroutine address plus whatever the called function expects
04005C             0065*   ; outputs: whatever the subroutine does, including HL and BC
04005C             0066*   ; destroys: only what the subroutine does, but always BC
04005C             0067*       MACRO CALL_HL
04005C             0068*       ld bc,$+6 ; Address of first instruction after the jump
04005C             0069*       push bc ; which constitutes the return address
04005C             0070*       jp (hl) ; Jump to the address in HL
04005C             0071*       ENDMACRO
04005C             0072*   
04005C             0073*   ; Simulated call to subroutine at IX
04005C             0074*   ; inputs: IX pointing to the subroutine address plus whatever the called function expects
04005C             0075*   ; outputs: whatever the subroutine does, including IX and BC
04005C             0076*   ; destroys: only what the subroutine does, but always BC
04005C             0077*       MACRO CALL_IX
04005C             0078*       ld bc,$+6 ; Address of first instruction after the jump
04005C             0079*       push bc ; which constitutes the return address
04005C             0080*       jp (ix) ; Jump to the address in IX
04005C             0081*       ENDMACRO
04005C             0082*   
04005C             0083*   ; Simulated call to soubroutinte at IY
04005C             0084*   ; inputs: IY pointing to the subroutine address plus whatever the called function expects
04005C             0085*   ; outputs: whatever the subroutine does, including IY and BC
04005C             0086*   ; destroys: only what the subroutine does, but always BC
04005C             0087*       MACRO CALL_IY
04005C             0088*       ld bc,$+6 ; Address of first instruction after the jump
04005C             0089*       push bc ; which constitutes the return address
04005C             0090*       jp (iy) ; Jump to the address in IY
04005C             0091*       ENDMACRO
04005C             0092*   
04005C             0093*   ; put the value in HLU into A
04005C             0094*   ; destroys: af
04005C             0095*       MACRO HLU_TO_A
04005C             0096*       dec sp ; 1 cycle
04005C             0097*       push hl ; 4 cycles
04005C             0098*       inc sp ; 1 cycle
04005C             0099*       pop af ; 4 cycles
04005C             0100*       ; 10 cycles total
04005C             0101*       ENDMACRO
04005C             0102*   
04005C             0103*       MACRO PUSH_ALL
04005C             0104*       ex af,af'
04005C             0105*       exx
04005C             0106*       push af
04005C             0107*       push hl
04005C             0108*       push bc
04005C             0109*       push de
04005C             0110*   
04005C             0111*       ex af,af'
04005C             0112*       exx
04005C             0113*       push af
04005C             0114*       push hl
04005C             0115*       push bc
04005C             0116*       push de
04005C             0117*       push ix
04005C             0118*       push iy
04005C             0119*       ENDMACRO
04005C             0120*   
04005C             0121*       MACRO POP_ALL
04005C             0122*       pop iy
04005C             0123*       pop ix
04005C             0124*       pop de
04005C             0125*       pop bc
04005C             0126*       pop hl
04005C             0127*       pop af
04005C             0128*       ex af,af'
04005C             0129*       exx
04005C             0130*   
04005C             0131*       pop de
04005C             0132*       pop bc
04005C             0133*       pop hl
04005C             0134*       pop af
04005C             0135*       ex af,af'
04005C             0136*       exx
04005C             0137*       ENDMACRO
04005C             0031        include "functions.inc"
04005C FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
040100             0002*   
040100             0003*   ; Print a zero-terminated string inline with code, e.g.:
040100             0004*   ;
040100             0005*   ;    call printInline
040100             0006*   ;    ASCIZ "Hello, world!\r\n"
040100             0007*   ;
040100             0008*   ; Destroys: HL,AF
040100             0009*   printInline:
040100 E1          0010*       pop hl ; get the return address = pointer to start of string
040101 CD 07 01 04 0011*       call printString ; HL advances to end of string
040105 E5          0012*       push hl ; restore the return address = pointer to end of string
040106 C9          0013*       ret
040107             0014*   
040107             0015*   ; https://github.com/envenomator/Agon/blob/master/ez80asm%20examples%20(annotated)/functions.s
040107             0016*   ; Print a zero-terminated string
040107             0017*   ; HL: Pointer to string
040107             0018*   printString:
040107 C5          0019*       PUSH BC
040108 01 00 00 00 0020*       LD BC,0
04010C 3E 00       0021*       LD A,0
04010E 5B DF       0022*       RST.LIL 18h
040110 C1          0023*       POP BC
040111 C9          0024*       RET
040112             0025*   ; print a VDU sequence
040112             0026*   ; HL: Pointer to VDU sequence - <1 byte length> <data>
040112             0027*   sendVDUsequence:
040112 C5          0028*       PUSH BC
040113 01 00 00 00 0029*       LD BC, 0
040117 4E          0030*       LD C, (HL)
040118 5B DF       0031*       RST.LIL 18h
04011A C1          0032*       POP BC
04011B C9          0033*       RET
04011C             0034*   ; Print Newline sequence to VDP
04011C             0035*   ; destroys bc
04011C             0036*   printNewLine:
04011C F5          0037*       push af ; for some reason rst.lil 10h sets carry flag
04011D 3E 0D       0038*       LD A, '\r'
04011F 5B D7       0039*       RST.LIL 10h
040121 3E 0A       0040*       LD A, '\n'
040123 5B D7       0041*       RST.LIL 10h
040125 F1          0042*       pop af
040126 C9          0043*       RET
040127             0044*   
040127             0045*   ; Print a 24-bit HEX number
040127             0046*   ; HLU: Number to print
040127             0047*   printHex24:
040127             0048*       HLU_TO_A
040127 3B          0001*M1     dec sp ; 1 cycle
040128 E5          0002*M1     push hl ; 4 cycles
040129 33          0003*M1     inc sp ; 1 cycle
04012A F1          0004*M1     pop af ; 4 cycles
04012B             0005*M1     ; 10 cycles total
04012B CD 35 01 04 0049*       CALL printHex8
04012F             0050*   ; Print a 16-bit HEX number
04012F             0051*   ; HL: Number to print
04012F             0052*   printHex16:
04012F 7C          0053*       LD A,H
040130 CD 35 01 04 0054*       CALL printHex8
040134 7D          0055*       LD A,L
040135             0056*   ; Print an 8-bit HEX number
040135             0057*   ; A: Number to print
040135             0058*   printHex8:
040135 4F          0059*       LD C,A
040136 1F          0060*       RRA
040137 1F          0061*       RRA
040138 1F          0062*       RRA
040139 1F          0063*       RRA
04013A CD 3F 01 04 0064*       CALL @F
04013E 79          0065*       LD A,C
04013F             0066*   @@:
04013F E6 0F       0067*       AND 0Fh
040141 C6 90       0068*       ADD A,90h
040143 27          0069*       DAA
040144 CE 40       0070*       ADC A,40h
040146 27          0071*       DAA
040147 5B D7       0072*       RST.LIL 10h
040149 C9          0073*       RET
04014A             0074*   
04014A             0075*   ; Print a 0x HEX prefix
04014A             0076*   DisplayHexPrefix:
04014A 3E 30       0077*       LD A, '0'
04014C 5B D7       0078*       RST.LIL 10h
04014E 3E 78       0079*       LD A, 'x'
040150 5B D7       0080*       RST.LIL 10h
040152 C9          0081*       RET
040153             0082*   
040153             0083*       MACRO printDecBC
040153             0084*       push hl
040153             0085*       push bc
040153             0086*       pop hl
040153             0087*       call printDec
040153             0088*       pop hl
040153             0089*       ENDMACRO
040153             0090*   
040153             0091*       MACRO printDecDE
040153             0092*       push hl
040153             0093*       push de
040153             0094*       pop hl
040153             0095*       call printDec
040153             0096*       pop hl
040153             0097*       ENDMACRO
040153             0098*   
040153             0099*       MACRO printDecHL
040153             0100*       call printDec
040153             0101*       ENDMACRO
040153             0102*   
040153             0103*       MACRO printDecIX
040153             0104*       push hl
040153             0105*       push ix
040153             0106*       pop hl
040153             0107*       call printDec
040153             0108*       pop hl
040153             0109*       ENDMACRO
040153             0110*   
040153             0111*       MACRO printDecIY
040153             0112*       push hl
040153             0113*       push iy
040153             0114*       pop hl
040153             0115*       call printDec
040153             0116*       pop hl
040153             0117*       ENDMACRO
040153             0118*   
040153             0119*   
040153             0120*   ; Prints the right justified decimal value in HL without leading zeroes
040153             0121*   ; HL : Value to print
040153             0122*   ; preserves all registers and flags
040153             0123*   printDec:
040153             0124*   ; BEGIN MY CODE
040153             0125*   ; back up all the things
040153 F5          0126*       push af
040154 C5          0127*       push bc
040155 D5          0128*       push de
040156 E5          0129*       push hl
040157             0130*   ; END MY CODE
040157 11 7F 01 04 0131*       LD DE, _printDecBuffer
04015B CD 8F 01 04 0132*       CALL u24_to_ascii
04015F             0133*   ; BEGIN MY CODE
04015F             0134*   ; replace leading zeroes with spaces
04015F 21 7F 01 04 0135*       LD HL, _printDecBuffer
040163 06 07       0136*       ld B, 7 ; if HL was 0, we want to keep the final zero
040165             0137*   @loop:
040165 7E          0138*       LD A, (HL)
040166 FE 30       0139*       CP '0'
040168 C2 72 01 04 0140*       JP NZ, @done
04016C 3E 20       0141*       LD A, ' '
04016E 77          0142*       LD (HL), A
04016F 23          0143*       INC HL
040170             0144*       ; CALL vdu_cursor_forward
040170 10 F3       0145*       DJNZ @loop
040172             0146*   @done:
040172             0147*   ; END MY CODE
040172 21 7F 01 04 0148*       LD HL, _printDecBuffer
040176 CD 07 01 04 0149*       CALL printString
04017A             0150*   ; BEGIN MY CODE
04017A             0151*   ; restore all the things
04017A E1          0152*       pop hl
04017B D1          0153*       pop de
04017C C1          0154*       pop bc
04017D F1          0155*       pop af
04017E             0156*   ; END MY CODE
04017E C9          0157*       RET
04017F 00 00 00 00 0158*   _printDecBuffer: blkb 16,0 ; a few bytes extra just to be sure
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
04018F             0159*   
04018F             0160*   ; This routine converts the unsigned 24-bit value in HLU into its ASCII representation,
04018F             0161*   ; starting to memory location pointing by DE, in decimal form and with leading zeroes
04018F             0162*   ; so it will allways be 8 characters length
04018F             0163*   ; HL : Value to convert to string
04018F             0164*   ; DE : pointer to buffer, at least 8 byte + 0
04018F             0165*   u24_to_ascii:
04018F 01 80 69 67 0166*       LD BC,-10000000
040193 CD C6 01 04 0167*       CALL @one_digit
040197 01 C0 BD F0 0168*       LD BC,-1000000
04019B CD C6 01 04 0169*       CALL @one_digit
04019F 01 60 79 FE 0170*       LD BC,-100000
0401A3 CD C6 01 04 0171*       CALL @one_digit
0401A7 01 F0 D8 FF 0172*       LD BC,-10000
0401AB CD C6 01 04 0173*       CALL @one_digit
0401AF 01 18 FC FF 0174*       LD BC,-1000
0401B3 CD C6 01 04 0175*       CALL @one_digit
0401B7 01 9C FF FF 0176*       LD BC,-100
0401BB CD C6 01 04 0177*       CALL @one_digit
0401BF 0E F6       0178*       LD C,-10
0401C1 CD C6 01 04 0179*       CALL @one_digit
0401C5 48          0180*       LD C,B
0401C6             0181*   @one_digit:
0401C6 3E 2F       0182*       LD A,'0'-1
0401C8             0183*   @divide_me:
0401C8 3C          0184*       INC A
0401C9 09          0185*       ADD HL,BC
0401CA 38 FC       0186*       JR C,@divide_me
0401CC ED 42       0187*       SBC HL,BC
0401CE 12          0188*       LD (DE),A
0401CF 13          0189*       INC DE
0401D0 C9          0190*       RET
0401D1             0191*   
0401D1             0192*   print_u24:
0401D1 D5          0193*       push de
0401D2 E5          0194*       push hl
0401D3 11 7F 01 04 0195*       ld de,_printDecBuffer
0401D7 CD 8F 01 04 0196*       call u24_to_ascii
0401DB 21 7F 01 04 0197*       ld hl,_printDecBuffer
0401DF CD 07 01 04 0198*       call printString
0401E3 3E 20       0199*       ld a,' '
0401E5 5B D7       0200*       rst.lil 10h
0401E7 E1          0201*       pop hl
0401E8 D1          0202*       pop de
0401E9 C9          0203*       ret
0401EA             0204*   
0401EA             0205*   ; u168_to_ascii: Converts an unsigned 16.8 fixed-point value in HL to an ASCII string.
0401EA             0206*   ; HL : Value to convert to string (integer part in H, fractional part in L)
0401EA             0207*   ; DE : Pointer to buffer, requires at least 11 bytes (8 digits, sign, decimal point, and null terminator)
0401EA             0208*   u168_to_ascii:
0401EA             0209*   ; add a leading space to make room for sign flag if needed
0401EA 3E 20       0210*       ld a,' '
0401EC 12          0211*       ld (de),a
0401ED 13          0212*       inc de
0401EE             0213*   ; Convert integer part
0401EE E5          0214*       push hl ; Save HL (weâ€™ll need the fractional part later)
0401EF             0215*       ; call hlu_udiv256 ; Shift to get integer portion in HL
0401EF             0216*       SRL_UHL ; Shift to get integer portion in HL
0401EF 3B          0001*M1     dec sp ; 1 cycle
0401F0 E5          0002*M1     push hl ; 4 cycles
0401F1 33          0003*M1     inc sp ; 1 cycle
0401F2 E1          0004*M1     pop hl ; 4 cycles
0401F3 23          0005*M1     inc hl ; 1 cycle
0401F4 52 2B       0006*M1     dec.s hl ; 2 cycles <-- the .s sets hlu to zero (undocumented)
0401F6             0007*M1     ; 13 cycles total
0401F6 01 F0 D8 FF 0217*       ld bc, -10000
0401FA CD 1D 02 04 0218*       call @one_int
0401FE 01 18 FC FF 0219*       ld bc, -1000
040202 CD 1D 02 04 0220*       call @one_int
040206 01 9C FF FF 0221*       ld bc, -100
04020A CD 1D 02 04 0222*       call @one_int
04020E 0E F6       0223*       ld c, -10
040210 CD 1D 02 04 0224*       call @one_int
040214 48          0225*       ld c, b
040215 CD 1D 02 04 0226*       call @one_int
040219 C3 28 02 04 0227*       jp @frac ; Jump to fractional part conversion
04021D             0228*   @one_int:
04021D 3E 2F       0229*       ld a, '0' - 1 ; Start ASCII character at '0'
04021F             0230*   @divide_me:
04021F 3C          0231*       inc a
040220 09          0232*       add hl, bc ; Accumulate until overflow
040221 38 FC       0233*       jr c, @divide_me
040223 ED 42       0234*       sbc hl, bc ; Remove excess after overflow
040225 12          0235*       ld (de), a ; Store ASCII digit
040226 13          0236*       inc de
040227 C9          0237*       ret
040228             0238*   ; Convert fractional part
040228             0239*   @frac:
040228 3E 2E       0240*       ld a, '.' ; Decimal point
04022A 12          0241*       ld (de), a
04022B 13          0242*       inc de
04022C E1          0243*       pop hl ; Restore HL with original fraction
04022D 06 03       0244*       ld b, 3 ; Loop counter for 3 fractional digits
04022F             0245*   @frac_loop:
04022F 26 0A       0246*       ld h, 10 ; Load multiplier for fractional part
040231 ED 6C       0247*       mlt hl ; Multiply by 10, result in HL (H holds the integer part)
040233 3E 30       0248*       ld a, '0'
040235 84          0249*       add a, h ; Convert integer part to ASCII
040236 12          0250*       ld (de), a
040237 13          0251*       inc de
040238 10 F5       0252*       djnz @frac_loop ; Repeat for each fractional digit
04023A             0253*   ; Add null terminator
04023A AF          0254*       xor a ; Null terminator
04023B 12          0255*       ld (de), a
04023C C9          0256*       ret
04023D             0257*   
04023D             0258*   print_u168:
04023D D5          0259*       push de
04023E E5          0260*       push hl
04023F 11 7F 01 04 0261*       ld de,_printDecBuffer
040243 CD EA 01 04 0262*       call u168_to_ascii
040247 21 7F 01 04 0263*       ld hl,_printDecBuffer
04024B CD 07 01 04 0264*       call printString
04024F E1          0265*       pop hl
040250 D1          0266*       pop de
040251 C9          0267*       ret
040252             0268*   
040252             0269*   ; signed version of u168_to_ascii
040252             0270*   s168_to_ascii:
040252 D5          0271*       push de ; save starting address of buffer
040253 CD 06 05 04 0272*       call hlu_abs
040257 F5          0273*       push af ; save sign flag
040258 CD EA 01 04 0274*       call u168_to_ascii
04025C F1          0275*       pop af ; restore sign flag
04025D D1          0276*       pop de ; restore starting address of buffer
04025E F0          0277*       ret p ; hlu was positive so nothing to do
04025F 3E 2D       0278*       ld a,'-'
040261 12          0279*       ld (de),a
040262 C9          0280*       ret
040263             0281*   
040263             0282*   print_s168:
040263 D5          0283*       push de
040264 E5          0284*       push hl
040265 11 7F 01 04 0285*       ld de,_printDecBuffer
040269 CD 52 02 04 0286*       call s168_to_ascii
04026D 21 7F 01 04 0287*       ld hl,_printDecBuffer
040271 CD 07 01 04 0288*       call printString
040275 E1          0289*       pop hl
040276 D1          0290*       pop de
040277 C9          0291*       ret
040278             0292*   
040278             0293*   print_s168_hl:
040278 F5          0294*       push af
040279 E5          0295*       push hl
04027A CD 63 02 04 0296*       call print_s168
04027E 3E 20       0297*       ld a,' '
040280 5B D7       0298*       rst.lil 10h
040282 E1          0299*       pop hl
040283 F1          0300*       pop af
040284 C9          0301*       ret
040285             0302*   
040285             0303*   print_s168_bc:
040285 F5          0304*       push af
040286 C5          0305*       push bc
040287 E5          0306*       push hl
040288 C5          0307*       push bc
040289 E1          0308*       pop hl
04028A CD 63 02 04 0309*       call print_s168
04028E 3E 20       0310*       ld a,' '
040290 5B D7       0311*       rst.lil 10h
040292 E1          0312*       pop hl
040293 C1          0313*       pop bc
040294 F1          0314*       pop af
040295 C9          0315*       ret
040296             0316*   
040296             0317*   print_s168_de:
040296 F5          0318*       push af
040297 D5          0319*       push de
040298 E5          0320*       push hl
040299 EB          0321*       ex de,hl
04029A CD 63 02 04 0322*       call print_s168
04029E 3E 20       0323*       ld a,' '
0402A0 5B D7       0324*       rst.lil 10h
0402A2 E1          0325*       pop hl
0402A3 D1          0326*       pop de
0402A4 F1          0327*       pop af
0402A5 C9          0328*       ret
0402A6             0329*   
0402A6             0330*   print_s168_hl_bc_de:
0402A6 F5          0331*       push af
0402A7 C5          0332*       push bc
0402A8 D5          0333*       push de
0402A9 E5          0334*       push hl
0402AA CD 63 02 04 0335*       call print_s168
0402AE 3E 20       0336*       ld a,' '
0402B0 5B D7       0337*       rst.lil 10h
0402B2 C5          0338*       push bc
0402B3 E1          0339*       pop hl
0402B4 CD 63 02 04 0340*       call print_s168
0402B8 3E 20       0341*       ld a,' '
0402BA 5B D7       0342*       rst.lil 10h
0402BC EB          0343*       ex de,hl
0402BD CD 63 02 04 0344*       call print_s168
0402C1 3E 20       0345*       ld a,' '
0402C3 5B D7       0346*       rst.lil 10h
0402C5 E1          0347*       pop hl
0402C6 D1          0348*       pop de
0402C7 C1          0349*       pop bc
0402C8 F1          0350*       pop af
0402C9 C9          0351*       ret
0402CA             0352*   
0402CA             0353*   print_s168_bc_de:
0402CA F5          0354*       push af
0402CB C5          0355*       push bc
0402CC D5          0356*       push de
0402CD C5          0357*       push bc
0402CE E1          0358*       pop hl
0402CF CD 63 02 04 0359*       call print_s168
0402D3 3E 20       0360*       ld a,' '
0402D5 5B D7       0361*       rst.lil 10h
0402D7 EB          0362*       ex de,hl
0402D8 CD 63 02 04 0363*       call print_s168
0402DC 3E 20       0364*       ld a,' '
0402DE 5B D7       0365*       rst.lil 10h
0402E0 E1          0366*       pop hl
0402E1 D1          0367*       pop de
0402E2 C1          0368*       pop bc
0402E3 F1          0369*       pop af
0402E4 C9          0370*       ret
0402E5             0371*   
0402E5             0372*   print_s168_a:
0402E5 F5          0373*       push af
0402E6 C5          0374*       push bc
0402E7 E5          0375*       push hl
0402E8 21 00 00 00 0376*       ld hl,0
0402EC 6F          0377*       ld l,a
0402ED CD 78 02 04 0378*       call print_s168_hl
0402F1 E1          0379*       pop hl
0402F2 C1          0380*       pop bc
0402F3 F1          0381*       pop af
0402F4 C9          0382*       ret
0402F5             0383*   
0402F5             0384*   ; #### new functions added by Brandon R. Gates ####
0402F5             0385*   
0402F5             0386*   ; print the binary representation of the 8-bit value in a
0402F5             0387*   ; destroys a, hl, bc
0402F5             0388*   printBin8:
0402F5 06 08       0389*       ld b,8 ; loop counter for 8 bits
0402F7 21 12 03 04 0390*       ld hl,@cmd ; set hl to the low byte of the output string
0402FB             0391*       ; (which will be the high bit of the value in a)
0402FB             0392*   @loop:
0402FB 07          0393*       rlca ; put the next highest bit into carry
0402FC 38 04       0394*       jr c,@one
0402FE 36 30       0395*       ld (hl),'0'
040300 18 02       0396*       jr @next_bit
040302             0397*   @one:
040302 36 31       0398*       ld (hl),'1'
040304             0399*   @next_bit:
040304 23          0400*       inc hl
040305 10 F4       0401*       djnz @loop
040307             0402*   ; print it
040307 21 12 03 04 0403*       ld hl,@cmd
04030B 01 08 00 00 0404*       ld bc,@end-@cmd
04030F 5B DF       0405*       rst.lil $18
040311 C9          0406*       ret
040312             0407*   @cmd: ds 8 ; eight bytes for eight bits
04031A             0408*   @end:
04031A             0409*   
04031A             0410*   ; print the binary representation of the 8-bit value in a
04031A             0411*   ; in reverse order (lsb first)
04031A             0412*   ; destroys a, hl, bc
04031A             0413*   printBin8Rev:
       FF FF FF FF 
       FF FF FF FF 
04031A 06 08       0414*       ld b,8 ; loop counter for 8 bits
04031C 21 37 03 04 0415*       ld hl,@cmd ; set hl to the low byte of the output string
040320             0416*       ; (which will be the high bit of the value in a)
040320             0417*   @loop:
040320 0F          0418*       rrca ; put the next lowest bit into carry
040321 38 04       0419*       jr c,@one
040323 36 30       0420*       ld (hl),'0'
040325 18 02       0421*       jr @next_bit
040327             0422*   @one:
040327 36 31       0423*       ld (hl),'1'
040329             0424*   @next_bit:
040329 23          0425*       inc hl
04032A 10 F4       0426*       djnz @loop
04032C             0427*   ; print it
04032C 21 37 03 04 0428*       ld hl,@cmd
040330 01 08 00 00 0429*       ld bc,@end-@cmd
040334 5B DF       0430*       rst.lil $18
040336 C9          0431*       ret
040337             0432*   @cmd: ds 8 ; eight bytes for eight bits
04033F             0433*   @end:
04033F             0434*   
       FF FF FF FF 
       FF FF FF FF 
04033F 20 61 66 3D 0435*   str_afu: db " af=",0
       00          
040344 20 68 6C 3D 0436*   str_hlu: db " hl=",0
       00          
040349 20 62 63 3D 0437*   str_bcu: db " bc=",0
       00          
04034E 20 64 65 3D 0438*   str_deu: db " de=",0
       00          
040353 20 69 78 3D 0439*   str_ixu: db " ix=",0
       00          
040358 20 69 79 3D 0440*   str_iyu: db " iy=",0
       00          
04035D             0441*   
04035D             0442*   ; print udeuhl to screen in hexidecimal format
04035D             0443*   ; inputs: none
04035D             0444*   ; outputs: concatenated hexidecimal udeuhl
04035D             0445*   ; destroys: nothing
04035D             0446*   dumpUDEUHLHex:
04035D             0447*   ; store everything in scratch
04035D 22 BC 03 04 0448*       ld (uhl),hl
040361 ED 43 BF 03 0449*       ld (ubc),bc
       04          
040366 ED 53 C2 03 0450*       ld (ude),de
       04          
04036B DD 22 C5 03 0451*       ld (uix),ix
       04          
040370 FD 22 C8 03 0452*       ld (uiy),iy
       04          
040375 F5          0453*       push af
040376             0454*   
040376             0455*   ; print each register
040376             0456*   
040376 21 B0 03 04 0457*       ld hl,str_udeuhl
04037A CD 07 01 04 0458*       call printString
04037E 2A C2 03 04 0459*       ld hl,(ude)
040382 CD 27 01 04 0460*       call printHex24
040386 3E 2E       0461*       ld a,'.' ; print a dot to separate the values
040388 5B D7       0462*       rst.lil 10h
04038A 2A BC 03 04 0463*       ld hl,(uhl)
04038E CD 27 01 04 0464*       call printHex24
040392 CD 1C 01 04 0465*       call printNewLine
040396             0466*   
040396             0467*   ; restore everything
040396 2A BC 03 04 0468*       ld hl, (uhl)
04039A ED 4B BF 03 0469*       ld bc, (ubc)
       04          
04039F ED 5B C2 03 0470*       ld de, (ude)
       04          
0403A4 DD 2A C5 03 0471*       ld ix, (uix)
       04          
0403A9 FD 2A C8 03 0472*       ld iy, (uiy)
       04          
0403AE F1          0473*       pop af
0403AF             0474*   ; all done
0403AF C9          0475*       ret
0403B0             0476*   
0403B0 75 64 65 2E 0477*   str_udeuhl: db "ude.uhl=",0
       75 68 6C 3D 
       00          
0403B9             0478*   
0403B9             0479*   ; global scratch memory for registers
0403B9 00 00 00    0480*   uaf: dl 0
0403BC 00 00 00    0481*   uhl: dl 0
0403BF 00 00 00    0482*   ubc: dl 0
0403C2 00 00 00    0483*   ude: dl 0
0403C5 00 00 00    0484*   uix: dl 0
0403C8 00 00 00    0485*   uiy: dl 0
0403CB 00 00 00    0486*   usp: dl 0
0403CE 00 00 00    0487*   upc: dl 0
0403D1             0488*   
0403D1             0489*   
0403D1             0490*   ; set all the bits in the flag register
0403D1             0491*   ; more of an academic exercise than anything useful
0403D1             0492*   ; inputs; none
0403D1             0493*   ; outputs; a=0,f=255
0403D1             0494*   ; destroys: flags, hl
0403D1             0495*   ; preserves: a, because why not
0403D1             0496*   setAllFlags:
0403D1 21 FF 00 00 0497*       ld hl,255
0403D5 67          0498*       ld h,a ; four cycles to preserve a is cheap
0403D6 E5          0499*       push hl
0403D7 F1          0500*       pop af
0403D8 C9          0501*       ret
0403D9             0502*   
0403D9             0503*   ; reset all the bits in the flag register
0403D9             0504*   ; unlike its inverse counterpart, this may actually be useful
0403D9             0505*   ; inputs; none
0403D9             0506*   ; outputs; a=0,f=0
0403D9             0507*   ; destroys: flags, hl
0403D9             0508*   ; preserves: a, because why not
0403D9             0509*   resetAllFlags:
0403D9 21 00 00 00 0510*       ld hl,0
0403DD 67          0511*       ld h,a ; four cycles to preserve a is cheap
0403DE E5          0512*       push hl
0403DF F1          0513*       pop af
0403E0 C9          0514*       ret
0403E1             0515*   
0403E1             0516*   ; wait until user presses a key
0403E1             0517*   ; inputs: none
0403E1             0518*   ; outputs: ascii code of key pressed in a
0403E1             0519*   ; destroys: af,ix
0403E1             0520*   waitKeypress:
0403E1             0521*       MOSCALL mos_getkey
0403E1 3E 00       0001*M1 			LD	A, function
0403E3 5B CF       0002*M1 			RST.LIL	08h
0403E5 C9          0522*       ret
0403E6             0523*   
0403E6             0524*   ; clear a block of memory by writing a prescribed value to each byte in the range
0403E6             0525*   ; inputs: a = value to write, hl = address of first byte, bc = number of bytes
0403E6             0526*   ; outputs: memory block is cleared
0403E6             0527*   ; destroys: hl, de
0403E6             0528*   clear_mem:
0403E6 0B          0529*       dec bc ; we do this because we will increment de before writing the first byte
0403E7 77          0530*       ld (hl),a
0403E8 E5          0531*       push hl
0403E9 D1          0532*       pop de
0403EA 13          0533*       inc de ; target address
0403EB ED B0       0534*       ldir
0403ED C9          0535*       ret
0403EE             0032        include "arith24.inc"
0403EE             0001*   ;------------------------------------------------------------------------
0403EE             0002*   ;  arith24.asm
0403EE             0003*   ;  24-bit ez80 arithmetic routines
0403EE             0004*   ;  Copyright (c) Shawn Sijnstra 2024
0403EE             0005*   ;  MIT license
0403EE             0006*   ;
0403EE             0007*   ;  This library was created as a tool to help make ez80
0403EE             0008*   ;  24-bit native assembly routines for simple mathematical problems
0403EE             0009*   ;  more widely available.
0403EE             0010*   ;
0403EE             0011*   ;------------------------------------------------------------------------
0403EE             0012*   
0403EE             0013*   ;------------------------------------------------------------------------
0403EE             0014*   ; umul24:	HL = HL*DE (unsigned)
0403EE             0015*   ; Preserves AF, BC, DE
0403EE             0016*   ; Uses a fast multiply routine.
0403EE             0017*   ;------------------------------------------------------------------------
0403EE             0018*   umul24:
0403EE D5          0019*   	push	DE
0403EF C5          0020*   	push	BC
0403F0 F5          0021*   	push	AF
0403F1 E5          0022*   	push	HL
0403F2 C1          0023*   	pop		BC
0403F3 3E 18       0024*       ld	 	a, 24 ; No. of bits to process
0403F5 21 00 00 00 0025*       ld	 	hl, 0 ; Result
0403F9             0026*   umul24_lp:
0403F9 29          0027*   	add	hl,hl
0403FA EB          0028*   	ex	de,hl
0403FB 29          0029*   	add	hl,hl
0403FC EB          0030*   	ex	de,hl
0403FD 30 01       0031*   	jr	nc,umul24_nc
0403FF 09          0032*   	add	hl,bc
040400             0033*   umul24_nc:
040400 3D          0034*   	dec	a
040401 20 F6       0035*   	jr	nz,umul24_lp
040403 F1          0036*   	pop	af
040404 C1          0037*   	pop	bc
040405 D1          0038*   	pop	de
040406 C9          0039*   	ret
040407             0040*   
040407             0041*   
040407             0042*   ;------------------------------------------------------------------------
040407             0043*   ; udiv24
040407             0044*   ; Unsigned 24-bit division
040407             0045*   ; Divides HLU by DEU. Gives result in DEU (and BC), remainder in HLU.
040407             0046*   ;
040407             0047*   ; Uses AF BC DE HL
040407             0048*   ; Uses Restoring Division algorithm
040407             0049*   ;------------------------------------------------------------------------
040407             0050*   
040407             0051*   udiv24:
040407 E5          0052*   	push	hl
040408 C1          0053*   	pop		bc	;move dividend to BCU
040409 21 00 00 00 0054*   	ld		hl,0	;result
04040D A7          0055*   	and		a
04040E ED 52       0056*   	sbc		hl,de	;test for div by 0
040410 C8          0057*   	ret		z		;it's zero, carry flag is clear
040411 19          0058*   	add		hl,de	;HL is 0 again
040412 3E 18       0059*   	ld		a,24	;number of loops through.
040414             0060*   udiv1:
040414 C5          0061*   	push	bc	;complicated way of doing this because of lack of access to top bits
040415 E3          0062*   	ex		(sp),hl
040416 37          0063*   	scf
040417 ED 6A       0064*   	adc	hl,hl
040419 E3          0065*   	ex	(sp),hl
04041A C1          0066*   	pop	bc		;we now have bc = (bc * 2) + 1
04041B             0067*   
04041B ED 6A       0068*   	adc	hl,hl
04041D A7          0069*   	and	a		;is this the bug
04041E ED 52       0070*   	sbc	hl,de
040420 30 02       0071*   	jr	nc,udiv2
040422 19          0072*   	add	hl,de
040423             0073*   ;	dec	c
040423 0B          0074*   	dec	bc
040424             0075*   udiv2:
040424 3D          0076*   	dec	a
040425 20 ED       0077*   	jr	nz,udiv1
040427 37          0078*   	scf		;flag used for div0 error
040428 C5          0079*   	push	bc
040429 D1          0080*   	pop		de	;remainder
04042A C9          0081*   	ret
04042B             0082*   
04042B             0083*   
04042B             0084*   
04042B             0085*   ;------------------------------------------------------------------------
04042B             0086*   ; neg24
04042B             0087*   ; Returns: HLU = 0-HLU
04042B             0088*   ; preserves all other registers
04042B             0089*   ;------------------------------------------------------------------------
04042B             0090*   neg24:
04042B D5          0091*   	push	de
04042C EB          0092*   	ex		de,hl
04042D 21 00 00 00 0093*   	ld		hl,0
040431 B7          0094*   	or		a
040432 ED 52       0095*   	sbc		hl,de
040434 D1          0096*   	pop		de
040435 C9          0097*   	ret
040436             0098*   
040436             0099*   ;------------------------------------------------------------------------
040436             0100*   ; or_hlu_deu: 24 bit bitwise OR
040436             0101*   ; Returns: hlu = hlu OR deu
040436             0102*   ; preserves all other registers
040436             0103*   ;------------------------------------------------------------------------
040436             0104*   or_hlu_deu:
040436 22 BF 04 04 0105*   	ld	(bitbuf1),hl
04043A ED 53 C2 04 0106*   	ld	(bitbuf2),de
       04          
04043F D5          0107*   	push	de	;preserve DEU
040440 C5          0108*   	push	bc	;preserve BCU
040441 06 03       0109*   	ld		b,3
040443 21 BF 04 04 0110*   	ld	hl,bitbuf1
040447 11 BF 04 04 0111*   	ld	de,bitbuf1
04044B             0112*   orloop_24:
04044B 1A          0113*   	ld	a,(de)
04044C B6          0114*   	or	(hl)
04044D 12          0115*   	ld	(de),a
04044E 13          0116*   	inc	de
04044F 23          0117*   	inc	hl
040450 10 F9       0118*   	djnz	orloop_24
040452 2A C2 04 04 0119*   	ld	hl,(bitbuf2)
040456 C1          0120*   	pop		bc	;restore BC
040457 D1          0121*   	pop		de	;restore DE
040458             0122*   
040458             0123*   ;------------------------------------------------------------------------
040458             0124*   ; and_hlu_deu: 24 bit bitwise AND
040458             0125*   ; Returns: hlu = hlu AND deu
040458             0126*   ; preserves all other registers
040458             0127*   ;------------------------------------------------------------------------
040458             0128*   and_hlu_deu:
040458 22 BF 04 04 0129*   	ld	(bitbuf1),hl
04045C ED 53 C2 04 0130*   	ld	(bitbuf2),de
       04          
040461 D5          0131*   	push	de	;preserve DEU
040462 C5          0132*   	push	bc	;preserve BCU
040463 06 03       0133*   	ld		b,3
040465 21 BF 04 04 0134*   	ld	hl,bitbuf1
040469 11 BF 04 04 0135*   	ld	de,bitbuf1
04046D             0136*   andloop_24:
04046D 1A          0137*   	ld	a,(de)
04046E A6          0138*   	and	(hl)
04046F 12          0139*   	ld	(de),a
040470 13          0140*   	inc	de
040471 23          0141*   	inc	hl
040472 10 F9       0142*   	djnz	andloop_24
040474 2A C2 04 04 0143*   	ld	hl,(bitbuf2)
040478 C1          0144*   	pop		bc	;restore BC
040479 D1          0145*   	pop		de	;restore DE
04047A             0146*   
04047A             0147*   ;------------------------------------------------------------------------
04047A             0148*   ; xor_hlu_deu: 24 bit bitwise XOR
04047A             0149*   ; Returns: hlu = hlu XOR deu
04047A             0150*   ; preserves all other registers
04047A             0151*   ;------------------------------------------------------------------------
04047A             0152*   xor_hlu_deu:
04047A 22 BF 04 04 0153*   	ld	(bitbuf1),hl
04047E ED 53 C2 04 0154*   	ld	(bitbuf2),de
       04          
040483 D5          0155*   	push	de	;preserve DEU
040484 C5          0156*   	push	bc	;preserve BCU
040485 06 03       0157*   	ld		b,3
040487 21 BF 04 04 0158*   	ld	hl,bitbuf1
04048B 11 BF 04 04 0159*   	ld	de,bitbuf1
04048F             0160*   xorloop_24:
04048F 1A          0161*   	ld	a,(de)
040490 AE          0162*   	xor	(hl)
040491 12          0163*   	ld	(de),a
040492 13          0164*   	inc	de
040493 23          0165*   	inc	hl
040494 10 F9       0166*   	djnz	xorloop_24
040496 2A C2 04 04 0167*   	ld	hl,(bitbuf2)
04049A C1          0168*   	pop		bc	;restore BC
04049B D1          0169*   	pop		de	;restore DE
04049C             0170*   
04049C             0171*   ;------------------------------------------------------------------------
04049C             0172*   ; shl_hlu: 24 bit shift left hlu by a positions
04049C             0173*   ; Returns: hlu = hlu << a
04049C             0174*   ;		   a = 0
04049C             0175*   ; NOTE: only considers a up to 16 bits.
04049C             0176*   ; preserves all other registers
04049C             0177*   ; modified by Brandon R. Gates to use a instead of de
04049C             0178*   ;------------------------------------------------------------------------
04049C             0179*   shl_hlu:
04049C B7          0180*   	or a
04049D C8          0181*   	ret		z		;we're done
04049E 29          0182*   	add		hl,hl	;shift HLU left
04049F 3D          0183*   	dec a
0404A0 18 FA       0184*   	jr		shl_hlu
0404A2             0185*   
0404A2             0186*   ;------------------------------------------------------------------------
0404A2             0187*   ; shr_hlu: 24 bit shift right hlu by a positions
0404A2             0188*   ; Returns: hlu = hlu >> a
0404A2             0189*   ;		   a = 0
0404A2             0190*   ; NOTE: only considers a up to 16 bits.
0404A2             0191*   ; preserves all other registers
0404A2             0192*   ; modified by Brandon R. Gates to use a instead of de
0404A2             0193*   ;------------------------------------------------------------------------
0404A2             0194*   shr_hlu:
0404A2 22 BF 04 04 0195*   	ld		(bitbuf1),hl
0404A6 21 C1 04 04 0196*   	ld		hl,bitbuf1+2
0404AA             0197*   @shr_loop:
0404AA B7          0198*   	or a
0404AB 28 0D       0199*   	jr		z,@shr_done		;we're done
0404AD             0200*   ;carry is clear from or instruction
0404AD CB 1E       0201*   	rr		(hl)
0404AF 2B          0202*   	dec		hl
0404B0 CB 1E       0203*   	rr		(hl)
0404B2 2B          0204*   	dec		hl
0404B3 CB 1E       0205*   	rr		(hl)
0404B5 23          0206*   	inc		hl
0404B6 23          0207*   	inc		hl
0404B7 3D          0208*   	dec a
0404B8 18 F0       0209*   	jr		@shr_loop
0404BA             0210*   @shr_done:
0404BA 2A BF 04 04 0211*   	ld		hl,(bitbuf1)	;collect result
0404BE C9          0212*   	ret
0404BF             0213*   
0404BF             0214*   ;------------------------------------------------------------------------
0404BF             0215*   ; Scratch area for calculations
0404BF             0216*   ;------------------------------------------------------------------------
0404BF 00 00 00    0217*   bitbuf1:	dw24	0	;bit manipulation buffer 1
0404C2 00 00 00    0218*   bitbuf2:	dw24	0	;bit manipulation buffer 2
0404C5             0219*   
0404C5             0220*   ; -----------------------------------------------------------------------
0404C5             0221*   ; Functions added by Brandon R. Gates
0404C5             0222*   ; -----------------------------------------------------------------------
0404C5             0223*   
0404C5             0224*   ;------------------------------------------------------------------------
0404C5             0225*   ; shr_hlu_div: Quick division by powers of two based on log2 of A
0404C5             0226*   ;              Determines the LSB of A and shifts HLU accordingly.
0404C5             0227*   ;              HLU = HLU >> LSB(A)
0404C5             0228*   ; Returns: HLU = HLU >> LSB(A)
0404C5             0229*   ; Destroys: af
0404C5             0230*   ;------------------------------------------------------------------------
0404C5             0231*   shr_hlu_log2a:
0404C5 B7          0232*   	or a    ; check for zero
0404C6 C8          0233*   	ret z   ; nothing to shift so we're done
0404C7 C5          0234*   	push 	bc ; preserve
0404C8 06 00       0235*   	ld		b,0 ; clear b
0404CA             0236*   @find_bit:
0404CA 0F          0237*   	rrca ; bit 0 to carry
0404CB DA D4 04 04 0238*   	jp c,@found_bit
0404CF 04          0239*   	inc b ; next bit
0404D0 C3 CA 04 04 0240*   	jp @find_bit
0404D4             0241*   @found_bit:
0404D4 78          0242*   	ld a,b
0404D5 CD A2 04 04 0243*   	call shr_hlu
0404D9 C1          0244*   	pop 	bc ; restore
0404DA C9          0245*   	ret
0404DB             0246*   ; end shr_hlu_log2a
0404DB             0247*   
0404DB             0248*   ;------------------------------------------------------------------------
0404DB             0249*   ; shl_hlu_log2a: Quick multiplication by powers of two based on log2 of A
0404DB             0250*   ;                Determines the LSB of A and shifts HLU accordingly.
0404DB             0251*   ;                HLU = HLU << LSB(A)
0404DB             0252*   ; Returns: HLU = HLU << LSB(A)
0404DB             0253*   ; Destroys: af
0404DB             0254*   ;------------------------------------------------------------------------
0404DB             0255*   shl_hlu_log2a:
0404DB B7          0256*   	or a    ; check for zero
0404DC C8          0257*   	ret z   ; nothing to shift so we're done
0404DD C5          0258*   	push 	bc ; preserve
0404DE 06 00       0259*   	ld		b,0 ; clear b
0404E0             0260*   @find_bit:
0404E0 0F          0261*   	rrca ; bit 0 to carry
0404E1 DA EA 04 04 0262*   	jp c,@found_bit
0404E5 04          0263*   	inc b ; next bit
0404E6 C3 E0 04 04 0264*   	jp @find_bit
0404EA             0265*   @found_bit:
0404EA 78          0266*   	ld a,b
0404EB CD 9C 04 04 0267*   	call shl_hlu
0404EF C1          0268*   	pop 	bc ; restore
0404F0 C9          0269*   	ret
0404F1             0270*   ; end shl_hlu_log2a
0404F1             0033        include "maths.inc"
0404F1 FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF    
040500             0002*   
040500             0003*   ;------------------------------------------------------------------------
040500             0004*   ; Scratch area for calculations
040500             0005*   ;------------------------------------------------------------------------
040500 00 00 00    0006*   scratch1: dw24 0 ;bit manipulation buffer 1
040503 00 00 00    0007*   scratch2: dw24 0 ;bit manipulation buffer 2
040506             0008*   
040506             0009*   ; absolute value of hlu
040506             0010*   ; returns: abs(hlu), flags set according to the incoming sign of hlu:
040506             0011*   ;         s1,z0,pv0,n1,c0 if hlu was negative
040506             0012*   ;         s0,z1,pv0,n1,c0 if hlu was zero
040506             0013*   ;         s0,z0,pv0,n1,c0 if hlu was positive
040506             0014*   ; destroys: a
040506             0015*   hlu_abs:
040506 19          0016*       add hl,de
040507 B7          0017*       or a
040508 ED 52       0018*       sbc hl,de
04050A FA 0F 05 04 0019*       jp m,@is_neg
04050E C9          0020*       ret ; hlu is positive or zero so we're done
04050F             0021*   @is_neg:
04050F F5          0022*       push af ; otherwise, save current flags for return
040510 CD 16 05 04 0023*       call neg_hlu ; negate hlu
040514 F1          0024*       pop af ; get back flags
040515 C9          0025*       ret
040516             0026*   
040516             0027*   ; flip the sign of hlu
040516             0028*   ; inputs: hlu
040516             0029*   ; returns: 0-hlu, flags set appropriately for the result:
040516             0030*   ;         s1,z0,pv0,n1,c1 if result is negative
040516             0031*   ;         s0,z1,pv0,n1,c0 if result is zero
040516             0032*   ;         s0,z0,pv0,n1,c1 if result is positive
040516             0033*   ; destroys a
040516             0034*   neg_hlu:
040516 D5          0035*       push de ; save de
040517 EB          0036*       ex de,hl ; put hl into de
040518 21 00 00 00 0037*       ld hl,0 ; clear hl
04051C AF          0038*       xor a ; clear carry
04051D ED 52       0039*       sbc hl,de ; 0-hlu = -hlu
04051F D1          0040*       pop de ; get de back
040520 C9          0041*       ret ; easy peasy
040521             0042*   
040521             0043*   ;------------------------------------------------------------------------
040521             0044*   ; divide hlu by 2, inspired by above
040521             0045*   ;------------------------------------------------------------------------
040521             0046*   hlu_div2:
040521 22 00 05 04 0047*       ld (scratch1),hl
040525 21 02 05 04 0048*       ld hl,scratch1+2
040529 CB 1E       0049*       rr (hl)
04052B 2B          0050*       dec hl
04052C CB 1E       0051*       rr (hl)
04052E 2B          0052*       dec hl
04052F CB 1E       0053*       rr (hl)
040531 23          0054*       inc hl
040532 23          0055*       inc hl
040533 2A 00 05 04 0056*       ld hl,(scratch1)
040537 C9          0057*       ret
040538             0058*   
040538             0059*   ; this is my little hack to divide by 16
040538             0060*   hlu_div16:
040538 AF          0061*       xor a
040539 29          0062*       add hl,hl
04053A 17          0063*       rla
04053B 29          0064*       add hl,hl
04053C 17          0065*       rla
04053D 29          0066*       add hl,hl
04053E 17          0067*       rla
04053F 29          0068*       add hl,hl
040540 17          0069*       rla
040541 22 4E 05 04 0070*       ld (@scratch),hl
040545 32 51 05 04 0071*       ld (@scratch+3),a
040549 2A 4F 05 04 0072*       ld hl,(@scratch+1)
04054D C9          0073*       ret
04054E             0074*   @scratch: ds 4
040552             0075*   
040552             0076*   ; hlu signed division by 256
040552             0077*   ; returns: hlu / 256
040552             0078*   ; destroys: af
040552             0079*   hlu_sdiv256:
       FF FF FF FF 
040552 AF          0080*       xor a ; assume hl is positive
040553 22 69 05 04 0081*       ld (@buffer),hl
040557             0082*       SIGN_HLU
040557 19          0001*M1     add hl,de ; 1 cycle
040558 B7          0002*M1     or a ; clear flags ; 1 cycle
040559 ED 52       0003*M1     sbc hl,de ; 2 cycles
04055B             0004*M1     ; 4 cycles total
04055B F2 60 05 04 0083*       jp p,@hl_pos
04055F 3D          0084*       dec a
040560             0085*   @hl_pos:
040560 32 6C 05 04 0086*       ld (@buffer+3),a
040564 2A 6A 05 04 0087*       ld hl,(@buffer+1)
040568 C9          0088*       ret
040569             0089*   @buffer: ds 4
04056D             0090*   
04056D             0091*   ; hlu 1 byte right shift, unsigned
04056D             0092*   ; returns: hlu / 256, fractional portion in a
04056D             0093*   ; destroys: af
04056D             0094*   hlu_udiv256:
       FF FF FF FF 
04056D AF          0095*       xor a
04056E 32 7F 05 04 0096*       ld (@buffer+3),a
040572 7D          0097*       ld a,l ; save the fractional portion
040573 22 7C 05 04 0098*       ld (@buffer),hl
040577 2A 7D 05 04 0099*       ld hl,(@buffer+1)
04057B C9          0100*       ret
04057C             0101*   @buffer: ds 4
040580             0102*   
       FF FF FF FF 
040580 00 00 00 00 0103*   add_bcd_arg1: db #00,#00,#00,#00
040584 00 00 00 00 0104*   add_bcd_arg2: db #00,#00,#00,#00
040588             0105*   
040588             0106*   ; set bcd values in a scratch memory address from registers bcde
040588             0107*   ; input: hl; scratch address,bcde; 8-place bcd number
040588             0108*   ; destroys ; hl
040588             0109*   set_bcd:
040588 73          0110*       ld (hl),e
040589 23          0111*       inc hl
04058A 72          0112*       ld (hl),d
04058B 23          0113*       inc hl
04058C 71          0114*       ld (hl),c
04058D 23          0115*       inc hl
04058E 70          0116*       ld (hl),b
04058F C9          0117*       ret
040590             0118*   
040590             0119*   ; load bcd values from a scratch memory address to bcde
040590             0120*   ; input: hl; scratch address
040590             0121*   ; output: bcde; 8-place bcd number
040590             0122*   ; destroys: hl
040590             0123*   get_bcd:
040590 5E          0124*       ld e,(hl)
040591 23          0125*       inc hl
040592 56          0126*       ld d,(hl)
040593 23          0127*       inc hl
040594 4E          0128*       ld c,(hl)
040595 23          0129*       inc hl
040596 46          0130*       ld b,(hl)
040597 C9          0131*       ret
040598             0132*   
040598             0133*   ; BCD addition
040598             0134*   ; inputs: (hl) and (de) point to BCD numbers of equal length (divisible by 2)
040598             0135*   ;       a is the number of bytes holding each number (number of places/2)
040598             0136*   ; outputs: (hl) + (de) --> (hl)
040598             0137*   ; destroys: a,b,de,hl
040598             0138*   add_bcd:
040598 47          0139*       ld b,a ; loop counter
040599 AF          0140*       xor a ; reset a, clear carry flag
04059A             0141*   adcec:
04059A 1A          0142*       ld a,(de) ; addend to acc
04059B 8E          0143*       adc a,(hl) ; add (hl) to acc
04059C 27          0144*       daa ; adjust result to bcd
04059D 77          0145*       ld (hl),a ; store result
04059E 23          0146*       inc hl ; advance memory pointers
04059F 13          0147*       inc de
0405A0 10 F8       0148*       djnz adcec ; loop until b == 0
0405A2 C9          0149*       ret
0405A3             0150*   
0405A3             0151*   ; BCD subtraction
0405A3             0152*   ; inputs: (hl) and (de) point to BCD numbers of equal length (divisible by 2)
0405A3             0153*   ;       a is the number of bytes holding each number (number of places/2)
0405A3             0154*   ; outputs: (hl) - (de) --> (hl)
0405A3             0155*   ; destroys: a,b,de,hl
0405A3             0156*   sub_bcd:
0405A3 47          0157*       ld b,a ; loop counter
0405A4 AF          0158*       xor a ; reset a,clear carry flag
0405A5             0159*   subdec:
0405A5 1A          0160*       ld a,(de) ; subtrahend to acc
0405A6 9E          0161*       sbc a,(hl) ; subtract (hl) from acc
0405A7 27          0162*       daa ; adjust result to bcd
0405A8 77          0163*       ld (hl),a ; store result
0405A9 23          0164*       inc hl ; advance memory pointers
0405AA 13          0165*       inc de
0405AB 10 F8       0166*       djnz subdec ; loop until b == 0
0405AD C9          0167*       ret
0405AE             0168*   
0405AE             0169*   ; http://www.z80.info/pseudo-random.txt
0405AE             0170*   rand_8:
0405AE C5          0171*       push bc
0405AF 3A C2 05 04 0172*       ld a,(r_seed)
0405B3 4F          0173*       ld c,a
0405B4             0174*   
0405B4 0F          0175*       rrca ; multiply by 32
0405B5 0F          0176*       rrca
0405B6 0F          0177*       rrca
0405B7 EE 1F       0178*       xor 0x1f
0405B9             0179*   
0405B9 81          0180*       add a,c
0405BA DE FF       0181*       sbc a,255 ; carry
0405BC             0182*   
0405BC 32 C2 05 04 0183*       ld (r_seed),a
0405C0 C1          0184*       pop bc
0405C1 C9          0185*       ret
0405C2 50          0186*   r_seed: defb $50
0405C3             0187*   
0405C3             0188*   ; https://www.omnimaga.org/asm-language/ez80-optimized-routines/msg399325/#msg399325
0405C3             0189*   prng24:
0405C3             0190*   ;;Expects ADL mode.
0405C3             0191*   ;;Output: HL
0405C3             0192*   ;;50cc
0405C3             0193*   ;;33 bytes
0405C3             0194*   ;;cycle length: 281,474,959,933,440 (about 2.8 trillion)
0405C3 ED 5B E4 05 0195*       ld de,(seed1)
       04          
0405C8 B7          0196*       or a
0405C9 ED 62       0197*       sbc hl,hl
0405CB 19          0198*       add hl,de
0405CC 29          0199*       add hl,hl
0405CD 29          0200*       add hl,hl
0405CE 2C          0201*       inc l
0405CF 19          0202*       add hl,de
0405D0 22 E4 05 04 0203*       ld (seed1),hl
0405D4 2A E7 05 04 0204*       ld hl,(seed2)
0405D8 29          0205*       add hl,hl
0405D9 9F          0206*       sbc a,a
0405DA E6 1B       0207*       and %00011011
0405DC AD          0208*       xor l
0405DD 6F          0209*       ld l,a
0405DE 22 E7 05 04 0210*       ld (seed2),hl
0405E2 19          0211*       add hl,de
0405E3 C9          0212*       ret
0405E4 00 00 00    0213*   seed1: dl 0
0405E7 00 00 00    0214*   seed2: dl 0
0405EA             0034        include "files.inc"
0405EA             0001*   ; load to onboard 8k sram
0405EA             0002*   filedata: equ 0xB7E000; Directory object structure (DIR)
0405EA             0035        include "fixed168.inc"
0405EA FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF       
040600             0002*   ; multiply a signed 24-bit number by an unsigned 8-bit number giving a signed 24-bit result
040600             0003*   ; uses EZ80 MLT instruction for speed
040600             0004*   ; operation: UHL * A --> UHL
040600             0005*   ; destroys: AF, HL
040600             0006*   smul24x8:
040600             0007*   ; make hl positive and store sign flag
040600 CD 06 05 04 0008*       call hlu_abs
040604 F5          0009*       push af
040605             0010*   ; do the division
040605 CD 10 06 04 0011*       call mul24x8 ; hl = product
040609             0012*   ; adjust sign of result
040609 F1          0013*       pop af ; sign de
04060A F0          0014*       ret p ; hl was positive, nothing to do
04060B CD 16 05 04 0015*       call neg_hlu ; result is negative
04060F C9          0016*       ret
040610             0017*   
040610             0018*   ; unsigned multiplication of a 24-bit and 8-bit number giving a 32-bit result
040610             0019*   ; uses EZ80 MLT instruction for speed
040610             0020*   ; operation: UHL * A --> AUHL
040610             0021*   ; destroys: AF, HL
040610             0022*   mul24x8:
040610 D5          0023*       push de ; preserve de
040611             0024*   ; low byte
040611 5D          0025*       ld e,l
040612 57          0026*       ld d,a
040613 ED 5C       0027*       mlt de
040615 6B          0028*       ld l,e ; product low byte
040616 08          0029*       ex af,af' ; save multiplier
040617 7A          0030*       ld a,d ; carry
040618 08          0031*       ex af,af' ; save carry, restore multiplier
040619             0032*   ; high byte
040619 5C          0033*       ld e,h
04061A 57          0034*       ld d,a
04061B ED 5C       0035*       mlt de
04061D 08          0036*       ex af,af' ; save multiplier, restore carry
04061E 83          0037*       add a,e ; add carry
04061F 67          0038*       ld h,a ; product middle byte
040620 7A          0039*       ld a,d ; carry
040621 08          0040*       ex af,af' ; save carry, restore multiplier
040622             0041*   ; upper byte
040622 22 3D 06 04 0042*       ld (@scratch),hl ; 7 cycles
040626 5F          0043*       ld e,a
040627 3A 3F 06 04 0044*       ld a,(@scratch+2)
04062B 57          0045*       ld d,a
04062C ED 5C       0046*       mlt de
04062E 08          0047*       ex af,af' ; restore carry
04062F 8B          0048*       adc a,e ; add carry
040630 32 3F 06 04 0049*       ld (@scratch+2),a ; 5 cycles
040634 2A 3D 06 04 0050*       ld hl,(@scratch) ; 7 cycles
040638             0051*   ; highest byte
040638 3E 00       0052*       ld a,0 ; preserve carry flag
04063A 8A          0053*       adc a,d ; product highest byte
04063B D1          0054*       pop de ; restore de
04063C C9          0055*       ret
04063D             0056*   @scratch: ds 3
040640             0057*   
       FF FF FF 
040640 00 00 00 00 0058*   mul24out: blkb 6,0
       00 00       
040646             0059*   
040646             0060*   ; unsigned multiplication of two 24-bit numbers giving a 48-bit result
040646             0061*   ; operation: UHL * UDE --> mul24out
040646             0062*   mul24:
040646 DD E5       0063*       push ix ; preserve
040648             0064*   ; point to output buffer and clear it
040648 DD 21 40 06 0065*       ld ix,mul24out
       04          
04064D C5          0066*       push bc
04064E 01 00 00 00 0067*       ld bc,0
040652 DD 0F 00    0068*       ld (ix),bc
040655 DD 0F 03    0069*       ld (ix+3),bc
040658 C1          0070*       pop bc
040659             0071*   ; STEP 1: UHL * E
040659 7B          0072*       ld a,e
04065A E5          0073*       push hl
04065B CD 10 06 04 0074*       call mul24x8
04065F DD 2F 00    0075*       ld (ix+0),hl
040662 DD 77 03    0076*       ld (ix+3),a
040665             0077*   ; STEP 2: UHL * D
040665 E1          0078*       pop hl
040666 E5          0079*       push hl
040667 7A          0080*       ld a,d
040668 CD 10 06 04 0081*       call mul24x8
04066C CD 85 06 04 0082*       call @accumulate
040670             0083*   ; STEP 3: UHL * DEU
040670 E1          0084*       pop hl
040671 ED 53 B5 06 0085*       ld (@de),de
       04          
040676 3A B7 06 04 0086*       ld a,(@de+2)
04067A CD 10 06 04 0087*       call mul24x8
04067E CD 85 06 04 0088*       call @accumulate
040682             0089*   ; all done
040682 DD E1       0090*       pop ix ; restore
040684 C9          0091*       ret
040685             0092*   @accumulate:
040685 DD 23       0093*       inc ix
040687             0094*   ; highest byte of product to carry
040687 DD 77 03    0095*       ld (ix+3),a
04068A             0096*   ; low byte of product
04068A 7D          0097*       ld a,l
04068B DD 86 00    0098*       add a,(ix+0)
04068E DD 77 00    0099*       ld (ix+0),a
040691             0100*   ; high byte of product
040691 7C          0101*       ld a,h
040692 DD 8E 01    0102*       adc a,(ix+1)
040695 DD 77 01    0103*       ld (ix+1),a
040698             0104*   ; uppper byte of product
040698 22 B2 06 04 0105*       ld (@hl),hl
04069C 3A B4 06 04 0106*       ld a,(@hl+2)
0406A0 DD 8E 02    0107*       adc a,(ix+2)
0406A3 DD 77 02    0108*       ld (ix+2),a
0406A6             0109*   ; carry
0406A6 3E 00       0110*       ld a,0 ; preserve flags
0406A8 DD 8E 03    0111*       adc a,(ix+3)
0406AB DD 77 03    0112*       ld (ix+3),a
0406AE C9          0113*       ret
0406AF             0114*   
0406AF 00 00 00    0115*   @ix: dl 0
0406B2 00 00 00    0116*   @hl: dl 0
0406B5 00 00 00    0117*   @de: dl 0
0406B8             0118*   
0406B8             0119*   ; ; UHL * UDE --> UHL (unsigned)
0406B8             0120*   ; umul24:
0406B8             0121*   ;     call mul24
0406B8             0122*   ;     ld hl,(mul24out)
0406B8             0123*   ;     ret
0406B8             0124*   
0406B8             0125*   ; UH.L = UH.L*UD.E (unsigned)
0406B8             0126*   umul168:
0406B8 CD 46 06 04 0127*       call mul24
0406BC 2A 41 06 04 0128*       ld hl,(mul24out+1)
0406C0 C9          0129*       ret
0406C1             0130*   
0406C1             0131*   ; UH.L * UD.E --> UH.L (signed)
0406C1             0132*   smul168:
0406C1             0133*   ; make everything positive and store sign flags
0406C1 CD 06 05 04 0134*       call hlu_abs
0406C5 F5          0135*       push af
0406C6 EB          0136*       ex de,hl
0406C7 CD 06 05 04 0137*       call hlu_abs
0406CB EB          0138*       ex de,hl
0406CC F5          0139*       push af
0406CD             0140*   ; do the division
0406CD CD B8 06 04 0141*       call umul168 ; hl = product
0406D1             0142*   ; adjust sign of result
0406D1 F1          0143*       pop af ; sign de
0406D2 FA DD 06 04 0144*       jp m,@de_neg
0406D6 F1          0145*       pop af ; sign hl
0406D7 F0          0146*       ret p ; both positive, nothing to do
0406D8             0147*   @hl_neg:
0406D8 CD 16 05 04 0148*       call neg_hlu ; de pos, hl neg, result is negative
0406DC C9          0149*       ret
0406DD             0150*   @de_neg:
0406DD F1          0151*       pop af
0406DE F8          0152*       ret m ; both negative, nothing to do
0406DF CD 16 05 04 0153*       call neg_hlu ; result is negative
0406E3 C9          0154*       ret
0406E4             0155*   
0406E4             0156*   ; UH.L / UD.E --> UD.E rem UHL (unsigned)
0406E4             0157*   ; perform unsigned division of 16.8 fixed place values
0406E4             0158*   ; with an unsigned 16.8 fixed place result and 24-bit remainder
0406E4             0159*   udiv168:
0406E4             0160*   ; back up divisor
0406E4 ED 53 1B 07 0161*       ld (@ude),de
       04          
0406E9             0162*   ; get the 16-bit integer part of the quotient
0406E9 CD 07 04 04 0163*       call udiv24 ; de = quotient, hl = remainder
0406ED             0164*   ; load quotient to upper three bytes of output
0406ED ED 53 22 07 0165*       ld (div168_out+1),de
       04          
0406F2             0166*   @div256:
0406F2             0167*   ; multiply remainder by 256
0406F2             0168*       hlu_mul256
0406F2 29          0001*M1     add hl,hl ; * 2
0406F3 29          0002*M1     add hl,hl ; * 4
0406F4 29          0003*M1     add hl,hl ; * 8
0406F5 29          0004*M1     add hl,hl ; * 16
0406F6 29          0005*M1     add hl,hl ; * 32
0406F7 29          0006*M1     add hl,hl ; * 64
0406F8 29          0007*M1     add hl,hl ; * 128
0406F9 29          0008*M1     add hl,hl ; * 256
0406FA             0169*   ; skip fractional computation if remainder is zero
0406FA             0170*       SIGN_HLU
0406FA 19          0001*M1     add hl,de ; 1 cycle
0406FB B7          0002*M1     or a ; clear flags ; 1 cycle
0406FC ED 52       0003*M1     sbc hl,de ; 2 cycles
0406FE             0004*M1     ; 4 cycles total
0406FE 20 03       0171*       jr nz,@div_frac
040700 AF          0172*       xor a
040701 18 0A       0173*       jr @write_frac
040703             0174*   ; now divide the shifted remainder by the divisor
040703             0175*   @div_frac:
040703 ED 5B 1B 07 0176*       ld de,(@ude) ; get back divisor
       04          
040708 CD 07 04 04 0177*       call udiv24 ; de = quotient, hl = remainder
04070C             0178*   ; load low byte of quotient to low byte of output
04070C 7B          0179*       ld a,e
04070D             0180*   @write_frac:
04070D 32 21 07 04 0181*       ld (div168_out),a
040711             0182*   ; load de with return value
040711 ED 5B 21 07 0183*       ld de,(div168_out)
       04          
040716             0184*   ; load a with any overflow
040716 3A 24 07 04 0185*       ld a,(div168_out+3)
04071A C9          0186*       ret ; ud.e is the 16.8 result
04071B             0187*   @ude: ds 6
040721             0188*   div168_out: ds 4 ; the extra byte is for overflow
040725             0189*   
040725             0190*   ; UH.L / UD.E --> UD.E (signed) rem UHL (unsigned)
040725             0191*   ; perform signed division of 16.8 fixed place values
040725             0192*   ; with a signed 16.8 fixed place result and unsigned 24-bit remainder
040725             0193*   sdiv168:
040725             0194*   ; make everything positive and store sign flags
       FF FF FF FF 
       FF FF FF FF 
       FF FF 
040725 CD 06 05 04 0195*       call hlu_abs
040729 F5          0196*       push af
04072A EB          0197*       ex de,hl
04072B CD 06 05 04 0198*       call hlu_abs
04072F EB          0199*       ex de,hl
040730 F5          0200*       push af
040731             0201*   ; do the division
040731 CD E4 06 04 0202*       call udiv168 ; de = quotient, hl = remainder
040735             0203*   ; adjust sign of result
040735 F1          0204*       pop af ; sign de
040736 FA 43 07 04 0205*       jp m,@de_neg
04073A F1          0206*       pop af ; sign hl
04073B F0          0207*       ret p ; both positive, nothing to do
04073C             0208*   @hl_neg:
04073C EB          0209*       ex de,hl ; hl = quotient, de = remainder
04073D CD 16 05 04 0210*       call neg_hlu ; de pos, hl neg, result is negative
040741 EB          0211*       ex de,hl ; de = negated quotient, hl = remainder
040742 C9          0212*       ret
040743             0213*   @de_neg:
040743 F1          0214*       pop af
040744 F8          0215*       ret m ; both negative, nothing to do
040745 EB          0216*       ex de,hl ; hl = quotient, de = remainder
040746 CD 16 05 04 0217*       call neg_hlu ; result is negative
04074A EB          0218*       ex de,hl ; de = negated quotient, hl = remainder
04074B C9          0219*       ret
04074C             0220*   
04074C             0221*   ; convert signed angles from a 360 to 256 degree circle
04074C             0222*   ; inputs: uh.l is the angle360 in 16.8 fixed format
04074C             0223*   ; outputs: uh.l is the angle256 in 16.8 fixed format
04074C             0224*   ; destroys: TODO
04074C             0225*   deg_360_to_256:
04074C D5          0226*       push de ; preserve de
04074D             0227*   ; make angle positive and store sign flag
04074D CD 06 05 04 0228*       call hlu_abs
040751 F5          0229*       push af
040752             0230*   ; multiply by coversion factor of 256/360
040752 11 B6 00 00 0231*       ld de,0x0000B6 ; 0.711
040756 CD B8 06 04 0232*       call umul168 ; uh.l = uh.l * 0.711
04075A             0233*   ; restore sign flag and adjust output accordingly
04075A F1          0234*       pop af
04075B F2 63 07 04 0235*       jp p,@pos ; positive number
04075F CD 16 05 04 0236*       call neg_hlu
040763             0237*   @pos:
040763             0238*   ; restore de and return uh.l as the result
040763 D1          0239*       pop de
040764 C9          0240*       ret
040765             0241*   
040765             0242*   ; convert signed angles from a 256 to 360 degree circle
040765             0243*   ; inputs: uh.l is the angle256 in 16.8 fixed format
040765             0244*   ; outputs: uh.l is the angle360 in 16.8 fixed format
040765             0245*   ; destroys: TODO
040765             0246*   deg_256_to_360:
040765 D5          0247*       push de ; preserve de
040766             0248*   ; make angle positive and store sign flag
040766 CD 06 05 04 0249*       call hlu_abs
04076A F5          0250*       push af
04076B             0251*   ; multiply by coversion factor of 360/256
04076B 11 68 01 00 0252*       ld de,0x000168 ; 1.406
04076F CD B8 06 04 0253*       call umul168 ; uh.l = uh.l * 1.406
040773             0254*   ; restore sign flag and adjust output accordingly
040773 F1          0255*       pop af
040774 F2 7C 07 04 0256*       jp p,@pos ; positive number
040778 CD 16 05 04 0257*       call neg_hlu
04077C             0258*   @pos:
04077C             0259*   ; restore de and return uh.l as the result
04077C D1          0260*       pop de
04077D C9          0261*       ret
04077E             0262*   
04077E             0263*   ; fixed 16.8 routine
04077E             0264*   ; cos(uh.l) --> uh.l
04077E             0265*   ; destroys: f, hl
04077E             0266*   cos168:
04077E D5          0267*       push de ; preserve de
04077F             0268*   ; for cos we simply increment the angle by 90 degrees
04077F             0269*   ; or 0x004000 in 16.8 degrees256
04077F             0270*   ; which makes it a sin problem
04077F 11 00 40 00 0271*       ld de,0x004000
040783 19          0272*       add hl,de ; modulo 256 happens below
040784 D1          0273*       pop de ; restore de
040785             0274*   ; fall through to sin168
040785             0275*   
040785             0276*   ; ---------------------
040785             0277*   ; fixed 16.8 routine
040785             0278*   ; sin(uh.l) --> uh.l
040785             0279*   ; destroys: f, hl
040785             0280*   sin168:
040785 D5          0281*       push de
040786             0282*   ; handle negative angles appropriately
040786 CD 06 05 04 0283*       call hlu_abs
04078A F2 93 07 04 0284*       jp p,@F
04078E 11 00 00 FF 0285*       ld de,-256*256
040792 19          0286*       add hl,de
040793             0287*   @@:
040793 2E 03       0288*       ld l,3 ; multiply by 3 to get our lookup index
040795 ED 6C       0289*       mlt hl
040797 11 4B 0A 04 0290*       ld de,sin_lut_168 ; grab the lut address
04079B 19          0291*       add hl,de ; bump hl by the index
04079C ED 27       0292*       ld hl,(hl) ; don't try this on a z80!
04079E D1          0293*       pop de
04079F C9          0294*       ret
0407A0             0295*   
0407A0             0296*   ; 16.8 fixed inputs / outputs
0407A0             0297*   ; takes: uh.l as angle in degrees 256
0407A0             0298*   ;        ud.e as radius
0407A0             0299*   ; returns ub.c as dx, ud.e as dy, uh.l as radius
0407A0             0300*   ;        displacements from origin (0,0)
0407A0             0301*   ; destroys: everything except indexes
0407A0             0302*   polar_to_cartesian:
0407A0             0303*   ; back up input parameters
0407A0 22 CF 07 04 0304*       ld (@angle), hl
0407A4 ED 53 D2 07 0305*       ld (@radius), de
       04          
0407A9             0306*   ; compute dx = sin(uh.l) * ud.e
0407A9 CD 85 07 04 0307*       call sin168 ; uh.l = sin(uh.l)
0407AD ED 5B D2 07 0308*       ld de,(@radius)
       04          
0407B2 CD C1 06 04 0309*       call smul168 ; uh.l = dx
0407B6 E5          0310*       push hl
0407B7             0311*   ; compute dy = -cos(uh.l) * ud.e
0407B7 2A CF 07 04 0312*       ld hl,(@angle)
0407BB CD 7E 07 04 0313*       call cos168 ; uh.l = cos(uh.l)
0407BF ED 5B D2 07 0314*       ld de,(@radius)
       04          
0407C4 CD C1 06 04 0315*       call smul168 ; uh.l = dy
0407C8 CD 16 05 04 0316*       call neg_hlu ; invert dy for screen coords convention
0407CC EB          0317*       ex de,hl ; de = dy for output
0407CD C1          0318*       pop bc ; bc = dx for output
0407CE             0319*   ; and out
0407CE C9          0320*       ret
0407CF             0321*   @angle: ds 3
0407D2             0322*   @radius: ds 3
0407D5             0323*   
0407D5             0324*   ; 16.8 fixed inputs / outputs
0407D5             0325*   ; inputs: ub.c as dx, ud.e as dy
0407D5             0326*   ;        displacements from origin (0,0)
0407D5             0327*   ; returns: uh.l as angle in degrees 256
0407D5             0328*   ;        ud.e as radius
0407D5             0329*   ; destroys: everything except indexes
0407D5             0330*   cartesian_to_polar:
       FF FF FF FF 
       FF FF 
0407D5 ED 43 2E 08 0331*       ld (dx168),bc ; dx argument for distance168
       04          
0407DA ED 53 34 08 0332*       ld (dy168),de ; dy argument for distance168
       04          
0407DF             0333*   ; compute radius
0407DF CD 3A 08 04 0334*       call distance168 ; uh.l = radius
0407E3 E5          0335*       push hl ; save radius
0407E4             0336*   ; compute angle
0407E4 ED 4B 2E 08 0337*       ld bc,(dx168) ; dx argument for atan2_168fast
       04          
0407E9 ED 5B 34 08 0338*       ld de,(dy168) ; dy argument for atan2_168fast
       04          
0407EE CD 9A 08 04 0339*       call atan2_168fast ; uh.l = angle
0407F2             0340*   ; return result
0407F2 D1          0341*       pop de ; de = radius (was hl)
0407F3 C9          0342*       ret
0407F4             0343*   ; end cartesian_to_polar
0407F4             0344*   
0407F4             0345*   ; 16.8 fixed inputs / outputs
0407F4             0346*   ; inputs: ub.c as dx, ud.e as dy
0407F4             0347*   ;        displacements from origin (0,0)
0407F4             0348*   ; returns: uh.l as angle in degrees 256
0407F4             0349*   ;        ud.e as radius
0407F4             0350*   ; destroys: everything except indexes
0407F4             0351*   ; note: uses distance168sm which is more accurate for small deltas
0407F4             0352*   cartesian_to_polar_sm:
0407F4 ED 43 2E 08 0353*       ld (dx168),bc ; dx argument for distance168
       04          
0407F9 ED 53 34 08 0354*       ld (dy168),de ; dy argument for distance168
       04          
0407FE             0355*   ; compute radius
0407FE CD 75 08 04 0356*       call distance168sm ; uh.l = radius
040802 E5          0357*       push hl ; save radius
040803             0358*   ; compute angle
040803 ED 4B 2E 08 0359*       ld bc,(dx168) ; dx argument for atan2_168fast
       04          
040808 ED 5B 34 08 0360*       ld de,(dy168) ; dy argument for atan2_168fast
       04          
04080D CD 9A 08 04 0361*       call atan2_168fast ; uh.l = angle
040811             0362*   ; return result
040811 D1          0363*       pop de ; de = radius (was hl)
040812 C9          0364*       ret
040813             0365*   ; end cartesian_to_polar
040813             0366*   
040813             0367*   ; inputs: ub.c and ud.e are x0 and y0 in 16.8 fixed format
040813             0368*   ;         ui.x and ui.y are x1 and y1 in 16.8 fixed format
040813             0369*   ; output: ub.c and ud.e are dx and dy in 16.8 fixed format
040813             0370*   ;         also populates scratch locations dx168 and dy168
040813             0371*   ; destroys: a,hl,bc,de
040813             0372*   dxy168:
040813             0373*   ; compute dx = x1-x0
040813 AF          0374*       xor a ; clear carry
040814 DD E5       0375*       push ix ; move ix to hl via the stack
040816 E1          0376*       pop hl ; hl = x1
040817 ED 42       0377*       sbc hl,bc ; hl = dx
040819 22 2E 08 04 0378*       ld (dx168),hl ; dx to scratch
04081D             0379*   ; compute dy = y1-y0
04081D AF          0380*       xor a ; clear carry
04081E FD E5       0381*       push iy ; move iy to hl via the stack
040820 E1          0382*       pop hl ; hl = y1
040821 ED 52       0383*       sbc hl,de ; hl = dy
040823 22 34 08 04 0384*       ld (dy168),hl ; dy to scratch
040827             0385*   ; populate output registers and return
040827 EB          0386*       ex de,hl ; ud.e = dy
040828 ED 4B 2E 08 0387*       ld bc,(dx168) ; ub.c = dx
       04          
04082D C9          0388*       ret
04082E 00 00 00 00 0389*   dx168: blkb 6,0
       00 00       
040834 00 00 00 00 0390*   dy168: blkb 6,0
       00 00       
04083A             0391*   
04083A             0392*   ; compute the euclidian distance between two cartesian coordinates
04083A             0393*   ; using the formula d = sqrt(dx^2+dy^2)
04083A             0394*   ; inputs: dx168 and dy168 are dx and dy in 16.8 fixed format
04083A             0395*   ; output; uh.l is the 16.8 fixed format distance
04083A             0396*   ;         also populates scratch locations dx168 and dy168
04083A             0397*   ; destroys: a,hl,bc,de
04083A             0398*   ; NOTE: rounds both deltas down to the nearest integer to avoid overflow when squaring,
04083A             0399*   ;       thus the result will always be an integer, albeit in 16.8 format
04083A             0400*   distance168:
04083A             0401*   ; compute dy^2
04083A 2A 34 08 04 0402*       ld hl,(dy168)
04083E CD 06 05 04 0403*       call hlu_abs
040842             0404*       ; call hlu_udiv256 ; make integer to avoid overflow
040842             0405*       SRL_UHL ; make integer to avoid overflow
040842 3B          0001*M1     dec sp ; 1 cycle
040843 E5          0002*M1     push hl ; 4 cycles
040844 33          0003*M1     inc sp ; 1 cycle
040845 E1          0004*M1     pop hl ; 4 cycles
040846 23          0005*M1     inc hl ; 1 cycle
040847 52 2B       0006*M1     dec.s hl ; 2 cycles <-- the .s sets hlu to zero (undocumented)
040849             0007*M1     ; 13 cycles total
040849 E5          0406*       push hl
04084A D1          0407*       pop de
04084B CD EE 03 04 0408*       call umul24 ; hl = dy^2
04084F E5          0409*       push hl ; save dy^2
040850             0410*   ; compute dx^2
040850 2A 2E 08 04 0411*       ld hl,(dx168)
040854 CD 06 05 04 0412*       call hlu_abs
040858             0413*       ; call hlu_udiv256 ; make integer to avoid overflow
040858             0414*       SRL_UHL ; make integer to avoid overflow
040858 3B          0001*M1     dec sp ; 1 cycle
040859 E5          0002*M1     push hl ; 4 cycles
04085A 33          0003*M1     inc sp ; 1 cycle
04085B E1          0004*M1     pop hl ; 4 cycles
04085C 23          0005*M1     inc hl ; 1 cycle
04085D 52 2B       0006*M1     dec.s hl ; 2 cycles <-- the .s sets hlu to zero (undocumented)
04085F             0007*M1     ; 13 cycles total
04085F E5          0415*       push hl
040860 D1          0416*       pop de
040861 CD EE 03 04 0417*       call umul24 ; hl = dx^2
040865             0418*   ; add dx^2 and dy^2
040865 D1          0419*       pop de ; de = dy^2 (was hl)
040866 19          0420*       add hl,de ; hl = dx^2 + dy^2
040867             0421*   ; compute the square root
040867 CD 65 09 04 0422*       call sqrt24 ; de = sqrt(dx^2 + dy^2)
04086B EB          0423*       ex de,hl ; hl = distance
04086C             0424*       hlu_mul256 ; convert back to 16.8 fixed
04086C 29          0001*M1     add hl,hl ; * 2
04086D 29          0002*M1     add hl,hl ; * 4
04086E 29          0003*M1     add hl,hl ; * 8
04086F 29          0004*M1     add hl,hl ; * 16
040870 29          0005*M1     add hl,hl ; * 32
040871 29          0006*M1     add hl,hl ; * 64
040872 29          0007*M1     add hl,hl ; * 128
040873 29          0008*M1     add hl,hl ; * 256
040874 C9          0425*       ret
040875             0426*   
040875             0427*   ; compute the euclidian distance between two cartesian coordinates
040875             0428*   ; using the formula d = sqrt(dx^2+dy^2)
040875             0429*   ; inputs: dx168 and dy168 are dx and dy in 16.8 fixed format
040875             0430*   ; output; uh.l is the 16.8 fixed format distance
040875             0431*   ;         also populates scratch locations dx168 and dy168
040875             0432*   ; destroys: a,hl,bc,de
040875             0433*   ; NOTE: sm means 'small' because it doesn't round down the deltas
040875             0434*   ;       making it more accurate for small deltas,
040875             0435*   ;       but will overflow if used for screen-sized deltas
040875             0436*   distance168sm:
040875             0437*   ; compute dy^2
040875 2A 34 08 04 0438*       ld hl,(dy168)
040879 CD 06 05 04 0439*       call hlu_abs
04087D E5          0440*       push hl
04087E D1          0441*       pop de
04087F CD EE 03 04 0442*       call umul24 ; hl = dy^2
040883 E5          0443*       push hl ; save dy^2
040884             0444*   ; compute dx^2
040884 2A 2E 08 04 0445*       ld hl,(dx168)
040888 CD 06 05 04 0446*       call hlu_abs
04088C E5          0447*       push hl
04088D D1          0448*       pop de
04088E CD EE 03 04 0449*       call umul24 ; hl = dx^2
040892             0450*   ; add dx^2 and dy^2
040892 D1          0451*       pop de ; de = dy^2 (was hl)
040893 19          0452*       add hl,de ; hl = dx^2 + dy^2
040894             0453*   ; compute the square root
040894 CD 65 09 04 0454*       call sqrt24 ; de = sqrt(dx^2 + dy^2)
040898 EB          0455*       ex de,hl ; hl = distance
040899 C9          0456*       ret
04089A             0457*   
04089A             0458*   ; atan2_(ub.c,ud.e) --> uh.l
04089A             0459*   ; inputs: ub.c and ud.e are dx and dy in 16.8 fixed format
04089A             0460*   ;   whether inputs are integers or fractional doesn't matter
04089A             0461*   ;   so long as the sign bit of the upper byte is correct
04089A             0462*   ; output: uh.l is the 16.8 fixed angle in degrees 256
04089A             0463*   ; angles are COMPASS HEADINGS based on
04089A             0464*   ; screen coordinate conventions,where the y axis is flipped
04089A             0465*   ; #E0 224      0       32 #20
04089A             0466*   ;        -x,-y | +x,-y
04089A             0467*   ; #C0 192------+------ 64 #40
04089A             0468*   ;        -x,+y | +x,+y
04089A             0469*   ; #A0 160   128 #80   96 #60
04089A             0470*   atan2_168fast:
04089A             0471*   ; get signs and make everything positive
04089A             0472*   ; get abs(x) and store its original sign
04089A C5          0473*       push bc
04089B E1          0474*       pop hl
04089C CD 06 05 04 0475*       call hlu_abs ; if x was negative this also sets the sign flag
0408A0 E5          0476*       push hl ; store abs(x)
0408A1 C1          0477*       pop bc ; bc = abs(x)
0408A2 F5          0478*       push af ; store sign of x
0408A3             0479*   ; get abs(y) and store its original sign
0408A3 EB          0480*       ex de,hl ; hl = y
0408A4 CD 06 05 04 0481*       call hlu_abs ; if y was negative this also sets the sign flag
0408A8 EB          0482*       ex de,hl ; de = abs(y)
0408A9 F5          0483*       push af ; store sign of y
0408AA             0484*   ; if abs(bc) < abs(de),then we do bc/de,otherwise de/bc
0408AA             0485*   ; this ensures that our lookup value is between 0 and 1 inclusive
0408AA AF          0486*       xor a ; clear the carry flag
0408AB D5          0487*       push de
0408AC E1          0488*       pop hl
0408AD ED 42       0489*       sbc hl,bc
0408AF F5          0490*       push af ; save sign of de - bc
0408B0 F2 B9 08 04 0491*       jp p,@1 ; bc <= de, so we skip ahead
0408B4             0492*   ; otherwise we swap bc and de
0408B4 C5          0493*       push bc
0408B5 E1          0494*       pop hl
0408B6 EB          0495*       ex de,hl
0408B7 E5          0496*       push hl
0408B8 C1          0497*       pop bc
0408B9             0498*   @1:
0408B9             0499*   ; now we're ready to snag our preliminary result
0408B9 C5          0500*       push bc
0408BA E1          0501*       pop hl
0408BB CD 29 09 04 0502*       call atan_168fast ; uh.l comes back with prelim result
0408BF             0503*   ; now we adjust uh.l based on sign of de - bc
0408BF F1          0504*       pop af
0408C0 F2 CC 08 04 0505*       jp p,@2 ; bc <= de,so we skip ahead
0408C4 EB          0506*       ex de,hl
0408C5 21 00 40 00 0507*       ld hl,64*256 ; subtract from 64 (90) degrees
0408C9 AF          0508*       xor a ; clear the carry flag
0408CA ED 52       0509*       sbc hl,de
0408CC             0510*   @2:
0408CC             0511*   ; adjust the result based on quadrant
0408CC             0512*   ; #E0 224      0       32 #20
0408CC             0513*   ;        -x,-y | +x,-y
0408CC             0514*   ; #C0 192------+------ 64 #40
0408CC             0515*   ;        -x,+y | +x,+y
0408CC             0516*   ; #A0 160   128 #80   96 #60
0408CC F1          0517*       pop af ; sign of y
0408CD CA 0A 09 04 0518*       jp z,@y_zero
0408D1 F2 EA 08 04 0519*       jp p,@y_pos
0408D5             0520*   ; y neg,check x
0408D5 F1          0521*       pop af ; sign of x
0408D6 CA E4 08 04 0522*       jp z,@y_neg_x_zero
0408DA F2 E9 08 04 0523*       jp p,@y_neg_x_pos
0408DE             0524*   ; y neg,x neg
0408DE             0525*   ; angle is 128 to 256 (270 to 360)
0408DE             0526*   ; negating the intermediate does the trick
0408DE CD 16 05 04 0527*       call neg_hlu
0408E2 18 31       0528*       jr @zero_hlu
0408E4             0529*   
0408E4             0530*   @y_neg_x_zero:
0408E4             0531*   ; y neg,x zero
0408E4             0532*   ; angle is 0
0408E4 21 00 00 00 0533*       ld hl,0
0408E8 C9          0534*       ret
0408E9             0535*   @y_neg_x_pos:
0408E9             0536*   ; y neg,x pos
0408E9             0537*   ; angle is 0 to 64 (0 to 90)
0408E9             0538*   ; so we're good
0408E9 C9          0539*       ret
0408EA             0540*   
0408EA             0541*   @y_pos:
0408EA F1          0542*       pop af ; sign of x
0408EB CA FA 08 04 0543*       jp z,@y_pos_x_zero
0408EF F2 FF 08 04 0544*       jp p,@y_pos_x_pos
0408F3             0545*   ; y pos,x neg
0408F3             0546*   ; angle is 128 to 192 (180-270)
0408F3             0547*   ; so we add 128 to intermediate
0408F3 11 00 80 00 0548*       ld de,128*256
0408F7 19          0549*       add hl,de
0408F8 18 1B       0550*       jr @zero_hlu
0408FA             0551*   @y_pos_x_zero:
0408FA             0552*   ; y pos,x zero
0408FA             0553*   ; angle is 128 (180)
0408FA 21 00 80 00 0554*       ld hl,128*256
0408FE C9          0555*       ret
0408FF             0556*   @y_pos_x_pos:
0408FF             0557*   ; y pos,x pos
0408FF             0558*   ; angle is 64 to 128 (90 to 180)
0408FF             0559*   ; neg the intermediate and add 180 degrees
0408FF CD 16 05 04 0560*       call neg_hlu
040903 11 00 80 00 0561*       ld de,128*256
040907 19          0562*       add hl,de
040908 18 0B       0563*       jr @zero_hlu
04090A             0564*   
04090A             0565*   @y_zero:
04090A F1          0566*       pop af ; sign of x
04090B FA 10 09 04 0567*       jp m,@y_zero_x_neg
04090F             0568*   ; y zero,x pos
04090F             0569*   ; angle is 64 (90),nothing to do
04090F C9          0570*       ret
040910             0571*   @y_zero_x_neg:
040910             0572*   ; y zero ,x neg
040910             0573*   ; angle is 192 (270)
040910 21 00 C0 00 0574*       ld hl,192*256
040914 C9          0575*       ret
040915             0576*   @zero_hlu:
040915 AF          0577*       xor a
040916 22 23 09 04 0578*       ld (@scratch),hl
04091A 32 25 09 04 0579*       ld (@scratch+2),a
04091E 2A 23 09 04 0580*       ld hl,(@scratch)
040922 C9          0581*       ret
040923             0582*   @scratch: ds 6
040929             0583*   
040929             0584*   ; inputs: ub.c and ud.e are dx and dy in 16.8 fixed format
040929             0585*   ; output: uh.l is the 16.8 fixed format angle in degrees 256
040929             0586*   ; destroys: a,hl,bc,de
040929             0587*   ; note: only works for angles from 0 to 32 (45) degrees
040929             0588*   ;   use atan2_168fast (which calls this proc) to handle the full 256 (360) degrees
040929             0589*   atan_168fast:
040929             0590*   ; because we use compass headings instead of geometric angles
040929             0591*   ; we compute dx/dy which is 1/tan(theta) in the maths world
040929             0592*   ; we can do faster unsigned division here because we know dx and dy are positive
       FF FF FF FF 
       FF FF 
040929 CD E4 06 04 0593*       call udiv168 ; ud.e = dx/dy
04092D EB          0594*       ex de,hl ; uh.l = dx/dy
04092E             0595*   ; test uh.l for 0
04092E 19          0596*       add hl,de
04092F B7          0597*       or a
040930 ED 52       0598*       sbc hl,de
040932 28 22       0599*       jr z,@is_zero
040934             0600*   ; test uh.l for 1
040934 AF          0601*       xor a ; clear carry
040935 EB          0602*       ex de,hl
040936 21 00 01 00 0603*       ld hl,1*256 ; 1 in 16.8 fixed format
04093A ED 52       0604*       sbc hl,de
04093C 28 13       0605*       jr z,@is_45
04093E EB          0606*       ex de,hl
04093F             0607*   ; no special cases so we move on
04093F             0608*   ; l contains the fractional portion of tan(uh.l)
04093F             0609*   ; we multiply it by three to get our lookup table index
04093F 26 03       0610*       ld h,3
040941 ED 6C       0611*       mlt hl ; index into lut
040943 11 00 00 00 0612*       ld de,0 ; clear deu
040947 54          0613*       ld d,h ; copy hl to de
040948 5D          0614*       ld e,l ; de contains our index
040949 21 4E 0D 04 0615*       ld hl,atan_lut_168 ; grab the lut address
04094D 19          0616*       add hl,de ; bump hl by the index
04094E ED 27       0617*       ld hl,(hl) ; don't try this on a z80!
040950 C9          0618*       ret ; and out
040951             0619*   @is_45:
040951 21 00 20 00 0620*       ld hl,32*256
040955 C9          0621*       ret
040956             0622*   ; for the case tan(0)
040956             0623*   @is_zero:
040956 21 00 00 00 0624*       ld hl,0*256
04095A C9          0625*       ret
04095B             0626*   
04095B             0627*   ; Expects  ADL mode
04095B             0628*   ; Inputs:  UH.L
04095B             0629*   ; Outputs: UH.L is the 16.8 square root
04095B             0630*   ;          UDE is the integer difference inputHL-DE^2
04095B             0631*   sqrt168:
04095B CD 65 09 04 0632*       call sqrt24
04095F EB          0633*       ex de,hl
040960 29          0634*       add hl,hl
040961 29          0635*       add hl,hl
040962 29          0636*       add hl,hl
040963 29          0637*       add hl,hl
040964 C9          0638*       ret
040965             0639*   
040965             0640*   ; credit: xeda112358
040965             0641*   ; https://www.cemetech.net/forum/viewtopic.php?t=11178&postdays=0&postorder=asc&start=0
040965             0642*   sqrt24:
040965             0643*   ; Expects ADL mode
040965             0644*   ; Inputs: HL
040965             0645*   ; Outputs: DE is the integer square root
040965             0646*   ;  HL is the difference inputHL-DE^2
040965             0647*   ;  c flag reset
040965 01 00 00 00 0648*       ld bc,0 ; clear bcu
040969 11 00 00 00 0649*       ld de,0 ; clear deu
04096D AF          0650*       xor a
04096E 45          0651*       ld b,l
04096F C5          0652*       push bc
040970 47          0653*       ld b,a
040971 6F          0654*       ld l,a
040972             0655*   ; Iteration 1
040972 29          0656*       add hl,hl
040973 CB 11       0657*       rl c
040975 29          0658*       add hl,hl
040976 CB 11       0659*       rl c
040978 91          0660*       sub c
040979 30 04       0661*       jr nc,$+6
04097B 1C          0662*       inc e
04097C 1C          0663*       inc e
04097D 2F          0664*       cpl
04097E 4F          0665*       ld c,a
04097F             0666*   ; Iteration 2
04097F 29          0667*       add hl,hl
040980 CB 11       0668*       rl c
040982 29          0669*       add hl,hl
040983 CB 11       0670*       rl c
040985 CB 13       0671*       rl e
040987 7B          0672*       ld a,e
040988 91          0673*       sub c
040989 30 04       0674*       jr nc,$+6
04098B 1C          0675*       inc e
04098C 1C          0676*       inc e
04098D 2F          0677*       cpl
04098E 4F          0678*       ld c,a
04098F             0679*   ; Iteration 3
04098F 29          0680*       add hl,hl
040990 CB 11       0681*       rl c
040992 29          0682*       add hl,hl
040993 CB 11       0683*       rl c
040995 CB 13       0684*       rl e
040997 7B          0685*       ld a,e
040998 91          0686*       sub c
040999 30 04       0687*       jr nc,$+6
04099B 1C          0688*       inc e
04099C 1C          0689*       inc e
04099D 2F          0690*       cpl
04099E 4F          0691*       ld c,a
04099F             0692*   ; Iteration 4
04099F 29          0693*       add hl,hl
0409A0 CB 11       0694*       rl c
0409A2 29          0695*       add hl,hl
0409A3 CB 11       0696*       rl c
0409A5 CB 13       0697*       rl e
0409A7 7B          0698*       ld a,e
0409A8 91          0699*       sub c
0409A9 30 04       0700*       jr nc,$+6
0409AB 1C          0701*       inc e
0409AC 1C          0702*       inc e
0409AD 2F          0703*       cpl
0409AE 4F          0704*       ld c,a
0409AF             0705*   ; Iteration 5
0409AF 29          0706*       add hl,hl
0409B0 CB 11       0707*       rl c
0409B2 29          0708*       add hl,hl
0409B3 CB 11       0709*       rl c
0409B5 CB 13       0710*       rl e
0409B7 7B          0711*       ld a,e
0409B8 91          0712*       sub c
0409B9 30 04       0713*       jr nc,$+6
0409BB 1C          0714*       inc e
0409BC 1C          0715*       inc e
0409BD 2F          0716*       cpl
0409BE 4F          0717*       ld c,a
0409BF             0718*   ; Iteration 6
0409BF 29          0719*       add hl,hl
0409C0 CB 11       0720*       rl c
0409C2 29          0721*       add hl,hl
0409C3 CB 11       0722*       rl c
0409C5 CB 13       0723*       rl e
0409C7 7B          0724*       ld a,e
0409C8 91          0725*       sub c
0409C9 30 04       0726*       jr nc,$+6
0409CB 1C          0727*       inc e
0409CC 1C          0728*       inc e
0409CD 2F          0729*       cpl
0409CE 4F          0730*       ld c,a
0409CF             0731*   ; Iteration 7
0409CF 29          0732*       add hl,hl
0409D0 CB 11       0733*       rl c
0409D2 29          0734*       add hl,hl
0409D3 CB 11       0735*       rl c
0409D5 CB 10       0736*       rl b
0409D7 EB          0737*       ex de,hl
0409D8 29          0738*       add hl,hl
0409D9 E5          0739*       push hl
0409DA ED 42       0740*       sbc hl,bc
0409DC 30 06       0741*       jr nc,$+8
0409DE 7C          0742*       ld a,h
0409DF 2F          0743*       cpl
0409E0 47          0744*       ld b,a
0409E1 7D          0745*       ld a,l
0409E2 2F          0746*       cpl
0409E3 4F          0747*       ld c,a
0409E4 E1          0748*       pop hl
0409E5 30 02       0749*       jr nc,$+4
0409E7 23          0750*       inc hl
0409E8 23          0751*       inc hl
0409E9 EB          0752*       ex de,hl
0409EA             0753*   ; Iteration 8
0409EA 29          0754*       add hl,hl
0409EB 69          0755*       ld l,c
0409EC 60          0756*       ld h,b
0409ED ED 6A       0757*       adc hl,hl
0409EF ED 6A       0758*       adc hl,hl
0409F1 EB          0759*       ex de,hl
0409F2 29          0760*       add hl,hl
0409F3 ED 52       0761*       sbc hl,de
0409F5 19          0762*       add hl,de
0409F6 EB          0763*       ex de,hl
0409F7 30 04       0764*       jr nc,$+6
0409F9 ED 52       0765*       sbc hl,de
0409FB 13          0766*       inc de
0409FC 13          0767*       inc de
0409FD             0768*   ; Iteration 9
0409FD F1          0769*       pop af
0409FE 17          0770*       rla
0409FF ED 6A       0771*       adc hl,hl
040A01 17          0772*       rla
040A02 ED 6A       0773*       adc hl,hl
040A04 EB          0774*       ex de,hl
040A05 29          0775*       add hl,hl
040A06 ED 52       0776*       sbc hl,de
040A08 19          0777*       add hl,de
040A09 EB          0778*       ex de,hl
040A0A 30 04       0779*       jr nc,$+6
040A0C ED 52       0780*       sbc hl,de
040A0E 13          0781*       inc de
040A0F 13          0782*       inc de
040A10             0783*   ; Iteration 10
040A10 17          0784*       rla
040A11 ED 6A       0785*       adc hl,hl
040A13 17          0786*       rla
040A14 ED 6A       0787*       adc hl,hl
040A16 EB          0788*       ex de,hl
040A17 29          0789*       add hl,hl
040A18 ED 52       0790*       sbc hl,de
040A1A 19          0791*       add hl,de
040A1B EB          0792*       ex de,hl
040A1C 30 04       0793*       jr nc,$+6
040A1E ED 52       0794*       sbc hl,de
040A20 13          0795*       inc de
040A21 13          0796*       inc de
040A22             0797*   ; Iteration 11
040A22 17          0798*       rla
040A23 ED 6A       0799*       adc hl,hl
040A25 17          0800*       rla
040A26 ED 6A       0801*       adc hl,hl
040A28 EB          0802*       ex de,hl
040A29 29          0803*       add hl,hl
040A2A ED 52       0804*       sbc hl,de
040A2C 19          0805*       add hl,de
040A2D EB          0806*       ex de,hl
040A2E 30 04       0807*       jr nc,$+6
040A30 ED 52       0808*       sbc hl,de
040A32 13          0809*       inc de
040A33 13          0810*       inc de
040A34             0811*   ; Iteration 12
040A34 17          0812*       rla
040A35 ED 6A       0813*       adc hl,hl
040A37 17          0814*       rla
040A38 ED 6A       0815*       adc hl,hl
040A3A EB          0816*       ex de,hl
040A3B 29          0817*       add hl,hl
040A3C ED 52       0818*       sbc hl,de
040A3E 19          0819*       add hl,de
040A3F EB          0820*       ex de,hl
040A40 30 04       0821*       jr nc,$+6
040A42 ED 52       0822*       sbc hl,de
040A44 13          0823*       inc de
040A45 13          0824*       inc de
040A46 CB 1A       0825*       rr d
040A48 CB 1B       0826*       rr e
040A4A C9          0827*       ret
040A4B             0828*   
040A4B             0829*   sin_lut_168:
040A4B 00 00 00    0830*       dl 0x000000 ; 0.000 00, 0.000
040A4E 06 00 00    0831*       dl 0x000006 ; 1.406 01, 0.025
040A51 0C 00 00    0832*       dl 0x00000C ; 2.813 02, 0.049
040A54 12 00 00    0833*       dl 0x000012 ; 4.219 03, 0.074
040A57 19 00 00    0834*       dl 0x000019 ; 5.625 04, 0.098
040A5A 1F 00 00    0835*       dl 0x00001F ; 7.031 05, 0.122
040A5D 25 00 00    0836*       dl 0x000025 ; 8.438 06, 0.147
040A60 2B 00 00    0837*       dl 0x00002B ; 9.844 07, 0.171
040A63 31 00 00    0838*       dl 0x000031 ; 11.250 08, 0.195
040A66 38 00 00    0839*       dl 0x000038 ; 12.656 09, 0.219
040A69 3E 00 00    0840*       dl 0x00003E ; 14.063 0A, 0.243
040A6C 44 00 00    0841*       dl 0x000044 ; 15.469 0B, 0.267
040A6F 4A 00 00    0842*       dl 0x00004A ; 16.875 0C, 0.290
040A72 50 00 00    0843*       dl 0x000050 ; 18.281 0D, 0.314
040A75 56 00 00    0844*       dl 0x000056 ; 19.688 0E, 0.337
040A78 5C 00 00    0845*       dl 0x00005C ; 21.094 0F, 0.360
040A7B 61 00 00    0846*       dl 0x000061 ; 22.500 10, 0.383
040A7E 67 00 00    0847*       dl 0x000067 ; 23.906 11, 0.405
040A81 6D 00 00    0848*       dl 0x00006D ; 25.313 12, 0.428
040A84 73 00 00    0849*       dl 0x000073 ; 26.719 13, 0.450
040A87 78 00 00    0850*       dl 0x000078 ; 28.125 14, 0.471
040A8A 7E 00 00    0851*       dl 0x00007E ; 29.531 15, 0.493
040A8D 83 00 00    0852*       dl 0x000083 ; 30.938 16, 0.514
040A90 88 00 00    0853*       dl 0x000088 ; 32.344 17, 0.535
040A93 8E 00 00    0854*       dl 0x00008E ; 33.750 18, 0.556
040A96 93 00 00    0855*       dl 0x000093 ; 35.156 19, 0.576
040A99 98 00 00    0856*       dl 0x000098 ; 36.563 1A, 0.596
040A9C 9D 00 00    0857*       dl 0x00009D ; 37.969 1B, 0.615
040A9F A2 00 00    0858*       dl 0x0000A2 ; 39.375 1C, 0.634
040AA2 A7 00 00    0859*       dl 0x0000A7 ; 40.781 1D, 0.653
040AA5 AB 00 00    0860*       dl 0x0000AB ; 42.188 1E, 0.672
040AA8 B0 00 00    0861*       dl 0x0000B0 ; 43.594 1F, 0.690
040AAB B5 00 00    0862*       dl 0x0000B5 ; 45.000 20, 0.707
040AAE B9 00 00    0863*       dl 0x0000B9 ; 46.406 21, 0.724
040AB1 BD 00 00    0864*       dl 0x0000BD ; 47.813 22, 0.741
040AB4 C1 00 00    0865*       dl 0x0000C1 ; 49.219 23, 0.757
040AB7 C5 00 00    0866*       dl 0x0000C5 ; 50.625 24, 0.773
040ABA C9 00 00    0867*       dl 0x0000C9 ; 52.031 25, 0.788
040ABD CD 00 00    0868*       dl 0x0000CD ; 53.438 26, 0.803
040AC0 D1 00 00    0869*       dl 0x0000D1 ; 54.844 27, 0.818
040AC3 D4 00 00    0870*       dl 0x0000D4 ; 56.250 28, 0.831
040AC6 D8 00 00    0871*       dl 0x0000D8 ; 57.656 29, 0.845
040AC9 DB 00 00    0872*       dl 0x0000DB ; 59.063 2A, 0.858
040ACC DE 00 00    0873*       dl 0x0000DE ; 60.469 2B, 0.870
040ACF E1 00 00    0874*       dl 0x0000E1 ; 61.875 2C, 0.882
040AD2 E4 00 00    0875*       dl 0x0000E4 ; 63.281 2D, 0.893
040AD5 E7 00 00    0876*       dl 0x0000E7 ; 64.688 2E, 0.904
040AD8 EA 00 00    0877*       dl 0x0000EA ; 66.094 2F, 0.914
040ADB EC 00 00    0878*       dl 0x0000EC ; 67.500 30, 0.924
040ADE EE 00 00    0879*       dl 0x0000EE ; 68.906 31, 0.933
040AE1 F1 00 00    0880*       dl 0x0000F1 ; 70.313 32, 0.942
040AE4 F3 00 00    0881*       dl 0x0000F3 ; 71.719 33, 0.950
040AE7 F4 00 00    0882*       dl 0x0000F4 ; 73.125 34, 0.957
040AEA F6 00 00    0883*       dl 0x0000F6 ; 74.531 35, 0.964
040AED F8 00 00    0884*       dl 0x0000F8 ; 75.938 36, 0.970
040AF0 F9 00 00    0885*       dl 0x0000F9 ; 77.344 37, 0.976
040AF3 FB 00 00    0886*       dl 0x0000FB ; 78.750 38, 0.981
040AF6 FC 00 00    0887*       dl 0x0000FC ; 80.156 39, 0.985
040AF9 FD 00 00    0888*       dl 0x0000FD ; 81.563 3A, 0.989
040AFC FE 00 00    0889*       dl 0x0000FE ; 82.969 3B, 0.992
040AFF FE 00 00    0890*       dl 0x0000FE ; 84.375 3C, 0.995
040B02 FF 00 00    0891*       dl 0x0000FF ; 85.781 3D, 0.997
040B05 FF 00 00    0892*       dl 0x0000FF ; 87.188 3E, 0.999
040B08 FF 00 00    0893*       dl 0x0000FF ; 88.594 3F, 1.000
040B0B 00 01 00    0894*       dl 0x000100 ; 90.000 40, 1.000
040B0E FF 00 00    0895*       dl 0x0000FF ; 91.406 41, 1.000
040B11 FF 00 00    0896*       dl 0x0000FF ; 92.813 42, 0.999
040B14 FF 00 00    0897*       dl 0x0000FF ; 94.219 43, 0.997
040B17 FE 00 00    0898*       dl 0x0000FE ; 95.625 44, 0.995
040B1A FE 00 00    0899*       dl 0x0000FE ; 97.031 45, 0.992
040B1D FD 00 00    0900*       dl 0x0000FD ; 98.438 46, 0.989
040B20 FC 00 00    0901*       dl 0x0000FC ; 99.844 47, 0.985
040B23 FB 00 00    0902*       dl 0x0000FB ; 101.250 48, 0.981
040B26 F9 00 00    0903*       dl 0x0000F9 ; 102.656 49, 0.976
040B29 F8 00 00    0904*       dl 0x0000F8 ; 104.063 4A, 0.970
040B2C F6 00 00    0905*       dl 0x0000F6 ; 105.469 4B, 0.964
040B2F F4 00 00    0906*       dl 0x0000F4 ; 106.875 4C, 0.957
040B32 F3 00 00    0907*       dl 0x0000F3 ; 108.281 4D, 0.950
040B35 F1 00 00    0908*       dl 0x0000F1 ; 109.688 4E, 0.942
040B38 EE 00 00    0909*       dl 0x0000EE ; 111.094 4F, 0.933
040B3B EC 00 00    0910*       dl 0x0000EC ; 112.500 50, 0.924
040B3E EA 00 00    0911*       dl 0x0000EA ; 113.906 51, 0.914
040B41 E7 00 00    0912*       dl 0x0000E7 ; 115.313 52, 0.904
040B44 E4 00 00    0913*       dl 0x0000E4 ; 116.719 53, 0.893
040B47 E1 00 00    0914*       dl 0x0000E1 ; 118.125 54, 0.882
040B4A DE 00 00    0915*       dl 0x0000DE ; 119.531 55, 0.870
040B4D DB 00 00    0916*       dl 0x0000DB ; 120.938 56, 0.858
040B50 D8 00 00    0917*       dl 0x0000D8 ; 122.344 57, 0.845
040B53 D4 00 00    0918*       dl 0x0000D4 ; 123.750 58, 0.831
040B56 D1 00 00    0919*       dl 0x0000D1 ; 125.156 59, 0.818
040B59 CD 00 00    0920*       dl 0x0000CD ; 126.563 5A, 0.803
040B5C C9 00 00    0921*       dl 0x0000C9 ; 127.969 5B, 0.788
040B5F C5 00 00    0922*       dl 0x0000C5 ; 129.375 5C, 0.773
040B62 C1 00 00    0923*       dl 0x0000C1 ; 130.781 5D, 0.757
040B65 BD 00 00    0924*       dl 0x0000BD ; 132.188 5E, 0.741
040B68 B9 00 00    0925*       dl 0x0000B9 ; 133.594 5F, 0.724
040B6B B5 00 00    0926*       dl 0x0000B5 ; 135.000 60, 0.707
040B6E B0 00 00    0927*       dl 0x0000B0 ; 136.406 61, 0.690
040B71 AB 00 00    0928*       dl 0x0000AB ; 137.813 62, 0.672
040B74 A7 00 00    0929*       dl 0x0000A7 ; 139.219 63, 0.653
040B77 A2 00 00    0930*       dl 0x0000A2 ; 140.625 64, 0.634
040B7A 9D 00 00    0931*       dl 0x00009D ; 142.031 65, 0.615
040B7D 98 00 00    0932*       dl 0x000098 ; 143.438 66, 0.596
040B80 93 00 00    0933*       dl 0x000093 ; 144.844 67, 0.576
040B83 8E 00 00    0934*       dl 0x00008E ; 146.250 68, 0.556
040B86 88 00 00    0935*       dl 0x000088 ; 147.656 69, 0.535
040B89 83 00 00    0936*       dl 0x000083 ; 149.063 6A, 0.514
040B8C 7E 00 00    0937*       dl 0x00007E ; 150.469 6B, 0.493
040B8F 78 00 00    0938*       dl 0x000078 ; 151.875 6C, 0.471
040B92 73 00 00    0939*       dl 0x000073 ; 153.281 6D, 0.450
040B95 6D 00 00    0940*       dl 0x00006D ; 154.688 6E, 0.428
040B98 67 00 00    0941*       dl 0x000067 ; 156.094 6F, 0.405
040B9B 61 00 00    0942*       dl 0x000061 ; 157.500 70, 0.383
040B9E 5C 00 00    0943*       dl 0x00005C ; 158.906 71, 0.360
040BA1 56 00 00    0944*       dl 0x000056 ; 160.313 72, 0.337
040BA4 50 00 00    0945*       dl 0x000050 ; 161.719 73, 0.314
040BA7 4A 00 00    0946*       dl 0x00004A ; 163.125 74, 0.290
040BAA 44 00 00    0947*       dl 0x000044 ; 164.531 75, 0.267
040BAD 3E 00 00    0948*       dl 0x00003E ; 165.938 76, 0.243
040BB0 38 00 00    0949*       dl 0x000038 ; 167.344 77, 0.219
040BB3 31 00 00    0950*       dl 0x000031 ; 168.750 78, 0.195
040BB6 2B 00 00    0951*       dl 0x00002B ; 170.156 79, 0.171
040BB9 25 00 00    0952*       dl 0x000025 ; 171.563 7A, 0.147
040BBC 1F 00 00    0953*       dl 0x00001F ; 172.969 7B, 0.122
040BBF 19 00 00    0954*       dl 0x000019 ; 174.375 7C, 0.098
040BC2 12 00 00    0955*       dl 0x000012 ; 175.781 7D, 0.074
040BC5 0C 00 00    0956*       dl 0x00000C ; 177.188 7E, 0.049
040BC8 06 00 00    0957*       dl 0x000006 ; 178.594 7F, 0.025
040BCB 00 00 00    0958*       dl 0x000000 ; 180.000 80, 0.000
040BCE FA FF FF    0959*       dl 0xFFFFFA ; 181.406 81, -0.025
040BD1 F4 FF FF    0960*       dl 0xFFFFF4 ; 182.813 82, -0.049
040BD4 EE FF FF    0961*       dl 0xFFFFEE ; 184.219 83, -0.074
040BD7 E7 FF FF    0962*       dl 0xFFFFE7 ; 185.625 84, -0.098
040BDA E1 FF FF    0963*       dl 0xFFFFE1 ; 187.031 85, -0.122
040BDD DB FF FF    0964*       dl 0xFFFFDB ; 188.438 86, -0.147
040BE0 D5 FF FF    0965*       dl 0xFFFFD5 ; 189.844 87, -0.171
040BE3 CF FF FF    0966*       dl 0xFFFFCF ; 191.250 88, -0.195
040BE6 C8 FF FF    0967*       dl 0xFFFFC8 ; 192.656 89, -0.219
040BE9 C2 FF FF    0968*       dl 0xFFFFC2 ; 194.063 8A, -0.243
040BEC BC FF FF    0969*       dl 0xFFFFBC ; 195.469 8B, -0.267
040BEF B6 FF FF    0970*       dl 0xFFFFB6 ; 196.875 8C, -0.290
040BF2 B0 FF FF    0971*       dl 0xFFFFB0 ; 198.281 8D, -0.314
040BF5 AA FF FF    0972*       dl 0xFFFFAA ; 199.688 8E, -0.337
040BF8 A4 FF FF    0973*       dl 0xFFFFA4 ; 201.094 8F, -0.360
040BFB 9F FF FF    0974*       dl 0xFFFF9F ; 202.500 90, -0.383
040BFE 99 FF FF    0975*       dl 0xFFFF99 ; 203.906 91, -0.405
040C01 93 FF FF    0976*       dl 0xFFFF93 ; 205.313 92, -0.428
040C04 8D FF FF    0977*       dl 0xFFFF8D ; 206.719 93, -0.450
040C07 88 FF FF    0978*       dl 0xFFFF88 ; 208.125 94, -0.471
040C0A 82 FF FF    0979*       dl 0xFFFF82 ; 209.531 95, -0.493
040C0D 7D FF FF    0980*       dl 0xFFFF7D ; 210.938 96, -0.514
040C10 78 FF FF    0981*       dl 0xFFFF78 ; 212.344 97, -0.535
040C13 72 FF FF    0982*       dl 0xFFFF72 ; 213.750 98, -0.556
040C16 6D FF FF    0983*       dl 0xFFFF6D ; 215.156 99, -0.576
040C19 68 FF FF    0984*       dl 0xFFFF68 ; 216.563 9A, -0.596
040C1C 63 FF FF    0985*       dl 0xFFFF63 ; 217.969 9B, -0.615
040C1F 5E FF FF    0986*       dl 0xFFFF5E ; 219.375 9C, -0.634
040C22 59 FF FF    0987*       dl 0xFFFF59 ; 220.781 9D, -0.653
040C25 55 FF FF    0988*       dl 0xFFFF55 ; 222.188 9E, -0.672
040C28 50 FF FF    0989*       dl 0xFFFF50 ; 223.594 9F, -0.690
040C2B 4B FF FF    0990*       dl 0xFFFF4B ; 225.000 A0, -0.707
040C2E 47 FF FF    0991*       dl 0xFFFF47 ; 226.406 A1, -0.724
040C31 43 FF FF    0992*       dl 0xFFFF43 ; 227.813 A2, -0.741
040C34 3F FF FF    0993*       dl 0xFFFF3F ; 229.219 A3, -0.757
040C37 3B FF FF    0994*       dl 0xFFFF3B ; 230.625 A4, -0.773
040C3A 37 FF FF    0995*       dl 0xFFFF37 ; 232.031 A5, -0.788
040C3D 33 FF FF    0996*       dl 0xFFFF33 ; 233.438 A6, -0.803
040C40 2F FF FF    0997*       dl 0xFFFF2F ; 234.844 A7, -0.818
040C43 2C FF FF    0998*       dl 0xFFFF2C ; 236.250 A8, -0.831
040C46 28 FF FF    0999*       dl 0xFFFF28 ; 237.656 A9, -0.845
040C49 25 FF FF    1000*       dl 0xFFFF25 ; 239.063 AA, -0.858
040C4C 22 FF FF    1001*       dl 0xFFFF22 ; 240.469 AB, -0.870
040C4F 1F FF FF    1002*       dl 0xFFFF1F ; 241.875 AC, -0.882
040C52 1C FF FF    1003*       dl 0xFFFF1C ; 243.281 AD, -0.893
040C55 19 FF FF    1004*       dl 0xFFFF19 ; 244.688 AE, -0.904
040C58 16 FF FF    1005*       dl 0xFFFF16 ; 246.094 AF, -0.914
040C5B 14 FF FF    1006*       dl 0xFFFF14 ; 247.500 B0, -0.924
040C5E 12 FF FF    1007*       dl 0xFFFF12 ; 248.906 B1, -0.933
040C61 0F FF FF    1008*       dl 0xFFFF0F ; 250.313 B2, -0.942
040C64 0D FF FF    1009*       dl 0xFFFF0D ; 251.719 B3, -0.950
040C67 0C FF FF    1010*       dl 0xFFFF0C ; 253.125 B4, -0.957
040C6A 0A FF FF    1011*       dl 0xFFFF0A ; 254.531 B5, -0.964
040C6D 08 FF FF    1012*       dl 0xFFFF08 ; 255.938 B6, -0.970
040C70 07 FF FF    1013*       dl 0xFFFF07 ; 257.344 B7, -0.976
040C73 05 FF FF    1014*       dl 0xFFFF05 ; 258.750 B8, -0.981
040C76 04 FF FF    1015*       dl 0xFFFF04 ; 260.156 B9, -0.985
040C79 03 FF FF    1016*       dl 0xFFFF03 ; 261.563 BA, -0.989
040C7C 02 FF FF    1017*       dl 0xFFFF02 ; 262.969 BB, -0.992
040C7F 02 FF FF    1018*       dl 0xFFFF02 ; 264.375 BC, -0.995
040C82 01 FF FF    1019*       dl 0xFFFF01 ; 265.781 BD, -0.997
040C85 01 FF FF    1020*       dl 0xFFFF01 ; 267.188 BE, -0.999
040C88 01 FF FF    1021*       dl 0xFFFF01 ; 268.594 BF, -1.000
040C8B 00 FF FF    1022*       dl 0xFFFF00 ; 270.000 C0, -1.000
040C8E 01 FF FF    1023*       dl 0xFFFF01 ; 271.406 C1, -1.000
040C91 01 FF FF    1024*       dl 0xFFFF01 ; 272.813 C2, -0.999
040C94 01 FF FF    1025*       dl 0xFFFF01 ; 274.219 C3, -0.997
040C97 02 FF FF    1026*       dl 0xFFFF02 ; 275.625 C4, -0.995
040C9A 02 FF FF    1027*       dl 0xFFFF02 ; 277.031 C5, -0.992
040C9D 03 FF FF    1028*       dl 0xFFFF03 ; 278.438 C6, -0.989
040CA0 04 FF FF    1029*       dl 0xFFFF04 ; 279.844 C7, -0.985
040CA3 05 FF FF    1030*       dl 0xFFFF05 ; 281.250 C8, -0.981
040CA6 07 FF FF    1031*       dl 0xFFFF07 ; 282.656 C9, -0.976
040CA9 08 FF FF    1032*       dl 0xFFFF08 ; 284.063 CA, -0.970
040CAC 0A FF FF    1033*       dl 0xFFFF0A ; 285.469 CB, -0.964
040CAF 0C FF FF    1034*       dl 0xFFFF0C ; 286.875 CC, -0.957
040CB2 0D FF FF    1035*       dl 0xFFFF0D ; 288.281 CD, -0.950
040CB5 0F FF FF    1036*       dl 0xFFFF0F ; 289.688 CE, -0.942
040CB8 12 FF FF    1037*       dl 0xFFFF12 ; 291.094 CF, -0.933
040CBB 14 FF FF    1038*       dl 0xFFFF14 ; 292.500 D0, -0.924
040CBE 16 FF FF    1039*       dl 0xFFFF16 ; 293.906 D1, -0.914
040CC1 19 FF FF    1040*       dl 0xFFFF19 ; 295.313 D2, -0.904
040CC4 1C FF FF    1041*       dl 0xFFFF1C ; 296.719 D3, -0.893
040CC7 1F FF FF    1042*       dl 0xFFFF1F ; 298.125 D4, -0.882
040CCA 22 FF FF    1043*       dl 0xFFFF22 ; 299.531 D5, -0.870
040CCD 25 FF FF    1044*       dl 0xFFFF25 ; 300.938 D6, -0.858
040CD0 28 FF FF    1045*       dl 0xFFFF28 ; 302.344 D7, -0.845
040CD3 2C FF FF    1046*       dl 0xFFFF2C ; 303.750 D8, -0.831
040CD6 2F FF FF    1047*       dl 0xFFFF2F ; 305.156 D9, -0.818
040CD9 33 FF FF    1048*       dl 0xFFFF33 ; 306.563 DA, -0.803
040CDC 37 FF FF    1049*       dl 0xFFFF37 ; 307.969 DB, -0.788
040CDF 3B FF FF    1050*       dl 0xFFFF3B ; 309.375 DC, -0.773
040CE2 3F FF FF    1051*       dl 0xFFFF3F ; 310.781 DD, -0.757
040CE5 43 FF FF    1052*       dl 0xFFFF43 ; 312.188 DE, -0.741
040CE8 47 FF FF    1053*       dl 0xFFFF47 ; 313.594 DF, -0.724
040CEB 4B FF FF    1054*       dl 0xFFFF4B ; 315.000 E0, -0.707
040CEE 50 FF FF    1055*       dl 0xFFFF50 ; 316.406 E1, -0.690
040CF1 55 FF FF    1056*       dl 0xFFFF55 ; 317.813 E2, -0.672
040CF4 59 FF FF    1057*       dl 0xFFFF59 ; 319.219 E3, -0.653
040CF7 5E FF FF    1058*       dl 0xFFFF5E ; 320.625 E4, -0.634
040CFA 63 FF FF    1059*       dl 0xFFFF63 ; 322.031 E5, -0.615
040CFD 68 FF FF    1060*       dl 0xFFFF68 ; 323.438 E6, -0.596
040D00 6D FF FF    1061*       dl 0xFFFF6D ; 324.844 E7, -0.576
040D03 72 FF FF    1062*       dl 0xFFFF72 ; 326.250 E8, -0.556
040D06 78 FF FF    1063*       dl 0xFFFF78 ; 327.656 E9, -0.535
040D09 7D FF FF    1064*       dl 0xFFFF7D ; 329.063 EA, -0.514
040D0C 82 FF FF    1065*       dl 0xFFFF82 ; 330.469 EB, -0.493
040D0F 88 FF FF    1066*       dl 0xFFFF88 ; 331.875 EC, -0.471
040D12 8D FF FF    1067*       dl 0xFFFF8D ; 333.281 ED, -0.450
040D15 93 FF FF    1068*       dl 0xFFFF93 ; 334.688 EE, -0.428
040D18 99 FF FF    1069*       dl 0xFFFF99 ; 336.094 EF, -0.405
040D1B 9F FF FF    1070*       dl 0xFFFF9F ; 337.500 F0, -0.383
040D1E A4 FF FF    1071*       dl 0xFFFFA4 ; 338.906 F1, -0.360
040D21 AA FF FF    1072*       dl 0xFFFFAA ; 340.313 F2, -0.337
040D24 B0 FF FF    1073*       dl 0xFFFFB0 ; 341.719 F3, -0.314
040D27 B6 FF FF    1074*       dl 0xFFFFB6 ; 343.125 F4, -0.290
040D2A BC FF FF    1075*       dl 0xFFFFBC ; 344.531 F5, -0.267
040D2D C2 FF FF    1076*       dl 0xFFFFC2 ; 345.938 F6, -0.243
040D30 C8 FF FF    1077*       dl 0xFFFFC8 ; 347.344 F7, -0.219
040D33 CF FF FF    1078*       dl 0xFFFFCF ; 348.750 F8, -0.195
040D36 D5 FF FF    1079*       dl 0xFFFFD5 ; 350.156 F9, -0.171
040D39 DB FF FF    1080*       dl 0xFFFFDB ; 351.563 FA, -0.147
040D3C E1 FF FF    1081*       dl 0xFFFFE1 ; 352.969 FB, -0.122
040D3F E7 FF FF    1082*       dl 0xFFFFE7 ; 354.375 FC, -0.098
040D42 EE FF FF    1083*       dl 0xFFFFEE ; 355.781 FD, -0.074
040D45 F4 FF FF    1084*       dl 0xFFFFF4 ; 357.188 FE, -0.049
040D48 FA FF FF    1085*       dl 0xFFFFFA ; 358.594 FF, -0.025
040D4B 00 00 00    1086*       dl 0x000000 ; 0.000 00, 0.000 for interpolation
040D4E             1087*   
040D4E             1088*   atan_lut_168:
040D4E 00 00 00    1089*       dl 0x000000 ; 000000, 0.000
040D51 28 00 00    1090*       dl 0x000028 ; 000001, 0.224
040D54 51 00 00    1091*       dl 0x000051 ; 000002, 0.448
040D57 7A 00 00    1092*       dl 0x00007A ; 000003, 0.671
040D5A A2 00 00    1093*       dl 0x0000A2 ; 000004, 0.895
040D5D CB 00 00    1094*       dl 0x0000CB ; 000005, 1.119
040D60 F4 00 00    1095*       dl 0x0000F4 ; 000006, 1.343
040D63 1D 01 00    1096*       dl 0x00011D ; 000007, 1.566
040D66 45 01 00    1097*       dl 0x000145 ; 000008, 1.790
040D69 6E 01 00    1098*       dl 0x00016E ; 000009, 2.013
040D6C 97 01 00    1099*       dl 0x000197 ; 00000A, 2.237
040D6F BF 01 00    1100*       dl 0x0001BF ; 00000B, 2.460
040D72 E8 01 00    1101*       dl 0x0001E8 ; 00000C, 2.684
040D75 11 02 00    1102*       dl 0x000211 ; 00000D, 2.907
040D78 39 02 00    1103*       dl 0x000239 ; 00000E, 3.130
040D7B 62 02 00    1104*       dl 0x000262 ; 00000F, 3.353
040D7E 8B 02 00    1105*       dl 0x00028B ; 000010, 3.576
040D81 B3 02 00    1106*       dl 0x0002B3 ; 000011, 3.799
040D84 DC 02 00    1107*       dl 0x0002DC ; 000012, 4.022
040D87 04 03 00    1108*       dl 0x000304 ; 000013, 4.245
040D8A 2D 03 00    1109*       dl 0x00032D ; 000014, 4.467
040D8D 55 03 00    1110*       dl 0x000355 ; 000015, 4.690
040D90 7E 03 00    1111*       dl 0x00037E ; 000016, 4.912
040D93 A6 03 00    1112*       dl 0x0003A6 ; 000017, 5.134
040D96 CE 03 00    1113*       dl 0x0003CE ; 000018, 5.356
040D99 F7 03 00    1114*       dl 0x0003F7 ; 000019, 5.578
040D9C 1F 04 00    1115*       dl 0x00041F ; 00001A, 5.799
040D9F 48 04 00    1116*       dl 0x000448 ; 00001B, 6.021
040DA2 70 04 00    1117*       dl 0x000470 ; 00001C, 6.242
040DA5 98 04 00    1118*       dl 0x000498 ; 00001D, 6.463
040DA8 C0 04 00    1119*       dl 0x0004C0 ; 00001E, 6.684
040DAB E8 04 00    1120*       dl 0x0004E8 ; 00001F, 6.905
040DAE 11 05 00    1121*       dl 0x000511 ; 000020, 7.125
040DB1 39 05 00    1122*       dl 0x000539 ; 000021, 7.345
040DB4 61 05 00    1123*       dl 0x000561 ; 000022, 7.565
040DB7 89 05 00    1124*       dl 0x000589 ; 000023, 7.785
040DBA B1 05 00    1125*       dl 0x0005B1 ; 000024, 8.005
040DBD D9 05 00    1126*       dl 0x0005D9 ; 000025, 8.224
040DC0 01 06 00    1127*       dl 0x000601 ; 000026, 8.443
040DC3 28 06 00    1128*       dl 0x000628 ; 000027, 8.662
040DC6 50 06 00    1129*       dl 0x000650 ; 000028, 8.881
040DC9 78 06 00    1130*       dl 0x000678 ; 000029, 9.099
040DCC A0 06 00    1131*       dl 0x0006A0 ; 00002A, 9.317
040DCF C7 06 00    1132*       dl 0x0006C7 ; 00002B, 9.535
040DD2 EF 06 00    1133*       dl 0x0006EF ; 00002C, 9.752
040DD5 16 07 00    1134*       dl 0x000716 ; 00002D, 9.970
040DD8 3E 07 00    1135*       dl 0x00073E ; 00002E, 10.187
040DDB 65 07 00    1136*       dl 0x000765 ; 00002F, 10.403
040DDE 8D 07 00    1137*       dl 0x00078D ; 000030, 10.620
040DE1 B4 07 00    1138*       dl 0x0007B4 ; 000031, 10.836
040DE4 DB 07 00    1139*       dl 0x0007DB ; 000032, 11.051
040DE7 03 08 00    1140*       dl 0x000803 ; 000033, 11.267
040DEA 2A 08 00    1141*       dl 0x00082A ; 000034, 11.482
040DED 51 08 00    1142*       dl 0x000851 ; 000035, 11.697
040DF0 78 08 00    1143*       dl 0x000878 ; 000036, 11.911
040DF3 9F 08 00    1144*       dl 0x00089F ; 000037, 12.125
040DF6 C6 08 00    1145*       dl 0x0008C6 ; 000038, 12.339
040DF9 ED 08 00    1146*       dl 0x0008ED ; 000039, 12.553
040DFC 13 09 00    1147*       dl 0x000913 ; 00003A, 12.766
040DFF 3A 09 00    1148*       dl 0x00093A ; 00003B, 12.978
040E02 61 09 00    1149*       dl 0x000961 ; 00003C, 13.191
040E05 87 09 00    1150*       dl 0x000987 ; 00003D, 13.403
040E08 AE 09 00    1151*       dl 0x0009AE ; 00003E, 13.614
040E0B D4 09 00    1152*       dl 0x0009D4 ; 00003F, 13.825
040E0E FB 09 00    1153*       dl 0x0009FB ; 000040, 14.036
040E11 21 0A 00    1154*       dl 0x000A21 ; 000041, 14.247
040E14 47 0A 00    1155*       dl 0x000A47 ; 000042, 14.457
040E17 6D 0A 00    1156*       dl 0x000A6D ; 000043, 14.666
040E1A 94 0A 00    1157*       dl 0x000A94 ; 000044, 14.876
040E1D BA 0A 00    1158*       dl 0x000ABA ; 000045, 15.085
040E20 E0 0A 00    1159*       dl 0x000AE0 ; 000046, 15.293
040E23 05 0B 00    1160*       dl 0x000B05 ; 000047, 15.501
040E26 2B 0B 00    1161*       dl 0x000B2B ; 000048, 15.709
040E29 51 0B 00    1162*       dl 0x000B51 ; 000049, 15.916
040E2C 77 0B 00    1163*       dl 0x000B77 ; 00004A, 16.123
040E2F 9C 0B 00    1164*       dl 0x000B9C ; 00004B, 16.329
040E32 C2 0B 00    1165*       dl 0x000BC2 ; 00004C, 16.535
040E35 E7 0B 00    1166*       dl 0x000BE7 ; 00004D, 16.740
040E38 0C 0C 00    1167*       dl 0x000C0C ; 00004E, 16.945
040E3B 32 0C 00    1168*       dl 0x000C32 ; 00004F, 17.150
040E3E 57 0C 00    1169*       dl 0x000C57 ; 000050, 17.354
040E41 7C 0C 00    1170*       dl 0x000C7C ; 000051, 17.558
040E44 A1 0C 00    1171*       dl 0x000CA1 ; 000052, 17.761
040E47 C6 0C 00    1172*       dl 0x000CC6 ; 000053, 17.964
040E4A EB 0C 00    1173*       dl 0x000CEB ; 000054, 18.166
040E4D 0F 0D 00    1174*       dl 0x000D0F ; 000055, 18.368
040E50 34 0D 00    1175*       dl 0x000D34 ; 000056, 18.569
040E53 58 0D 00    1176*       dl 0x000D58 ; 000057, 18.770
040E56 7D 0D 00    1177*       dl 0x000D7D ; 000058, 18.970
040E59 A1 0D 00    1178*       dl 0x000DA1 ; 000059, 19.170
040E5C C6 0D 00    1179*       dl 0x000DC6 ; 00005A, 19.370
040E5F EA 0D 00    1180*       dl 0x000DEA ; 00005B, 19.569
040E62 0E 0E 00    1181*       dl 0x000E0E ; 00005C, 19.767
040E65 32 0E 00    1182*       dl 0x000E32 ; 00005D, 19.965
040E68 56 0E 00    1183*       dl 0x000E56 ; 00005E, 20.163
040E6B 7A 0E 00    1184*       dl 0x000E7A ; 00005F, 20.360
040E6E 9E 0E 00    1185*       dl 0x000E9E ; 000060, 20.556
040E71 C1 0E 00    1186*       dl 0x000EC1 ; 000061, 20.752
040E74 E5 0E 00    1187*       dl 0x000EE5 ; 000062, 20.947
040E77 08 0F 00    1188*       dl 0x000F08 ; 000063, 21.142
040E7A 2C 0F 00    1189*       dl 0x000F2C ; 000064, 21.337
040E7D 4F 0F 00    1190*       dl 0x000F4F ; 000065, 21.531
040E80 72 0F 00    1191*       dl 0x000F72 ; 000066, 21.724
040E83 95 0F 00    1192*       dl 0x000F95 ; 000067, 21.917
040E86 B8 0F 00    1193*       dl 0x000FB8 ; 000068, 22.109
040E89 DB 0F 00    1194*       dl 0x000FDB ; 000069, 22.301
040E8C FE 0F 00    1195*       dl 0x000FFE ; 00006A, 22.493
040E8F 21 10 00    1196*       dl 0x001021 ; 00006B, 22.683
040E92 44 10 00    1197*       dl 0x001044 ; 00006C, 22.874
040E95 66 10 00    1198*       dl 0x001066 ; 00006D, 23.063
040E98 89 10 00    1199*       dl 0x001089 ; 00006E, 23.253
040E9B AB 10 00    1200*       dl 0x0010AB ; 00006F, 23.441
040E9E CD 10 00    1201*       dl 0x0010CD ; 000070, 23.629
040EA1 EF 10 00    1202*       dl 0x0010EF ; 000071, 23.817
040EA4 11 11 00    1203*       dl 0x001111 ; 000072, 24.004
040EA7 33 11 00    1204*       dl 0x001133 ; 000073, 24.191
040EAA 55 11 00    1205*       dl 0x001155 ; 000074, 24.376
040EAD 77 11 00    1206*       dl 0x001177 ; 000075, 24.562
040EB0 99 11 00    1207*       dl 0x001199 ; 000076, 24.747
040EB3 BA 11 00    1208*       dl 0x0011BA ; 000077, 24.931
040EB6 DC 11 00    1209*       dl 0x0011DC ; 000078, 25.115
040EB9 FD 11 00    1210*       dl 0x0011FD ; 000079, 25.298
040EBC 1E 12 00    1211*       dl 0x00121E ; 00007A, 25.481
040EBF 3F 12 00    1212*       dl 0x00123F ; 00007B, 25.663
040EC2 60 12 00    1213*       dl 0x001260 ; 00007C, 25.844
040EC5 81 12 00    1214*       dl 0x001281 ; 00007D, 26.025
040EC8 A2 12 00    1215*       dl 0x0012A2 ; 00007E, 26.206
040ECB C3 12 00    1216*       dl 0x0012C3 ; 00007F, 26.386
040ECE E4 12 00    1217*       dl 0x0012E4 ; 000080, 26.565
040ED1 04 13 00    1218*       dl 0x001304 ; 000081, 26.744
040ED4 25 13 00    1219*       dl 0x001325 ; 000082, 26.922
040ED7 45 13 00    1220*       dl 0x001345 ; 000083, 27.100
040EDA 65 13 00    1221*       dl 0x001365 ; 000084, 27.277
040EDD 85 13 00    1222*       dl 0x001385 ; 000085, 27.453
040EE0 A5 13 00    1223*       dl 0x0013A5 ; 000086, 27.629
040EE3 C5 13 00    1224*       dl 0x0013C5 ; 000087, 27.805
040EE6 E5 13 00    1225*       dl 0x0013E5 ; 000088, 27.979
040EE9 05 14 00    1226*       dl 0x001405 ; 000089, 28.154
040EEC 24 14 00    1227*       dl 0x001424 ; 00008A, 28.327
040EEF 44 14 00    1228*       dl 0x001444 ; 00008B, 28.501
040EF2 63 14 00    1229*       dl 0x001463 ; 00008C, 28.673
040EF5 83 14 00    1230*       dl 0x001483 ; 00008D, 28.845
040EF8 A2 14 00    1231*       dl 0x0014A2 ; 00008E, 29.017
040EFB C1 14 00    1232*       dl 0x0014C1 ; 00008F, 29.187
040EFE E0 14 00    1233*       dl 0x0014E0 ; 000090, 29.358
040F01 FF 14 00    1234*       dl 0x0014FF ; 000091, 29.527
040F04 1E 15 00    1235*       dl 0x00151E ; 000092, 29.697
040F07 3C 15 00    1236*       dl 0x00153C ; 000093, 29.865
040F0A 5B 15 00    1237*       dl 0x00155B ; 000094, 30.033
040F0D 79 15 00    1238*       dl 0x001579 ; 000095, 30.201
040F10 98 15 00    1239*       dl 0x001598 ; 000096, 30.368
040F13 B6 15 00    1240*       dl 0x0015B6 ; 000097, 30.534
040F16 D4 15 00    1241*       dl 0x0015D4 ; 000098, 30.700
040F19 F2 15 00    1242*       dl 0x0015F2 ; 000099, 30.865
040F1C 10 16 00    1243*       dl 0x001610 ; 00009A, 31.030
040F1F 2E 16 00    1244*       dl 0x00162E ; 00009B, 31.194
040F22 4C 16 00    1245*       dl 0x00164C ; 00009C, 31.357
040F25 6A 16 00    1246*       dl 0x00166A ; 00009D, 31.520
040F28 87 16 00    1247*       dl 0x001687 ; 00009E, 31.682
040F2B A5 16 00    1248*       dl 0x0016A5 ; 00009F, 31.844
040F2E C2 16 00    1249*       dl 0x0016C2 ; 0000A0, 32.005
040F31 DF 16 00    1250*       dl 0x0016DF ; 0000A1, 32.166
040F34 FC 16 00    1251*       dl 0x0016FC ; 0000A2, 32.326
040F37 19 17 00    1252*       dl 0x001719 ; 0000A3, 32.486
040F3A 36 17 00    1253*       dl 0x001736 ; 0000A4, 32.645
040F3D 53 17 00    1254*       dl 0x001753 ; 0000A5, 32.803
040F40 70 17 00    1255*       dl 0x001770 ; 0000A6, 32.961
040F43 8C 17 00    1256*       dl 0x00178C ; 0000A7, 33.118
040F46 A9 17 00    1257*       dl 0x0017A9 ; 0000A8, 33.275
040F49 C5 17 00    1258*       dl 0x0017C5 ; 0000A9, 33.431
040F4C E2 17 00    1259*       dl 0x0017E2 ; 0000AA, 33.587
040F4F FE 17 00    1260*       dl 0x0017FE ; 0000AB, 33.742
040F52 1A 18 00    1261*       dl 0x00181A ; 0000AC, 33.896
040F55 36 18 00    1262*       dl 0x001836 ; 0000AD, 34.050
040F58 52 18 00    1263*       dl 0x001852 ; 0000AE, 34.203
040F5B 6E 18 00    1264*       dl 0x00186E ; 0000AF, 34.356
040F5E 8A 18 00    1265*       dl 0x00188A ; 0000B0, 34.509
040F61 A5 18 00    1266*       dl 0x0018A5 ; 0000B1, 34.660
040F64 C1 18 00    1267*       dl 0x0018C1 ; 0000B2, 34.811
040F67 DC 18 00    1268*       dl 0x0018DC ; 0000B3, 34.962
040F6A F7 18 00    1269*       dl 0x0018F7 ; 0000B4, 35.112
040F6D 13 19 00    1270*       dl 0x001913 ; 0000B5, 35.262
040F70 2E 19 00    1271*       dl 0x00192E ; 0000B6, 35.410
040F73 49 19 00    1272*       dl 0x001949 ; 0000B7, 35.559
040F76 64 19 00    1273*       dl 0x001964 ; 0000B8, 35.707
040F79 7F 19 00    1274*       dl 0x00197F ; 0000B9, 35.854
040F7C 99 19 00    1275*       dl 0x001999 ; 0000BA, 36.001
040F7F B4 19 00    1276*       dl 0x0019B4 ; 0000BB, 36.147
040F82 CE 19 00    1277*       dl 0x0019CE ; 0000BC, 36.293
040F85 E9 19 00    1278*       dl 0x0019E9 ; 0000BD, 36.438
040F88 03 1A 00    1279*       dl 0x001A03 ; 0000BE, 36.582
040F8B 1D 1A 00    1280*       dl 0x001A1D ; 0000BF, 36.726
040F8E 37 1A 00    1281*       dl 0x001A37 ; 0000C0, 36.870
040F91 51 1A 00    1282*       dl 0x001A51 ; 0000C1, 37.013
040F94 6B 1A 00    1283*       dl 0x001A6B ; 0000C2, 37.155
040F97 85 1A 00    1284*       dl 0x001A85 ; 0000C3, 37.297
040F9A 9F 1A 00    1285*       dl 0x001A9F ; 0000C4, 37.439
040F9D B9 1A 00    1286*       dl 0x001AB9 ; 0000C5, 37.579
040FA0 D2 1A 00    1287*       dl 0x001AD2 ; 0000C6, 37.720
040FA3 EC 1A 00    1288*       dl 0x001AEC ; 0000C7, 37.859
040FA6 05 1B 00    1289*       dl 0x001B05 ; 0000C8, 37.999
040FA9 1E 1B 00    1290*       dl 0x001B1E ; 0000C9, 38.137
040FAC 37 1B 00    1291*       dl 0x001B37 ; 0000CA, 38.276
040FAF 50 1B 00    1292*       dl 0x001B50 ; 0000CB, 38.413
040FB2 69 1B 00    1293*       dl 0x001B69 ; 0000CC, 38.550
040FB5 82 1B 00    1294*       dl 0x001B82 ; 0000CD, 38.687
040FB8 9B 1B 00    1295*       dl 0x001B9B ; 0000CE, 38.823
040FBB B4 1B 00    1296*       dl 0x001BB4 ; 0000CF, 38.959
040FBE CC 1B 00    1297*       dl 0x001BCC ; 0000D0, 39.094
040FC1 E5 1B 00    1298*       dl 0x001BE5 ; 0000D1, 39.228
040FC4 FD 1B 00    1299*       dl 0x001BFD ; 0000D2, 39.362
040FC7 16 1C 00    1300*       dl 0x001C16 ; 0000D3, 39.496
040FCA 2E 1C 00    1301*       dl 0x001C2E ; 0000D4, 39.629
040FCD 46 1C 00    1302*       dl 0x001C46 ; 0000D5, 39.762
040FD0 5E 1C 00    1303*       dl 0x001C5E ; 0000D6, 39.894
040FD3 76 1C 00    1304*       dl 0x001C76 ; 0000D7, 40.025
040FD6 8E 1C 00    1305*       dl 0x001C8E ; 0000D8, 40.156
040FD9 A5 1C 00    1306*       dl 0x001CA5 ; 0000D9, 40.286
040FDC BD 1C 00    1307*       dl 0x001CBD ; 0000DA, 40.416
040FDF D5 1C 00    1308*       dl 0x001CD5 ; 0000DB, 40.546
040FE2 EC 1C 00    1309*       dl 0x001CEC ; 0000DC, 40.675
040FE5 04 1D 00    1310*       dl 0x001D04 ; 0000DD, 40.803
040FE8 1B 1D 00    1311*       dl 0x001D1B ; 0000DE, 40.931
040FEB 32 1D 00    1312*       dl 0x001D32 ; 0000DF, 41.059
040FEE 49 1D 00    1313*       dl 0x001D49 ; 0000E0, 41.186
040FF1 60 1D 00    1314*       dl 0x001D60 ; 0000E1, 41.312
040FF4 77 1D 00    1315*       dl 0x001D77 ; 0000E2, 41.438
040FF7 8E 1D 00    1316*       dl 0x001D8E ; 0000E3, 41.564
040FFA A5 1D 00    1317*       dl 0x001DA5 ; 0000E4, 41.689
040FFD BB 1D 00    1318*       dl 0x001DBB ; 0000E5, 41.814
041000 D2 1D 00    1319*       dl 0x001DD2 ; 0000E6, 41.938
041003 E9 1D 00    1320*       dl 0x001DE9 ; 0000E7, 42.061
041006 FF 1D 00    1321*       dl 0x001DFF ; 0000E8, 42.184
041009 15 1E 00    1322*       dl 0x001E15 ; 0000E9, 42.307
04100C 2C 1E 00    1323*       dl 0x001E2C ; 0000EA, 42.429
04100F 42 1E 00    1324*       dl 0x001E42 ; 0000EB, 42.551
041012 58 1E 00    1325*       dl 0x001E58 ; 0000EC, 42.672
041015 6E 1E 00    1326*       dl 0x001E6E ; 0000ED, 42.793
041018 84 1E 00    1327*       dl 0x001E84 ; 0000EE, 42.913
04101B 99 1E 00    1328*       dl 0x001E99 ; 0000EF, 43.033
04101E AF 1E 00    1329*       dl 0x001EAF ; 0000F0, 43.152
041021 C5 1E 00    1330*       dl 0x001EC5 ; 0000F1, 43.271
041024 DA 1E 00    1331*       dl 0x001EDA ; 0000F2, 43.390
041027 F0 1E 00    1332*       dl 0x001EF0 ; 0000F3, 43.508
04102A 05 1F 00    1333*       dl 0x001F05 ; 0000F4, 43.625
04102D 1B 1F 00    1334*       dl 0x001F1B ; 0000F5, 43.742
041030 30 1F 00    1335*       dl 0x001F30 ; 0000F6, 43.859
041033 45 1F 00    1336*       dl 0x001F45 ; 0000F7, 43.975
041036 5A 1F 00    1337*       dl 0x001F5A ; 0000F8, 44.091
041039 6F 1F 00    1338*       dl 0x001F6F ; 0000F9, 44.206
04103C 84 1F 00    1339*       dl 0x001F84 ; 0000FA, 44.321
04103F 99 1F 00    1340*       dl 0x001F99 ; 0000FB, 44.435
041042 AD 1F 00    1341*       dl 0x001FAD ; 0000FC, 44.549
041045 C2 1F 00    1342*       dl 0x001FC2 ; 0000FD, 44.662
041048 D7 1F 00    1343*       dl 0x001FD7 ; 0000FE, 44.775
04104B EB 1F 00    1344*       dl 0x001FEB ; 0000FF, 44.888
04104E 00 20 00    1345*       dl 0x002000 ; 000100, 45.000 only needed for interpolation
041051             0036        include "fonts.inc"
041051 FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF    
041100             0002*   
041100             0003*   fonts_load:
041100 DD 21 00 27 0004*       ld ix,font_list ; pointer to font list lookup
       04          
041105 06 07       0005*       ld b,num_fonts ; loop counter
041107             0006*   
041107             0007*   @load_loop:
041107 C5          0008*       push bc ; save loop counter
041108             0009*   
041108             0010*   ; load font into a buffer
041108 DD 27 06    0011*       ld hl,(ix+font_list_bufferId)
04110B DD 31 09    0012*       ld iy,(ix+font_list_filename)
04110E CD 78 18 04 0013*       call vdu_load_buffer_from_file
041112             0014*   
041112             0015*   ; create font from buffer
041112 DD 27 06    0016*       ld hl,(ix+font_list_bufferId)
041115 DD 5E 00    0017*       ld e,(ix+font_list_width)
041118 DD 56 03    0018*       ld d,(ix+font_list_height)
04111B 3E 00       0019*       ld a,0 ; flags
04111D CD 1A 1A 04 0020*       call vdu_font_create
041121             0021*   
041121             0022*   ; select font
041121 DD 27 06    0023*       ld hl,(ix+font_list_bufferId)
041124 3E 01       0024*       ld a,1 ; flags
041126 CD 00 1A 04 0025*       call vdu_font_select
04112A             0026*   
04112A             0027*   ; ; debug print filename
04112A             0028*   ;     call printNewLine
04112A             0029*   ;     ld hl,(ix+font_list_filename)
04112A             0030*   ;     call printString
04112A             0031*   
04112A             0032*   ; advance font_list pointer to next record
04112A ED 32 0C    0033*       lea ix,ix+font_list_record_size
04112D             0034*   
04112D             0035*   ; restore loop counter
04112D C1          0036*       pop bc
04112E 10 D7       0037*       djnz @load_loop
041130             0038*   
041130             0039*   ; all done
041130 C9          0040*       ret
041131             0037        include "images.inc"
041131 FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF    
041200             0002*   
041200             0003*   image_type: equ 0
041200             0004*   image_width: equ image_type+3
041200             0005*   image_height: equ image_width+3
041200             0006*   image_filesize: equ image_height+3
041200             0007*   image_filename: equ image_filesize+3
041200             0008*   image_bufferId: equ image_filename+3
041200             0009*   image_record_size: equ image_bufferId+3
041200             0010*   
041200 00 00 00    0011*   cur_image_list: dl 0
041203 00 00 00    0012*   cur_filename: dl 0
041206 00 00 00    0013*   cur_buffer_id: dl 0
041209             0014*   
041209             0015*   img_load_init:
041209             0016*   ; initialize logo's position parameters
041209 21 00 00 00 0017*       ld hl,0
04120D 22 BE 12 04 0018*       ld (logo_xvel),hl
041211 22 C1 12 04 0019*       ld (logo_xpos),hl
041215             0020*   ; begin 16.8 maths to determine logo's y position and velocity
041215 21 00 E0 00 0021*       ld hl,224*256
041219 22 C7 12 04 0022*       ld (logo_ypos),hl
04121D EB          0023*       ex de,hl
04121E 21 00 28 FF 0024*       ld hl,-240+24*256
041222             0025*       ; ld de,-256*[sprites_num_images+tiles_dg_num_images+ui_num_images]
041222 11 00 83 01 0026*       ld de,[sprites_num_images+tiles_dg_num_images+ui_num_images]*256
041226 CD 25 07 04 0027*       call sdiv168 ; ud.e = distance / num images = y velocity
04122A ED 53 C4 12 0028*       ld (logo_yvel),de
       04          
04122F             0029*   ; all done
04122F C9          0030*       ret
041230             0031*   
041230             0032*   ; inputs: bc is the number of images to load, cur_image_list set
041230             0033*   img_load_main:
041230             0034*   ; back up loop counter
041230 C5          0035*       push bc
041231             0036*   
041231             0037*   ; load the next image
041231 CD 68 12 04 0038*       call load_next_image
041235             0039*   
041235             0040*   ; plot the background
041235 CD 4B 16 04 0041*       call vdu_cls
041239 21 29 00 00 0042*       ld hl,BUF_SPLASH_BG
04123D CD 38 17 04 0043*       call vdu_buff_select
041241 01 00 00 00 0044*       ld bc,0
041245 11 00 00 00 0045*       ld de,0
041249 CD 20 1B 04 0046*       call vdu_plot_bmp
04124D             0047*   
04124D             0048*   ; ; draw the most recently loaded image
04124D             0049*   ; 	ld hl,(cur_buffer_id)
04124D             0050*   ; 	call vdu_buff_select
04124D             0051*   ; 	ld bc,0
04124D             0052*   ; 	ld de,0
04124D             0053*   ; 	call vdu_plot_bmp
04124D             0054*   
04124D             0055*   ; move logo
04124D CD 99 12 04 0056*       call move_logo
041251             0057*   
041251             0058*   ; print current filename
041251 2A 03 12 04 0059*       ld hl,(cur_filename)
041255 CD 07 01 04 0060*       call printString
041259             0061*   
041259             0062*   ; flip the framebuffer
041259             0063*       ; call vdu_flip
041259             0064*   
041259             0065*   ; decrement loop counter
041259 C1          0066*       pop bc
04125A 0B          0067*       dec bc
04125B 79          0068*       ld a,c
04125C B7          0069*       or a
04125D C2 30 12 04 0070*       jp nz,img_load_main
041261 78          0071*       ld a,b
041262 B7          0072*       or a
041263 C2 30 12 04 0073*       jp nz,img_load_main
041267 C9          0074*       ret
041268             0075*   
041268             0076*   load_next_image:
041268 FD 2A 00 12 0077*       ld iy,(cur_image_list)
       04          
04126D FD E5       0078*       push iy
04126F FD 7E 00    0079*       ld a,(iy+image_type) ; get image type
041272 FD 07 03    0080*       ld bc,(iy+image_width) ; get image width
041275 FD 17 06    0081*       ld de,(iy+image_height) ; get image height
041278 FD 31 09    0082*       ld ix,(iy+image_filesize) ; get image file size
04127B FD 27 0F    0083*       ld hl,(iy+image_bufferId) ; get image bufferId
04127E 22 06 12 04 0084*       ld (cur_buffer_id),hl
041282 FD 37 0C    0085*       ld iy,(iy+image_filename) ; get image filename
041285 FD 22 03 12 0086*       ld (cur_filename),iy
       04          
04128A CD 56 18 04 0087*       call vdu_load_img
04128E FD E1       0088*       pop iy
041290 ED 33 12    0089*       lea iy,iy+image_record_size
041293 FD 22 00 12 0090*       ld (cur_image_list),iy
       04          
041298 C9          0091*       ret
041299             0092*   
041299             0093*   move_logo:
041299             0094*   ; activate logo bitmap
041299 21 2A 00 00 0095*       ld hl, BUF_SPLASH_LOGO
04129D CD 38 17 04 0096*       call vdu_buff_select
0412A1             0097*   ; update position based on velocity parameters
0412A1 2A C7 12 04 0098*       ld hl,(logo_ypos)
0412A5 ED 5B C4 12 0099*       ld de,(logo_yvel)
       04          
0412AA 19          0100*       add hl,de
0412AB 22 C7 12 04 0101*       ld (logo_ypos),hl
0412AF             0102*   ; draw logo
0412AF ED 4B C1 12 0103*       ld bc,(logo_xpos)
       04          
0412B4 ED 5B C7 12 0104*       ld de,(logo_ypos)
       04          
0412B9 CD 3C 1B 04 0105*       call vdu_plot_bmp168
0412BD C9          0106*       ret
0412BE             0107*   
0412BE 00 00 00    0108*   logo_xvel: dl 0
0412C1 00 00 00    0109*   logo_xpos: dl 0
0412C4             0110*   
0412C4 00 00 00    0111*   logo_yvel: dl 0
0412C7 00 00 00    0112*   logo_ypos: dl 0
0412CA             0113*   
0412CA             0114*   load_ui_images:
0412CA             0115*   ; initialize image loading variables
0412CA 21 16 61 04 0116*       ld hl,ui_image_list
0412CE 22 00 12 04 0117*       ld (cur_image_list),hl
0412D2             0118*   ; load images
0412D2 06 2B       0119*       ld b,ui_num_images
0412D4             0120*   @loop:
0412D4 C5          0121*       push bc
0412D5 CD 68 12 04 0122*       call load_next_image
0412D9 C1          0123*       pop bc
0412DA 10 F8       0124*       djnz @loop
0412DC C9          0125*       ret
0412DD             0126*   ; end load_ui_images
0412DD             0127*   
0412DD             0128*   load_sprite_images:
0412DD             0129*   ; initialize image loading variables
0412DD 21 CC 45 04 0130*       ld hl,sprites_image_list
0412E1 22 00 12 04 0131*       ld (cur_image_list),hl
0412E5 01 9D 00 00 0132*       ld bc,sprites_num_images
0412E9             0133*   ; load images
0412E9 CD 30 12 04 0134*       call img_load_main
0412ED C9          0135*       ret
0412EE             0136*   ; end load_sprite_images
0412EE             0137*   
0412EE             0138*   load_tilesets:
0412EE             0139*   ; initialize image loading variables
0412EE 21 4F 29 04 0140*       ld hl,tiles_dg_image_list
0412F2 22 00 12 04 0141*       ld (cur_image_list),hl
0412F6 01 BB 00 00 0142*       ld bc,tiles_dg_num_images
0412FA             0143*   ; load images
0412FA CD 30 12 04 0144*       call img_load_main
0412FE C9          0145*       ret
0412FF             0146*   ; end load_tilesets
0412FF             0147*   
0412FF             0148*   load_backgrounds:
0412FF             0149*   ; initialize image loading variables
0412FF 21 1F 28 04 0150*       ld hl,bg_image_list
041303 22 00 12 04 0151*       ld (cur_image_list),hl
041307 01 08 00 00 0152*       ld bc,bg_num_images
04130B             0153*   ; load images
04130B CD 30 12 04 0154*       call img_load_main
04130F C9          0155*       ret
041310             0156*   ; end load_backgrounds
041310             0157*   
041310             0158*   ; ; initialize image loading variables
041310             0159*   ;     ld hl,tiles_xevious_image_list
041310             0160*   ;     ld (cur_image_list),hl
041310             0161*   ;     ld bc,tiles_xevious_num_images
041310             0162*   ; ; load images
041310             0163*   ;     call img_load_main
041310 C9          0164*       ret
041311             0038        include "timer.inc"
041311 FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF    
041400             0002*   
041400             0003*   ; Table 32. Timer Control Registers
041400             0004*   ; this constant is the base address of the timer control registers
041400             0005*   ; each timer takes three bytes:
041400             0006*   ;   0: control register
041400             0007*   ;   1: low byte of timer reset value
041400             0008*   ;   2: high byte of timer reset value
041400             0009*   ; note that the value is only 8-bits,so we use in0/out0 i/o calls,
041400             0010*   ; which correctly force the high and upper bytes of the address bus to zero
041400             0011*   TMR_CTL:     equ 80h
041400             0012*   
041400             0013*   ; Timer Control Register Bit Definitions
041400             0014*   PRT_IRQ_0:    equ %00000000 ; The timer does not reach its end-of-count value.
041400             0015*                               ; This bit is reset to 0 every time the TMRx_CTL register is read.
041400             0016*   PRT_IRQ_1:    equ %10000000 ; The timer reaches its end-of-count value. If IRQ_EN is set to 1,
041400             0017*                               ; an interrupt signal is sent to the CPU. This bit remains 1 until
041400             0018*                               ; the TMRx_CTL register is read.
041400             0019*   
041400             0020*   IRQ_EN_0:     equ %00000000 ; Timer interrupt requests are disabled.
041400             0021*   IRQ_EN_1:     equ %01000000 ; Timer interrupt requests are enabled.
041400             0022*   
041400             0023*   PRT_MODE_0:   equ %00000000 ; The timer operates in SINGLE PASS mode. PRT_EN (bit 0) is reset to
041400             0024*                               ;  0,and counting stops when the end-of-count value is reached.
041400             0025*   PRT_MODE_1:   equ %00010000 ; The timer operates in CONTINUOUS mode. The timer reload value is
041400             0026*                               ; written to the counter when the end-of-count value is reached.
041400             0027*   
041400             0028*   ; CLK_DIV is a 2-bit mask that sets the timer input source clock divider
041400             0029*   CLK_DIV_256:  equ %00001100 ;
041400             0030*   CLK_DIV_64:   equ %00001000 ;
041400             0031*   CLK_DIV_16:   equ %00000100 ;
041400             0032*   CLK_DIV_4:    equ %00000000 ;
041400             0033*   
041400             0034*   RST_EN_0:     equ %00000000 ; The reload and restart function is disabled.
041400             0035*   RST_EN_1:     equ %00000010 ; The reload and restart function is enabled.
041400             0036*                               ; When a 1 is written to this bit,the values in the reload registers
041400             0037*                               ;  are loaded into the downcounter when the timer restarts. The
041400             0038*                               ; programmer must ensure that this bit is set to 1 each time
041400             0039*                               ; SINGLE-PASS mode is used.
041400             0040*   
041400             0041*   ; disable/enable the programmable reload timer
041400             0042*   PRT_EN_0:     equ %00000000 ;
041400             0043*   PRT_EN_1:     equ %00000001 ;
041400             0044*   
041400             0045*   ; Table 37. Timer Input Source Select Register
041400             0046*   ; Each of the 4 timers are allocated two bits of the 8-bit register
041400             0047*   ; in little-endian order,with TMR0 using bits 0 and 1,TMR1 using bits 2 and 3,etc.
041400             0048*   ;   00: System clock / CLK_DIV
041400             0049*   ;   01: RTC / CLK_DIV
041400             0050*   ;   NOTE: these are the values given in the manual,but it may be a typo
041400             0051*   ;   10: GPIO port B pin 1.
041400             0052*   ;   11: GPIO port B pin 1.
041400             0053*   TMR_ISS:   equ 92h ; register address
041400             0054*   
041400             0055*   ; Table 51. Real-Time Clock Control Register
041400             0056*   RTC_CTRL: equ EDh ; register address
041400             0057*   
041400             0058*   ; alarm interrupt disable/enable
041400             0059*   RTC_ALARM_0:    equ %00000000
041400             0060*   RTC_ALARM_1:    equ %10000000
041400             0061*   
041400             0062*   ; interrupt on alarm disable/enable
041400             0063*   RTC_INT_ENT_0:  equ %00000000
041400             0064*   RTC_INT_ENT_1:  equ %01000000
041400             0065*   
041400             0066*   RTC_BCD_EN_0:   equ %00000000   ; RTC count and alarm registers are binary
041400             0067*   RTC_BCD_EN_1:   equ %00100000   ; RTC count and alarm registers are BCD
041400             0068*   
041400             0069*   RTC_CLK_SEL_0:  equ %00000000   ; RTC clock source is crystal oscillator output (32768 Hz).
041400             0070*                                   ; On-chip 32768 Hz oscillator is enabled.
041400             0071*   RTC_CLK_SEL_1:  equ %00010000   ; RTC clock source is power line frequency input as set by FREQ_SEL.
041400             0072*                                   ; On-chip 32768 Hz oscillator is disabled.
041400             0073*   
041400             0074*   RTC_FREQ_SEL_0: equ %00000000   ; 60 Hz power line frequency.
041400             0075*   RTC_FREQ_SEL_1: equ %00001000   ; 50 Hz power line frequency.
041400             0076*   
041400             0077*   RTC_SLP_WAKE_0: equ %00000000   ; RTC does not generate a sleep-mode recovery reset.
041400             0078*   RTC_SLP_WAKE_1: equ %00000010   ; RTC generates a sleep-mode recovery reset.
041400             0079*   
041400             0080*   RTC_UNLOCK_0:   equ %00000000   ; RTC count registers are locked to prevent Write access.
041400             0081*                                   ; RTC counter is enabled.
041400             0082*   RTC_UNLOCK_1:   equ %00000001   ; RTC count registers are unlocked to allow Write access.
041400             0083*                                   ; RTC counter is disabled.
041400             0084*   
041400             0085*   ; prt_reload_emulator: equ 11234 ; 1/102.4 seconds on emulator with 16 clock divider
041400             0086*   
041400             0087*   prt_reload_emulator: equ 11519 ; 1 centisecond on emulator with 16 clock divider
041400             0088*   prt_reload_hardware: equ 11532 ; 1 centisecond on hardware with 16 clock divider
041400 00 00 00    0089*   prt_reload: dl 0x000000
041403             0090*   
041403             0091*   ; set PRT timer
041403             0092*   prt_set:
041403 21 00 00 00 0093*       ld hl,0
041407 22 51 14 04 0094*       ld (prt_irq_counter),hl
04140B 2A 00 14 04 0095*       ld hl,(prt_reload)
04140F ED 29 84    0096*       out0 ($84),l
041412 ED 21 85    0097*   	out0 ($85),h
041415             0098*   ; disable timer
041415 3E 06       0099*       ld a,PRT_IRQ_0 | IRQ_EN_0 | PRT_MODE_0 | CLK_DIV_16 | RST_EN_1 | PRT_EN_0
041417 ED 39 83    0100*   	out0 ($83),a
04141A             0101*   ; enable timer,with interrupt and CONTINUOUS mode,clock divider 16
04141A 3E 57       0102*       ld a,PRT_IRQ_0 | IRQ_EN_1 | PRT_MODE_1 | CLK_DIV_16 | RST_EN_1 | PRT_EN_1
04141C ED 39 83    0103*   	out0 ($83),a
04141F C9          0104*       ret
041420             0105*   
041420             0106*   ; ===============================================
041420             0107*   ; PRT Timer Interrupt Handling
041420             0108*   ; https://github.com/tomm/agon-cpu-emulator/blob/main/sdcard/regression_suite/timerirq.inc
041420             0109*   ; -----------------------------------------------
041420             0110*   prt_irq_init:
041420             0111*       ; set up interrupt vector table 2
041420 21 00 00 00 0112*   	ld hl,0
041424 3A 0C 01 00 0113*   	ld a,($10c)
041428 6F          0114*   	ld l,a
041429 3A 0D 01 00 0115*   	ld a,($10d)
04142D 67          0116*   	ld h,a
04142E             0117*   
04142E             0118*   	; skip over CALL ($c3)
04142E 23          0119*   	inc hl
04142F             0120*   	; load address of jump into vector table 2 (in ram)
04142F ED 27       0121*   	ld hl,(hl)
041431             0122*   
041431             0123*   	; write CALL prt_irq_handler to vector table 2
041431 3E C3       0124*   	ld a,$c3
041433 77          0125*   	ld (hl),a
041434 23          0126*   	inc hl
041435 11 3C 14 04 0127*   	ld de,prt_irq_handler
041439 ED 1F       0128*   	ld (hl),de
04143B             0129*   
04143B C9          0130*       ret
04143C             0131*   
04143C             0132*   prt_irq_handler:
04143C F3          0133*   	di
04143D F5          0134*   	push af
04143E E5          0135*       push hl
04143F ED 38 83    0136*   	in0 a,($83)
041442 2A 51 14 04 0137*   	ld hl,(prt_irq_counter)
041446 23          0138*   	inc hl
041447 22 51 14 04 0139*   	ld (prt_irq_counter),hl
04144B E1          0140*       pop hl
04144C F1          0141*   	pop af
04144D FB          0142*   	ei
04144E 5B ED 4D    0143*   	reti.l
041451             0144*   
041451             0145*   prt_irq_counter:
041451 00 00 00    0146*   	.dl 0
041454             0147*   prt_irq_counter_saved:
041454 00 00 00    0148*       .dl 0
041457             0149*   
041457             0150*   prt_loop_reset:
041457 E5          0151*       push hl
041458 21 00 00 00 0152*   	ld hl,0
04145C 22 51 14 04 0153*   	ld (prt_irq_counter),hl
041460 22 C2 14 04 0154*       ld (prt_loop_counter),hl
041464 22 C5 14 04 0155*       ld (prt_loops),hl
041468 CD 03 14 04 0156*       call prt_set
04146C E1          0157*       pop hl
04146D C9          0158*       ret
04146E             0159*   
04146E             0160*   prt_loop_start:
04146E E5          0161*       push hl
04146F 21 00 00 00 0162*   	ld hl,0
041473 22 51 14 04 0163*   	ld (prt_irq_counter),hl
041477 E1          0164*       pop hl
041478 C9          0165*       ret
041479             0166*   
041479             0167*   prt_loop_stop:
041479 E5          0168*       push hl
04147A D5          0169*       push de
04147B 2A 51 14 04 0170*       ld hl,(prt_irq_counter)
04147F ED 5B C2 14 0171*       ld de,(prt_loop_counter)
       04          
041484 19          0172*       add hl,de
041485 22 C2 14 04 0173*       ld (prt_loop_counter),hl
041489 21 00 00 00 0174*       ld hl,0
04148D 22 51 14 04 0175*       ld (prt_irq_counter),hl
041491 2A C5 14 04 0176*       ld hl,(prt_loops)
041495 23          0177*       inc hl
041496 22 C5 14 04 0178*       ld (prt_loops),hl
04149A D1          0179*       pop de
04149B E1          0180*       pop hl
04149C C9          0181*       ret
04149D             0182*   
04149D             0183*   ; inputs: bc = y,x text coordinates to print
04149D             0184*   prt_loop_print:
04149D F5          0185*       push af
04149E E5          0186*       push hl
04149F C5          0187*       push bc
0414A0 D5          0188*       push de
0414A1 DD E5       0189*       push ix
0414A3 FD E5       0190*       push iy
0414A5 CD 37 16 04 0191*       call vdu_move_cursor
0414A9             0192*   
0414A9 2A C2 14 04 0193*       ld hl,(prt_loop_counter)
0414AD CD 53 01 04 0194*       call printDec
0414B1             0195*   
0414B1 2A C5 14 04 0196*       ld hl,(prt_loops)
0414B5 CD 53 01 04 0197*       call printDec
0414B9             0198*   
0414B9 FD E1       0199*       pop iy
0414BB DD E1       0200*       pop ix
0414BD D1          0201*       pop de
0414BE C1          0202*       pop bc
0414BF E1          0203*       pop hl
0414C0 F1          0204*       pop af
0414C1 C9          0205*       ret
0414C2             0206*   
0414C2             0207*   prt_loop_counter:
0414C2 00 00 00    0208*       .dl 0
0414C5             0209*   prt_loops:
0414C5 00 00 00    0210*       .dl 0
0414C8             0211*   
0414C8             0212*   ; ===============================================
0414C8             0213*   ; Timer functions
0414C8             0214*   ; -----------------------------------------------
0414C8             0215*   ; set a countdown timer
0414C8             0216*   ; inputs: hl = time to set in 1/120ths of a second; iy = pointer to 3-byte buffer holding start time,iy+3 = pointer to 3-byte buffer holding timer set value
0414C8             0217*   ; returns: hl = current time
0414C8             0218*   tmr_set:
0414C8 FD 2F 03    0219*       ld (iy+3),hl            ; set time remaining
0414CB             0220*       MOSCALL mos_sysvars     ; ix points to syvars table
0414CB 3E 08       0001*M1 			LD	A, function
0414CD 5B CF       0002*M1 			RST.LIL	08h
0414CF DD 27 00    0221*       ld hl,(ix+sysvar_time)  ; get current time
0414D2 FD 2F 00    0222*       ld (iy+0),hl            ; set start time
0414D5 C9          0223*       ret
0414D6             0224*   
0414D6             0225*   ; gets time remaining on a countdown timer
0414D6             0226*   ; inputs: iy = pointer to 3-byte buffer holding start time,iy+3 = pointer to 3-byte buffer holding timer set value
0414D6             0227*   ; returns: hl pos = time remaining in 1/120ths of a second,hl neg = time past expiration
0414D6             0228*   ;          sign flags: pos = time not expired,zero or neg = time expired
0414D6             0229*   tmr_get:
0414D6             0230*       MOSCALL mos_sysvars     ; ix points to syvars table
0414D6 3E 08       0001*M1 			LD	A, function
0414D8 5B CF       0002*M1 			RST.LIL	08h
0414DA DD 17 00    0231*       ld de,(ix+sysvar_time)  ; get current time
0414DD FD 27 00    0232*       ld hl,(iy+0)            ; get start time
0414E0 AF          0233*       xor a                   ; clear carry
0414E1 ED 52       0234*       sbc hl,de               ; hl = time elapsed (will always be zero or negative)
0414E3 FD 17 03    0235*       ld de,(iy+3)            ; get timer set value
0414E6 AF          0236*       xor a                   ; clear carry
0414E7 ED 5A       0237*       adc hl,de               ; hl = time remaining
0414E9             0238*                               ; (we do adc because add hl,rr doesn't set sign or zero flags)
0414E9 C9          0239*       ret
0414EA             0240*   
0414EA             0241*   tmr_test: ds 6 ; example of a buffer to hold timer data
0414F0             0242*   
       FF FF FF FF 
       FF FF 
0414F0 00 00 00    0243*   timestamp_now: dl 0
0414F3 00 00 00    0244*   timestamp_old: dl 0
0414F6 00 00 00    0245*   timestamp_chg: dl 0
0414F9             0246*   
0414F9             0247*   ; update the global timestamp from the system clock
0414F9             0248*   ; inputs: none
0414F9             0249*   ; returns: hl = time elapsed in 1/120ths of a second
0414F9             0250*   ;          ix = pointer to syvars table
0414F9             0251*   ; destroys: af,hl,de,ix
0414F9             0252*   timestamp_tick:
0414F9 ED 5B F0 14 0253*       ld de,(timestamp_now)   ; get previous time
       04          
0414FE ED 53 F3 14 0254*       ld (timestamp_old),de   ; save previous time
       04          
041503             0255*       MOSCALL mos_sysvars     ; ix points to syvars table
041503 3E 08       0001*M1 			LD	A, function
041505 5B CF       0002*M1 			RST.LIL	08h
041507 DD 27 00    0256*       ld hl,(ix+sysvar_time)  ; get current time
04150A 22 F0 14 04 0257*       ld (timestamp_now),hl   ; save current time
04150E AF          0258*       xor a                   ; clear carry
04150F ED 52       0259*       sbc hl,de               ; hl = time elapsed
041511 22 F6 14 04 0260*       ld (timestamp_chg),hl   ; save elapsed time
041515 C9          0261*       ret
041516             0262*   
041516             0263*   ; set a countdown timer
041516             0264*   ; inputs: hl = time to set in 1/120ths of a second; iy = pointer to 3-byte buffer holding start time,iy+3 = pointer to 3-byte buffer holding timer set value
041516             0265*   ; requires: timestamp_tick to be called at least once before this function
041516             0266*   ; returns: hl = current time
041516             0267*   ; destroys: hl
041516             0268*   timestamp_tmr_set:
041516 FD 2F 03    0269*       ld (iy+3),hl            ; set time remaining
041519 2A F0 14 04 0270*       ld hl,(timestamp_now)   ; get current timestamp
04151D FD 2F 00    0271*       ld (iy+0),hl            ; set start time
041520 C9          0272*       ret
041521             0273*   
041521             0274*   ; gets time remaining on a countdown timer following the global timestamp
041521             0275*   ; inputs: iy = pointer to 3-byte buffer holding start time,iy+3 = pointer to 3-byte buffer holding timer set value
041521             0276*   ; requires: timestamp_tick to be called at least once before this function
041521             0277*   ; returns: hl pos = time remaining in 1/120ths of a second,hl neg = time past expiration
041521             0278*   ;          sign flags: pos = time not expired,zero or neg = time expired
041521             0279*   ; destroys: af,hl,de
041521             0280*   timestamp_tmr_get:
041521 ED 5B F0 14 0281*       ld de,(timestamp_now)   ; get current timestamp
       04          
041526 FD 27 00    0282*       ld hl,(iy+0)            ; get start time
041529 AF          0283*       xor a                   ; clear carry
04152A ED 52       0284*       sbc hl,de               ; hl = time elapsed (will always be zero or negative)
04152C FD 17 03    0285*       ld de,(iy+3)            ; get timer set value
04152F AF          0286*       xor a                   ; clear carry
041530 ED 5A       0287*       adc hl,de               ; hl = time remaining
041532             0288*                               ; (we do adc because add hl,rr doesn't set sign or zero flags)
041532 C9          0289*       ret
041533             0290*   
041533             0291*   ; set a stopwatch
041533             0292*   ; returns: hl = start time
041533             0293*   ; destroys: hl,ix
041533             0294*   stopwatch_set:
041533             0295*       MOSCALL mos_sysvars     ; ix points to syvars table
041533 3E 08       0001*M1 			LD	A, function
041535 5B CF       0002*M1 			RST.LIL	08h
041537 DD 27 00    0296*       ld hl,(ix+sysvar_time)  ; get current time
04153A 22 4F 15 04 0297*       ld (stopwatch_started),hl            ; set start time
04153E C9          0298*       ret
04153F             0299*   
04153F             0300*   ; gets time elapsed on a stopwatch
04153F             0301*   ; returns: hl = time elapsed in 1/120ths of a second
04153F             0302*   ; destroys: af,hl,de,ix
04153F             0303*   stopwatch_get:
04153F             0304*       MOSCALL mos_sysvars     ; ix points to syvars table
04153F 3E 08       0001*M1 			LD	A, function
041541 5B CF       0002*M1 			RST.LIL	08h
041543 DD 27 00    0305*       ld hl,(ix+sysvar_time)  ; get current time
041546 ED 5B 4F 15 0306*       ld de,(stopwatch_started)            ; get start time
       04          
04154B AF          0307*       xor a                   ; clear carry
04154C ED 52       0308*       sbc hl,de               ; hl = time elapsed (will always be zero or positive)
04154E C9          0309*       ret
04154F             0310*   
04154F             0311*   stopwatch_started: ds 3 ; buffer to hold stopwatch start time
041552             0312*   
041552             0313*   ; ------------------
041552             0314*   ; delay routine
041552             0315*   ; Author: Richard Turrnidge
041552             0316*   ; https://github.com/richardturnnidge/lessons/blob/main/slowdown.inc
041552             0317*   ; routine waits a fixed time,then returns
041552             0318*   ; arrive with A =  the delay byte. One bit to be set only.
041552             0319*   ; eg. ld A,00000100b
041552             0320*   
041552             0321*   multiPurposeDelay:
       FF FF FF 
041552 F5          0322*       push af
041553 C5          0323*       push bc
041554 DD E5       0324*       push ix
041556 47          0325*       ld b,a
041557 3E 08       0326*       ld a,$08
041559 5B CF       0327*       RST.LIL	08h                 ; get IX pointer to sysvars
04155B             0328*   
04155B             0329*   waitLoop:
04155B             0330*   
04155B DD 7E 00    0331*       ld a,(ix + 0)              ; ix+0h is lowest byte of clock timer
04155E             0332*   
04155E             0333*                                   ;   we check if bit set is same as last time we checked.
04155E             0334*                                   ;   bit 0 - don't use
04155E             0335*                                   ;   bit 1 - changes 64 times per second
04155E             0336*                                   ;   bit 2 - changes 32 times per second
04155E             0337*                                   ;   bit 3 - changes 16 times per second
04155E             0338*   
04155E             0339*                                   ;   bit 4 - changes 8 times per second
04155E             0340*                                   ;   bit 5 - changes 4 times per second
04155E             0341*                                   ;   bit 6 - changes 2 times per second
04155E             0342*                                   ;   bit 7 - changes 1 times per second
04155E A0          0343*       and b
04155F 4F          0344*       ld c,a
041560 3A 71 15 04 0345*       ld a,(oldTimeStamp)
041564 B9          0346*       cp c                        ; is A same as last value?
041565 28 F4       0347*       jr z,waitLoop              ; loop here if it is
041567 79          0348*       ld a,c
041568 32 71 15 04 0349*       ld (oldTimeStamp),a        ; set new value
04156C             0350*   
04156C DD E1       0351*       pop ix
04156E C1          0352*       pop bc
04156F F1          0353*       pop af
041570 C9          0354*       ret
041571             0355*   
041571 00          0356*   oldTimeStamp:   .db 00h
041572             0039        include "vdu.inc"
041572 FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF       
041600             0002*   
041600             0003*   ; VDU 30: Home cursor
041600             0004*   vdu_home_cursor:
041600 3E 1E       0005*       ld a,30
041602 5B D7       0006*   	rst.lil $10
041604 C9          0007*   	ret
041605             0008*   
041605             0009*   vdu_cursor_on:
041605 21 10 16 04 0010*   	ld hl,@cmd
041609 01 03 00 00 0011*   	ld bc,@end-@cmd
04160D 5B DF       0012*   	rst.lil $18
04160F C9          0013*   	ret
041610             0014*   @cmd:
041610 17 01 01    0015*   	db 23,1,1
041613             0016*   @end:
041613             0017*   
041613             0018*   vdu_cursor_off:
041613 21 1E 16 04 0019*   	ld hl,@cmd
041617 01 03 00 00 0020*   	ld bc,@end-@cmd
04161B 5B DF       0021*   	rst.lil $18
04161D C9          0022*   	ret
04161E             0023*   @cmd:
04161E 17 01 00    0024*   	db 23,1,0
041621             0025*   @end:
041621             0026*   
041621             0027*   ; VDU 5: Write text at graphics cursor
041621             0028*   ; inputs: a is the character to write to the screen
041621             0029*   ; prerequisites: the graphics cursor at the intended position on screen
041621             0030*   ; outputs: see the name of the function
041621             0031*   ; destroys: a, hl, bc
041621             0032*   vdu_char_to_gfx_cursor:
041621 32 31 16 04 0033*   	ld (@arg),a
041625 21 30 16 04 0034*   	ld hl,@cmd
041629 01 02 00 00 0035*   	ld bc,@end-@cmd
04162D 5B DF       0036*   	rst.lil $18
04162F C9          0037*   	ret
041630 05          0038*   @cmd: db 5
041631 00          0039*   @arg: db 0
041632             0040*   @end:
041632             0041*   ; VDU 9: Move cursor forward one character
041632             0042*   vdu_cursor_forward:
041632 3E 09       0043*       ld a,9
041634 5B D7       0044*   	rst.lil $10
041636 C9          0045*   	ret
041637             0046*   
041637             0047*   ; VDU 31, x, y: Move text cursor to x, y text position (TAB(x, y))
041637             0048*   ; inputs: c=x, b=y 8-bit unsigned integers
041637             0049*   vdu_move_cursor:
041637 ED 43 48 16 0050*       ld (@x0),bc
       04          
04163C 21 47 16 04 0051*   	ld hl,@cmd
041640 01 03 00 00 0052*   	ld bc,@end-@cmd
041644 5B DF       0053*   	rst.lil $18
041646 C9          0054*   	ret
041647 1F          0055*   @cmd: 	db 31
041648 00          0056*   @x0:	db 0
041649 00          0057*   @y0: 	db 0
04164A 00          0058*   @end: 	db 0 ; padding
04164B             0059*   
04164B             0060*   ; VDU 12: Clear text area (CLS)
04164B             0061*   vdu_cls:
04164B 3E 0C       0062*       ld a,12
04164D 5B D7       0063*   	rst.lil $10
04164F C9          0064*   	ret
041650             0065*   
041650             0066*   vdu_flip:
041650 21 5B 16 04 0067*   	ld hl,@cmd
041654 01 03 00 00 0068*   	ld bc,@end-@cmd
041658 5B DF       0069*   	rst.lil $18
04165A C9          0070*   	ret
04165B 17 00 C3    0071*   @cmd: db 23,0,0xC3
04165E             0072*   @end:
04165E             0073*   
04165E             0074*   ; VDU 16: Clear graphics area (CLG)
04165E             0075*   vdu_clg:
04165E 3E 10       0076*       ld a,16
041660 5B D7       0077*   	rst.lil $10
041662 C9          0078*   	ret
041663             0079*   
041663             0080*   ; https://github.com/breakintoprogram/agon-docs/wiki/VDP
041663             0081*   ; VDU 23, 7: Scrolling
041663             0082*   ;     VDU 23, 7, extent, direction, speed: Scroll the screen
041663             0083*   ; inputs: a, extent; l, direction; h; speed
041663             0084*   vdu_scroll_down:
041663 32 78 16 04 0085*   	ld (@extent),a
041667 22 79 16 04 0086*   	ld (@dir),hl ; implicitly populates @speed
04166B 21 76 16 04 0087*   	ld hl,@cmd
04166F 01 05 00 00 0088*   	ld bc,@end-@cmd
041673 5B DF       0089*   	rst.lil $18     ;; Sending command to VDP
041675 C9          0090*   	ret
041676 17 07       0091*   @cmd:       db 23,7
041678 00          0092*   @extent:    db 0x00 ; 0 current text window, 1 entire screen, 2 curr gfx viewport
041679 00          0093*   @dir:       db 0x00 ; 0 right, 1 left, 2 down, 3 up
04167A 00          0094*   @speed:     db 0x00 ; pixels
04167B 00          0095*   @end:		db 0x00 ; padding
04167C             0096*   
04167C             0097*   ; COLOUR MODES
04167C             0098*   ; Mode	Effect
04167C             0099*   ; 0	Set on-screen pixel to target colour value
04167C             0100*   ; 1	OR value with the on-screen pixel
04167C             0101*   ; 2	AND value with the on-screen pixel
04167C             0102*   ; 3	XOR value with the on-screen pixel
04167C             0103*   ; 4	Invert the on-screen pixel
04167C             0104*   ; 5	No operation
04167C             0105*   ; 6	AND the inverse of the specified colour with the on-screen pixel
04167C             0106*   ; 7	OR the inverse of the specified colour with the on-screen pixel
04167C             0107*   
04167C             0108*   ; VDU 17, colour: Define text colour (COLOUR)
04167C             0109*   vdu_colour_text:
04167C 32 8C 16 04 0110*   	ld (@arg),a
041680 21 8B 16 04 0111*   	ld hl,@cmd
041684 01 02 00 00 0112*   	ld bc,@end-@cmd
041688 5B DF       0113*   	rst.lil $18
04168A C9          0114*   	ret
04168B 11          0115*   @cmd: db 17
04168C 00          0116*   @arg: db 0
04168D             0117*   @end:
04168D             0118*   
04168D             0119*   ; VDU 18, mode, colour: Set graphics colour (GCOL mode, colour)
04168D             0120*   ; inputs: a=mode, c=colour (add 128 to set background colour)
04168D             0121*   vdu_gcol:
04168D 32 A2 16 04 0122*   	ld (@mode),a
041691 79          0123*       ld a,c
041692 32 A3 16 04 0124*       ld (@col),a
041696 21 A1 16 04 0125*   	ld hl,@cmd
04169A 01 03 00 00 0126*   	ld bc,@end-@cmd
04169E 5B DF       0127*   	rst.lil $18
0416A0 C9          0128*   	ret
0416A1 12          0129*   @cmd:  db 18
0416A2 00          0130*   @mode: db 0
0416A3 00          0131*   @col:  db 0
0416A4             0132*   @end:
0416A4             0133*   
0416A4             0134*   
0416A4             0135*   ; VDU 28, left, bottom, right, top: Set text viewport **
0416A4             0136*   ; MIND THE LITTLE-ENDIANESS
0416A4             0137*   ; inputs: c=left,b=bottom,e=right,d=top
0416A4             0138*   ; outputs; nothing
0416A4             0139*   ; destroys: a might make it out alive
0416A4             0140*   vdu_set_txt_viewport:
0416A4 ED 43 BA 16 0141*       ld (@lb),bc
       04          
0416A9 ED 53 BC 16 0142*   	ld (@rt),de
       04          
0416AE 21 B9 16 04 0143*   	ld hl,@cmd
0416B2 01 05 00 00 0144*   	ld bc,@end-@cmd
0416B6 5B DF       0145*   	rst.lil $18
0416B8 C9          0146*   	ret
0416B9 1C          0147*   @cmd:   db 28 ; set text viewport command
0416BA 00 00       0148*   @lb: 	dw 0x0000 ; set by bc
0416BC 00 00       0149*   @rt: 	dw 0x0000 ; set by de
0416BE 00          0150*   @end:   db 0x00	  ; padding
0416BF             0151*   
0416BF             0152*   ; Wait for VBLANK interrupt
0416BF             0153*   vdu_vblank:
0416BF DD E5       0154*       PUSH 	IX
0416C1             0155*   	MOSCALL	mos_sysvars
0416C1 3E 08       0001*M1 			LD	A, function
0416C3 5B CF       0002*M1 			RST.LIL	08h
0416C5 DD 7E 00    0156*   	LD	A, (IX + sysvar_time + 0)
0416C8             0157*   @wait:
0416C8 DD BE 00    0158*       CP 	A, (IX + sysvar_time + 0)
0416CB 28 FB       0159*       JR	Z, @wait
0416CD DD E1       0160*       POP	IX
0416CF C9          0161*       RET
0416D0             0162*   
0416D0             0163*   ; VDU 29, x; y;: Set graphics origin
0416D0             0164*   ; This command sets the graphics origin.
0416D0             0165*   ; The origin is the point on the screen where the coordinates (0,0) are located.
0416D0             0166*   ; inputs: bc=x0,de=y0
0416D0             0167*   ; outputs; nothing
0416D0             0168*   ; destroys: a might make it out alive
0416D0             0169*   vdu_set_gfx_origin:
0416D0 ED 43 E6 16 0170*       ld (@x0),bc
       04          
0416D5 ED 53 E8 16 0171*       ld (@y0),de
       04          
0416DA 21 E5 16 04 0172*       ld hl,@cmd
0416DE 01 05 00 00 0173*       ld bc,@end-@cmd
0416E2 5B DF       0174*       rst.lil $18
0416E4 C9          0175*       ret
0416E5 1D          0176*   @cmd:   db 29 ; set graphics origin command
0416E6 00 00       0177*   @x0: 	dw 0x0000 ; set by bc
0416E8 00 00       0178*   @y0: 	dw 0x0000 ; set by de
0416EA 00          0179*   @end:   db 0x00	  ; padding
0416EB             0180*   
0416EB             0181*   ; VDU 24, left; bottom; right; top;: Set graphics viewport
0416EB             0182*   ; NOTE: the order of the y-coordinate parameters are inverted
0416EB             0183*   ; 	because we have turned off logical screen scaling
0416EB             0184*   ; NOTE: coordinates are relative to current gfx origin
0416EB             0185*   ; inputs: bc=x0,de=y0,ix=x1,iy=y1
0416EB             0186*   ; outputs; nothing
0416EB             0187*   ; destroys: a might make it out alive
0416EB             0188*   vdu_set_gfx_viewport:
0416EB ED 43 0B 17 0189*       ld (@x0),bc
       04          
0416F0 FD 22 0D 17 0190*       ld (@y1),iy
       04          
0416F5 DD 22 0F 17 0191*   	ld (@x1),ix
       04          
0416FA ED 53 11 17 0192*   	ld (@y0),de
       04          
0416FF 21 0A 17 04 0193*   	ld hl,@cmd
041703 01 09 00 00 0194*   	ld bc,@end-@cmd
041707 5B DF       0195*   	rst.lil $18
041709 C9          0196*   	ret
04170A 18          0197*   @cmd:   db 24 ; set graphics viewport command
04170B 00 00       0198*   @x0: 	dw 0x0000 ; set by bc
04170D 00 00       0199*   @y1: 	dw 0x0000 ; set by iy
04170F 00 00       0200*   @x1: 	dw 0x0000 ; set by ix
041711 00 00       0201*   @y0: 	dw 0x0000 ; set by de
041713 00          0202*   @end:   db 0x00	  ; padding
041714             0203*   
041714             0204*   ; SCREEN MODES
041714             0205*   ; ===============================
041714             0206*   ; Mode  Horz  Vert  Cols  Refresh
041714             0207*   ; ---   ----  ----  ----  -------
041714             0208*   ; 11    320   240   2     60hz
041714             0209*   ; 139   320   240   2     60hz
041714             0210*   ; 23    512   384   2     60hz
041714             0211*   ; 151   512   384   2     60hz
041714             0212*   ; 6     640   240   2     60hz
041714             0213*   ; 134   640   240   2     60hz
041714             0214*   ; 2     640   480   2     60hz
041714             0215*   ; 130   640   480   2     60hz
041714             0216*   ; 17    800   600   2     60hz
041714             0217*   ; 145   800   600   2     60hz
041714             0218*   ; 18    1024  768   2     60hz
041714             0219*   ; 146   1024  768   2     60hz
041714             0220*   ; ---   ----  ----  ----  -------
041714             0221*   ; 10    320   240   4     60hz
041714             0222*   ; 138   320   240   4     60hz
041714             0223*   ; 22    512   384   4     60hz
041714             0224*   ; 150   512   384   4     60hz
041714             0225*   ; 5     640   240   4     60hz
041714             0226*   ; 133   640   240   4     60hz
041714             0227*   ; 1     640   480   4     60hz
041714             0228*   ; 129   640   480   4     60hz
041714             0229*   ; 16    800   600   4     60hz
041714             0230*   ; 19    1024  768   4     60hz
041714             0231*   ; ---   ----  ----  ----  -------
041714             0232*   ; 9     320   240   16    60hz
041714             0233*   ; 137   320   240   16    60hz
041714             0234*   ; 21    512   384   16    60hz
041714             0235*   ; 149   512   384   16    60hz
041714             0236*   ; 4     640   240   16    60hz
041714             0237*   ; 132   640   240   16    60hz
041714             0238*   ; 0     640   480   16    60hz
041714             0239*   ; 7     n/a   n/a   16    60hz
041714             0240*   ; ---   ----  ----  ----  -------
041714             0241*   ; 8     320   240   64    60hz
041714             0242*   ; 136   320   240   64    60hz
041714             0243*   ; 20    512   384   64    60hz
041714             0244*   ; 3     640   240   64    60hz
041714             0245*   ; ---   ----  ----  ----  -------
041714             0246*   vdu_set_screen_mode:
041714 32 24 17 04 0247*   	ld (@arg),a
041718 21 23 17 04 0248*   	ld hl,@cmd
04171C 01 02 00 00 0249*   	ld bc,@end-@cmd
041720 5B DF       0250*   	rst.lil $18
041722 C9          0251*   	ret
041723 16          0252*   @cmd: db 22 ; set screen mode
041724 00          0253*   @arg: db 0  ; screen mode parameter
041725             0254*   @end:
041725             0255*   
041725             0256*   ; VDU 23, 0, &C0, n: Turn logical screen scaling on and off *
041725             0257*   ; inputs: a is scaling mode, 1=on, 0=off
041725             0258*   ; note: default setting on boot is scaling ON
041725             0259*   vdu_set_scaling:
041725 32 37 17 04 0260*   	ld (@arg),a
041729 21 34 17 04 0261*   	ld hl,@cmd
04172D 01 04 00 00 0262*   	ld bc,@end-@cmd
041731 5B DF       0263*   	rst.lil $18
041733 C9          0264*   	ret
041734 17 00 C0    0265*   @cmd: db 23,0,0xC0
041737 00          0266*   @arg: db 0  ; scaling on/off
041738             0267*   @end:
041738             0268*   
041738             0269*   ; VDU 23, 27, &20, bufferId; : Select bitmap (using a buffer ID)
041738             0270*   ; inputs: hl=bufferId
041738             0271*   vdu_buff_select:
041738 22 4A 17 04 0272*   	ld (@bufferId),hl
04173C 21 47 17 04 0273*   	ld hl,@cmd
041740 01 05 00 00 0274*   	ld bc,@end-@cmd
041744 5B DF       0275*   	rst.lil $18
041746 C9          0276*   	ret
041747 17 1B 20    0277*   @cmd: db 23,27,0x20
04174A 00 00       0278*   @bufferId: dw 0x0000
04174C 00          0279*   @end: db 0x00 ; padding
04174D             0280*   
04174D             0281*   ; VDU 23, 27, &21, w; h; format: Create bitmap from selected buffer
04174D             0282*   ; inputs: a=format; bc=width; de=height
04174D             0283*   ; prerequisites: buffer selected by vdu_bmp_select or vdu_buff_select
04174D             0284*   ; formats: https://agonconsole8.github.io/agon-docs/VDP---Bitmaps-API.html
04174D             0285*   ; 0 	RGBA8888 (4-bytes per pixel)
04174D             0286*   ; 1 	RGBA2222 (1-bytes per pixel)
04174D             0287*   ; 2 	Mono/Mask (1-bit per pixel)
04174D             0288*   ; 3 	Reserved for internal use by VDP (â€œnativeâ€ format)
04174D             0289*   vdu_bmp_create:
04174D ED 43 69 17 0290*       ld (@width),bc
       04          
041752 ED 53 6B 17 0291*       ld (@height),de
       04          
041757 32 6D 17 04 0292*       ld (@fmt),a
04175B 21 66 17 04 0293*   	ld hl,@cmd
04175F 01 08 00 00 0294*   	ld bc,@end-@cmd
041763 5B DF       0295*   	rst.lil $18
041765 C9          0296*   	ret
041766 17 1B 21    0297*   @cmd:       db 23,27,0x21
041769 00 00       0298*   @width:     dw 0x0000
04176B 00 00       0299*   @height:    dw 0x0000
04176D 00          0300*   @fmt:       db 0x00
04176E             0301*   @end:
04176E             0302*   
04176E             0303*   ; load an rgba2222 image file to a working buffer and make it an rgba8888 bitmap in a target buffer
04176E             0304*   ; inputs: bc,de image width,height ; hl = targetBufferId ; ix = file size ; iy = pointer to filename
04176E             0305*   vdu_load_img_rgba2_to_8:
04176E             0306*   ; backup the target buffer id and image dimensions
04176E E5          0307*       push hl
04176F D5          0308*       push de
041770 C5          0309*       push bc
041771             0310*   ; load the rgba2 image to working buffer 65534
041771 21 FE FF 00 0311*       ld hl,65534 ; temporary working buffer id
041775 CD 78 18 04 0312*   	call vdu_load_buffer_from_file
041779             0313*   ; restore the image dimensions and target buffer id
041779 C1          0314*       pop bc
04177A D1          0315*       pop de
04177B E1          0316*       pop hl
04177C             0317*   ; fall through to vdu_rgba2_to_8
04177C             0318*   
04177C             0319*   ; https://discord.com/channels/1158535358624039014/1158536711148675072/1257757461729771771
04177C             0320*   ; ok, so the "expand bitmap" can be used, when coupled with a "reverse" - the expanded bitmap _doesn't_ come out "right" otherwise, cos of endian-ness
04177C             0321*   ; the "expand bitmap" command is:
04177C             0322*   ; VDU 23,0,&A0,targetBufferID%;&48,2,sourceBufferId%;0,&7F,&BF,&FF
04177C             0323*   ; and then to reverse the byte order to fix endian-ness:
04177C             0324*   ; VDU 23,0,&A0,targetBufferID%;24,4,4;
04177C             0325*   ; finally you'd need to set that buffer to be an RGBA8888 format bitmap:
04177C             0326*   ; VDU 23,27,&20,targetBufferID%;
04177C             0327*   ; VDU 23,27,&21,width%;height%;0
04177C             0328*   ; -------------------------------------------------------------------
04177C             0329*   ; inputs: bc,de image width,height ; hl = targetBufferId
04177C             0330*   ; prerequisites: rgba2 image data loaded into workingBufferId 65534
04177C             0331*   vdu_rgba2_to_8:
04177C             0332*   ; load the image dimensions and buffer id parameters
04177C ED 43 D8 17 0333*       ld (@width),bc
       04          
041781 ED 53 DA 17 0334*       ld (@height),de
       04          
041786 22 BD 17 04 0335*       ld (@bufferId0),hl
04178A 22 CA 17 04 0336*       ld (@bufferId2),hl
04178E 22 D3 17 04 0337*       ld (@bufferId1),hl
041792             0338*   ; clean up bytes that got stomped on by the ID loads
041792 3E 48       0339*       ld a,0x48
041794 32 BF 17 04 0340*       ld (@bufferId0+2),a
041798 3E 17       0341*       ld a,23
04179A 32 D5 17 04 0342*       ld (@bufferId1+2),a
04179E 3E 18       0343*       ld a,24
0417A0 32 CC 17 04 0344*       ld (@bufferId2+2),a
0417A4 AF          0345*       xor a
0417A5 32 DC 17 04 0346*       ld (@height+2),a
0417A9             0347*   ; send the vdu command strings
0417A9 21 B4 17 04 0348*       ld hl,@beg
0417AD 01 29 00 00 0349*       ld bc,@end-@beg
0417B1 5B DF       0350*       rst.lil $18
0417B3 C9          0351*       ret
0417B4             0352*   @beg:
0417B4             0353*   ; Command 14: Consolidate blocks in a buffer
0417B4             0354*   ; VDU 23, 0, &A0, bufferId; 14
0417B4 17 00 A0    0355*       db 23,0,0xA0
0417B7 FE FF       0356*       dw 65534 ; workingBufferId
0417B9 0E          0357*       db 14 ; consolidate blocks
0417BA             0358*   ; the "expand bitmap" command is:
0417BA             0359*   ; VDU 23,0,&A0,targetBufferID%;&48,2,sourceBufferId%;0,&7F,&BF,&FF
0417BA 17 00 A0    0360*       db 23,0,0xA0
0417BD 00 00       0361*   @bufferId0: dw 0x0000 ; targetBufferId
0417BF 48          0362*       db 0x48 ; given as decimal command 72 in the docs
0417C0 02          0363*       db 2 ; options mask: %00000011 is the number of bits per pixel in the source bitmap
0417C1 FE FF       0364*       dw 65534 ; sourceBufferId
0417C3 00 7F BF FF 0365*       db 0x00,0x7F,0xBF,0xFF ; expanding to bytes by bit-shifting?
0417C7             0366*   ; reverse the byte order to fix endian-ness:
0417C7             0367*   ; Command 24: Reverse the order of data of blocks within a buffer
0417C7             0368*   ; VDU 23, 0, &A0, bufferId; 24, options, [valueSize;] [chunkSize;]
0417C7             0369*   ; VDU 23,0,&A0,targetBufferID%;24,4,4;
0417C7 17 00 A0    0370*       db 23,0,0xA0
0417CA 00 00       0371*   @bufferId2:    dw 0x0000 ; targetBufferId
0417CC 18          0372*       db 24 ; reverse byte order
0417CD 04          0373*       db 4 ; option: Reverse data of the value size within chunk of data of the specified size
0417CE 04 00       0374*       dw 4 ; size (4 bytes)
0417D0             0375*   ; finally you'd need to set that buffer to be an RGBA8888 format bitmap:
0417D0             0376*   ; VDU 23,27,&20,targetBufferID%;
0417D0 17 1B 20    0377*       db 23,27,0x20 ; select bitmap
0417D3 00 00       0378*   @bufferId1: dw 0x0000 ; targetBufferId
0417D5             0379*   ; VDU 23,27,&21,width%;height%;0
0417D5 17 1B 21    0380*       db 23,27,0x21 ; create bitmap from buffer
0417D8 00 00       0381*   @width: dw 0x0000
0417DA 00 00       0382*   @height: dw 0x0000
0417DC 00          0383*       db 0x00 ; rgba8888 format
0417DD             0384*   @end:
0417DD             0385*   
0417DD             0386*   ; scratch variables
0417DD 00 00 00    0387*   bufferId0: dl 0x000000
0417E0 00 00 00    0388*   bufferId1: dl 0x000000
0417E3             0389*   
0417E3             0390*   ; load a vdu buffer from local memory
0417E3             0391*   ; inputs: hl = bufferId ; bc = length ; de = pointer to data
0417E3             0392*   vdu_load_buffer:
0417E3 ED 43 0C 18 0393*       ld (@length),bc
       04          
0417E8 D5          0394*       push de ; save data pointer
0417E9             0395*   ; send the vdu command string
0417E9 7D          0396*       ld a,l
0417EA 32 09 18 04 0397*       ld (@bufferId),a
0417EE 7C          0398*       ld a,h
0417EF 32 0A 18 04 0399*       ld (@bufferId+1),a
0417F3 21 06 18 04 0400*       ld hl,@cmd
0417F7 01 08 00 00 0401*       ld bc,@end-@cmd
0417FB 5B DF       0402*       rst.lil $18
0417FD             0403*   ; send the buffer data
0417FD E1          0404*       pop hl ; pointer to data
0417FE ED 4B 0C 18 0405*       ld bc,(@length)
       04          
041803 5B DF       0406*       rst.lil $18 ; send it
041805 C9          0407*       ret
041806             0408*   ; Upload data :: VDU 23, 0 &A0, bufferId; 0, length; <buffer-data>
041806 17 00 A0    0409*   @cmd:       db 23,0,0xA0
041809 00 00       0410*   @bufferId:	dw 0x0000
04180B 00          0411*   		    db 0 ; load buffer
04180C 00 00       0412*   @length:	dw 0x0000
04180E 00          0413*   @end: db 0 ; padding
04180F             0414*   
04180F             0415*   ; clear a buffer
04180F             0416*   ; inputs: hl = bufferId
04180F             0417*   vdu_clear_buffer:
04180F 7D          0418*       ld a,l
041810 32 27 18 04 0419*       ld (@bufferId),a
041814 7C          0420*       ld a,h
041815 32 28 18 04 0421*       ld (@bufferId+1),a
041819 21 24 18 04 0422*       ld hl,@cmd
04181D 01 06 00 00 0423*       ld bc,@end-@cmd
041821 5B DF       0424*       rst.lil $18
041823 C9          0425*       ret
041824 17 00 A0    0426*   @cmd:       db 23,0,0xA0
041827 00 00       0427*   @bufferId:	dw 0x0000
041829 02          0428*   		    db 2 ; clear buffer
04182A             0429*   @end:
04182A             0430*   
04182A             0431*   vdu_clear_all_buffers:
04182A             0432*   ; clear all buffers
04182A 21 35 18 04 0433*       ld hl,@beg
04182E 01 06 00 00 0434*       ld bc,@end-@beg
041832 5B DF       0435*       rst.lil $18
041834 C9          0436*       ret
041835 17 00 A0    0437*   @beg: db 23,0,$A0
041838 FF FF       0438*         dw -1 ; clear all buffers
04183A 02          0439*         db 2  ; command 2: clear a buffer
04183B             0440*   @end:
04183B             0441*   
04183B             0442*   ; Command 14: Consolidate blocks in a buffer
04183B             0443*   vdu_consolidate_buffer:
04183B             0444*   ; set parameters for vdu call
04183B 7D          0445*       ld a,l
04183C 32 53 18 04 0446*       ld (@bufferId),a
041840 7C          0447*       ld a,h
041841 32 54 18 04 0448*       ld (@bufferId+1),a
041845 21 50 18 04 0449*       ld hl,@beg
041849 01 06 00 00 0450*       ld bc,@end-@beg
04184D 5B DF       0451*       rst.lil $18
04184F C9          0452*       ret
041850             0453*   ; VDU 23, 0, &A0, bufferId; 14
041850 17 00 A0    0454*   @beg: db 23,0,0xA0
041853 00 00       0455*   @bufferId: dw 0x0000
041855 0E          0456*              db 14
041856             0457*   @end:
041856             0458*   
041856             0459*   ; load an image file to a buffer and make it a bitmap
041856             0460*   ; inputs: a = image type ; bc,de image width,height ; hl = bufferId ; ix = file size ; iy = pointer to filename
041856             0461*   vdu_load_img:
041856             0462*   ; back up image type and dimension parameters
041856 22 DD 17 04 0463*       ld (bufferId0),hl
04185A F5          0464*       push af
04185B C5          0465*   	push bc
04185C D5          0466*   	push de
04185D             0467*   ; load the image
04185D CD 78 18 04 0468*   	call vdu_load_buffer_from_file
041861             0469*   ; now make it a bitmap
041861 2A DD 17 04 0470*       ld hl,(bufferId0)
041865 CD 3B 18 04 0471*       call vdu_consolidate_buffer
041869 2A DD 17 04 0472*       ld hl,(bufferId0)
04186D CD 38 17 04 0473*       call vdu_buff_select
041871 D1          0474*   	pop de ; image height
041872 C1          0475*   	pop bc ; image width
041873 F1          0476*   	pop af ; image type
041874 C3 4D 17 04 0477*   	jp vdu_bmp_create ; will return to caller from there
041878             0478*   
041878             0479*   ; inputs: hl = bufferId; iy = pointer to filename
041878             0480*   vdu_load_buffer_from_file:
041878 22 DD 17 04 0481*       ld (bufferId0),hl
04187C             0482*   
04187C             0483*   ; clear target buffer
04187C CD 0F 18 04 0484*       call vdu_clear_buffer
041880             0485*   
041880             0486*   ; open the file in read mode
041880             0487*   ; Open a file
041880             0488*   ; HLU: Filename
041880             0489*   ;   C: Mode
041880             0490*   ; Returns:
041880             0491*   ;   A: Filehandle, or 0 if couldn't open
041880 FD E5       0492*   	push iy ; pointer to filename
041882 E1          0493*   	pop hl
041883 0E 01       0494*   	ld c,fa_read
041885             0495*       MOSCALL mos_fopen
041885 3E 0A       0001*M1 			LD	A, function
041887 5B CF       0002*M1 			RST.LIL	08h
041889 32 C4 18 04 0496*       ld (@filehandle),a
04188D             0497*   
04188D             0498*   @read_file:
04188D             0499*   ; Read a block of data from a file
04188D             0500*   ;   C: Filehandle
04188D             0501*   ; HLU: Pointer to where to write the data to
04188D             0502*   ; DEU: Number of bytes to read
04188D             0503*   ; Returns:
04188D             0504*   ; DEU: Number of bytes read
04188D 3A C4 18 04 0505*       ld a,(@filehandle)
041891 4F          0506*       ld c,a
041892 21 00 E0 B7 0507*       ld hl,filedata
041896 11 00 20 00 0508*       ld de,8192 ; max we can read into onboard sram at one time
04189A             0509*       MOSCALL mos_fread
04189A 3E 1A       0001*M1 			LD	A, function
04189C 5B CF       0002*M1 			RST.LIL	08h
04189E             0510*   
04189E             0511*   ; test de for zero bytes read
04189E 21 00 00 00 0512*       ld hl,0
0418A2 AF          0513*       xor a ; clear carry
0418A3 ED 52       0514*       sbc hl,de
0418A5 CA BB 18 04 0515*       jp z,@close_file
0418A9             0516*   
0418A9             0517*   ; load a vdu buffer from local memory
0418A9             0518*   ; inputs: hl = bufferId ; bc = length ; de = pointer to data
0418A9 2A DD 17 04 0519*       ld hl,(bufferId0)
0418AD D5          0520*       push de ; chunksize
0418AE C1          0521*       pop bc
0418AF 11 00 E0 B7 0522*       ld de,filedata
0418B3 CD E3 17 04 0523*       call vdu_load_buffer
0418B7             0524*   
0418B7             0525*   ; read the next block
0418B7 C3 8D 18 04 0526*       jp @read_file
0418BB             0527*   
0418BB             0528*   ; close the file
0418BB             0529*   @close_file:
0418BB 3A C4 18 04 0530*       ld a,(@filehandle)
0418BF             0531*       MOSCALL mos_fclose
0418BF 3E 0B       0001*M1 			LD	A, function
0418C1 5B CF       0002*M1 			RST.LIL	08h
0418C3 C9          0532*       ret ; vdu_load_buffer_from_file
0418C4             0533*   
0418C4 00          0534*   @filehandle: db 0 ; file handle
0418C5 00 00 00    0535*   @fil: dl 0 ; pointer to FIL struct
0418C8             0536*   
0418C8 00 00 00    0537*   @chunkpointer: dl 0 ; pointer to current chunk
0418CB             0538*   
0418CB             0539*   ; File information structure (FILINFO)
0418CB             0540*   @filinfo:
0418CB 00 00 00 00 0541*   @filinfo_fsize:    blkb 4, 0   ; File size (4 bytes)
0418CF 00 00       0542*   @filinfo_fdate:    blkb 2, 0   ; Modified date (2 bytes)
0418D1 00 00       0543*   @filinfo_ftime:    blkb 2, 0   ; Modified time (2 bytes)
0418D3 00          0544*   @filinfo_fattrib:  blkb 1, 0   ; File attribute (1 byte)
0418D4 00 00 00 00 0545*   @filinfo_altname:  blkb 13, 0  ; Alternative file name (13 bytes)
       00 00 00 00 
       00 00 00 00 
       00          
0418E1 00 00 00 00 0546*   @filinfo_fname:    blkb 256, 0 ; Primary file name (256 bytes)
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
0419E1             0040        include "vdu_fonts.inc"
0419E1 FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF    
041A00             0002*   ; select font
041A00             0003*   ; inputs: hl = bufferId, a = font flags
041A00             0004*   ; Flags:
041A00             0005*   ; Bit	Description
041A00             0006*   ; 0	Adjust cursor position to ensure text baseline is aligned
041A00             0007*   ;   0: Do not adjust cursor position (best for changing font on a new line)
041A00             0008*   ;   1: Adjust cursor position (best for changing font in the middle of a line)
041A00             0009*   ; 1-7	Reserved for future use
041A00             0010*   ; VDU 23, 0, &95, 0, bufferId; flags: Select font
041A00             0011*   vdu_font_select:
041A00 22 17 1A 04 0012*       ld (@bufferId),hl
041A04 32 19 1A 04 0013*       ld (@flags),a
041A08 21 13 1A 04 0014*       ld hl,@cmd
041A0C 01 07 00 00 0015*       ld bc,@end-@cmd
041A10 5B DF       0016*       rst.lil $18
041A12 C9          0017*       ret
041A13 17 00 95 00 0018*   @cmd: db 23, 0, 0x95, 0
041A17 00 00       0019*   @bufferId: dw 0x0000
041A19 00          0020*   @flags: db 0x00
041A1A             0021*   @end:
041A1A             0022*   
041A1A             0023*   ; create font from buffer
041A1A             0024*   ; inputs: hl = bufferId, e = width, d = height, d = ascent, a = flags
041A1A             0025*   ; VDU 23, 0, &95, 1, bufferId; width, height, ascent, flags: Create font from buffer
041A1A             0026*   vdu_font_create:
041A1A 22 3F 1A 04 0027*       ld (@bufferId),hl
041A1E ED 53 41 1A 0028*       ld (@width),de ; also loads height
       04          
041A23 32 44 1A 04 0029*       ld (@flags),a
041A27 7A          0030*       ld a,d ; height
041A28 32 43 1A 04 0031*       ld (@ascent),a ; ascent = height
041A2C             0032*   ; consolidate buffer
041A2C CD 3B 18 04 0033*       call vdu_consolidate_buffer
041A30             0034*   ; create font
041A30 21 3B 1A 04 0035*       ld hl,@cmd
041A34 01 0A 00 00 0036*       ld bc,@end-@cmd
041A38 5B DF       0037*       rst.lil $18
041A3A C9          0038*       ret
041A3B 17 00 95 01 0039*   @cmd: db 23, 0, 0x95, 1
041A3F 00 00       0040*   @bufferId: dw 0x0000
041A41 00          0041*   @width: db 0x00
041A42 00          0042*   @height: db 0x00
041A43 00          0043*   @ascent: db 0x00
041A44 00          0044*   @flags: db 0x00
041A45             0045*   @end:
041A45             0046*   
041A45             0047*   ; set or adjust font property
041A45             0048*   ; inputs: hl = bufferId, a = field, de = value
041A45             0049*   ; VDU 23, 0, &95, 2, bufferId; field, value;: Set or adjust font property
041A45             0050*   vdu_font_property:
041A45 22 61 1A 04 0051*       ld (@bufferId),hl
041A49 32 63 1A 04 0052*       ld (@field),a
041A4D ED 53 64 1A 0053*       ld (@value),de
       04          
041A52 21 5D 1A 04 0054*       ld hl,@cmd
041A56 01 09 00 00 0055*       ld bc,@end-@cmd
041A5A 5B DF       0056*       rst.lil $18
041A5C C9          0057*       ret
041A5D 17 00 95 02 0058*   @cmd: db 23, 0, 0x95, 2
041A61 00 00       0059*   @bufferId: dw 0x0000
041A63 00          0060*   @field: db 0x00
041A64 00 00       0061*   @value: dw 0x0000
041A66 00          0062*   @end: db 0x00 ; padding
041A67             0063*   
041A67             0064*   ; VDU 23, 0, &95, 3, bufferId; [<args>]: Reserved
041A67             0065*   
041A67             0066*   ; Clear/Delete font
041A67             0067*   ; inputs: hl = bufferId
041A67             0068*   ; VDU 23, 0, &95, 4, bufferId;: Clear/Delete font
041A67             0069*   vdu_font_clear:
041A67 22 7A 1A 04 0070*       ld (@bufferId),hl
041A6B 21 76 1A 04 0071*       ld hl,@cmd
041A6F 01 06 00 00 0072*       ld bc,@end-@cmd
041A73 5B DF       0073*       rst.lil $18
041A75 C9          0074*       ret
041A76 17 00 95 04 0075*   @cmd: db 23, 0, 0x95, 4
041A7A 00 00       0076*   @bufferId: dw 0x0000
041A7C 00          0077*   @end: db 0x00 ; padding
041A7D             0078*   
041A7D             0079*   ; Copy system font to buffer
041A7D             0080*   ; inputs: hl = bufferId
041A7D             0081*   ; VDU 23, 0, &95, 5, bufferId;: Copy system font to buffer
041A7D             0082*   vdu_font_copy_system:
041A7D 22 90 1A 04 0083*       ld (@bufferId),hl
041A81 21 8C 1A 04 0084*       ld hl,@cmd
041A85 01 06 00 00 0085*       ld bc,@end-@cmd
041A89 5B DF       0086*       rst.lil $18
041A8B C9          0087*       ret
041A8C 17 00 95 05 0088*   @cmd: db 23, 0, 0x95, 5
041A90 00 00       0089*   @bufferId: dw 0x0000
041A92 00          0090*   @end: db 0x00 ; padding
041A93             0041        include "vdu_plot.inc"
041A93 FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF          
041B00             0002*   ; https://agonconsole8.github.io/agon-docs/VDP---PLOT-Commands.html
041B00             0003*   ; PLOT code 	(Decimal) 	Effect
041B00             0004*   ; &00-&07 	0-7 	Solid line, includes both ends
041B00             0005*   plot_sl_both: equ 0x00
041B00             0006*   
041B00             0007*   ; &08-&0F 	8-15 	Solid line, final point omitted
041B00             0008*   plot_sl_first: equ 0x08
041B00             0009*   
041B00             0010*   ; &10-&17 	16-23 	Not supported (Dot-dash line, includes both ends, pattern restarted)
041B00             0011*   ; &18-&1F 	24-31 	Not supported (Dot-dash line, first point omitted, pattern restarted)
041B00             0012*   
041B00             0013*   ; &20-&27 	32-39 	Solid line, first point omitted
041B00             0014*   plot_sl_last: equ 0x20
041B00             0015*   
041B00             0016*   ; &28-&2F 	40-47 	Solid line, both points omitted
041B00             0017*   plot_sl_none: equ 0x28
041B00             0018*   
041B00             0019*   ; &30-&37 	48-55 	Not supported (Dot-dash line, first point omitted, pattern continued)
041B00             0020*   ; &38-&3F 	56-63 	Not supported (Dot-dash line, both points omitted, pattern continued)
041B00             0021*   
041B00             0022*   ; &40-&47 	64-71 	Point plot
041B00             0023*   plot_pt: equ 0x40
041B00             0024*   
041B00             0025*   ; &48-&4F 	72-79 	Line fill left and right to non-background Â§Â§
041B00             0026*   plot_lf_lr_non_bg: equ 0x48
041B00             0027*   
041B00             0028*   ; &50-&57 	80-87 	Triangle fill
041B00             0029*   plot_tf: equ 0x50
041B00             0030*   
041B00             0031*   ; &58-&5F 	88-95 	Line fill right to background Â§Â§
041B00             0032*   plot_lf_r_bg: equ 0x58
041B00             0033*   
041B00             0034*   ; &60-&67 	96-103 	Rectangle fill
041B00             0035*   plot_rf: equ 0x60
041B00             0036*   
041B00             0037*   ; &68-&6F 	104-111 	Line fill left and right to foreground Â§Â§
041B00             0038*   plot_lf_lr_fg: equ 0x60
041B00             0039*   
041B00             0040*   ; &70-&77 	112-119 	Parallelogram fill
041B00             0041*   plot_pf: equ 0x70
041B00             0042*   
041B00             0043*   ; &78-&7F 	120-127 	Line fill right to non-foreground Â§Â§
041B00             0044*   plot_lf_r_non_fg: equ 0x78
041B00             0045*   
041B00             0046*   ; &80-&87 	128-135 	Not supported (Flood until non-background)
041B00             0047*   ; &88-&8F 	136-143 	Not supported (Flood until foreground)
041B00             0048*   
041B00             0049*   ; &90-&97 	144-151 	Circle outline
041B00             0050*   plot_co: equ 0x90
041B00             0051*   
041B00             0052*   ; &98-&9F 	152-159 	Circle fill
041B00             0053*   plot_cf: equ 0x98
041B00             0054*   
041B00             0055*   ; &A0-&A7 	160-167 	Not supported (Circular arc)
041B00             0056*   ; &A8-&AF 	168-175 	Not supported (Circular segment)
041B00             0057*   ; &B0-&B7 	176-183 	Not supported (Circular sector)
041B00             0058*   
041B00             0059*   ; &B8-&BF 	184-191 	Rectangle copy/move
041B00             0060*   plot_rcm: equ 0xB8
041B00             0061*   
041B00             0062*   ; &C0-&C7 	192-199 	Not supported (Ellipse outline)
041B00             0063*   ; &C8-&CF 	200-207 	Not supported (Ellipse fill)
041B00             0064*   ; &D0-&D7 	208-215 	Not defined
041B00             0065*   ; &D8-&DF 	216-223 	Not defined
041B00             0066*   ; &E0-&E7 	224-231 	Not defined
041B00             0067*   
041B00             0068*   ; &E8-&EF 	232-239 	Bitmap plot Â§
041B00             0069*   plot_bmp: equ 0xE8
041B00             0070*   
041B00             0071*   ; &F0-&F7 	240-247 	Not defined
041B00             0072*   ; &F8-&FF 	248-255 	Not defined
041B00             0073*   
041B00             0074*   ; Â§ Support added in Agon Console8 VDP 2.1.0 Â§Â§ Support added in
041B00             0075*   ; Agon Console8 VDP 2.2.0
041B00             0076*   
041B00             0077*   ; Within each group of eight plot codes, the effects are as follows:
041B00             0078*   ; Plot code 	Effect
041B00             0079*   ; 0 	Move relative
041B00             0080*   mv_rel: equ 0
041B00             0081*   
041B00             0082*   ; 1 	Plot relative in current foreground colour
041B00             0083*   dr_rel_fg: equ 1
041B00             0084*   
041B00             0085*   ; 2 	Not supported (Plot relative in logical inverse colour)
041B00             0086*   ; 3 	Plot relative in current background colour
041B00             0087*   dr_rel_bg: equ 3
041B00             0088*   
041B00             0089*   ; 4 	Move absolute
041B00             0090*   mv_abs: equ 4
041B00             0091*   
041B00             0092*   ; 5 	Plot absolute in current foreground colour
041B00             0093*   dr_abs_fg: equ 5
041B00             0094*   
041B00             0095*   ; 6 	Not supported (Plot absolute in logical inverse colour)
041B00             0096*   ; 7 	Plot absolute in current background colour
041B00             0097*   dr_abs_bg: equ 7
041B00             0098*   
041B00             0099*   ; Codes 0-3 use the position data provided as part of the command
041B00             0100*   ; as a relative position, adding the position given to the current
041B00             0101*   ; graphical cursor position. Codes 4-7 use the position data provided
041B00             0102*   ; as part of the command as an absolute position, setting the current
041B00             0103*   ; graphical cursor position to the position given.
041B00             0104*   
041B00             0105*   ; Codes 2 and 6 on Acorn systems plot using a logical inverse of the
041B00             0106*   ; current pixel colour. These operations cannot currently be supported
041B00             0107*   ; by the graphics system the Agon VDP uses, so these codes are not
041B00             0108*   ; supported. Support for these codes may be added in a future version
041B00             0109*   ; of the VDP firmware.
041B00             0110*   
041B00             0111*   ; 16 colour palette constants
041B00             0112*   c_black: equ 0
041B00             0113*   c_red_dk: equ 1
041B00             0114*   c_green_dk: equ 2
041B00             0115*   c_yellow_dk: equ 3
041B00             0116*   c_blue_dk: equ 4
041B00             0117*   c_magenta_dk: equ 5
041B00             0118*   c_cyan_dk: equ 6
041B00             0119*   c_grey: equ 7
041B00             0120*   c_grey_dk: equ 8
041B00             0121*   c_red: equ 9
041B00             0122*   c_green: equ 10
041B00             0123*   c_yellow: equ 11
041B00             0124*   c_blue: equ 12
041B00             0125*   c_magenta: equ 13
041B00             0126*   c_cyan: equ 14
041B00             0127*   c_white: equ 15
041B00             0128*   
041B00             0129*   ; VDU 25, mode, x; y;: PLOT command
041B00             0130*   ; inputs: a=mode, bc=x0, de=y0
041B00             0131*   vdu_plot:
041B00 32 1A 1B 04 0132*       ld (@mode),a
041B04 ED 43 1B 1B 0133*       ld (@x0),bc
       04          
041B09 ED 53 1D 1B 0134*       ld (@y0),de
       04          
041B0E 21 19 1B 04 0135*   	ld hl,@cmd
041B12 01 06 00 00 0136*   	ld bc,@end-@cmd
041B16 5B DF       0137*   	rst.lil $18
041B18 C9          0138*   	ret
041B19 19          0139*   @cmd:   db 25
041B1A 00          0140*   @mode:  db 0
041B1B 00 00       0141*   @x0: 	dw 0
041B1D 00 00       0142*   @y0: 	dw 0
041B1F 00          0143*   @end:   db 0 ; extra byte to soak up deu
041B20             0144*   
041B20             0145*   ; https://agonconsole8.github.io/agon-docs/VDP---PLOT-Commands.html
041B20             0146*   ; &E8-&EF 	232-239 	Bitmap plot Â§
041B20             0147*   ; VDU 25, mode, x; y;: PLOT command
041B20             0148*   ; inputs: bc=x0, de=y0
041B20             0149*   ; prerequisites: vdu_buff_select
041B20             0150*   vdu_plot_bmp:
041B20 ED 43 37 1B 0151*       ld (@x0),bc
       04          
041B25 ED 53 39 1B 0152*       ld (@y0),de
       04          
041B2A 21 35 1B 04 0153*   	ld hl,@cmd
041B2E 01 06 00 00 0154*   	ld bc,@end-@cmd
041B32 5B DF       0155*   	rst.lil $18
041B34 C9          0156*   	ret
041B35 19          0157*   @cmd:   db 25
041B36 ED          0158*   @mode:  db plot_bmp+dr_abs_fg ; 0xED
041B37 00 00       0159*   @x0: 	dw 0x0000
041B39 00 00       0160*   @y0: 	dw 0x0000
041B3B 00          0161*   @end:   db 0x00 ; padding
041B3C             0162*   
041B3C             0163*   ; https://agonconsole8.github.io/agon-docs/VDP---PLOT-Commands.html
041B3C             0164*   ; &E8-&EF 	232-239 	Bitmap plot Â§
041B3C             0165*   ; VDU 25, mode, x; y;: PLOT command
041B3C             0166*   ; inputs: bc=x0, de=y0
041B3C             0167*   ; USING 16.8 FIXED POINT COORDINATES
041B3C             0168*   ; inputs: ub.c is x coordinate, ud.e is y coordinate
041B3C             0169*   ;   the fractional portiion of the inputs are truncated
041B3C             0170*   ;   leaving only the 16-bit integer portion
041B3C             0171*   ; prerequisites: vdu_buff_select
041B3C             0172*   vdu_plot_bmp168:
041B3C             0173*   ; populate in the reverse of normal to keep the
041B3C             0174*   ; inputs from stomping on each other
041B3C ED 53 5A 1B 0175*       ld (@y0-1),de
       04          
041B41 ED 43 58 1B 0176*       ld (@x0-1),bc
       04          
041B46 3E ED       0177*       ld a,plot_bmp+dr_abs_fg ; 0xED
041B48 32 58 1B 04 0178*       ld (@mode),a ; restore the mode byte that got stomped on by bcu
041B4C 21 57 1B 04 0179*   	ld hl,@cmd
041B50 01 06 00 00 0180*   	ld bc,@end-@cmd
041B54 5B DF       0181*   	rst.lil $18
041B56 C9          0182*   	ret
041B57 19          0183*   @cmd:   db 25
041B58 ED          0184*   @mode:  db plot_bmp+dr_abs_fg ; 0xED
041B59 00 00       0185*   @x0: 	dw 0x0000
041B5B 00 00       0186*   @y0: 	dw 0x0000
041B5D             0187*   @end:  ; no padding required b/c we shifted de right
041B5D             0188*   
041B5D             0189*   ; draw a filled rectangle
041B5D             0190*   vdu_plot_rf:
041B5D ED 43 84 1B 0191*       ld (@x0),bc
       04          
041B62 ED 53 86 1B 0192*       ld (@y0),de
       04          
041B67 DD 22 8A 1B 0193*       ld (@x1),ix
       04          
041B6C FD 22 8C 1B 0194*       ld (@y1),iy
       04          
041B71 3E 19       0195*       ld a,25 ; we have to reload the 2nd plot command
041B73 32 88 1B 04 0196*       ld (@cmd1),a ; because the 24-bit y0 load stomped on it
041B77 21 82 1B 04 0197*   	ld hl,@cmd0
041B7B 01 0C 00 00 0198*   	ld bc,@end-@cmd0
041B7F 5B DF       0199*   	rst.lil $18
041B81 C9          0200*       ret
041B82 19          0201*   @cmd0:  db 25 ; plot
041B83 04          0202*   @arg0:  db plot_sl_both+mv_abs
041B84 00 00       0203*   @x0:    dw 0x0000
041B86 00 00       0204*   @y0:    dw 0x0000
041B88 19          0205*   @cmd1:  db 25 ; plot
041B89 65          0206*   @arg1:  db plot_rf+dr_abs_fg
041B8A 00 00       0207*   @x1:    dw 0x0000
041B8C 00 00       0208*   @y1:    dw 0x0000
041B8E 00          0209*   @end:   db 0x00 ; padding
041B8F             0210*   
041B8F             0211*   ; draw a filled circle
041B8F             0212*   vdu_plot_cf:
041B8F ED 43 B6 1B 0213*       ld (@x0),bc
       04          
041B94 ED 53 B8 1B 0214*       ld (@y0),de
       04          
041B99 DD 22 BC 1B 0215*       ld (@x1),ix
       04          
041B9E FD 22 BE 1B 0216*       ld (@y1),iy
       04          
041BA3 3E 19       0217*       ld a,25 ; we have to reload the 2nd plot command
041BA5 32 BA 1B 04 0218*       ld (@cmd1),a ; because the 24-bit y0 load stomped on it
041BA9 21 B4 1B 04 0219*   	ld hl,@cmd0
041BAD 01 0C 00 00 0220*   	ld bc,@end-@cmd0
041BB1 5B DF       0221*   	rst.lil $18
041BB3 C9          0222*       ret
041BB4 19          0223*   @cmd0:  db 25 ; plot
041BB5 04          0224*   @arg0:  db plot_sl_both+mv_abs
041BB6 00 00       0225*   @x0:    dw 0x0000
041BB8 00 00       0226*   @y0:    dw 0x0000
041BBA 19          0227*   @cmd1:  db 25 ; plot
041BBB 9D          0228*   @arg1:  db plot_cf+dr_abs_fg
041BBC 00 00       0229*   @x1:    dw 0x0000
041BBE 00 00       0230*   @y1:    dw 0x0000
041BC0 00          0231*   @end:   db 0x00 ; padding
041BC1             0042        include "vdu_sprites.inc"
041BC1 FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF    
041C00             0002*   ; ; https://github.com/AgonConsole8/agon-docs/blob/main/VDP---Bitmaps-API.md
041C00             0003*   ; the VDP can support up to 256 sprites. They must be defined
041C00             0004*   ; contiguously, and so the first sprite is sprite 0.
041C00             0005*   ; (In contrast, bitmaps can have any ID from 0 to 65534.)
041C00             0006*   ; Once a selection of sprites have been defined, you can activate
041C00             0007*   ; them using the VDU 23, 27, 7, n command, where n is the number
041C00             0008*   ; of sprites to activate. This will activate the first n sprites,
041C00             0009*   ; starting with sprite 0. All sprites from 0 to n-1 must be defined.
041C00             0010*   
041C00             0011*   ; A single sprite can have multiple "frames", referring to
041C00             0012*   ; different bitmaps.
041C00             0013*   ; (These bitmaps do not need to be the same size.)
041C00             0014*   ; This allows a sprite to include an animation sequence,
041C00             0015*   ; which can be stepped through one frame at a time, or picked
041C00             0016*   ; in any order.
041C00             0017*   
041C00             0018*   ; Any format of bitmap can be used as a sprite frame. It should
041C00             0019*   ; be noted however that "native" format bitmaps are not
041C00             0020*   ; recommended for use as sprite frames, as they cannot get
041C00             0021*   ; erased from the screen. (As noted above, the "native" bitmap
041C00             0022*   ; format is not really intended for general use.) This is part
041C00             0023*   ; of why from Agon Console8 VDP 2.6.0 bitmaps captured from the
041C00             0024*   ; screen are now stored in RGBA2222 format.
041C00             0025*   
041C00             0026*   ; An "active" sprite can be hidden, so it will stop being drawn,
041C00             0027*   ; and then later shown again.
041C00             0028*   
041C00             0029*   ; Moving sprites around the screen is done by changing the
041C00             0030*   ; position of the sprite. This can be done either by setting
041C00             0031*   ; the absolute position of the sprite, or by moving the sprite
041C00             0032*   ; by a given number of pixels. (Sprites are positioned using
041C00             0033*   ; pixel coordinates, and not by the logical OS coordinate system.)
041C00             0034*   ; In the current sprite system, sprites will not update their
041C00             0035*   ; position on-screen until either another drawing operation is
041C00             0036*   ; performed or an explicit VDU 23, 27, 15 command is performed.
041C00             0037*   
041C00             0038*   ; VDU 23, 27, 4, n: Select sprite n
041C00             0039*   ; inputs: a is the 8-bit sprite id
041C00             0040*   vdu_sprite_select:
041C00 32 12 1C 04 0041*       ld (@sprite),a
041C04 21 0F 1C 04 0042*       ld hl,@cmd
041C08 01 04 00 00 0043*       ld bc,@end-@cmd
041C0C 5B DF       0044*       rst.lil $18
041C0E C9          0045*       ret
041C0F 17 1B 04    0046*   @cmd:    db 23,27,4
041C12 00          0047*   @sprite: db 0x00
041C13             0048*   @end:
041C13             0049*   
041C13             0050*   ; VDU 23, 27, 5: Clear frames in current sprite
041C13             0051*   ; inputs: none
041C13             0052*   ; prerequisites: vdu_sprite_select
041C13             0053*   vdu_sprite_clear_frames:
041C13 21 1E 1C 04 0054*       ld hl,@cmd
041C17 01 03 00 00 0055*       ld bc,@end-@cmd
041C1B 5B DF       0056*       rst.lil $18
041C1D C9          0057*       ret
041C1E 17 1B 05    0058*   @cmd: db 23,27,5
041C21             0059*   @end:
041C21             0060*   
041C21             0061*   ; VDU 23, 27, 6, n: Add bitmap n as a frame to current sprite (where bitmap's buffer ID is 64000+n)
041C21             0062*   ; inputs: a is the 8-bit bitmap number
041C21             0063*   ; prerequisites: vdu_sprite_select
041C21             0064*   vdu_sprite_add_bmp:
041C21 32 33 1C 04 0065*       ld (@bmp),a
041C25 21 30 1C 04 0066*       ld hl,@cmd
041C29 01 04 00 00 0067*       ld bc,@end-@cmd
041C2D 5B DF       0068*       rst.lil $18
041C2F C9          0069*       ret
041C30 17 1B 06    0070*   @cmd: db 23,27,6
041C33 00          0071*   @bmp: db 0x00
041C34             0072*   @end:
041C34             0073*   
041C34             0074*   ; VDU 23, 27, 7, n: Activate n sprites
041C34             0075*   ; inputs: a is the number of sprites to activate
041C34             0076*   ; prerequisites: each sprite activated must have at least one frame attached to it
041C34             0077*   vdu_sprite_activate:
041C34 32 46 1C 04 0078*       ld (@num),a
041C38 21 43 1C 04 0079*       ld hl,@cmd
041C3C 01 04 00 00 0080*       ld bc,@end-@cmd
041C40 5B DF       0081*       rst.lil $18
041C42 C9          0082*       ret
041C43 17 1B 07    0083*   @cmd: db 23,27,7
041C46 00          0084*   @num: db 0x00
041C47             0085*   @end:
041C47             0086*   
041C47             0087*   ; VDU 23, 27, 8: Select next frame of current sprite
041C47             0088*   ; inputs: none
041C47             0089*   ; prerequisites: vdu_sprite_select
041C47             0090*   vdu_sprite_next_frame:
041C47 21 52 1C 04 0091*       ld hl,@cmd
041C4B 01 03 00 00 0092*       ld bc,@end-@cmd
041C4F 5B DF       0093*       rst.lil $18
041C51 C9          0094*       ret
041C52 17 1B 08    0095*   @cmd: db 23,27,8
041C55             0096*   @end:
041C55             0097*   
041C55             0098*   ; VDU 23, 27, 9: Select previous frame of current sprite
041C55             0099*   ; inputs: none
041C55             0100*   ; prerequisites: vdu_sprite_select
041C55             0101*   vdu_sprite_prev_frame:
041C55 21 60 1C 04 0102*       ld hl,@cmd
041C59 01 03 00 00 0103*       ld bc,@end-@cmd
041C5D 5B DF       0104*       rst.lil $18
041C5F C9          0105*       ret
041C60 17 1B 09    0106*   @cmd: db 23,27,9
041C63             0107*   @end:
041C63             0108*   
041C63             0109*   ; VDU 23, 27, 10, n: Select the nth frame of current sprite
041C63             0110*   ; inputs: a is frame number to select
041C63             0111*   ; prerequisites: vdu_sprite_select
041C63             0112*   vdu_sprite_select_frame:
041C63 32 75 1C 04 0113*       ld (@frame),a
041C67 21 72 1C 04 0114*       ld hl,@cmd
041C6B 01 04 00 00 0115*       ld bc,@end-@cmd
041C6F 5B DF       0116*       rst.lil $18
041C71 C9          0117*       ret
041C72 17 1B 0A    0118*   @cmd:    db 23,27,10
041C75 00          0119*   @frame:  db 0x00
041C76             0120*   @end:
041C76             0121*   
041C76             0122*   ; VDU 23, 27, 11: Show current sprite
041C76             0123*   ; inputs: none
041C76             0124*   ; prerequisites: vdu_sprite_select
041C76             0125*   vdu_sprite_show:
041C76 21 81 1C 04 0126*       ld hl,@cmd
041C7A 01 03 00 00 0127*       ld bc,@end-@cmd
041C7E 5B DF       0128*       rst.lil $18
041C80 C9          0129*       ret
041C81 17 1B 0B    0130*   @cmd: db 23,27,11
041C84             0131*   @end:
041C84             0132*   
041C84             0133*   ; VDU 23, 27, 12: Hide current sprite
041C84             0134*   ; inputs: none
041C84             0135*   ; prerequisites: vdu_sprite_select
041C84             0136*   vdu_sprite_hide:
041C84 21 8F 1C 04 0137*       ld hl,@cmd
041C88 01 03 00 00 0138*       ld bc,@end-@cmd
041C8C 5B DF       0139*       rst.lil $18
041C8E C9          0140*       ret
041C8F 17 1B 0C    0141*   @cmd: db 23,27,12
041C92             0142*   @end:
041C92             0143*   
041C92             0144*   ; VDU 23, 27, 13, x; y;: Move current sprite to pixel position x, y
041C92             0145*   ; inputs: bc is x coordinate, de is y coordinate
041C92             0146*   ; prerequisites: vdu_sprite_select
041C92             0147*   vdu_sprite_move_abs:
041C92 ED 43 AA 1C 0148*       ld (@xpos),bc
       04          
041C97 ED 53 AC 1C 0149*       ld (@ypos),de
       04          
041C9C 21 A7 1C 04 0150*       ld hl,@cmd
041CA0 01 07 00 00 0151*       ld bc,@end-@cmd
041CA4 5B DF       0152*       rst.lil $18
041CA6 C9          0153*       ret
041CA7 17 1B 0D    0154*   @cmd:  db 23,27,13
041CAA 00 00       0155*   @xpos: dw 0x0000
041CAC 00 00       0156*   @ypos: dw 0x0000
041CAE 00          0157*   @end:  db 0x00 ; padding
041CAF             0158*   
041CAF             0159*   ; VDU 23, 27, 14, x; y;: Move current sprite by x, y pixels
041CAF             0160*   ; inputs: bc is x coordinate, de is y coordinate
041CAF             0161*   ; prerequisites: vdu_sprite_select
041CAF             0162*   vdu_sprite_move_rel:
041CAF ED 43 C7 1C 0163*       ld (@dx),bc
       04          
041CB4 ED 53 C9 1C 0164*       ld (@dy),de
       04          
041CB9 21 C4 1C 04 0165*       ld hl,@cmd
041CBD 01 07 00 00 0166*       ld bc,@end-@cmd
041CC1 5B DF       0167*       rst.lil $18
041CC3 C9          0168*       ret
041CC4 17 1B 0E    0169*   @cmd: db 23,27,14
041CC7 00 00       0170*   @dx:  dw 0x0000
041CC9 00 00       0171*   @dy:  dw 0x0000
041CCB 00          0172*   @end: db 0x00 ; padding
041CCC             0173*   
041CCC             0174*   ; VDU 23, 27, 13, x; y;: Move current sprite to pixel position x, y
041CCC             0175*   ; USING 16.8 FIXED POINT COORDINATES
041CCC             0176*   ; inputs: ub.c is x coordinate, ud.e is y coordinate
041CCC             0177*   ;   the fractional portiion of the inputs are truncated
041CCC             0178*   ;   leaving only the 16-bit integer portion
041CCC             0179*   ; prerequisites: vdu_sprite_select
041CCC             0180*   vdu_sprite_move_abs168:
041CCC             0181*   ; offset inputs by the gfx origin
041CCC             0182*   ; y coordinate
041CCC 21 00 40 00 0183*       ld hl,origin_top*256
041CD0 19          0184*       add hl,de
041CD1 22 F3 1C 04 0185*       ld (@ypos-1),hl
041CD5             0186*   ; x coordinate
041CD5 21 00 80 00 0187*       ld hl,origin_left*256
041CD9 09          0188*       add hl,bc
041CDA 22 F1 1C 04 0189*       ld (@xpos-1),hl
041CDE             0190*   ; prepare vdu command
041CDE 3E 0D       0191*       ld a,13       ; restore the final byte of the command
041CE0 32 F1 1C 04 0192*       ld (@cmd+2),a ; string that got stomped on by bcu
041CE4 21 EF 1C 04 0193*       ld hl,@cmd
041CE8 01 07 00 00 0194*       ld bc,@end-@cmd
041CEC 5B DF       0195*       rst.lil $18
041CEE C9          0196*       ret
041CEF 17 1B 0D    0197*   @cmd:  db 23,27,13
041CF2 00 00       0198*   @xpos: dw 0x0000
041CF4 00 00       0199*   @ypos: dw 0x0000
041CF6             0200*   @end:  ; no padding required b/c we shifted de right
041CF6             0201*   
041CF6             0202*   ; VDU 23, 27, 14, x; y;: Move current sprite by x, y pixels
041CF6             0203*   ; USING 16.8 FIXED POINT COORDINATES
041CF6             0204*   ; inputs: ub.c is dx, ud.e is dy
041CF6             0205*   ;   the fractional portiion of the inputs are truncated
041CF6             0206*   ;   leaving only the 16-bit integer portion
041CF6             0207*   ; prerequisites: vdu_sprite_select
041CF6             0208*   vdu_sprite_move_rel168:
041CF6             0209*   ; populate in the reverse of normal to keep the
041CF6             0210*   ; inputs from stomping on each other
041CF6 ED 53 15 1D 0211*       ld (@dy-1),de
       04          
041CFB ED 43 13 1D 0212*       ld (@dx-1),bc
       04          
041D00 3E 0E       0213*       ld a,14       ; restore the final byte of the command
041D02 32 13 1D 04 0214*       ld (@cmd+2),a ; string that got stomped on by bcu
041D06 21 11 1D 04 0215*       ld hl,@cmd
041D0A 01 07 00 00 0216*       ld bc,@end-@cmd
041D0E 5B DF       0217*       rst.lil $18
041D10 C9          0218*       ret
041D11 17 1B 0E    0219*   @cmd:  db 23,27,14
041D14 00 00       0220*   @dx: dw 0x0000
041D16 00 00       0221*   @dy: dw 0x0000
041D18             0222*   @end:  ; no padding required b/c we shifted de right
041D18             0223*   
041D18             0224*   ; VDU 23, 27, 15: Update the sprites in the GPU
041D18             0225*   ; inputs: none
041D18             0226*   vdu_sprite_update:
041D18 21 23 1D 04 0227*       ld hl,@cmd
041D1C 01 03 00 00 0228*       ld bc,@end-@cmd
041D20 5B DF       0229*       rst.lil $18
041D22 C9          0230*       ret
041D23 17 1B 0F    0231*   @cmd: db 23,27,15
041D26             0232*   @end:
041D26             0233*   
041D26             0234*   ; VDU 23, 27, 16: Reset bitmaps and sprites and clear all data
041D26             0235*   ; inputs: none
041D26             0236*   vdu_sprite_bmp_reset:
041D26 21 31 1D 04 0237*       ld hl,@cmd
041D2A 01 03 00 00 0238*       ld bc,@end-@cmd
041D2E 5B DF       0239*       rst.lil $18
041D30 C9          0240*       ret
041D31 17 1B 10    0241*   @cmd: db 23,27,16
041D34             0242*   @end:
041D34             0243*   
041D34             0244*   ; VDU 23, 27, 17: Reset sprites (only) and clear all data
041D34             0245*   ; inputs: none
041D34             0246*   vdu_sprite_reset:
041D34 21 3F 1D 04 0247*       ld hl,@cmd
041D38 01 03 00 00 0248*       ld bc,@end-@cmd
041D3C 5B DF       0249*       rst.lil $18
041D3E C9          0250*       ret
041D3F 17 1B 11    0251*   @cmd: db 23,27,17
041D42             0252*   @end:
041D42             0253*   
041D42             0254*   ; VDU 23, 27, 18, n: Set the current sprite GCOL paint mode to n **
041D42             0255*   ; inputs: a is the GCOL paint mode
041D42             0256*   ; prerequisites: vdu_sprite_select
041D42             0257*   vdu_sprite_set_gcol:
041D42 32 54 1D 04 0258*       ld (@mode),a
041D46 21 51 1D 04 0259*       ld hl,@cmd
041D4A 01 04 00 00 0260*       ld bc,@end-@cmd
041D4E 5B DF       0261*       rst.lil $18
041D50 C9          0262*       ret
041D51 17 1B 12    0263*   @cmd:  db 23,27,18
041D54 00          0264*   @mode: db 0x00
041D55             0265*   @end:
041D55             0266*   
041D55             0267*   ; VDU 23, 27, &26, n;: Add bitmap n as a frame to current sprite using a 16-bit buffer ID
041D55             0268*   ; inputs: hl=bufferId
041D55             0269*   ; prerequisites: vdu_sprite_select
041D55             0270*   vdu_sprite_add_buff:
041D55 22 67 1D 04 0271*       ld (@bufferId),hl
041D59 21 64 1D 04 0272*       ld hl,@cmd
041D5D 01 05 00 00 0273*       ld bc,@end-@cmd
041D61 5B DF       0274*       rst.lil $18
041D63 C9          0275*       ret
041D64 17 1B 26    0276*   @cmd:      db 23,27,0x26
041D67 00 00       0277*   @bufferId: dw 0x0000
041D69 00          0278*   @end:      db 0x00 ; padding
041D6A             0043    
041D6A             0044    ; APPLICATION INCLUDES
041D6A             0045        include "ascii.inc"
041D6A             0001*   loading_ui:
041D6A 57 45 4C 43 0002*       db "WELCOME TO ...",13,10
       4F 4D 45 20 
       54 4F 20 2E 
       2E 2E 0D 0A 
041D7A 0D 0A       0003*       db 13,10
041D7C 20 20 20 20 0004*       db 32,32,32,32,32,32,32,32,95,95,32,32,32,32,95,95,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,95,95,13,10
       20 20 20 20 
       5F 5F 20 20 
       20 20 5F 5F 
       20 20 20 20 
       20 20 20 20 
       20 20 20 20 
       20 20 20 20 
       20 5F 5F 0D 
       0A          
041DA1 5F 5F 5F 5F 0005*       db 95,95,95,95,95,32,95,47,32,32,124,95,95,47,32,32,124,95,95,95,95,95,95,32,32,32,32,95,95,95,95,32,124,32,32,124,32,95,95,13,10
       5F 20 5F 2F 
       20 20 7C 5F 
       5F 2F 20 20 
       7C 5F 5F 5F 
       5F 5F 5F 20 
       20 20 20 5F 
       5F 5F 5F 20 
       7C 20 20 7C 
       20 5F 5F 0D 
       0A          
041DCA 5C 5F 5F 20 0006*       db 92,95,95,32,32,92,32,32,32,95,95,92,32,32,32,95,95,92,95,95,32,32,92,32,95,47,32,95,95,95,92,124,32,32,124,47,32,47,13,10
       20 5C 20 20 
       20 5F 5F 5C 
       20 20 20 5F 
       5F 5C 5F 5F 
       20 20 5C 20 
       5F 2F 20 5F 
       5F 5F 5C 7C 
       20 20 7C 2F 
       20 2F 0D 0A 
041DF2 20 2F 20 5F 0007*       db 32,47,32,95,95,32,92,124,32,32,124,32,32,124,32,32,124,32,32,47,32,95,95,32,92,32,32,92,95,95,95,124,32,32,32,32,60,13,10
       5F 20 5C 7C 
       20 20 7C 20 
       20 7C 20 20 
       7C 20 20 2F 
       20 5F 5F 20 
       5C 20 20 5C 
       5F 5F 5F 7C 
       20 20 20 20 
       3C 0D 0A    
041E19 28 5F 5F 5F 0008*       db 40,95,95,95,95,32,32,47,95,95,124,32,32,124,95,95,124,32,40,95,95,95,95,32,32,47,92,95,95,95,32,32,62,95,95,124,95,32,92,13,10
       5F 20 20 2F 
       5F 5F 7C 20 
       20 7C 5F 5F 
       7C 20 28 5F 
       5F 5F 5F 20 
       20 2F 5C 5F 
       5F 5F 20 20 
       3E 5F 5F 7C 
       5F 20 5C 0D 
       0A          
041E42 20 20 20 20 0009*       db 32,32,32,32,32,92,47,32,95,95,95,95,95,32,32,32,32,95,95,32,32,46,95,95,47,32,32,32,32,32,92,47,32,32,32,32,32,92,47,13,10
       20 5C 2F 20 
       5F 5F 5F 5F 
       5F 20 20 20 
       20 5F 5F 20 
       20 2E 5F 5F 
       2F 20 20 20 
       20 20 5C 2F 
       20 20 20 20 
       20 5C 2F 0D 
       0A          
041E6B 20 20 5F 5F 0010*       db 32,32,95,95,95,95,95,47,32,95,95,95,95,92,32,95,47,32,32,124,95,124,32,32,124,95,95,32,32,32,95,95,95,95,13,10
       5F 5F 5F 2F 
       20 5F 5F 5F 
       5F 5C 20 5F 
       2F 20 20 7C 
       5F 7C 20 20 
       7C 5F 5F 20 
       20 20 5F 5F 
       5F 5F 0D 0A 
041E8F 20 2F 20 20 0011*       db 32,47,32,32,95,32,92,32,32,32,95,95,92,32,32,92,32,32,32,95,95,92,32,32,124,32,32,92,95,47,32,95,95,32,92,13,10
       5F 20 5C 20 
       20 20 5F 5F 
       5C 20 20 5C 
       20 20 20 5F 
       5F 5C 20 20 
       7C 20 20 5C 
       5F 2F 20 5F 
       5F 20 5C 0D 
       0A          
041EB4 28 20 20 3C 0012*       db 40,32,32,60,95,62,32,41,32,32,124,32,32,32,32,32,124,32,32,124,32,124,32,32,32,89,32,32,92,32,32,95,95,95,47,13,10
       5F 3E 20 29 
       20 20 7C 20 
       20 20 20 20 
       7C 20 20 7C 
       20 7C 20 20 
       20 59 20 20 
       5C 20 20 5F 
       5F 5F 2F 0D 
       0A          
041ED9 20 5C 5F 5F 0013*       db 32,92,95,95,95,95,47,124,95,95,124,32,32,32,32,32,124,95,95,124,32,124,95,95,95,124,32,32,47,92,95,95,95,32,32,62,13,10
       5F 5F 2F 7C 
       5F 5F 7C 20 
       20 20 20 20 
       7C 5F 5F 7C 
       20 7C 5F 5F 
       5F 7C 20 20 
       2F 5C 5F 5F 
       5F 20 20 3E 
       0D 0A       
041EFF 5F 5F 5F 5F 0014*       db 95,95,95,95,95,95,95,95,95,95,32,95,95,95,95,32,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,46,95,95,95,95,32,32,32,32,32,95,95,95,95,95,95,95,95,95,95,95,13,10
       5F 5F 5F 5F 
       5F 5F 20 5F 
       5F 5F 5F 20 
       5F 5F 5F 5F 
       5F 5F 5F 5F 
       5F 5F 5F 5F 
       5F 5F 5F 5F 
       5F 5F 5F 5F 
       5F 5F 5F 2E 
       5F 5F 5F 5F 
       20 20 20 20 
       20 5F 5F 5F 
       5F 5F 5F 5F 
       5F 5F 5F 5F 
       0D 0A       
041F3D 5C 5F 5F 5F 0015*       db 92,95,95,95,95,95,95,32,32,32,92,32,32,32,32,124,32,32,32,92,95,95,95,95,95,95,32,32,32,92,95,95,95,95,95,95,32,32,32,92,32,32,32,32,124,32,32,32,32,92,95,32,32,32,95,95,95,95,95,47,13,10
       5F 5F 5F 20 
       20 20 5C 20 
       20 20 20 7C 
       20 20 20 5C 
       5F 5F 5F 5F 
       5F 5F 20 20 
       20 5C 5F 5F 
       5F 5F 5F 5F 
       20 20 20 5C 
       20 20 20 20 
       7C 20 20 20 
       20 5C 5F 20 
       20 20 5F 5F 
       5F 5F 5F 2F 
       0D 0A       
041F7B 20 7C 20 20 0016*       db 32,124,32,32,32,32,32,95,95,95,47,32,32,32,32,124,32,32,32,47,124,32,32,32,32,32,32,32,95,47,124,32,32,32,32,32,95,95,95,47,32,32,32,32,124,32,32,32,32,32,124,32,32,32,32,95,95,41,95,13,10
       20 20 20 5F 
       5F 5F 2F 20 
       20 20 20 7C 
       20 20 20 2F 
       7C 20 20 20 
       20 20 20 20 
       5F 2F 7C 20 
       20 20 20 20 
       5F 5F 5F 2F 
       20 20 20 20 
       7C 20 20 20 
       20 20 7C 20 
       20 20 20 5F 
       5F 29 5F 0D 
       0A          
041FB8 20 7C 20 20 0017*       db 32,124,32,32,32,32,124,32,32,32,124,32,32,32,32,124,32,32,47,32,124,32,32,32,32,124,32,32,32,92,124,32,32,32,32,124,32,32,32,124,32,32,32,32,124,95,95,95,32,32,124,32,32,32,32,32,32,32,32,92,13,10
       20 20 7C 20 
       20 20 7C 20 
       20 20 20 7C 
       20 20 2F 20 
       7C 20 20 20 
       20 7C 20 20 
       20 5C 7C 20 
       20 20 20 7C 
       20 20 20 7C 
       20 20 20 20 
       7C 5F 5F 5F 
       20 20 7C 20 
       20 20 20 20 
       20 20 20 5C 
       0D 0A       
041FF6 20 7C 5F 5F 0018*       db 32,124,95,95,95,95,124,32,32,32,124,95,95,95,95,95,95,47,32,32,124,95,95,95,95,124,95,32,32,47,124,95,95,95,95,124,32,32,32,124,95,95,95,95,95,95,95,32,92,47,95,95,95,95,95,95,95,32,32,47,13,10
       5F 5F 7C 20 
       20 20 7C 5F 
       5F 5F 5F 5F 
       5F 2F 20 20 
       7C 5F 5F 5F 
       5F 7C 5F 20 
       20 2F 7C 5F 
       5F 5F 5F 7C 
       20 20 20 7C 
       5F 5F 5F 5F 
       5F 5F 5F 20 
       5C 2F 5F 5F 
       5F 5F 5F 5F 
       5F 20 20 2F 
       0D 0A       
042034 20 5F 5F 5F 0019*       db 32,95,95,95,95,95,95,95,32,32,32,95,95,95,95,32,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,46,95,95,95,95,32,32,32,92,47,95,95,95,95,95,95,95,95,95,95,95,32,95,95,95,95,95,95,95,95,95,13,10
       5F 5F 5F 5F 
       20 20 20 5F 
       5F 5F 5F 20 
       5F 5F 5F 5F 
       5F 5F 5F 5F 
       5F 5F 5F 5F 
       5F 5F 5F 5F 
       5F 5F 5F 5F 
       5F 5F 5F 2E 
       5F 5F 5F 5F 
       20 20 20 5C 
       2F 5F 5F 5F 
       5F 5F 5F 5F 
       5F 5F 5F 5F 
       20 5F 5F 5F 
       5F 5F 5F 5F 
       5F 5F 0D 0A 
04207C 20 5C 20 20 0020*       db 32,92,32,32,32,32,32,32,92,32,124,32,32,32,32,124,32,32,32,92,95,95,95,95,95,95,32,32,32,92,95,95,95,95,95,95,32,32,32,92,32,32,32,32,124,32,32,32,32,92,95,32,32,32,95,95,95,95,95,47,47,32,32,32,95,95,95,95,95,47,13,10
       20 20 20 20 
       5C 20 7C 20 
       20 20 20 7C 
       20 20 20 5C 
       5F 5F 5F 5F 
       5F 5F 20 20 
       20 5C 5F 5F 
       5F 5F 5F 5F 
       20 20 20 5C 
       20 20 20 20 
       7C 20 20 20 
       20 5C 5F 20 
       20 20 5F 5F 
       5F 5F 5F 2F 
       2F 20 20 20 
       5F 5F 5F 5F 
       5F 2F 0D 0A 
0420C4 20 2F 20 20 0021*       db 32,47,32,32,32,124,32,32,32,92,124,32,32,32,32,124,32,32,32,47,124,32,32,32,32,32,32,32,95,47,124,32,32,32,32,32,95,95,95,47,32,32,32,32,124,32,32,32,32,32,124,32,32,32,32,95,95,41,95,32,92,95,95,95,95,95,32,32,92,13,10
       20 7C 20 20 
       20 5C 7C 20 
       20 20 20 7C 
       20 20 20 2F 
       7C 20 20 20 
       20 20 20 20 
       5F 2F 7C 20 
       20 20 20 20 
       5F 5F 5F 2F 
       20 20 20 20 
       7C 20 20 20 
       20 20 7C 20 
       20 20 20 5F 
       5F 29 5F 20 
       5C 5F 5F 5F 
       5F 5F 20 20 
       5C 0D 0A    
04210B 2F 20 20 20 0022*       db 47,32,32,32,32,124,32,32,32,32,92,32,32,32,32,124,32,32,47,32,124,32,32,32,32,124,32,32,32,92,124,32,32,32,32,124,32,32,32,124,32,32,32,32,124,95,95,95,32,32,124,32,32,32,32,32,32,32,32,92,47,32,32,32,32,32,32,32,32,92,13,10
       20 7C 20 20 
       20 20 5C 20 
       20 20 20 7C 
       20 20 2F 20 
       7C 20 20 20 
       20 7C 20 20 
       20 5C 7C 20 
       20 20 20 7C 
       20 20 20 7C 
       20 20 20 20 
       7C 5F 5F 5F 
       20 20 7C 20 
       20 20 20 20 
       20 20 20 5C 
       2F 20 20 20 
       20 20 20 20 
       20 5C 0D 0A 
042153 5C 5F 5F 5F 0023*       db 92,95,95,95,95,124,95,95,32,32,47,95,95,95,95,95,95,47,32,32,124,95,95,95,95,124,95,32,32,47,124,95,95,95,95,124,32,32,32,124,95,95,95,95,95,95,95,32,92,47,95,95,95,95,95,95,95,32,32,47,95,95,95,95,95,95,95,32,32,47,13,10
       5F 7C 5F 5F 
       20 20 2F 5F 
       5F 5F 5F 5F 
       5F 2F 20 20 
       7C 5F 5F 5F 
       5F 7C 5F 20 
       20 2F 7C 5F 
       5F 5F 5F 7C 
       20 20 20 7C 
       5F 5F 5F 5F 
       5F 5F 5F 20 
       5C 2F 5F 5F 
       5F 5F 5F 5F 
       5F 20 20 2F 
       5F 5F 5F 5F 
       5F 5F 5F 20 
       20 2F 0D 0A 
04219B 20 20 20 20 0024*       db 32,32,32,32,32,32,32,32,92,47,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,92,47,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,92,47,32,32,32,32,32,32,32,32,92,47,32,32,32,32,32,32,32,32,92,47,13,10
       20 20 20 20 
       5C 2F 20 20 
       20 20 20 20 
       20 20 20 20 
       20 20 20 20 
       20 20 20 5C 
       2F 20 20 20 
       20 20 20 20 
       20 20 20 20 
       20 20 20 20 
       20 20 20 5C 
       2F 20 20 20 
       20 20 20 20 
       20 5C 2F 20 
       20 20 20 20 
       20 20 20 5C 
       2F 0D 0A    
0421E2 4C 4F 41 44 0025*       db "LOADING UI ...",0
       49 4E 47 20 
       55 49 20 2E 
       2E 2E 00    
0421F1             0046        include "collisions.inc"
0421F1 FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF    
042200             0002*   ; ====== COLLISION DETECTION ======
042200             0003*   ; --- constants ---
042200             0004*   ; sprite_collisions flags
042200             0005*   ; collides_with_player: equ %00000001
042200             0006*   ; collides_with_laser: equ %00000010
042200             0007*   sprite_alive: equ 6; set when sprite is alive
042200             0008*   sprite_just_died: equ 7; set when sprite just died
042200             0009*   collide_top: equ %00001000
042200             0010*   collide_bottom: equ %00000100
042200             0011*   collide_left: equ %00000010
042200             0012*   collide_right: equ %00000001
042200             0013*   
042200 00 00 00    0014*   collision_table_pointer: dl 0x000000 ; pointer to the sprite in the group being checked for collision
042203             0015*   
042203             0016*   collision_draw_hitboxes:
042203             0017*   ; draw hitbox for ix collider
042203 DD E5       0018*       push ix
042205 FD E5       0019*       push iy
042207 AF          0020*       xor a ; color mode 0
042208 0E 09       0021*       ld c,c_red
04220A CD 8D 16 04 0022*       call vdu_gcol
04220E 01 00 00 00 0023*       ld bc,0
042212 DD 4E 02    0024*       ld c,(ix+sprite_x+1)
042215 DD 46 03    0025*       ld b,(ix+sprite_x+2)
042218 11 00 00 00 0026*       ld de,0
04221C DD 5E 05    0027*       ld e,(ix+sprite_y+1)
04221F DD 56 06    0028*       ld d,(ix+sprite_y+2)
042222 21 00 00 00 0029*       ld hl,0 ; clear hlu and h
042226 DD 6E 1E    0030*       ld l,(ix+sprite_dim_x)
042229 09          0031*       add hl,bc ; hl = x1
04222A E5          0032*       push hl ; save x1
04222B 21 00 00 00 0033*       ld hl,0 ; clear hlu and h
04222F DD 6E 1F    0034*       ld l,(ix+sprite_dim_y)
042232 19          0035*       add hl,de ; hl = y1
042233 DD E1       0036*       pop ix ; ix = x1 (was hl)
042235 E5          0037*       push hl
042236 FD E1       0038*       pop iy ; iy = y1
042238 CD 5D 1B 04 0039*       call vdu_plot_rf
04223C FD E1       0040*       pop iy
04223E DD E1       0041*       pop ix
042240             0042*   
042240             0043*   ; draw hitbox for iy collider
042240 DD E5       0044*       push ix
042242 FD E5       0045*       push iy
042244 AF          0046*       xor a ; color mode 0
042245 0E 0A       0047*       ld c,c_green
042247 CD 8D 16 04 0048*       call vdu_gcol
04224B 01 00 00 00 0049*       ld bc,0
04224F FD 4E 02    0050*       ld c,(iy+sprite_x+1)
042252 FD 46 03    0051*       ld b,(iy+sprite_x+2)
042255 11 00 00 00 0052*       ld de,0
042259 FD 5E 05    0053*       ld e,(iy+sprite_y+1)
04225C FD 56 06    0054*       ld d,(iy+sprite_y+2)
04225F 21 00 00 00 0055*       ld hl,0 ; clear hlu and h
042263 FD 6E 1E    0056*       ld l,(iy+sprite_dim_x)
042266 09          0057*       add hl,bc ; hl = x1
042267 E5          0058*       push hl ; save x1
042268 21 00 00 00 0059*       ld hl,0 ; clear hlu and h
04226C FD 6E 1F    0060*       ld l,(iy+sprite_dim_y)
04226F 19          0061*       add hl,de ; hl = y1
042270 DD E1       0062*       pop ix ; ix = x1 (was hl)
042272 E5          0063*       push hl
042273 FD E1       0064*       pop iy ; iy = y1
042275 CD 5D 1B 04 0065*       call vdu_plot_rf
042279 FD E1       0066*       pop iy
04227B DD E1       0067*       pop ix
04227D C9          0068*       ret
04227E             0069*   ; end collision_draw_hitboxes
04227E             0070*   
04227E             0071*   ; check_collision:
04227E             0072*   ; Detects collision using bounding box method.
04227E             0073*   ; Inputs:
04227E             0074*   ;   IX -> Sprite/Tile table for Collider A
04227E             0075*   ;   IY -> Sprite/Tile table for Collider B
04227E             0076*   ; Outputs:
04227E             0077*   ;   a = 0, zero flag set, positive sign, carry reset -> Collision detected
04227E             0078*   ;   a = -1, zero flag reset, negative sign, carry set -> No collision detected
04227E             0079*   ; Destroys: HL, DE, AF
04227E             0080*   check_collision:
04227E             0081*   check_collision_box:
04227E             0082*   ; Test 1: (ay + ah) - by < 0
04227E 21 00 00 00 0083*       ld hl,0                     ; Clear hlu
042282 DD 6E 05    0084*       ld l,(ix+sprite_y+1)        ; Load ay integer part low byte
042285 DD 66 06    0085*       ld h,(ix+sprite_y+2)        ; Load ay integer part high byte
042288 11 00 00 00 0086*       ld de,0                     ; Clear deu and d
04228C DD 5E 1F    0087*       ld e,(ix+sprite_dim_y)      ; Load ah
04228F 19          0088*       add hl,de                   ; (ay + ah)
042290 FD 5E 05    0089*       ld e,(iy+sprite_y+1)        ; Load by integer part low byte
042293 FD 56 06    0090*       ld d,(iy+sprite_y+2)        ; Load by integer part high byte
042296 AF          0091*       xor a                       ; Clear carry
042297 ED 52       0092*       sbc hl,de                   ; (ay + ah) - by
042299 FA FC 22 04 0093*       jp m,@not_collision         ; No collision if negative
04229D             0094*   
04229D             0095*   ; Test 2: ay - (by + bh) < 0
04229D 21 00 00 00 0096*       ld hl,0                     ; Clear hlu
0422A1 FD 6E 05    0097*       ld l,(iy+sprite_y+1)        ; Load by integer part low byte
0422A4 FD 66 06    0098*       ld h,(iy+sprite_y+2)        ; Load by integer part high byte
0422A7 11 00 00 00 0099*       ld de,0                     ; Clear deu and d
0422AB FD 5E 1F    0100*       ld e,(iy+sprite_dim_y)      ; Load bh
0422AE 19          0101*       add hl,de                   ; (by + bh)
0422AF DD 5E 05    0102*       ld e,(ix+sprite_y+1)        ; Load ay integer part low byte
0422B2 DD 56 06    0103*       ld d,(ix+sprite_y+2)        ; Load ay integer part high byte
0422B5 AF          0104*       xor a                       ; Clear carry
0422B6 ED 52       0105*       sbc hl,de                   ; (by + bh) - ay
0422B8 FA FC 22 04 0106*       jp m,@not_collision         ; No collision if negative
0422BC             0107*   
0422BC             0108*   ; Test 3: (ax + aw) - bx < 0
0422BC 21 00 00 00 0109*       ld hl,0                     ; Clear hlu
0422C0 DD 6E 02    0110*       ld l,(ix+sprite_x+1)        ; Load ax integer part low byte
0422C3 DD 66 03    0111*       ld h,(ix+sprite_x+2)        ; Load ax integer part high byte
0422C6 11 00 00 00 0112*       ld de,0                     ; Clear deu and d
0422CA DD 5E 1E    0113*       ld e,(ix+sprite_dim_x)      ; Load aw
0422CD 19          0114*       add hl,de                   ; (ax + aw)
0422CE FD 5E 02    0115*       ld e,(iy+sprite_x+1)        ; Load bx integer part low byte
0422D1 FD 56 03    0116*       ld d,(iy+sprite_x+2)        ; Load bx integer part high byte
0422D4 AF          0117*       xor a                       ; Clear carry
0422D5 ED 52       0118*       sbc hl,de                   ; (ax + aw) - bx
0422D7 FA FC 22 04 0119*       jp m,@not_collision         ; No collision if negative
0422DB             0120*   
0422DB             0121*   ; Test 4: ax - (bx + bw) < 0
0422DB 21 00 00 00 0122*       ld hl,0                     ; Clear hlu
0422DF FD 6E 02    0123*       ld l,(iy+sprite_x+1)        ; Load bx integer part low byte
0422E2 FD 66 03    0124*       ld h,(iy+sprite_x+2)        ; Load bx integer part high byte
0422E5 11 00 00 00 0125*       ld de,0                     ; Clear deu and d
0422E9 FD 5E 1E    0126*       ld e,(iy+sprite_dim_x)      ; Load bw
0422EC 19          0127*       add hl,de                   ; (bx + bw)
0422ED DD 5E 02    0128*       ld e,(ix+sprite_x+1)        ; Load ax integer part low byte
0422F0 DD 56 03    0129*       ld d,(ix+sprite_x+2)        ; Load ax integer part high byte
0422F3 AF          0130*       xor a                       ; Clear carry
0422F4 ED 52       0131*       sbc hl,de                   ; (bx + bw) - ax
0422F6 FA FC 22 04 0132*       jp m,@not_collision         ; No collision if negative
0422FA             0133*   
0422FA             0134*   ; If all tests pass, collision is detected
0422FA             0135*   @is_collision:
0422FA AF          0136*       xor a                       ; Clear accumulator and flags (a = 0)
0422FB C9          0137*       ret                         ; Return with zero flag set
0422FC             0138*   
0422FC             0139*   ; No collision detected
0422FC             0140*   @not_collision:
0422FC 3D          0141*       dec a                       ; Set a to -1
0422FD C9          0142*       ret                         ; Return with carry set
0422FE             0143*   ; End check_collision_box
0422FE             0144*   
0422FE             0145*   
0422FE             0146*   ; this routine detects collisions between two collidable objects,
0422FE             0147*   ; which can include sprites, active tiles, or any screen coordinate
0422FE             0148*   ; which has been set up with a sprite table structure that includes dim_x
0422FE             0149*   ; representing the radius of the collidable object
0422FE             0150*   ; inputs: ix and iy point to the colliding objects' sprite/tile table records
0422FE             0151*   ; outputs: uh.l = distance - sum of radii
0422FE             0152*   ;          zero flag set if collision detected
0422FE             0153*   ;          dx168 and dy168 are also populated with the signed displacements
0422FE             0154*   ; destroys: everything except indexes
0422FE             0155*   ; check_collision:
0422FE             0156*   check_collision_cartesian:
0422FE             0157*   ; compute dx = x1-x0
0422FE DD 27 01    0158*       ld hl,(ix+sprite_x)
042301 FD 17 01    0159*       ld de,(iy+sprite_x)
042304 AF          0160*       xor a ; clear carry
042305 ED 52       0161*       sbc hl,de
042307 22 2E 08 04 0162*       ld (dx168),hl ; dx to scratch
04230B             0163*   ; compute dy = y1-y0
04230B DD 27 04    0164*       ld hl,(ix+sprite_y)
04230E FD 17 04    0165*       ld de,(iy+sprite_y)
042311 AF          0166*       xor a ; clear carry
042312 ED 52       0167*       sbc hl,de ; hl = dy
042314 22 34 08 04 0168*       ld (dy168),hl ; dy to scratch
042318             0169*   ; compute euclidean distance between centers
042318 CD 3A 08 04 0170*       call distance168 ; uh.l = distance
04231C             0171*   ; check for overlap by summing half the radii
04231C DD 7E 1E    0172*       ld a,(ix+sprite_dim_x)
04231F CB 3F       0173*       srl a ; divide by 2
042321 FD 5E 1E    0174*       ld e,(iy+sprite_dim_x)
042324 CB 3B       0175*       srl e ; divide by 2
042326 83          0176*       add a,e
042327 11 00 00 00 0177*       ld de,0 ; clear deu and e
04232B 57          0178*       ld d,a ; ud.e = sum of radii
04232C B7          0179*       or a ; clear carry
04232D ED 52       0180*       sbc hl,de ; uh.l = distance - sum of radii
04232F C8          0181*       ret z ; return collision
042330 F0          0182*       ret p ; return no collision
042331 AF          0183*       xor a ; return collision
042332 C9          0184*       ret
042333             0185*   ; end check_collision_cartesian
042333             0186*   
042333             0187*   ; check collisions of a sprite or tile against a sprite group
042333             0188*   ; inputs: iy = pointer to sprite or tile record being checked
042333             0189*   ;         ix = pointer to sprite group, b = number of records in sprite group
042333             0190*   check_sprite_group_collisions:
042333             0191*   @collision_loop:
042333 DD 22 00 22 0192*       ld (collision_table_pointer),ix ; update table pointer
       04          
042338 C5          0193*       push bc ; backup loop counter
042339             0194*   ; check sprite_collisions sprite_alive flag to see if sprite is active
042339 DD CB 1D 76 0195*       bit sprite_alive,(ix+sprite_collisions)
04233D CA 53 23 04 0196*       jp z,@next_record ; not alive so skip to next record
042341             0197*   ; sprite alive so check for collision
042341 CD 7E 22 04 0198*       call check_collision
042345 C2 53 23 04 0199*       jp nz,@next_record ; no collision
042349             0200*   ; set sprite_just_died flag for each entity and return to caller
042349 C1          0201*       pop bc ; dummy pop to balance stack
04234A DD CB 1D FE 0202*       set sprite_just_died,(ix+sprite_collisions)
04234E FD CB 1D FE 0203*       set sprite_just_died,(iy+sprite_collisions)
042352 C9          0204*       ret
042353             0205*   @next_record:
042353 C1          0206*       pop bc ; get back our loop counter
042354 ED 32 40    0207*       lea ix,ix+table_record_size
042357 10 DA       0208*       djnz @collision_loop ; loop until we've checked all the records
042359             0209*   ; return to caller
042359 AF          0210*       xor a
04235A 3C          0211*       inc a ; resets sign flag and a to non-zero indicating no collision
04235B C9          0212*       ret
04235C             0213*   ; end check_sprite_group_collisions
04235C             0214*   
04235C             0215*   check_enemy_collision_laser: ; check for collisions with laser
04235C DD 21 2A A0 0216*       ld ix,player_lasers_begin
       04          
042361 06 04       0217*       ld b,player_lasers_max
042363 CD 33 23 04 0218*       call check_sprite_group_collisions
042367 C9          0219*       ret
042368             0220*   ; end check_enemy_collision_laser
042368             0221*   
042368             0222*   check_enemy_collision_player: ; check for collisions with player
042368 DD 21 2A A1 0223*       ld ix,player_begin
       04          
04236D CD 7E 22 04 0224*       call check_collision
042371 C0          0225*       ret nz ; no collision so nothing to do
042372 DD CB 1D FE 0226*       set sprite_just_died,(ix+sprite_collisions)
042376 FD CB 1D FE 0227*       set sprite_just_died,(iy+sprite_collisions)
04237A AF          0228*       xor a ; signal collision detected
04237B C9          0229*       ret
04237C             0230*   ; end check_enemy_collision_player
04237C             0047        include "enemies.inc"
04237C 8A 23 04    0001*   enemies_state: dl enemies_alive
04237F             0002*   
04237F             0003*   do_enemies:
04237F 2A 7C 23 04 0004*       ld hl,(enemies_state)
042383             0005*       CALL_HL
042383 01 89 23 04 0001*M1     ld bc,$+6 ; Address of first instruction after the jump
042387 C5          0002*M1     push bc ; which constitutes the return address
042388 E9          0003*M1     jp (hl) ; Jump to the address in HL
042389 C9          0006*       ret
04238A             0007*   
04238A             0008*   enemies_alive:
04238A FD 21 6A A1 0009*       ld iy,enemy_sprites_begin
       04          
04238F 06 07       0010*       ld b,table_num_enemy_records
042391 CD 0E 82 04 0011*       call move_sprite_group
042395 C9          0012*       ret
042396             0013*   
042396             0014*   enemies_despawning:
042396 C9          0015*       ret
042397             0016*   
042397             0017*   enemies_dead:
042397 C9          0018*       ret
042398             0019*   
042398             0020*   enemies_respawning:
042398 C9          0021*       ret
042399             0048        include "enemy_fireball.inc"
042399 FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF    
042400             0002*   speed_fireball: equ 4*256 ; 6 pixels per frame 16.8 fixed
042400             0003*   fireballs_max: equ 4
042400             0004*   
042400             0005*   fireball_defaults:
042400 03          0006*       db enemy_projectile     ; type
042401 0A 01 00    0007*       dl BUF_FIREBALL_2_000   ; base_bufferId
042404 52 24 04    0008*       dl move_enemy_fireball  ; move_program
042407 40          0009*       db %01000000            ; collisions bit 6 signals sprite alive
042408 10          0010*       db 16                   ; dim_x
042409 10          0011*       db 16                   ; dim_y
04240A 20          0012*       db 32                   ; num_orientations
04240B 02          0013*       db 2                    ; num_animations
04240C 00          0014*       db 0                    ; animation
04240D 08          0015*       db 8                    ; animation_timer
04240E 00          0016*       db 0                    ; move_timer
04240F 00          0017*       db 0                    ; move_step
042410 00          0018*       db 0                    ; points
042411 FE          0019*       db -2                   ; shield_damage
042412 00          0020*       db 0                    ; frame
042413             0021*   
042413             0022*   enemy_spawn_fireball:
042413 21 00 24 04 0023*       ld hl,fireball_defaults
042417 DD 21 2A A2 0024*       ld ix,fireballs_base
       04          
04241C 06 04       0025*       ld b,fireballs_max
04241E CD F0 8E 04 0026*       call spawn_sprite_from_tile
042422 D0          0027*       ret nc ; no carry means no free sprite slots, so we go home
042423             0028*   ; other specific initialization
042423             0029*   ; ------------------------------------------------
042423             0030*   ; copy sprite heading and component velocities from targeting_computer
042423 2A 52 87 04 0031*       ld hl,(Bearing_t)
042427 11 00 80 00 0032*       ld de,128*256 ; rotate 128 degrees
04242B 19          0033*       add hl,de
04242C DD 2F 10    0034*       ld (ix+sprite_heading),hl
04242F 2A 5B 87 04 0035*       ld hl,(Vp_x)
042433 DD 2F 07    0036*       ld (ix+sprite_xvel),hl
042436 2A 5E 87 04 0037*       ld hl,(Vp_y)
04243A DD 2F 0A    0038*       ld (ix+sprite_yvel),hl
04243D             0039*   ; move projectile one frame's distance so it isn't drawn right over turret
04243D DD 27 01    0040*       ld hl,(ix+sprite_x)
042440 DD 17 07    0041*       ld de,(ix+sprite_xvel)
042443 19          0042*       add hl,de
042444 DD 2F 01    0043*       ld (ix+sprite_x),hl
042447 DD 27 04    0044*       ld hl,(ix+sprite_y)
04244A DD 17 0A    0045*       ld de,(ix+sprite_yvel)
04244D 19          0046*       add hl,de
04244E DD 2F 04    0047*       ld (ix+sprite_y),hl
042451 C9          0048*       ret
042452             0049*   ; end enemy_spawn_fireball
042452             0050*   
042452             0051*   move_enemy_fireball:
042452             0052*   ; run the movement program for the fireball enemy
042452 CD 8F 82 04 0053*       call move_sprite
042456 3A E2 80 04 0054*       ld a,(sprite_screen_edge)
04245A B7          0055*       or a ; a will be non-zero if have scrolled off screen
04245B C2 28 81 04 0056*       jp nz,table_deactivate_sprite
04245F CD 68 23 04 0057*       call check_enemy_collision_player
042463 C2 6F 24 04 0058*       jp nz,@animate ; no collision so do animation
042467 CD B0 80 04 0059*       call update_shields
04246B C3 13 26 04 0060*       jp spawn_explosion
04246F             0061*   @animate:
04246F             0062*   ; check the animation timer
04246F FD 35 23    0063*       dec (iy+sprite_animation_timer)
042472 C0          0064*       ret nz ; not time to animate
042473             0065*   ; reset the animation timer and bump animation
042473 3E 08       0066*       ld a,8
042475 FD 77 23    0067*       ld (iy+sprite_animation_timer),a
042478 FD 7E 22    0068*       ld a,(iy+sprite_animation)
04247B 3C          0069*       inc a
04247C E6 01       0070*       and %00000001 ; modulo 2
04247E FD 77 22    0071*       ld (iy+sprite_animation),a
042481 CD 46 83 04 0072*       call sprite_frame_heading_animation ; a, sprite_frame set to heading-based frame
042485 CD 63 1C 04 0073*       call vdu_sprite_select_frame
042489 C9          0074*       ret
04248A             0075*   ; end move_enemy_fireball
04248A             0076*   
04248A             0077*   init_enemy_fireballs:
04248A             0078*   ; set pointer to seeker sprite table
04248A FD 21 2A A2 0079*       ld iy,fireballs_base
       04          
04248F FD 7E 00    0080*       ld a,(iy+sprite_id) ; sprite id
042492 1E 04       0081*       ld e,fireballs_max ; sprite loop counter
042494             0082*   ; define seeker sprites
042494             0083*   @sprites_loop:
042494 F5          0084*       push af
042495 D5          0085*       push de
042496 CD 00 1C 04 0086*       call vdu_sprite_select
04249A CD 13 1C 04 0087*       call vdu_sprite_clear_frames
04249E 21 0A 01 00 0088*       ld hl,BUF_FIREBALL_2_000
0424A2 06 80       0089*       ld b,4*32 ; 4 animations * 32 orientations
0424A4             0090*   @frames_loop:
0424A4 C5          0091*       push bc
0424A5 E5          0092*       push hl
0424A6 CD 55 1D 04 0093*       call vdu_sprite_add_buff
0424AA E1          0094*       pop hl
0424AB 23          0095*       inc hl
0424AC C1          0096*       pop bc
0424AD 10 F5       0097*       djnz @frames_loop
0424AF D1          0098*       pop de ; sprite loop counter
0424B0 F1          0099*       pop af ; sprite id
0424B1 3C          0100*       inc a
0424B2 1D          0101*       dec e
0424B3 C2 94 24 04 0102*       jp nz,@sprites_loop
0424B7 C9          0103*       ret
0424B8             0104*   ; end init_enemy_fireballs
0424B8             0049        include "enemy_seeker.inc"
0424B8 FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
042500             0002*   
042500 00          0003*   seekers_count: db 0
042501             0004*   seekers_max: equ 3
042501             0005*   speed_seeker: equ 0x000280 ; 2.5 pixels per frame
042501             0006*   
042501             0007*   seeker_defaults:
042501 01          0008*       db enemy_air            ; type
042502 4F 01 00    0009*       dl BUF_SEEKER_000       ; base_bufferId
042505 2C 25 04    0010*       dl move_enemy_seeker    ; move_program
042508 40          0011*       db %01000000            ; collisions bit 6 signals sprite alive
042509 10          0012*       db 16                   ; dim_x
04250A 10          0013*       db 16                   ; dim_y
04250B 20          0014*       db 32                   ; num_orientations
04250C 01          0015*       db 1                    ; num_animations
04250D 00          0016*       db 0                    ; animation
04250E 00          0017*       db 0                    ; animation_timer
04250F 01          0018*       db 1                    ; move_timer
042510 00          0019*       db 0                    ; move_step
042511 0A          0020*       db 10                   ; points
042512 FC          0021*       db -4                   ; shield_damage
042513 00          0022*       db 0                    ; frame
042514             0023*   
042514             0024*   enemy_spawn_seeker:
042514 21 01 25 04 0025*       ld hl,seeker_defaults
042518 DD 21 6A A1 0026*       ld ix,seekers_base
       04          
04251D 06 03       0027*       ld b,seekers_max
04251F CD F0 8E 04 0028*       call spawn_sprite_from_tile
042523 D0          0029*       ret nc ; no carry means no free sprite slots, so we go home
042524             0030*   ; other specific initialization
042524 21 80 02 00 0031*       ld hl,speed_seeker
042528 DD 2F 0D    0032*       ld (ix+sprite_vel),hl
04252B C9          0033*       ret
04252C             0034*   ; end enemy_spawn_seeker
04252C             0035*   
04252C             0036*   move_enemy_seeker:
04252C             0037*   ; run the movement program for the seeker enemy
04252C CD 60 25 04 0038*       call en_nav_seek_zag
042530 CD 68 23 04 0039*       call check_enemy_collision_player
042534 CA 58 25 04 0040*       jp z,@player
042538 CD 5C 23 04 0041*       call check_enemy_collision_laser
04253C CA 50 25 04 0042*       jp z,@laser
042540             0043*   ; change the animation frame to match heading
042540 FD 7E 00    0044*       ld a,(iy+sprite_id)
042543 CD 00 1C 04 0045*       call vdu_sprite_select
042547 CD 5B 83 04 0046*       call sprite_frame_heading ; a, sprite_frame set to heading-based frame
04254B CD 63 1C 04 0047*       call vdu_sprite_select_frame
04254F C9          0048*       ret
042550             0049*   @laser:
042550 CD 56 80 04 0050*       call update_score
042554 C3 13 26 04 0051*       jp spawn_explosion
042558             0052*   @player:
042558 CD B0 80 04 0053*       call update_shields
04255C C3 13 26 04 0054*       jp spawn_explosion
042560             0055*   ; end move_enemy_seeker
042560             0056*   
042560             0057*   ; contains the logic for how to move the enemy
042560             0058*   ; and then does the moving
042560             0059*   ; inputs: a fully-populated active sprite table
042560             0060*   ;         player position variables
042560             0061*   ; destroys: everything except index registers
042560             0062*   ; outputs: moving enemies
042560             0063*   en_nav_seek_zag:
042560             0064*   ; set velocity and orientation by player's relative location
042560             0065*   ; move enemies y-axis
042560             0066*   ; where is player relative to us?
042560 CD 00 87 04 0067*       call orientation_to_player ; uh.l angle to player, ub.c, ud.e = dx, dy
042564             0068*   ; is player above or below us?
042564 ED 53 C2 03 0069*       ld (ude),de ; dy
       04          
042569 3A C4 03 04 0070*       ld a,(ude+2) ; deu
04256D 17          0071*       rla ; shift sign bit into carry
04256E D2 93 25 04 0072*       jp nc,@zig_zag ; player is below,evade
042572             0073*   ; player is even or above,so home in on current heading
042572 FD 2F 10    0074*       ld (iy+sprite_heading),hl ; save sprite heading
042575             0075*   ; fall through to @compute_velocities
042575             0076*   @compute_velocities:
042575 CD 30 83 04 0077*       call sprite_compute_velocities
042579 CD 8F 82 04 0078*       call move_sprite ; move the sprite
04257D B7          0079*       or a ; a will be non-zero if have collided with screen edge
04257E C2 9E 25 04 0080*       jp nz,@zag_switch ; switch direction
042582 C9          0081*       ret ; didn't hit edge, nothing else to do
042583             0082*   @zig_zag_start:
042583 FD 2A DF 80 0083*       ld iy,(table_pointer)
       04          
042588 CD AE 05 04 0084*       call rand_8
04258C E6 3F       0085*       and %00111111 ; limit it to 64
04258E CB DF       0086*       set 3,a ; make sure it's at least 8
042590 FD 77 24    0087*       ld (iy+sprite_move_timer),a ; store it
042593             0088*       ; fall through to @zig_zag
042593             0089*   @zig_zag:
042593 FD 7E 24    0090*       ld a,(iy+sprite_move_timer)
042596 3D          0091*       dec a
042597 FD 77 24    0092*       ld (iy+sprite_move_timer),a
04259A C2 C0 25 04 0093*       jp nz,@zig_zag_no_switch
04259E             0094*   @zag_switch:
04259E             0095*       ; otherwise flip direction and restart timer
04259E FD 7E 25    0096*       ld a,(iy+sprite_move_step)
0425A1 EE 01       0097*       xor %1 ; flips bit zero
0425A3 FD 77 25    0098*       ld (iy+sprite_move_step),a ; store it
0425A6 C2 B5 25 04 0099*       jp nz,@F ; zag right
0425AA             0100*   ;otherwise zag left
0425AA 21 00 A0 00 0101*       ld hl,160*256; southwest heading
0425AE FD 2F 10    0102*       ld (iy+sprite_heading),hl ; save sprite heading
0425B1 C3 83 25 04 0103*       jp @zig_zag_start
0425B5             0104*   @@: ; zag right
0425B5 21 00 60 00 0105*       ld hl,96*256; southeast heading
0425B9 FD 2F 10    0106*       ld (iy+sprite_heading),hl ; save sprite heading
0425BC C3 83 25 04 0107*       jp @zig_zag_start
0425C0             0108*   @zig_zag_no_switch:
0425C0             0109*       ; ld a,(sprite_orientation)
0425C0 FD 27 10    0110*       ld hl,(iy+sprite_heading)
0425C3 C3 75 25 04 0111*       jp @compute_velocities
0425C7             0112*   ; end en_nav_seek_zag
0425C7             0113*   
0425C7             0114*   
0425C7             0115*   init_enemy_seekers:
0425C7             0116*   ; set pointer to seeker sprite table
0425C7 FD 21 6A A1 0117*       ld iy,seekers_base
       04          
0425CC FD 7E 00    0118*       ld a,(iy+sprite_id) ; sprite id
0425CF 1E 03       0119*       ld e,seekers_max ; sprite loop counter
0425D1             0120*   ; define seeker sprites
0425D1             0121*   @sprites_loop:
0425D1 F5          0122*       push af
0425D2 D5          0123*       push de
0425D3 CD 00 1C 04 0124*   	call vdu_sprite_select
0425D7 CD 13 1C 04 0125*   	call vdu_sprite_clear_frames
0425DB 21 4F 01 00 0126*   	ld hl,BUF_SEEKER_000
0425DF 06 20       0127*   	ld b,32 ; 32 bitmaps for seeker
0425E1             0128*   @frames_loop:
0425E1 C5          0129*   	push bc
0425E2 E5          0130*   	push hl
0425E3 CD 55 1D 04 0131*   	call vdu_sprite_add_buff
0425E7 E1          0132*   	pop hl
0425E8 23          0133*   	inc hl
0425E9 C1          0134*   	pop bc
0425EA 10 F5       0135*   	djnz @frames_loop
0425EC D1          0136*       pop de ; sprite loop counter
0425ED F1          0137*       pop af ; sprite id
0425EE 3C          0138*       inc a
0425EF 1D          0139*       dec e
0425F0 C2 D1 25 04 0140*       jp nz,@sprites_loop
0425F4 C9          0141*       ret
0425F5             0142*   ; end init_enemy_seekers
0425F5             0050        include "explosion.inc"
0425F5 FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF    
042600             0002*   
042600             0003*   explosions_max: equ 8
042600             0004*   explosion_defaults:
042600 04          0005*       db explosion            ; type
042601 05 01 00    0006*       dl BUF_EXPLOSION_A	    ; base_bufferId
042604 5D 26 04    0007*       dl move_explosion	    ; move_program
042607 40          0008*       db %01000000            ; collisions bit 6 signals sprite alive
042608 07          0009*       db 7	                ; dim_x
042609 07          0010*       db 7                    ; dim_y
04260A 01          0011*       db 1                    ; num_orientations
04260B 05          0012*       db 5                    ; num_animations
04260C 05          0013*       db 5	                ; animation
04260D 08          0014*       db 8	                ; animation_timer
04260E 00          0015*       db 0	                ; move_timer
04260F 00          0016*       db 0	                ; move_step
042610 00          0017*       db 0	                ; points
042611 00          0018*       db 0	                ; shield_damage
042612 00          0019*       db 0                    ; frame
042613             0020*   
042613             0021*   spawn_explosion:
042613 21 00 26 04 0022*       ld hl,explosion_defaults
042617 DD 21 2A A3 0023*       ld ix,explosions_base
       04          
04261C 06 08       0024*       ld b,explosions_max
04261E CD DC 81 04 0025*       call spawn_sprite_from_sprite
042622 D2 28 81 04 0026*       jp nc,table_deactivate_sprite ; no carry means no free sprite slots, so we deactivate parent sprite and go home
042626             0027*   ; other specific initialization
042626 21 00 00 00 0028*       ld hl,0
04262A DD 2F 07    0029*       ld (ix+sprite_xvel),hl
04262D 21 00 01 00 0030*       ld hl,1*256
042631 DD 2F 0A    0031*       ld (ix+sprite_yvel),hl
042634             0032*   ; deactivate parent sprite
042634 C3 28 81 04 0033*       jp table_deactivate_sprite
042638             0034*   ; end spawn_explosion
042638             0035*   
042638             0036*   tile_spawn_explosion:
042638 21 00 26 04 0037*       ld hl,explosion_defaults
04263C DD 21 2A A3 0038*       ld ix,explosions_base
       04          
042641 06 08       0039*       ld b,explosions_max
042643 CD F0 8E 04 0040*       call spawn_sprite_from_tile
042647 D2 90 8B 04 0041*       jp nc,table_deactivate_tile ; no carry means no free sprite slots, so we deactivate parent tile and go home
04264B             0042*   ; other specific initialization
04264B 21 00 00 00 0043*       ld hl,0
04264F DD 2F 07    0044*       ld (ix+sprite_xvel),hl
042652 21 00 01 00 0045*       ld hl,1*256
042656 DD 2F 0A    0046*       ld (ix+sprite_yvel),hl
042659             0047*   ; deactivate parent sprite
042659 C3 90 8B 04 0048*       jp table_deactivate_tile
04265D             0049*   ; end tile_spawn_explosion
04265D             0050*   
04265D             0051*   move_explosion:
04265D             0052*   ; run the movement program for the explosion
04265D CD 8F 82 04 0053*       call move_sprite
042661 B7          0054*       or a ; a will be non-zero if have scrolled off screen
042662 C2 28 81 04 0055*       jp nz,table_deactivate_sprite
042666             0056*   ; do the animations
042666 FD 35 23    0057*       dec (iy+sprite_animation_timer)
042669 C0          0058*       ret nz ; not time to bump animation frame
04266A FD 34 28    0059*       inc (iy+sprite_frame)
04266D FD 35 22    0060*       dec (iy+sprite_animation)
042670 CA 28 81 04 0061*       jp z,table_deactivate_sprite ; reached the end of the animations
042674 3E 08       0062*       ld a,8 ; reset animation timer
042676 FD 77 23    0063*       ld (iy+sprite_animation_timer),a
042679 C9          0064*       ret
04267A             0065*   ; end move_explosion
04267A             0066*   
04267A             0067*   move_explosions:
04267A             0068*   ; initialize pointers and loop counter
04267A FD 21 2A A3 0069*       ld iy,explosions_base ; set iy to first record in table
       04          
04267F 06 08       0070*       ld b,explosions_max ; loop counter
042681 CD 0E 82 04 0071*       call move_sprite_group
042685 C9          0072*       ret
042686             0073*   ; end move_explosions
042686             0074*   
042686             0075*   init_explosions:
042686             0076*   ; set pointer to explosion sprite table
042686 FD 21 2A A3 0077*       ld iy,explosions_base
       04          
04268B FD 7E 00    0078*       ld a,(iy+sprite_id) ; sprite id
04268E 1E 08       0079*       ld e,explosions_max ; sprite loop counter
042690             0080*   ; define explosion sprites
042690             0081*   @sprites_loop:
042690 F5          0082*       push af
042691 D5          0083*       push de
042692 CD 00 1C 04 0084*   	call vdu_sprite_select
042696 CD 13 1C 04 0085*   	call vdu_sprite_clear_frames
04269A 21 05 01 00 0086*   	ld hl,BUF_EXPLOSION_A
04269E 06 05       0087*   	ld b,5 ; 5 bitmaps for explosion
0426A0             0088*   @frames_loop:
0426A0 C5          0089*   	push bc
0426A1 E5          0090*   	push hl
0426A2 CD 55 1D 04 0091*   	call vdu_sprite_add_buff
0426A6 E1          0092*   	pop hl
0426A7 23          0093*   	inc hl
0426A8 C1          0094*   	pop bc
0426A9 10 F5       0095*   	djnz @frames_loop
0426AB D1          0096*       pop de ; sprite loop counter
0426AC F1          0097*       pop af ; sprite id
0426AD 3C          0098*       inc a
0426AE 1D          0099*       dec e
0426AF C2 90 26 04 0100*       jp nz,@sprites_loop
0426B3 C9          0101*       ret
0426B4             0102*   ; end init_explosions
0426B4             0051        include "fonts_list.inc"
0426B4 FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
042700             0002*   
042700             0003*   ; Generated by asm_config_editor.py
042700             0004*   font_list_record_size: equ 12
042700             0005*   font_list_width: equ 0
042700             0006*   font_list_height: equ 3
042700             0007*   font_list_bufferId: equ 6
042700             0008*   font_list_filename: equ 9
042700             0009*   
042700             0010*   num_fonts: equ 7
042700             0011*   
042700             0012*   ; Index list:
042700             0013*   amiga_forever_8x8: equ 64000
042700             0014*   computer_pixel_7_8x12: equ 64001
042700             0015*   computer_pixel_7_8x16: equ 64002
042700             0016*   Lat2_VGA8_8x8: equ 64003
042700             0017*   Lat7_VGA8_8x8: equ 64004
042700             0018*   Squarewave_Bold_8x12: equ 64005
042700             0019*   wendy_neue_6x6: equ 64006
042700             0020*   
042700             0021*   font_list: ; width; height; bufferId; filename;:
042700 08 00 00 08 0022*   	dl 8, 8, 64000, fn_amiga_forever_8x8
       00 00 00 FA 
       00 54 27 04 
04270C 08 00 00 0C 0023*   	dl 8, 12, 64001, fn_computer_pixel_7_8x12
       00 00 01 FA 
       00 71 27 04 
042718 08 00 00 10 0024*   	dl 8, 16, 64002, fn_computer_pixel_7_8x16
       00 00 02 FA 
       00 92 27 04 
042724 08 00 00 08 0025*   	dl 8, 8, 64003, fn_Lat2_VGA8_8x8
       00 00 03 FA 
       00 B3 27 04 
042730 08 00 00 08 0026*   	dl 8, 8, 64004, fn_Lat7_VGA8_8x8
       00 00 04 FA 
       00 CC 27 04 
04273C 08 00 00 0C 0027*   	dl 8, 12, 64005, fn_Squarewave_Bold_8x12
       00 00 05 FA 
       00 E5 27 04 
042748 06 00 00 06 0028*   	dl 6, 6, 64006, fn_wendy_neue_6x6
       00 00 06 FA 
       00 05 28 04 
042754             0029*   
042754             0030*   ; files_list: ; filename:
042754 66 6F 6E 74 0031*   fn_amiga_forever_8x8: db "fonts/amiga_forever_8x8.font",0
       73 2F 61 6D 
       69 67 61 5F 
       66 6F 72 65 
       76 65 72 5F 
       38 78 38 2E 
       66 6F 6E 74 
       00          
042771 66 6F 6E 74 0032*   fn_computer_pixel_7_8x12: db "fonts/computer_pixel_7_8x12.font",0
       73 2F 63 6F 
       6D 70 75 74 
       65 72 5F 70 
       69 78 65 6C 
       5F 37 5F 38 
       78 31 32 2E 
       66 6F 6E 74 
       00          
042792 66 6F 6E 74 0033*   fn_computer_pixel_7_8x16: db "fonts/computer_pixel_7_8x16.font",0
       73 2F 63 6F 
       6D 70 75 74 
       65 72 5F 70 
       69 78 65 6C 
       5F 37 5F 38 
       78 31 36 2E 
       66 6F 6E 74 
       00          
0427B3 66 6F 6E 74 0034*   fn_Lat2_VGA8_8x8: db "fonts/Lat2-VGA8_8x8.font",0
       73 2F 4C 61 
       74 32 2D 56 
       47 41 38 5F 
       38 78 38 2E 
       66 6F 6E 74 
       00          
0427CC 66 6F 6E 74 0035*   fn_Lat7_VGA8_8x8: db "fonts/Lat7-VGA8_8x8.font",0
       73 2F 4C 61 
       74 37 2D 56 
       47 41 38 5F 
       38 78 38 2E 
       66 6F 6E 74 
       00          
0427E5 66 6F 6E 74 0036*   fn_Squarewave_Bold_8x12: db "fonts/Squarewave_Bold_8x12.font",0
       73 2F 53 71 
       75 61 72 65 
       77 61 76 65 
       5F 42 6F 6C 
       64 5F 38 78 
       31 32 2E 66 
       6F 6E 74 00 
042805 66 6F 6E 74 0037*   fn_wendy_neue_6x6: db "fonts/wendy_neue_6x6.font",0
       73 2F 77 65 
       6E 64 79 5F 
       6E 65 75 65 
       5F 36 78 36 
       2E 66 6F 6E 
       74 00       
04281F             0052        include "images_bg.inc"
04281F             0001*   ; Generated by make_images.py
04281F             0002*   
04281F             0003*   bg_num_images: equ 8
04281F             0004*   
04281F             0005*   ; buffer_ids:
04281F             0006*   BUF_BG_STARS_0: equ 1024
04281F             0007*   BUF_BG_STARS_1: equ 1025
04281F             0008*   BUF_BG_STARS_2: equ 1026
04281F             0009*   BUF_BG_STARS_3: equ 1027
04281F             0010*   BUF_BG_STARS_4: equ 1028
04281F             0011*   BUF_BG_STARS_5: equ 1029
04281F             0012*   BUF_BG_STARS_6: equ 1030
04281F             0013*   BUF_BG_STARS_7: equ 1031
04281F             0014*   
04281F             0015*   bg_image_list: ; type; width; height; size; filename; bufferId:
04281F 01 00 00 00 0016*   	dl 1, 256, 256, 65536, fn_bg_stars_0, 1024
       01 00 00 01 
       00 00 00 01 
       AF 28 04 00 
       04 00       
042831 01 00 00 00 0017*   	dl 1, 256, 256, 65536, fn_bg_stars_1, 1025
       01 00 00 01 
       00 00 00 01 
       C3 28 04 01 
       04 00       
042843 01 00 00 00 0018*   	dl 1, 256, 256, 65536, fn_bg_stars_2, 1026
       01 00 00 01 
       00 00 00 01 
       D7 28 04 02 
       04 00       
042855 01 00 00 00 0019*   	dl 1, 256, 256, 65536, fn_bg_stars_3, 1027
       01 00 00 01 
       00 00 00 01 
       EB 28 04 03 
       04 00       
042867 01 00 00 00 0020*   	dl 1, 256, 256, 65536, fn_bg_stars_4, 1028
       01 00 00 01 
       00 00 00 01 
       FF 28 04 04 
       04 00       
042879 01 00 00 00 0021*   	dl 1, 256, 256, 65536, fn_bg_stars_5, 1029
       01 00 00 01 
       00 00 00 01 
       13 29 04 05 
       04 00       
04288B 01 00 00 00 0022*   	dl 1, 256, 256, 65536, fn_bg_stars_6, 1030
       01 00 00 01 
       00 00 00 01 
       27 29 04 06 
       04 00       
04289D 01 00 00 00 0023*   	dl 1, 256, 256, 65536, fn_bg_stars_7, 1031
       01 00 00 01 
       00 00 00 01 
       3B 29 04 07 
       04 00       
0428AF             0024*   
0428AF             0025*   ; files_list: ; filename:
0428AF 62 67 2F 62 0026*   fn_bg_stars_0: db "bg/bg_stars_0.rgba2",0
       67 5F 73 74 
       61 72 73 5F 
       30 2E 72 67 
       62 61 32 00 
0428C3 62 67 2F 62 0027*   fn_bg_stars_1: db "bg/bg_stars_1.rgba2",0
       67 5F 73 74 
       61 72 73 5F 
       31 2E 72 67 
       62 61 32 00 
0428D7 62 67 2F 62 0028*   fn_bg_stars_2: db "bg/bg_stars_2.rgba2",0
       67 5F 73 74 
       61 72 73 5F 
       32 2E 72 67 
       62 61 32 00 
0428EB 62 67 2F 62 0029*   fn_bg_stars_3: db "bg/bg_stars_3.rgba2",0
       67 5F 73 74 
       61 72 73 5F 
       33 2E 72 67 
       62 61 32 00 
0428FF 62 67 2F 62 0030*   fn_bg_stars_4: db "bg/bg_stars_4.rgba2",0
       67 5F 73 74 
       61 72 73 5F 
       34 2E 72 67 
       62 61 32 00 
042913 62 67 2F 62 0031*   fn_bg_stars_5: db "bg/bg_stars_5.rgba2",0
       67 5F 73 74 
       61 72 73 5F 
       35 2E 72 67 
       62 61 32 00 
042927 62 67 2F 62 0032*   fn_bg_stars_6: db "bg/bg_stars_6.rgba2",0
       67 5F 73 74 
       61 72 73 5F 
       36 2E 72 67 
       62 61 32 00 
04293B 62 67 2F 62 0033*   fn_bg_stars_7: db "bg/bg_stars_7.rgba2",0
       67 5F 73 74 
       61 72 73 5F 
       37 2E 72 67 
       62 61 32 00 
04294F             0053        include "images_tiles_dg.inc"
04294F             0001*   ; Generated by tiles_dg.py
04294F             0002*   
04294F             0003*   tiles_dg_num_images: equ 187
04294F             0004*   
04294F             0005*   ; bufferIds:
04294F             0006*   
04294F             0007*   
04294F             0008*   tiles_dg_image_list: ; type; width; height; size; filename; bufferId:
04294F 01 00 00 10 0009*   	dl 1, 16, 16, 256, fn_dg_000, 512
       00 00 10 00 
       00 00 01 00 
       75 36 04 00 
       02 00       
042961 01 00 00 10 0010*   	dl 1, 16, 16, 256, fn_dg_001, 513
       00 00 10 00 
       00 00 01 00 
       8A 36 04 01 
       02 00       
042973 01 00 00 10 0011*   	dl 1, 16, 16, 256, fn_dg_002, 514
       00 00 10 00 
       00 00 01 00 
       9F 36 04 02 
       02 00       
042985 01 00 00 10 0012*   	dl 1, 16, 16, 256, fn_dg_003, 515
       00 00 10 00 
       00 00 01 00 
       B4 36 04 03 
       02 00       
042997 01 00 00 10 0013*   	dl 1, 16, 16, 256, fn_dg_004, 516
       00 00 10 00 
       00 00 01 00 
       C9 36 04 04 
       02 00       
0429A9 01 00 00 10 0014*   	dl 1, 16, 16, 256, fn_dg_005, 517
       00 00 10 00 
       00 00 01 00 
       DE 36 04 05 
       02 00       
0429BB 01 00 00 10 0015*   	dl 1, 16, 16, 256, fn_dg_006, 518
       00 00 10 00 
       00 00 01 00 
       F3 36 04 06 
       02 00       
0429CD 01 00 00 10 0016*   	dl 1, 16, 16, 256, fn_dg_007, 519
       00 00 10 00 
       00 00 01 00 
       08 37 04 07 
       02 00       
0429DF 01 00 00 10 0017*   	dl 1, 16, 16, 256, fn_dg_008, 520
       00 00 10 00 
       00 00 01 00 
       1D 37 04 08 
       02 00       
0429F1 01 00 00 10 0018*   	dl 1, 16, 16, 256, fn_dg_009, 521
       00 00 10 00 
       00 00 01 00 
       32 37 04 09 
       02 00       
042A03 01 00 00 10 0019*   	dl 1, 16, 16, 256, fn_dg_010, 522
       00 00 10 00 
       00 00 01 00 
       47 37 04 0A 
       02 00       
042A15 01 00 00 10 0020*   	dl 1, 16, 16, 256, fn_dg_011, 523
       00 00 10 00 
       00 00 01 00 
       5C 37 04 0B 
       02 00       
042A27 01 00 00 10 0021*   	dl 1, 16, 16, 256, fn_dg_016, 528
       00 00 10 00 
       00 00 01 00 
       71 37 04 10 
       02 00       
042A39 01 00 00 10 0022*   	dl 1, 16, 16, 256, fn_dg_033, 545
       00 00 10 00 
       00 00 01 00 
       86 37 04 21 
       02 00       
042A4B 01 00 00 10 0023*   	dl 1, 16, 16, 256, fn_dg_034, 546
       00 00 10 00 
       00 00 01 00 
       9B 37 04 22 
       02 00       
042A5D 01 00 00 10 0024*   	dl 1, 16, 16, 256, fn_dg_035, 547
       00 00 10 00 
       00 00 01 00 
       B0 37 04 23 
       02 00       
042A6F 01 00 00 10 0025*   	dl 1, 16, 16, 256, fn_dg_036, 548
       00 00 10 00 
       00 00 01 00 
       C5 37 04 24 
       02 00       
042A81 01 00 00 10 0026*   	dl 1, 16, 16, 256, fn_dg_037, 549
       00 00 10 00 
       00 00 01 00 
       DA 37 04 25 
       02 00       
042A93 01 00 00 10 0027*   	dl 1, 16, 16, 256, fn_dg_038, 550
       00 00 10 00 
       00 00 01 00 
       EF 37 04 26 
       02 00       
042AA5 01 00 00 10 0028*   	dl 1, 16, 16, 256, fn_dg_039, 551
       00 00 10 00 
       00 00 01 00 
       04 38 04 27 
       02 00       
042AB7 01 00 00 10 0029*   	dl 1, 16, 16, 256, fn_dg_040, 552
       00 00 10 00 
       00 00 01 00 
       19 38 04 28 
       02 00       
042AC9 01 00 00 10 0030*   	dl 1, 16, 16, 256, fn_dg_045, 557
       00 00 10 00 
       00 00 01 00 
       2E 38 04 2D 
       02 00       
042ADB 01 00 00 10 0031*   	dl 1, 16, 16, 256, fn_dg_046, 558
       00 00 10 00 
       00 00 01 00 
       43 38 04 2E 
       02 00       
042AED 01 00 00 10 0032*   	dl 1, 16, 16, 256, fn_dg_047, 559
       00 00 10 00 
       00 00 01 00 
       58 38 04 2F 
       02 00       
042AFF 01 00 00 10 0033*   	dl 1, 16, 16, 256, fn_dg_048, 560
       00 00 10 00 
       00 00 01 00 
       6D 38 04 30 
       02 00       
042B11 01 00 00 10 0034*   	dl 1, 16, 16, 256, fn_dg_049, 561
       00 00 10 00 
       00 00 01 00 
       82 38 04 31 
       02 00       
042B23 01 00 00 10 0035*   	dl 1, 16, 16, 256, fn_dg_050, 562
       00 00 10 00 
       00 00 01 00 
       97 38 04 32 
       02 00       
042B35 01 00 00 10 0036*   	dl 1, 16, 16, 256, fn_dg_051, 563
       00 00 10 00 
       00 00 01 00 
       AC 38 04 33 
       02 00       
042B47 01 00 00 10 0037*   	dl 1, 16, 16, 256, fn_dg_052, 564
       00 00 10 00 
       00 00 01 00 
       C1 38 04 34 
       02 00       
042B59 01 00 00 10 0038*   	dl 1, 16, 16, 256, fn_dg_053, 565
       00 00 10 00 
       00 00 01 00 
       D6 38 04 35 
       02 00       
042B6B 01 00 00 10 0039*   	dl 1, 16, 16, 256, fn_dg_054, 566
       00 00 10 00 
       00 00 01 00 
       EB 38 04 36 
       02 00       
042B7D 01 00 00 10 0040*   	dl 1, 16, 16, 256, fn_dg_055, 567
       00 00 10 00 
       00 00 01 00 
       00 39 04 37 
       02 00       
042B8F 01 00 00 10 0041*   	dl 1, 16, 16, 256, fn_dg_056, 568
       00 00 10 00 
       00 00 01 00 
       15 39 04 38 
       02 00       
042BA1 01 00 00 10 0042*   	dl 1, 16, 16, 256, fn_dg_057, 569
       00 00 10 00 
       00 00 01 00 
       2A 39 04 39 
       02 00       
042BB3 01 00 00 10 0043*   	dl 1, 16, 16, 256, fn_dg_058, 570
       00 00 10 00 
       00 00 01 00 
       3F 39 04 3A 
       02 00       
042BC5 01 00 00 10 0044*   	dl 1, 16, 16, 256, fn_dg_059, 571
       00 00 10 00 
       00 00 01 00 
       54 39 04 3B 
       02 00       
042BD7 01 00 00 10 0045*   	dl 1, 16, 16, 256, fn_dg_061, 573
       00 00 10 00 
       00 00 01 00 
       69 39 04 3D 
       02 00       
042BE9 01 00 00 10 0046*   	dl 1, 16, 16, 256, fn_dg_062, 574
       00 00 10 00 
       00 00 01 00 
       7E 39 04 3E 
       02 00       
042BFB 01 00 00 10 0047*   	dl 1, 16, 16, 256, fn_dg_063, 575
       00 00 10 00 
       00 00 01 00 
       93 39 04 3F 
       02 00       
042C0D 01 00 00 10 0048*   	dl 1, 16, 16, 256, fn_dg_064, 576
       00 00 10 00 
       00 00 01 00 
       A8 39 04 40 
       02 00       
042C1F 01 00 00 10 0049*   	dl 1, 16, 16, 256, fn_dg_065, 577
       00 00 10 00 
       00 00 01 00 
       BD 39 04 41 
       02 00       
042C31 01 00 00 10 0050*   	dl 1, 16, 16, 256, fn_dg_066, 578
       00 00 10 00 
       00 00 01 00 
       D2 39 04 42 
       02 00       
042C43 01 00 00 10 0051*   	dl 1, 16, 16, 256, fn_dg_067, 579
       00 00 10 00 
       00 00 01 00 
       E7 39 04 43 
       02 00       
042C55 01 00 00 10 0052*   	dl 1, 16, 16, 256, fn_dg_068, 580
       00 00 10 00 
       00 00 01 00 
       FC 39 04 44 
       02 00       
042C67 01 00 00 10 0053*   	dl 1, 16, 16, 256, fn_dg_069, 581
       00 00 10 00 
       00 00 01 00 
       11 3A 04 45 
       02 00       
042C79 01 00 00 10 0054*   	dl 1, 16, 16, 256, fn_dg_070, 582
       00 00 10 00 
       00 00 01 00 
       26 3A 04 46 
       02 00       
042C8B 01 00 00 10 0055*   	dl 1, 16, 16, 256, fn_dg_071, 583
       00 00 10 00 
       00 00 01 00 
       3B 3A 04 47 
       02 00       
042C9D 01 00 00 10 0056*   	dl 1, 16, 16, 256, fn_dg_072, 584
       00 00 10 00 
       00 00 01 00 
       50 3A 04 48 
       02 00       
042CAF 01 00 00 10 0057*   	dl 1, 16, 16, 256, fn_dg_073, 585
       00 00 10 00 
       00 00 01 00 
       65 3A 04 49 
       02 00       
042CC1 01 00 00 10 0058*   	dl 1, 16, 16, 256, fn_dg_074, 586
       00 00 10 00 
       00 00 01 00 
       7A 3A 04 4A 
       02 00       
042CD3 01 00 00 10 0059*   	dl 1, 16, 16, 256, fn_dg_075, 587
       00 00 10 00 
       00 00 01 00 
       8F 3A 04 4B 
       02 00       
042CE5 01 00 00 10 0060*   	dl 1, 16, 16, 256, fn_dg_076, 588
       00 00 10 00 
       00 00 01 00 
       A4 3A 04 4C 
       02 00       
042CF7 01 00 00 10 0061*   	dl 1, 16, 16, 256, fn_dg_077, 589
       00 00 10 00 
       00 00 01 00 
       B9 3A 04 4D 
       02 00       
042D09 01 00 00 10 0062*   	dl 1, 16, 16, 256, fn_dg_081, 593
       00 00 10 00 
       00 00 01 00 
       CE 3A 04 51 
       02 00       
042D1B 01 00 00 10 0063*   	dl 1, 16, 16, 256, fn_dg_082, 594
       00 00 10 00 
       00 00 01 00 
       E3 3A 04 52 
       02 00       
042D2D 01 00 00 10 0064*   	dl 1, 16, 16, 256, fn_dg_083, 595
       00 00 10 00 
       00 00 01 00 
       F8 3A 04 53 
       02 00       
042D3F 01 00 00 10 0065*   	dl 1, 16, 16, 256, fn_dg_084, 596
       00 00 10 00 
       00 00 01 00 
       0D 3B 04 54 
       02 00       
042D51 01 00 00 10 0066*   	dl 1, 16, 16, 256, fn_dg_085, 597
       00 00 10 00 
       00 00 01 00 
       22 3B 04 55 
       02 00       
042D63 01 00 00 10 0067*   	dl 1, 16, 16, 256, fn_dg_086, 598
       00 00 10 00 
       00 00 01 00 
       37 3B 04 56 
       02 00       
042D75 01 00 00 10 0068*   	dl 1, 16, 16, 256, fn_dg_087, 599
       00 00 10 00 
       00 00 01 00 
       4C 3B 04 57 
       02 00       
042D87 01 00 00 10 0069*   	dl 1, 16, 16, 256, fn_dg_088, 600
       00 00 10 00 
       00 00 01 00 
       61 3B 04 58 
       02 00       
042D99 01 00 00 10 0070*   	dl 1, 16, 16, 256, fn_dg_089, 601
       00 00 10 00 
       00 00 01 00 
       76 3B 04 59 
       02 00       
042DAB 01 00 00 10 0071*   	dl 1, 16, 16, 256, fn_dg_090, 602
       00 00 10 00 
       00 00 01 00 
       8B 3B 04 5A 
       02 00       
042DBD 01 00 00 10 0072*   	dl 1, 16, 16, 256, fn_dg_091, 603
       00 00 10 00 
       00 00 01 00 
       A0 3B 04 5B 
       02 00       
042DCF 01 00 00 10 0073*   	dl 1, 16, 16, 256, fn_dg_092, 604
       00 00 10 00 
       00 00 01 00 
       B5 3B 04 5C 
       02 00       
042DE1 01 00 00 10 0074*   	dl 1, 16, 16, 256, fn_dg_093, 605
       00 00 10 00 
       00 00 01 00 
       CA 3B 04 5D 
       02 00       
042DF3 01 00 00 10 0075*   	dl 1, 16, 16, 256, fn_dg_097, 609
       00 00 10 00 
       00 00 01 00 
       DF 3B 04 61 
       02 00       
042E05 01 00 00 10 0076*   	dl 1, 16, 16, 256, fn_dg_098, 610
       00 00 10 00 
       00 00 01 00 
       F4 3B 04 62 
       02 00       
042E17 01 00 00 10 0077*   	dl 1, 16, 16, 256, fn_dg_099, 611
       00 00 10 00 
       00 00 01 00 
       09 3C 04 63 
       02 00       
042E29 01 00 00 10 0078*   	dl 1, 16, 16, 256, fn_dg_100, 612
       00 00 10 00 
       00 00 01 00 
       1E 3C 04 64 
       02 00       
042E3B 01 00 00 10 0079*   	dl 1, 16, 16, 256, fn_dg_101, 613
       00 00 10 00 
       00 00 01 00 
       33 3C 04 65 
       02 00       
042E4D 01 00 00 10 0080*   	dl 1, 16, 16, 256, fn_dg_102, 614
       00 00 10 00 
       00 00 01 00 
       48 3C 04 66 
       02 00       
042E5F 01 00 00 10 0081*   	dl 1, 16, 16, 256, fn_dg_103, 615
       00 00 10 00 
       00 00 01 00 
       5D 3C 04 67 
       02 00       
042E71 01 00 00 10 0082*   	dl 1, 16, 16, 256, fn_dg_104, 616
       00 00 10 00 
       00 00 01 00 
       72 3C 04 68 
       02 00       
042E83 01 00 00 10 0083*   	dl 1, 16, 16, 256, fn_dg_105, 617
       00 00 10 00 
       00 00 01 00 
       87 3C 04 69 
       02 00       
042E95 01 00 00 10 0084*   	dl 1, 16, 16, 256, fn_dg_106, 618
       00 00 10 00 
       00 00 01 00 
       9C 3C 04 6A 
       02 00       
042EA7 01 00 00 10 0085*   	dl 1, 16, 16, 256, fn_dg_107, 619
       00 00 10 00 
       00 00 01 00 
       B1 3C 04 6B 
       02 00       
042EB9 01 00 00 10 0086*   	dl 1, 16, 16, 256, fn_dg_108, 620
       00 00 10 00 
       00 00 01 00 
       C6 3C 04 6C 
       02 00       
042ECB 01 00 00 10 0087*   	dl 1, 16, 16, 256, fn_dg_113, 625
       00 00 10 00 
       00 00 01 00 
       DB 3C 04 71 
       02 00       
042EDD 01 00 00 10 0088*   	dl 1, 16, 16, 256, fn_dg_114, 626
       00 00 10 00 
       00 00 01 00 
       F0 3C 04 72 
       02 00       
042EEF 01 00 00 10 0089*   	dl 1, 16, 16, 256, fn_dg_115, 627
       00 00 10 00 
       00 00 01 00 
       05 3D 04 73 
       02 00       
042F01 01 00 00 10 0090*   	dl 1, 16, 16, 256, fn_dg_116, 628
       00 00 10 00 
       00 00 01 00 
       1A 3D 04 74 
       02 00       
042F13 01 00 00 10 0091*   	dl 1, 16, 16, 256, fn_dg_117, 629
       00 00 10 00 
       00 00 01 00 
       2F 3D 04 75 
       02 00       
042F25 01 00 00 10 0092*   	dl 1, 16, 16, 256, fn_dg_118, 630
       00 00 10 00 
       00 00 01 00 
       44 3D 04 76 
       02 00       
042F37 01 00 00 10 0093*   	dl 1, 16, 16, 256, fn_dg_119, 631
       00 00 10 00 
       00 00 01 00 
       59 3D 04 77 
       02 00       
042F49 01 00 00 10 0094*   	dl 1, 16, 16, 256, fn_dg_120, 632
       00 00 10 00 
       00 00 01 00 
       6E 3D 04 78 
       02 00       
042F5B 01 00 00 10 0095*   	dl 1, 16, 16, 256, fn_dg_121, 633
       00 00 10 00 
       00 00 01 00 
       83 3D 04 79 
       02 00       
042F6D 01 00 00 10 0096*   	dl 1, 16, 16, 256, fn_dg_122, 634
       00 00 10 00 
       00 00 01 00 
       98 3D 04 7A 
       02 00       
042F7F 01 00 00 10 0097*   	dl 1, 16, 16, 256, fn_dg_123, 635
       00 00 10 00 
       00 00 01 00 
       AD 3D 04 7B 
       02 00       
042F91 01 00 00 10 0098*   	dl 1, 16, 16, 256, fn_dg_129, 641
       00 00 10 00 
       00 00 01 00 
       C2 3D 04 81 
       02 00       
042FA3 01 00 00 10 0099*   	dl 1, 16, 16, 256, fn_dg_130, 642
       00 00 10 00 
       00 00 01 00 
       D7 3D 04 82 
       02 00       
042FB5 01 00 00 10 0100*   	dl 1, 16, 16, 256, fn_dg_131, 643
       00 00 10 00 
       00 00 01 00 
       EC 3D 04 83 
       02 00       
042FC7 01 00 00 10 0101*   	dl 1, 16, 16, 256, fn_dg_132, 644
       00 00 10 00 
       00 00 01 00 
       01 3E 04 84 
       02 00       
042FD9 01 00 00 10 0102*   	dl 1, 16, 16, 256, fn_dg_133, 645
       00 00 10 00 
       00 00 01 00 
       16 3E 04 85 
       02 00       
042FEB 01 00 00 10 0103*   	dl 1, 16, 16, 256, fn_dg_134, 646
       00 00 10 00 
       00 00 01 00 
       2B 3E 04 86 
       02 00       
042FFD 01 00 00 10 0104*   	dl 1, 16, 16, 256, fn_dg_135, 647
       00 00 10 00 
       00 00 01 00 
       40 3E 04 87 
       02 00       
04300F 01 00 00 10 0105*   	dl 1, 16, 16, 256, fn_dg_136, 648
       00 00 10 00 
       00 00 01 00 
       55 3E 04 88 
       02 00       
043021 01 00 00 10 0106*   	dl 1, 16, 16, 256, fn_dg_137, 649
       00 00 10 00 
       00 00 01 00 
       6A 3E 04 89 
       02 00       
043033 01 00 00 10 0107*   	dl 1, 16, 16, 256, fn_dg_138, 650
       00 00 10 00 
       00 00 01 00 
       7F 3E 04 8A 
       02 00       
043045 01 00 00 10 0108*   	dl 1, 16, 16, 256, fn_dg_139, 651
       00 00 10 00 
       00 00 01 00 
       94 3E 04 8B 
       02 00       
043057 01 00 00 10 0109*   	dl 1, 16, 16, 256, fn_dg_140, 652
       00 00 10 00 
       00 00 01 00 
       A9 3E 04 8C 
       02 00       
043069 01 00 00 10 0110*   	dl 1, 16, 16, 256, fn_dg_145, 657
       00 00 10 00 
       00 00 01 00 
       BE 3E 04 91 
       02 00       
04307B 01 00 00 10 0111*   	dl 1, 16, 16, 256, fn_dg_146, 658
       00 00 10 00 
       00 00 01 00 
       D3 3E 04 92 
       02 00       
04308D 01 00 00 10 0112*   	dl 1, 16, 16, 256, fn_dg_147, 659
       00 00 10 00 
       00 00 01 00 
       E8 3E 04 93 
       02 00       
04309F 01 00 00 10 0113*   	dl 1, 16, 16, 256, fn_dg_148, 660
       00 00 10 00 
       00 00 01 00 
       FD 3E 04 94 
       02 00       
0430B1 01 00 00 10 0114*   	dl 1, 16, 16, 256, fn_dg_149, 661
       00 00 10 00 
       00 00 01 00 
       12 3F 04 95 
       02 00       
0430C3 01 00 00 10 0115*   	dl 1, 16, 16, 256, fn_dg_150, 662
       00 00 10 00 
       00 00 01 00 
       27 3F 04 96 
       02 00       
0430D5 01 00 00 10 0116*   	dl 1, 16, 16, 256, fn_dg_151, 663
       00 00 10 00 
       00 00 01 00 
       3C 3F 04 97 
       02 00       
0430E7 01 00 00 10 0117*   	dl 1, 16, 16, 256, fn_dg_152, 664
       00 00 10 00 
       00 00 01 00 
       51 3F 04 98 
       02 00       
0430F9 01 00 00 10 0118*   	dl 1, 16, 16, 256, fn_dg_153, 665
       00 00 10 00 
       00 00 01 00 
       66 3F 04 99 
       02 00       
04310B 01 00 00 10 0119*   	dl 1, 16, 16, 256, fn_dg_154, 666
       00 00 10 00 
       00 00 01 00 
       7B 3F 04 9A 
       02 00       
04311D 01 00 00 10 0120*   	dl 1, 16, 16, 256, fn_dg_155, 667
       00 00 10 00 
       00 00 01 00 
       90 3F 04 9B 
       02 00       
04312F 01 00 00 10 0121*   	dl 1, 16, 16, 256, fn_dg_156, 668
       00 00 10 00 
       00 00 01 00 
       A5 3F 04 9C 
       02 00       
043141 01 00 00 10 0122*   	dl 1, 16, 16, 256, fn_dg_161, 673
       00 00 10 00 
       00 00 01 00 
       BA 3F 04 A1 
       02 00       
043153 01 00 00 10 0123*   	dl 1, 16, 16, 256, fn_dg_162, 674
       00 00 10 00 
       00 00 01 00 
       CF 3F 04 A2 
       02 00       
043165 01 00 00 10 0124*   	dl 1, 16, 16, 256, fn_dg_163, 675
       00 00 10 00 
       00 00 01 00 
       E4 3F 04 A3 
       02 00       
043177 01 00 00 10 0125*   	dl 1, 16, 16, 256, fn_dg_164, 676
       00 00 10 00 
       00 00 01 00 
       F9 3F 04 A4 
       02 00       
043189 01 00 00 10 0126*   	dl 1, 16, 16, 256, fn_dg_165, 677
       00 00 10 00 
       00 00 01 00 
       0E 40 04 A5 
       02 00       
04319B 01 00 00 10 0127*   	dl 1, 16, 16, 256, fn_dg_166, 678
       00 00 10 00 
       00 00 01 00 
       23 40 04 A6 
       02 00       
0431AD 01 00 00 10 0128*   	dl 1, 16, 16, 256, fn_dg_167, 679
       00 00 10 00 
       00 00 01 00 
       38 40 04 A7 
       02 00       
0431BF 01 00 00 10 0129*   	dl 1, 16, 16, 256, fn_dg_168, 680
       00 00 10 00 
       00 00 01 00 
       4D 40 04 A8 
       02 00       
0431D1 01 00 00 10 0130*   	dl 1, 16, 16, 256, fn_dg_169, 681
       00 00 10 00 
       00 00 01 00 
       62 40 04 A9 
       02 00       
0431E3 01 00 00 10 0131*   	dl 1, 16, 16, 256, fn_dg_170, 682
       00 00 10 00 
       00 00 01 00 
       77 40 04 AA 
       02 00       
0431F5 01 00 00 10 0132*   	dl 1, 16, 16, 256, fn_dg_171, 683
       00 00 10 00 
       00 00 01 00 
       8C 40 04 AB 
       02 00       
043207 01 00 00 10 0133*   	dl 1, 16, 16, 256, fn_dg_172, 684
       00 00 10 00 
       00 00 01 00 
       A1 40 04 AC 
       02 00       
043219 01 00 00 10 0134*   	dl 1, 16, 16, 256, fn_dg_174, 686
       00 00 10 00 
       00 00 01 00 
       B6 40 04 AE 
       02 00       
04322B 01 00 00 10 0135*   	dl 1, 16, 16, 256, fn_dg_175, 687
       00 00 10 00 
       00 00 01 00 
       CB 40 04 AF 
       02 00       
04323D 01 00 00 10 0136*   	dl 1, 16, 16, 256, fn_dg_176, 688
       00 00 10 00 
       00 00 01 00 
       E0 40 04 B0 
       02 00       
04324F 01 00 00 10 0137*   	dl 1, 16, 16, 256, fn_dg_177, 689
       00 00 10 00 
       00 00 01 00 
       F5 40 04 B1 
       02 00       
043261 01 00 00 10 0138*   	dl 1, 16, 16, 256, fn_dg_178, 690
       00 00 10 00 
       00 00 01 00 
       0A 41 04 B2 
       02 00       
043273 01 00 00 10 0139*   	dl 1, 16, 16, 256, fn_dg_179, 691
       00 00 10 00 
       00 00 01 00 
       1F 41 04 B3 
       02 00       
043285 01 00 00 10 0140*   	dl 1, 16, 16, 256, fn_dg_180, 692
       00 00 10 00 
       00 00 01 00 
       34 41 04 B4 
       02 00       
043297 01 00 00 10 0141*   	dl 1, 16, 16, 256, fn_dg_181, 693
       00 00 10 00 
       00 00 01 00 
       49 41 04 B5 
       02 00       
0432A9 01 00 00 10 0142*   	dl 1, 16, 16, 256, fn_dg_182, 694
       00 00 10 00 
       00 00 01 00 
       5E 41 04 B6 
       02 00       
0432BB 01 00 00 10 0143*   	dl 1, 16, 16, 256, fn_dg_183, 695
       00 00 10 00 
       00 00 01 00 
       73 41 04 B7 
       02 00       
0432CD 01 00 00 10 0144*   	dl 1, 16, 16, 256, fn_dg_184, 696
       00 00 10 00 
       00 00 01 00 
       88 41 04 B8 
       02 00       
0432DF 01 00 00 10 0145*   	dl 1, 16, 16, 256, fn_dg_185, 697
       00 00 10 00 
       00 00 01 00 
       9D 41 04 B9 
       02 00       
0432F1 01 00 00 10 0146*   	dl 1, 16, 16, 256, fn_dg_186, 698
       00 00 10 00 
       00 00 01 00 
       B2 41 04 BA 
       02 00       
043303 01 00 00 10 0147*   	dl 1, 16, 16, 256, fn_dg_187, 699
       00 00 10 00 
       00 00 01 00 
       C7 41 04 BB 
       02 00       
043315 01 00 00 10 0148*   	dl 1, 16, 16, 256, fn_dg_188, 700
       00 00 10 00 
       00 00 01 00 
       DC 41 04 BC 
       02 00       
043327 01 00 00 10 0149*   	dl 1, 16, 16, 256, fn_dg_190, 702
       00 00 10 00 
       00 00 01 00 
       F1 41 04 BE 
       02 00       
043339 01 00 00 10 0150*   	dl 1, 16, 16, 256, fn_dg_191, 703
       00 00 10 00 
       00 00 01 00 
       06 42 04 BF 
       02 00       
04334B 01 00 00 10 0151*   	dl 1, 16, 16, 256, fn_dg_192, 704
       00 00 10 00 
       00 00 01 00 
       1B 42 04 C0 
       02 00       
04335D 01 00 00 10 0152*   	dl 1, 16, 16, 256, fn_dg_193, 705
       00 00 10 00 
       00 00 01 00 
       30 42 04 C1 
       02 00       
04336F 01 00 00 10 0153*   	dl 1, 16, 16, 256, fn_dg_194, 706
       00 00 10 00 
       00 00 01 00 
       45 42 04 C2 
       02 00       
043381 01 00 00 10 0154*   	dl 1, 16, 16, 256, fn_dg_195, 707
       00 00 10 00 
       00 00 01 00 
       5A 42 04 C3 
       02 00       
043393 01 00 00 10 0155*   	dl 1, 16, 16, 256, fn_dg_196, 708
       00 00 10 00 
       00 00 01 00 
       6F 42 04 C4 
       02 00       
0433A5 01 00 00 10 0156*   	dl 1, 16, 16, 256, fn_dg_197, 709
       00 00 10 00 
       00 00 01 00 
       84 42 04 C5 
       02 00       
0433B7 01 00 00 10 0157*   	dl 1, 16, 16, 256, fn_dg_198, 710
       00 00 10 00 
       00 00 01 00 
       99 42 04 C6 
       02 00       
0433C9 01 00 00 10 0158*   	dl 1, 16, 16, 256, fn_dg_199, 711
       00 00 10 00 
       00 00 01 00 
       AE 42 04 C7 
       02 00       
0433DB 01 00 00 10 0159*   	dl 1, 16, 16, 256, fn_dg_200, 712
       00 00 10 00 
       00 00 01 00 
       C3 42 04 C8 
       02 00       
0433ED 01 00 00 10 0160*   	dl 1, 16, 16, 256, fn_dg_201, 713
       00 00 10 00 
       00 00 01 00 
       D8 42 04 C9 
       02 00       
0433FF 01 00 00 10 0161*   	dl 1, 16, 16, 256, fn_dg_202, 714
       00 00 10 00 
       00 00 01 00 
       ED 42 04 CA 
       02 00       
043411 01 00 00 10 0162*   	dl 1, 16, 16, 256, fn_dg_203, 715
       00 00 10 00 
       00 00 01 00 
       02 43 04 CB 
       02 00       
043423 01 00 00 10 0163*   	dl 1, 16, 16, 256, fn_dg_204, 716
       00 00 10 00 
       00 00 01 00 
       17 43 04 CC 
       02 00       
043435 01 00 00 10 0164*   	dl 1, 16, 16, 256, fn_dg_206, 718
       00 00 10 00 
       00 00 01 00 
       2C 43 04 CE 
       02 00       
043447 01 00 00 10 0165*   	dl 1, 16, 16, 256, fn_dg_207, 719
       00 00 10 00 
       00 00 01 00 
       41 43 04 CF 
       02 00       
043459 01 00 00 10 0166*   	dl 1, 16, 16, 256, fn_dg_208, 720
       00 00 10 00 
       00 00 01 00 
       56 43 04 D0 
       02 00       
04346B 01 00 00 10 0167*   	dl 1, 16, 16, 256, fn_dg_209, 721
       00 00 10 00 
       00 00 01 00 
       6B 43 04 D1 
       02 00       
04347D 01 00 00 10 0168*   	dl 1, 16, 16, 256, fn_dg_210, 722
       00 00 10 00 
       00 00 01 00 
       80 43 04 D2 
       02 00       
04348F 01 00 00 10 0169*   	dl 1, 16, 16, 256, fn_dg_211, 723
       00 00 10 00 
       00 00 01 00 
       95 43 04 D3 
       02 00       
0434A1 01 00 00 10 0170*   	dl 1, 16, 16, 256, fn_dg_212, 724
       00 00 10 00 
       00 00 01 00 
       AA 43 04 D4 
       02 00       
0434B3 01 00 00 10 0171*   	dl 1, 16, 16, 256, fn_dg_213, 725
       00 00 10 00 
       00 00 01 00 
       BF 43 04 D5 
       02 00       
0434C5 01 00 00 10 0172*   	dl 1, 16, 16, 256, fn_dg_214, 726
       00 00 10 00 
       00 00 01 00 
       D4 43 04 D6 
       02 00       
0434D7 01 00 00 10 0173*   	dl 1, 16, 16, 256, fn_dg_215, 727
       00 00 10 00 
       00 00 01 00 
       E9 43 04 D7 
       02 00       
0434E9 01 00 00 10 0174*   	dl 1, 16, 16, 256, fn_dg_216, 728
       00 00 10 00 
       00 00 01 00 
       FE 43 04 D8 
       02 00       
0434FB 01 00 00 10 0175*   	dl 1, 16, 16, 256, fn_dg_217, 729
       00 00 10 00 
       00 00 01 00 
       13 44 04 D9 
       02 00       
04350D 01 00 00 10 0176*   	dl 1, 16, 16, 256, fn_dg_218, 730
       00 00 10 00 
       00 00 01 00 
       28 44 04 DA 
       02 00       
04351F 01 00 00 10 0177*   	dl 1, 16, 16, 256, fn_dg_219, 731
       00 00 10 00 
       00 00 01 00 
       3D 44 04 DB 
       02 00       
043531 01 00 00 10 0178*   	dl 1, 16, 16, 256, fn_dg_220, 732
       00 00 10 00 
       00 00 01 00 
       52 44 04 DC 
       02 00       
043543 01 00 00 10 0179*   	dl 1, 16, 16, 256, fn_dg_225, 737
       00 00 10 00 
       00 00 01 00 
       67 44 04 E1 
       02 00       
043555 01 00 00 10 0180*   	dl 1, 16, 16, 256, fn_dg_226, 738
       00 00 10 00 
       00 00 01 00 
       7C 44 04 E2 
       02 00       
043567 01 00 00 10 0181*   	dl 1, 16, 16, 256, fn_dg_227, 739
       00 00 10 00 
       00 00 01 00 
       91 44 04 E3 
       02 00       
043579 01 00 00 10 0182*   	dl 1, 16, 16, 256, fn_dg_228, 740
       00 00 10 00 
       00 00 01 00 
       A6 44 04 E4 
       02 00       
04358B 01 00 00 10 0183*   	dl 1, 16, 16, 256, fn_dg_229, 741
       00 00 10 00 
       00 00 01 00 
       BB 44 04 E5 
       02 00       
04359D 01 00 00 10 0184*   	dl 1, 16, 16, 256, fn_dg_230, 742
       00 00 10 00 
       00 00 01 00 
       D0 44 04 E6 
       02 00       
0435AF 01 00 00 10 0185*   	dl 1, 16, 16, 256, fn_dg_231, 743
       00 00 10 00 
       00 00 01 00 
       E5 44 04 E7 
       02 00       
0435C1 01 00 00 10 0186*   	dl 1, 16, 16, 256, fn_dg_232, 744
       00 00 10 00 
       00 00 01 00 
       FA 44 04 E8 
       02 00       
0435D3 01 00 00 10 0187*   	dl 1, 16, 16, 256, fn_dg_233, 745
       00 00 10 00 
       00 00 01 00 
       0F 45 04 E9 
       02 00       
0435E5 01 00 00 10 0188*   	dl 1, 16, 16, 256, fn_dg_234, 746
       00 00 10 00 
       00 00 01 00 
       24 45 04 EA 
       02 00       
0435F7 01 00 00 10 0189*   	dl 1, 16, 16, 256, fn_dg_235, 747
       00 00 10 00 
       00 00 01 00 
       39 45 04 EB 
       02 00       
043609 01 00 00 10 0190*   	dl 1, 16, 16, 256, fn_dg_236, 748
       00 00 10 00 
       00 00 01 00 
       4E 45 04 EC 
       02 00       
04361B 01 00 00 10 0191*   	dl 1, 16, 16, 256, fn_dg_241, 753
       00 00 10 00 
       00 00 01 00 
       63 45 04 F1 
       02 00       
04362D 01 00 00 10 0192*   	dl 1, 16, 16, 256, fn_dg_242, 754
       00 00 10 00 
       00 00 01 00 
       78 45 04 F2 
       02 00       
04363F 01 00 00 10 0193*   	dl 1, 16, 16, 256, fn_dg_245, 757
       00 00 10 00 
       00 00 01 00 
       8D 45 04 F5 
       02 00       
043651 01 00 00 10 0194*   	dl 1, 16, 16, 256, fn_dg_246, 758
       00 00 10 00 
       00 00 01 00 
       A2 45 04 F6 
       02 00       
043663 01 00 00 10 0195*   	dl 1, 16, 16, 256, fn_dg_248, 760
       00 00 10 00 
       00 00 01 00 
       B7 45 04 F8 
       02 00       
043675             0196*   
043675             0197*   tiles_dg_files_list: ; filename:
043675 74 69 6C 65 0198*   fn_dg_000: db "tiles/dg/0/000.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       30 30 2E 72 
       67 62 61 32 
       00          
04368A 74 69 6C 65 0199*   fn_dg_001: db "tiles/dg/0/001.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       30 31 2E 72 
       67 62 61 32 
       00          
04369F 74 69 6C 65 0200*   fn_dg_002: db "tiles/dg/0/002.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       30 32 2E 72 
       67 62 61 32 
       00          
0436B4 74 69 6C 65 0201*   fn_dg_003: db "tiles/dg/0/003.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       30 33 2E 72 
       67 62 61 32 
       00          
0436C9 74 69 6C 65 0202*   fn_dg_004: db "tiles/dg/0/004.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       30 34 2E 72 
       67 62 61 32 
       00          
0436DE 74 69 6C 65 0203*   fn_dg_005: db "tiles/dg/0/005.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       30 35 2E 72 
       67 62 61 32 
       00          
0436F3 74 69 6C 65 0204*   fn_dg_006: db "tiles/dg/0/006.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       30 36 2E 72 
       67 62 61 32 
       00          
043708 74 69 6C 65 0205*   fn_dg_007: db "tiles/dg/0/007.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       30 37 2E 72 
       67 62 61 32 
       00          
04371D 74 69 6C 65 0206*   fn_dg_008: db "tiles/dg/0/008.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       30 38 2E 72 
       67 62 61 32 
       00          
043732 74 69 6C 65 0207*   fn_dg_009: db "tiles/dg/0/009.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       30 39 2E 72 
       67 62 61 32 
       00          
043747 74 69 6C 65 0208*   fn_dg_010: db "tiles/dg/0/010.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       31 30 2E 72 
       67 62 61 32 
       00          
04375C 74 69 6C 65 0209*   fn_dg_011: db "tiles/dg/0/011.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       31 31 2E 72 
       67 62 61 32 
       00          
043771 74 69 6C 65 0210*   fn_dg_016: db "tiles/dg/0/016.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       31 36 2E 72 
       67 62 61 32 
       00          
043786 74 69 6C 65 0211*   fn_dg_033: db "tiles/dg/0/033.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       33 33 2E 72 
       67 62 61 32 
       00          
04379B 74 69 6C 65 0212*   fn_dg_034: db "tiles/dg/0/034.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       33 34 2E 72 
       67 62 61 32 
       00          
0437B0 74 69 6C 65 0213*   fn_dg_035: db "tiles/dg/0/035.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       33 35 2E 72 
       67 62 61 32 
       00          
0437C5 74 69 6C 65 0214*   fn_dg_036: db "tiles/dg/0/036.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       33 36 2E 72 
       67 62 61 32 
       00          
0437DA 74 69 6C 65 0215*   fn_dg_037: db "tiles/dg/0/037.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       33 37 2E 72 
       67 62 61 32 
       00          
0437EF 74 69 6C 65 0216*   fn_dg_038: db "tiles/dg/0/038.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       33 38 2E 72 
       67 62 61 32 
       00          
043804 74 69 6C 65 0217*   fn_dg_039: db "tiles/dg/0/039.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       33 39 2E 72 
       67 62 61 32 
       00          
043819 74 69 6C 65 0218*   fn_dg_040: db "tiles/dg/0/040.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       34 30 2E 72 
       67 62 61 32 
       00          
04382E 74 69 6C 65 0219*   fn_dg_045: db "tiles/dg/0/045.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       34 35 2E 72 
       67 62 61 32 
       00          
043843 74 69 6C 65 0220*   fn_dg_046: db "tiles/dg/0/046.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       34 36 2E 72 
       67 62 61 32 
       00          
043858 74 69 6C 65 0221*   fn_dg_047: db "tiles/dg/0/047.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       34 37 2E 72 
       67 62 61 32 
       00          
04386D 74 69 6C 65 0222*   fn_dg_048: db "tiles/dg/0/048.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       34 38 2E 72 
       67 62 61 32 
       00          
043882 74 69 6C 65 0223*   fn_dg_049: db "tiles/dg/0/049.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       34 39 2E 72 
       67 62 61 32 
       00          
043897 74 69 6C 65 0224*   fn_dg_050: db "tiles/dg/0/050.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       35 30 2E 72 
       67 62 61 32 
       00          
0438AC 74 69 6C 65 0225*   fn_dg_051: db "tiles/dg/0/051.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       35 31 2E 72 
       67 62 61 32 
       00          
0438C1 74 69 6C 65 0226*   fn_dg_052: db "tiles/dg/0/052.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       35 32 2E 72 
       67 62 61 32 
       00          
0438D6 74 69 6C 65 0227*   fn_dg_053: db "tiles/dg/0/053.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       35 33 2E 72 
       67 62 61 32 
       00          
0438EB 74 69 6C 65 0228*   fn_dg_054: db "tiles/dg/0/054.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       35 34 2E 72 
       67 62 61 32 
       00          
043900 74 69 6C 65 0229*   fn_dg_055: db "tiles/dg/0/055.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       35 35 2E 72 
       67 62 61 32 
       00          
043915 74 69 6C 65 0230*   fn_dg_056: db "tiles/dg/0/056.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       35 36 2E 72 
       67 62 61 32 
       00          
04392A 74 69 6C 65 0231*   fn_dg_057: db "tiles/dg/0/057.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       35 37 2E 72 
       67 62 61 32 
       00          
04393F 74 69 6C 65 0232*   fn_dg_058: db "tiles/dg/0/058.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       35 38 2E 72 
       67 62 61 32 
       00          
043954 74 69 6C 65 0233*   fn_dg_059: db "tiles/dg/0/059.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       35 39 2E 72 
       67 62 61 32 
       00          
043969 74 69 6C 65 0234*   fn_dg_061: db "tiles/dg/0/061.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       36 31 2E 72 
       67 62 61 32 
       00          
04397E 74 69 6C 65 0235*   fn_dg_062: db "tiles/dg/0/062.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       36 32 2E 72 
       67 62 61 32 
       00          
043993 74 69 6C 65 0236*   fn_dg_063: db "tiles/dg/0/063.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       36 33 2E 72 
       67 62 61 32 
       00          
0439A8 74 69 6C 65 0237*   fn_dg_064: db "tiles/dg/0/064.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       36 34 2E 72 
       67 62 61 32 
       00          
0439BD 74 69 6C 65 0238*   fn_dg_065: db "tiles/dg/0/065.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       36 35 2E 72 
       67 62 61 32 
       00          
0439D2 74 69 6C 65 0239*   fn_dg_066: db "tiles/dg/0/066.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       36 36 2E 72 
       67 62 61 32 
       00          
0439E7 74 69 6C 65 0240*   fn_dg_067: db "tiles/dg/0/067.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       36 37 2E 72 
       67 62 61 32 
       00          
0439FC 74 69 6C 65 0241*   fn_dg_068: db "tiles/dg/0/068.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       36 38 2E 72 
       67 62 61 32 
       00          
043A11 74 69 6C 65 0242*   fn_dg_069: db "tiles/dg/0/069.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       36 39 2E 72 
       67 62 61 32 
       00          
043A26 74 69 6C 65 0243*   fn_dg_070: db "tiles/dg/0/070.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       37 30 2E 72 
       67 62 61 32 
       00          
043A3B 74 69 6C 65 0244*   fn_dg_071: db "tiles/dg/0/071.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       37 31 2E 72 
       67 62 61 32 
       00          
043A50 74 69 6C 65 0245*   fn_dg_072: db "tiles/dg/0/072.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       37 32 2E 72 
       67 62 61 32 
       00          
043A65 74 69 6C 65 0246*   fn_dg_073: db "tiles/dg/0/073.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       37 33 2E 72 
       67 62 61 32 
       00          
043A7A 74 69 6C 65 0247*   fn_dg_074: db "tiles/dg/0/074.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       37 34 2E 72 
       67 62 61 32 
       00          
043A8F 74 69 6C 65 0248*   fn_dg_075: db "tiles/dg/0/075.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       37 35 2E 72 
       67 62 61 32 
       00          
043AA4 74 69 6C 65 0249*   fn_dg_076: db "tiles/dg/0/076.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       37 36 2E 72 
       67 62 61 32 
       00          
043AB9 74 69 6C 65 0250*   fn_dg_077: db "tiles/dg/0/077.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       37 37 2E 72 
       67 62 61 32 
       00          
043ACE 74 69 6C 65 0251*   fn_dg_081: db "tiles/dg/0/081.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       38 31 2E 72 
       67 62 61 32 
       00          
043AE3 74 69 6C 65 0252*   fn_dg_082: db "tiles/dg/0/082.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       38 32 2E 72 
       67 62 61 32 
       00          
043AF8 74 69 6C 65 0253*   fn_dg_083: db "tiles/dg/0/083.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       38 33 2E 72 
       67 62 61 32 
       00          
043B0D 74 69 6C 65 0254*   fn_dg_084: db "tiles/dg/0/084.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       38 34 2E 72 
       67 62 61 32 
       00          
043B22 74 69 6C 65 0255*   fn_dg_085: db "tiles/dg/0/085.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       38 35 2E 72 
       67 62 61 32 
       00          
043B37 74 69 6C 65 0256*   fn_dg_086: db "tiles/dg/0/086.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       38 36 2E 72 
       67 62 61 32 
       00          
043B4C 74 69 6C 65 0257*   fn_dg_087: db "tiles/dg/0/087.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       38 37 2E 72 
       67 62 61 32 
       00          
043B61 74 69 6C 65 0258*   fn_dg_088: db "tiles/dg/0/088.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       38 38 2E 72 
       67 62 61 32 
       00          
043B76 74 69 6C 65 0259*   fn_dg_089: db "tiles/dg/0/089.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       38 39 2E 72 
       67 62 61 32 
       00          
043B8B 74 69 6C 65 0260*   fn_dg_090: db "tiles/dg/0/090.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       39 30 2E 72 
       67 62 61 32 
       00          
043BA0 74 69 6C 65 0261*   fn_dg_091: db "tiles/dg/0/091.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       39 31 2E 72 
       67 62 61 32 
       00          
043BB5 74 69 6C 65 0262*   fn_dg_092: db "tiles/dg/0/092.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       39 32 2E 72 
       67 62 61 32 
       00          
043BCA 74 69 6C 65 0263*   fn_dg_093: db "tiles/dg/0/093.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       39 33 2E 72 
       67 62 61 32 
       00          
043BDF 74 69 6C 65 0264*   fn_dg_097: db "tiles/dg/0/097.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       39 37 2E 72 
       67 62 61 32 
       00          
043BF4 74 69 6C 65 0265*   fn_dg_098: db "tiles/dg/0/098.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       39 38 2E 72 
       67 62 61 32 
       00          
043C09 74 69 6C 65 0266*   fn_dg_099: db "tiles/dg/0/099.rgba2",0
       73 2F 64 67 
       2F 30 2F 30 
       39 39 2E 72 
       67 62 61 32 
       00          
043C1E 74 69 6C 65 0267*   fn_dg_100: db "tiles/dg/0/100.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       30 30 2E 72 
       67 62 61 32 
       00          
043C33 74 69 6C 65 0268*   fn_dg_101: db "tiles/dg/0/101.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       30 31 2E 72 
       67 62 61 32 
       00          
043C48 74 69 6C 65 0269*   fn_dg_102: db "tiles/dg/0/102.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       30 32 2E 72 
       67 62 61 32 
       00          
043C5D 74 69 6C 65 0270*   fn_dg_103: db "tiles/dg/0/103.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       30 33 2E 72 
       67 62 61 32 
       00          
043C72 74 69 6C 65 0271*   fn_dg_104: db "tiles/dg/0/104.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       30 34 2E 72 
       67 62 61 32 
       00          
043C87 74 69 6C 65 0272*   fn_dg_105: db "tiles/dg/0/105.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       30 35 2E 72 
       67 62 61 32 
       00          
043C9C 74 69 6C 65 0273*   fn_dg_106: db "tiles/dg/0/106.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       30 36 2E 72 
       67 62 61 32 
       00          
043CB1 74 69 6C 65 0274*   fn_dg_107: db "tiles/dg/0/107.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       30 37 2E 72 
       67 62 61 32 
       00          
043CC6 74 69 6C 65 0275*   fn_dg_108: db "tiles/dg/0/108.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       30 38 2E 72 
       67 62 61 32 
       00          
043CDB 74 69 6C 65 0276*   fn_dg_113: db "tiles/dg/0/113.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       31 33 2E 72 
       67 62 61 32 
       00          
043CF0 74 69 6C 65 0277*   fn_dg_114: db "tiles/dg/0/114.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       31 34 2E 72 
       67 62 61 32 
       00          
043D05 74 69 6C 65 0278*   fn_dg_115: db "tiles/dg/0/115.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       31 35 2E 72 
       67 62 61 32 
       00          
043D1A 74 69 6C 65 0279*   fn_dg_116: db "tiles/dg/0/116.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       31 36 2E 72 
       67 62 61 32 
       00          
043D2F 74 69 6C 65 0280*   fn_dg_117: db "tiles/dg/0/117.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       31 37 2E 72 
       67 62 61 32 
       00          
043D44 74 69 6C 65 0281*   fn_dg_118: db "tiles/dg/0/118.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       31 38 2E 72 
       67 62 61 32 
       00          
043D59 74 69 6C 65 0282*   fn_dg_119: db "tiles/dg/0/119.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       31 39 2E 72 
       67 62 61 32 
       00          
043D6E 74 69 6C 65 0283*   fn_dg_120: db "tiles/dg/0/120.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       32 30 2E 72 
       67 62 61 32 
       00          
043D83 74 69 6C 65 0284*   fn_dg_121: db "tiles/dg/0/121.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       32 31 2E 72 
       67 62 61 32 
       00          
043D98 74 69 6C 65 0285*   fn_dg_122: db "tiles/dg/0/122.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       32 32 2E 72 
       67 62 61 32 
       00          
043DAD 74 69 6C 65 0286*   fn_dg_123: db "tiles/dg/0/123.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       32 33 2E 72 
       67 62 61 32 
       00          
043DC2 74 69 6C 65 0287*   fn_dg_129: db "tiles/dg/0/129.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       32 39 2E 72 
       67 62 61 32 
       00          
043DD7 74 69 6C 65 0288*   fn_dg_130: db "tiles/dg/0/130.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       33 30 2E 72 
       67 62 61 32 
       00          
043DEC 74 69 6C 65 0289*   fn_dg_131: db "tiles/dg/0/131.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       33 31 2E 72 
       67 62 61 32 
       00          
043E01 74 69 6C 65 0290*   fn_dg_132: db "tiles/dg/0/132.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       33 32 2E 72 
       67 62 61 32 
       00          
043E16 74 69 6C 65 0291*   fn_dg_133: db "tiles/dg/0/133.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       33 33 2E 72 
       67 62 61 32 
       00          
043E2B 74 69 6C 65 0292*   fn_dg_134: db "tiles/dg/0/134.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       33 34 2E 72 
       67 62 61 32 
       00          
043E40 74 69 6C 65 0293*   fn_dg_135: db "tiles/dg/0/135.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       33 35 2E 72 
       67 62 61 32 
       00          
043E55 74 69 6C 65 0294*   fn_dg_136: db "tiles/dg/0/136.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       33 36 2E 72 
       67 62 61 32 
       00          
043E6A 74 69 6C 65 0295*   fn_dg_137: db "tiles/dg/0/137.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       33 37 2E 72 
       67 62 61 32 
       00          
043E7F 74 69 6C 65 0296*   fn_dg_138: db "tiles/dg/0/138.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       33 38 2E 72 
       67 62 61 32 
       00          
043E94 74 69 6C 65 0297*   fn_dg_139: db "tiles/dg/0/139.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       33 39 2E 72 
       67 62 61 32 
       00          
043EA9 74 69 6C 65 0298*   fn_dg_140: db "tiles/dg/0/140.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       34 30 2E 72 
       67 62 61 32 
       00          
043EBE 74 69 6C 65 0299*   fn_dg_145: db "tiles/dg/0/145.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       34 35 2E 72 
       67 62 61 32 
       00          
043ED3 74 69 6C 65 0300*   fn_dg_146: db "tiles/dg/0/146.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       34 36 2E 72 
       67 62 61 32 
       00          
043EE8 74 69 6C 65 0301*   fn_dg_147: db "tiles/dg/0/147.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       34 37 2E 72 
       67 62 61 32 
       00          
043EFD 74 69 6C 65 0302*   fn_dg_148: db "tiles/dg/0/148.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       34 38 2E 72 
       67 62 61 32 
       00          
043F12 74 69 6C 65 0303*   fn_dg_149: db "tiles/dg/0/149.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       34 39 2E 72 
       67 62 61 32 
       00          
043F27 74 69 6C 65 0304*   fn_dg_150: db "tiles/dg/0/150.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       35 30 2E 72 
       67 62 61 32 
       00          
043F3C 74 69 6C 65 0305*   fn_dg_151: db "tiles/dg/0/151.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       35 31 2E 72 
       67 62 61 32 
       00          
043F51 74 69 6C 65 0306*   fn_dg_152: db "tiles/dg/0/152.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       35 32 2E 72 
       67 62 61 32 
       00          
043F66 74 69 6C 65 0307*   fn_dg_153: db "tiles/dg/0/153.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       35 33 2E 72 
       67 62 61 32 
       00          
043F7B 74 69 6C 65 0308*   fn_dg_154: db "tiles/dg/0/154.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       35 34 2E 72 
       67 62 61 32 
       00          
043F90 74 69 6C 65 0309*   fn_dg_155: db "tiles/dg/0/155.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       35 35 2E 72 
       67 62 61 32 
       00          
043FA5 74 69 6C 65 0310*   fn_dg_156: db "tiles/dg/0/156.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       35 36 2E 72 
       67 62 61 32 
       00          
043FBA 74 69 6C 65 0311*   fn_dg_161: db "tiles/dg/0/161.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       36 31 2E 72 
       67 62 61 32 
       00          
043FCF 74 69 6C 65 0312*   fn_dg_162: db "tiles/dg/0/162.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       36 32 2E 72 
       67 62 61 32 
       00          
043FE4 74 69 6C 65 0313*   fn_dg_163: db "tiles/dg/0/163.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       36 33 2E 72 
       67 62 61 32 
       00          
043FF9 74 69 6C 65 0314*   fn_dg_164: db "tiles/dg/0/164.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       36 34 2E 72 
       67 62 61 32 
       00          
04400E 74 69 6C 65 0315*   fn_dg_165: db "tiles/dg/0/165.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       36 35 2E 72 
       67 62 61 32 
       00          
044023 74 69 6C 65 0316*   fn_dg_166: db "tiles/dg/0/166.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       36 36 2E 72 
       67 62 61 32 
       00          
044038 74 69 6C 65 0317*   fn_dg_167: db "tiles/dg/0/167.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       36 37 2E 72 
       67 62 61 32 
       00          
04404D 74 69 6C 65 0318*   fn_dg_168: db "tiles/dg/0/168.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       36 38 2E 72 
       67 62 61 32 
       00          
044062 74 69 6C 65 0319*   fn_dg_169: db "tiles/dg/0/169.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       36 39 2E 72 
       67 62 61 32 
       00          
044077 74 69 6C 65 0320*   fn_dg_170: db "tiles/dg/0/170.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       37 30 2E 72 
       67 62 61 32 
       00          
04408C 74 69 6C 65 0321*   fn_dg_171: db "tiles/dg/0/171.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       37 31 2E 72 
       67 62 61 32 
       00          
0440A1 74 69 6C 65 0322*   fn_dg_172: db "tiles/dg/0/172.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       37 32 2E 72 
       67 62 61 32 
       00          
0440B6 74 69 6C 65 0323*   fn_dg_174: db "tiles/dg/0/174.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       37 34 2E 72 
       67 62 61 32 
       00          
0440CB 74 69 6C 65 0324*   fn_dg_175: db "tiles/dg/0/175.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       37 35 2E 72 
       67 62 61 32 
       00          
0440E0 74 69 6C 65 0325*   fn_dg_176: db "tiles/dg/0/176.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       37 36 2E 72 
       67 62 61 32 
       00          
0440F5 74 69 6C 65 0326*   fn_dg_177: db "tiles/dg/0/177.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       37 37 2E 72 
       67 62 61 32 
       00          
04410A 74 69 6C 65 0327*   fn_dg_178: db "tiles/dg/0/178.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       37 38 2E 72 
       67 62 61 32 
       00          
04411F 74 69 6C 65 0328*   fn_dg_179: db "tiles/dg/0/179.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       37 39 2E 72 
       67 62 61 32 
       00          
044134 74 69 6C 65 0329*   fn_dg_180: db "tiles/dg/0/180.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       38 30 2E 72 
       67 62 61 32 
       00          
044149 74 69 6C 65 0330*   fn_dg_181: db "tiles/dg/0/181.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       38 31 2E 72 
       67 62 61 32 
       00          
04415E 74 69 6C 65 0331*   fn_dg_182: db "tiles/dg/0/182.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       38 32 2E 72 
       67 62 61 32 
       00          
044173 74 69 6C 65 0332*   fn_dg_183: db "tiles/dg/0/183.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       38 33 2E 72 
       67 62 61 32 
       00          
044188 74 69 6C 65 0333*   fn_dg_184: db "tiles/dg/0/184.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       38 34 2E 72 
       67 62 61 32 
       00          
04419D 74 69 6C 65 0334*   fn_dg_185: db "tiles/dg/0/185.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       38 35 2E 72 
       67 62 61 32 
       00          
0441B2 74 69 6C 65 0335*   fn_dg_186: db "tiles/dg/0/186.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       38 36 2E 72 
       67 62 61 32 
       00          
0441C7 74 69 6C 65 0336*   fn_dg_187: db "tiles/dg/0/187.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       38 37 2E 72 
       67 62 61 32 
       00          
0441DC 74 69 6C 65 0337*   fn_dg_188: db "tiles/dg/0/188.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       38 38 2E 72 
       67 62 61 32 
       00          
0441F1 74 69 6C 65 0338*   fn_dg_190: db "tiles/dg/0/190.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       39 30 2E 72 
       67 62 61 32 
       00          
044206 74 69 6C 65 0339*   fn_dg_191: db "tiles/dg/0/191.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       39 31 2E 72 
       67 62 61 32 
       00          
04421B 74 69 6C 65 0340*   fn_dg_192: db "tiles/dg/0/192.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       39 32 2E 72 
       67 62 61 32 
       00          
044230 74 69 6C 65 0341*   fn_dg_193: db "tiles/dg/0/193.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       39 33 2E 72 
       67 62 61 32 
       00          
044245 74 69 6C 65 0342*   fn_dg_194: db "tiles/dg/0/194.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       39 34 2E 72 
       67 62 61 32 
       00          
04425A 74 69 6C 65 0343*   fn_dg_195: db "tiles/dg/0/195.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       39 35 2E 72 
       67 62 61 32 
       00          
04426F 74 69 6C 65 0344*   fn_dg_196: db "tiles/dg/0/196.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       39 36 2E 72 
       67 62 61 32 
       00          
044284 74 69 6C 65 0345*   fn_dg_197: db "tiles/dg/0/197.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       39 37 2E 72 
       67 62 61 32 
       00          
044299 74 69 6C 65 0346*   fn_dg_198: db "tiles/dg/0/198.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       39 38 2E 72 
       67 62 61 32 
       00          
0442AE 74 69 6C 65 0347*   fn_dg_199: db "tiles/dg/0/199.rgba2",0
       73 2F 64 67 
       2F 30 2F 31 
       39 39 2E 72 
       67 62 61 32 
       00          
0442C3 74 69 6C 65 0348*   fn_dg_200: db "tiles/dg/0/200.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       30 30 2E 72 
       67 62 61 32 
       00          
0442D8 74 69 6C 65 0349*   fn_dg_201: db "tiles/dg/0/201.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       30 31 2E 72 
       67 62 61 32 
       00          
0442ED 74 69 6C 65 0350*   fn_dg_202: db "tiles/dg/0/202.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       30 32 2E 72 
       67 62 61 32 
       00          
044302 74 69 6C 65 0351*   fn_dg_203: db "tiles/dg/0/203.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       30 33 2E 72 
       67 62 61 32 
       00          
044317 74 69 6C 65 0352*   fn_dg_204: db "tiles/dg/0/204.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       30 34 2E 72 
       67 62 61 32 
       00          
04432C 74 69 6C 65 0353*   fn_dg_206: db "tiles/dg/0/206.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       30 36 2E 72 
       67 62 61 32 
       00          
044341 74 69 6C 65 0354*   fn_dg_207: db "tiles/dg/0/207.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       30 37 2E 72 
       67 62 61 32 
       00          
044356 74 69 6C 65 0355*   fn_dg_208: db "tiles/dg/0/208.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       30 38 2E 72 
       67 62 61 32 
       00          
04436B 74 69 6C 65 0356*   fn_dg_209: db "tiles/dg/0/209.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       30 39 2E 72 
       67 62 61 32 
       00          
044380 74 69 6C 65 0357*   fn_dg_210: db "tiles/dg/0/210.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       31 30 2E 72 
       67 62 61 32 
       00          
044395 74 69 6C 65 0358*   fn_dg_211: db "tiles/dg/0/211.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       31 31 2E 72 
       67 62 61 32 
       00          
0443AA 74 69 6C 65 0359*   fn_dg_212: db "tiles/dg/0/212.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       31 32 2E 72 
       67 62 61 32 
       00          
0443BF 74 69 6C 65 0360*   fn_dg_213: db "tiles/dg/0/213.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       31 33 2E 72 
       67 62 61 32 
       00          
0443D4 74 69 6C 65 0361*   fn_dg_214: db "tiles/dg/0/214.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       31 34 2E 72 
       67 62 61 32 
       00          
0443E9 74 69 6C 65 0362*   fn_dg_215: db "tiles/dg/0/215.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       31 35 2E 72 
       67 62 61 32 
       00          
0443FE 74 69 6C 65 0363*   fn_dg_216: db "tiles/dg/0/216.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       31 36 2E 72 
       67 62 61 32 
       00          
044413 74 69 6C 65 0364*   fn_dg_217: db "tiles/dg/0/217.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       31 37 2E 72 
       67 62 61 32 
       00          
044428 74 69 6C 65 0365*   fn_dg_218: db "tiles/dg/0/218.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       31 38 2E 72 
       67 62 61 32 
       00          
04443D 74 69 6C 65 0366*   fn_dg_219: db "tiles/dg/0/219.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       31 39 2E 72 
       67 62 61 32 
       00          
044452 74 69 6C 65 0367*   fn_dg_220: db "tiles/dg/0/220.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       32 30 2E 72 
       67 62 61 32 
       00          
044467 74 69 6C 65 0368*   fn_dg_225: db "tiles/dg/0/225.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       32 35 2E 72 
       67 62 61 32 
       00          
04447C 74 69 6C 65 0369*   fn_dg_226: db "tiles/dg/0/226.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       32 36 2E 72 
       67 62 61 32 
       00          
044491 74 69 6C 65 0370*   fn_dg_227: db "tiles/dg/0/227.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       32 37 2E 72 
       67 62 61 32 
       00          
0444A6 74 69 6C 65 0371*   fn_dg_228: db "tiles/dg/0/228.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       32 38 2E 72 
       67 62 61 32 
       00          
0444BB 74 69 6C 65 0372*   fn_dg_229: db "tiles/dg/0/229.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       32 39 2E 72 
       67 62 61 32 
       00          
0444D0 74 69 6C 65 0373*   fn_dg_230: db "tiles/dg/0/230.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       33 30 2E 72 
       67 62 61 32 
       00          
0444E5 74 69 6C 65 0374*   fn_dg_231: db "tiles/dg/0/231.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       33 31 2E 72 
       67 62 61 32 
       00          
0444FA 74 69 6C 65 0375*   fn_dg_232: db "tiles/dg/0/232.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       33 32 2E 72 
       67 62 61 32 
       00          
04450F 74 69 6C 65 0376*   fn_dg_233: db "tiles/dg/0/233.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       33 33 2E 72 
       67 62 61 32 
       00          
044524 74 69 6C 65 0377*   fn_dg_234: db "tiles/dg/0/234.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       33 34 2E 72 
       67 62 61 32 
       00          
044539 74 69 6C 65 0378*   fn_dg_235: db "tiles/dg/0/235.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       33 35 2E 72 
       67 62 61 32 
       00          
04454E 74 69 6C 65 0379*   fn_dg_236: db "tiles/dg/0/236.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       33 36 2E 72 
       67 62 61 32 
       00          
044563 74 69 6C 65 0380*   fn_dg_241: db "tiles/dg/0/241.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       34 31 2E 72 
       67 62 61 32 
       00          
044578 74 69 6C 65 0381*   fn_dg_242: db "tiles/dg/0/242.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       34 32 2E 72 
       67 62 61 32 
       00          
04458D 74 69 6C 65 0382*   fn_dg_245: db "tiles/dg/0/245.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       34 35 2E 72 
       67 62 61 32 
       00          
0445A2 74 69 6C 65 0383*   fn_dg_246: db "tiles/dg/0/246.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       34 36 2E 72 
       67 62 61 32 
       00          
0445B7 74 69 6C 65 0384*   fn_dg_248: db "tiles/dg/0/248.rgba2",0
       73 2F 64 67 
       2F 30 2F 32 
       34 38 2E 72 
       67 62 61 32 
       00          
0445CC             0054        include "images_sprites.inc"
0445CC             0001*   ; Generated by make_images.py
0445CC             0002*   
0445CC             0003*   sprites_num_images: equ 157
0445CC             0004*   
0445CC             0005*   ; buffer_ids:
0445CC             0006*   BUF_CRATER: equ 256
0445CC             0007*   BUF_CRATER_0: equ 257
0445CC             0008*   BUF_CRATER_1: equ 258
0445CC             0009*   BUF_CRATER_2: equ 259
0445CC             0010*   BUF_CRATER_3: equ 260
0445CC             0011*   BUF_EXPLOSION_A: equ 261
0445CC             0012*   BUF_EXPLOSION_B: equ 262
0445CC             0013*   BUF_EXPLOSION_C: equ 263
0445CC             0014*   BUF_EXPLOSION_D: equ 264
0445CC             0015*   BUF_EXPLOSION_E: equ 265
0445CC             0016*   BUF_FIREBALL_2_000: equ 266
0445CC             0017*   BUF_FIREBALL_2_008: equ 267
0445CC             0018*   BUF_FIREBALL_2_016: equ 268
0445CC             0019*   BUF_FIREBALL_2_024: equ 269
0445CC             0020*   BUF_FIREBALL_2_032: equ 270
0445CC             0021*   BUF_FIREBALL_2_040: equ 271
0445CC             0022*   BUF_FIREBALL_2_048: equ 272
0445CC             0023*   BUF_FIREBALL_2_056: equ 273
0445CC             0024*   BUF_FIREBALL_2_064: equ 274
0445CC             0025*   BUF_FIREBALL_2_072: equ 275
0445CC             0026*   BUF_FIREBALL_2_080: equ 276
0445CC             0027*   BUF_FIREBALL_2_088: equ 277
0445CC             0028*   BUF_FIREBALL_2_096: equ 278
0445CC             0029*   BUF_FIREBALL_2_104: equ 279
0445CC             0030*   BUF_FIREBALL_2_112: equ 280
0445CC             0031*   BUF_FIREBALL_2_120: equ 281
0445CC             0032*   BUF_FIREBALL_2_128: equ 282
0445CC             0033*   BUF_FIREBALL_2_136: equ 283
0445CC             0034*   BUF_FIREBALL_2_144: equ 284
0445CC             0035*   BUF_FIREBALL_2_152: equ 285
0445CC             0036*   BUF_FIREBALL_2_160: equ 286
0445CC             0037*   BUF_FIREBALL_2_168: equ 287
0445CC             0038*   BUF_FIREBALL_2_176: equ 288
0445CC             0039*   BUF_FIREBALL_2_184: equ 289
0445CC             0040*   BUF_FIREBALL_2_192: equ 290
0445CC             0041*   BUF_FIREBALL_2_200: equ 291
0445CC             0042*   BUF_FIREBALL_2_208: equ 292
0445CC             0043*   BUF_FIREBALL_2_216: equ 293
0445CC             0044*   BUF_FIREBALL_2_224: equ 294
0445CC             0045*   BUF_FIREBALL_2_232: equ 295
0445CC             0046*   BUF_FIREBALL_2_240: equ 296
0445CC             0047*   BUF_FIREBALL_2_248: equ 297
0445CC             0048*   BUF_FIREBALL_3_000: equ 298
0445CC             0049*   BUF_FIREBALL_3_008: equ 299
0445CC             0050*   BUF_FIREBALL_3_016: equ 300
0445CC             0051*   BUF_FIREBALL_3_024: equ 301
0445CC             0052*   BUF_FIREBALL_3_032: equ 302
0445CC             0053*   BUF_FIREBALL_3_040: equ 303
0445CC             0054*   BUF_FIREBALL_3_048: equ 304
0445CC             0055*   BUF_FIREBALL_3_056: equ 305
0445CC             0056*   BUF_FIREBALL_3_064: equ 306
0445CC             0057*   BUF_FIREBALL_3_072: equ 307
0445CC             0058*   BUF_FIREBALL_3_080: equ 308
0445CC             0059*   BUF_FIREBALL_3_088: equ 309
0445CC             0060*   BUF_FIREBALL_3_096: equ 310
0445CC             0061*   BUF_FIREBALL_3_104: equ 311
0445CC             0062*   BUF_FIREBALL_3_112: equ 312
0445CC             0063*   BUF_FIREBALL_3_120: equ 313
0445CC             0064*   BUF_FIREBALL_3_128: equ 314
0445CC             0065*   BUF_FIREBALL_3_136: equ 315
0445CC             0066*   BUF_FIREBALL_3_144: equ 316
0445CC             0067*   BUF_FIREBALL_3_152: equ 317
0445CC             0068*   BUF_FIREBALL_3_160: equ 318
0445CC             0069*   BUF_FIREBALL_3_168: equ 319
0445CC             0070*   BUF_FIREBALL_3_176: equ 320
0445CC             0071*   BUF_FIREBALL_3_184: equ 321
0445CC             0072*   BUF_FIREBALL_3_192: equ 322
0445CC             0073*   BUF_FIREBALL_3_200: equ 323
0445CC             0074*   BUF_FIREBALL_3_208: equ 324
0445CC             0075*   BUF_FIREBALL_3_216: equ 325
0445CC             0076*   BUF_FIREBALL_3_224: equ 326
0445CC             0077*   BUF_FIREBALL_3_232: equ 327
0445CC             0078*   BUF_FIREBALL_3_240: equ 328
0445CC             0079*   BUF_FIREBALL_3_248: equ 329
0445CC             0080*   BUF_LASER_A: equ 330
0445CC             0081*   BUF_LASER_B: equ 331
0445CC             0082*   BUF_LIGHTNING_H_0: equ 332
0445CC             0083*   BUF_LIGHTNING_H_1: equ 333
0445CC             0084*   BUF_PAD: equ 334
0445CC             0085*   BUF_SEEKER_000: equ 335
0445CC             0086*   BUF_SEEKER_008: equ 336
0445CC             0087*   BUF_SEEKER_016: equ 337
0445CC             0088*   BUF_SEEKER_024: equ 338
0445CC             0089*   BUF_SEEKER_032: equ 339
0445CC             0090*   BUF_SEEKER_040: equ 340
0445CC             0091*   BUF_SEEKER_048: equ 341
0445CC             0092*   BUF_SEEKER_056: equ 342
0445CC             0093*   BUF_SEEKER_064: equ 343
0445CC             0094*   BUF_SEEKER_072: equ 344
0445CC             0095*   BUF_SEEKER_080: equ 345
0445CC             0096*   BUF_SEEKER_088: equ 346
0445CC             0097*   BUF_SEEKER_096: equ 347
0445CC             0098*   BUF_SEEKER_104: equ 348
0445CC             0099*   BUF_SEEKER_112: equ 349
0445CC             0100*   BUF_SEEKER_120: equ 350
0445CC             0101*   BUF_SEEKER_128: equ 351
0445CC             0102*   BUF_SEEKER_136: equ 352
0445CC             0103*   BUF_SEEKER_144: equ 353
0445CC             0104*   BUF_SEEKER_152: equ 354
0445CC             0105*   BUF_SEEKER_160: equ 355
0445CC             0106*   BUF_SEEKER_168: equ 356
0445CC             0107*   BUF_SEEKER_176: equ 357
0445CC             0108*   BUF_SEEKER_184: equ 358
0445CC             0109*   BUF_SEEKER_192: equ 359
0445CC             0110*   BUF_SEEKER_200: equ 360
0445CC             0111*   BUF_SEEKER_208: equ 361
0445CC             0112*   BUF_SEEKER_216: equ 362
0445CC             0113*   BUF_SEEKER_224: equ 363
0445CC             0114*   BUF_SEEKER_232: equ 364
0445CC             0115*   BUF_SEEKER_240: equ 365
0445CC             0116*   BUF_SEEKER_248: equ 366
0445CC             0117*   BUF_SHIP_0L: equ 367
0445CC             0118*   BUF_SHIP_1C: equ 368
0445CC             0119*   BUF_SHIP_2R: equ 369
0445CC             0120*   BUF_SHIP_SMALL: equ 370
0445CC             0121*   BUF_TEST_STRIPES: equ 371
0445CC             0122*   BUF_TILE_BLANK: equ 372
0445CC             0123*   BUF_TILE_PAD_0: equ 373
0445CC             0124*   BUF_TILE_PAD_1: equ 374
0445CC             0125*   BUF_TILE_PAD_2: equ 375
0445CC             0126*   BUF_TILE_PAD_3: equ 376
0445CC             0127*   BUF_TILE_PAD_4: equ 377
0445CC             0128*   BUF_TILE_PAD_5: equ 378
0445CC             0129*   BUF_TILE_PAD_6: equ 379
0445CC             0130*   BUF_TILE_PAD_7: equ 380
0445CC             0131*   BUF_TURRET_000: equ 381
0445CC             0132*   BUF_TURRET_008: equ 382
0445CC             0133*   BUF_TURRET_016: equ 383
0445CC             0134*   BUF_TURRET_024: equ 384
0445CC             0135*   BUF_TURRET_032: equ 385
0445CC             0136*   BUF_TURRET_040: equ 386
0445CC             0137*   BUF_TURRET_048: equ 387
0445CC             0138*   BUF_TURRET_056: equ 388
0445CC             0139*   BUF_TURRET_064: equ 389
0445CC             0140*   BUF_TURRET_072: equ 390
0445CC             0141*   BUF_TURRET_080: equ 391
0445CC             0142*   BUF_TURRET_088: equ 392
0445CC             0143*   BUF_TURRET_096: equ 393
0445CC             0144*   BUF_TURRET_104: equ 394
0445CC             0145*   BUF_TURRET_112: equ 395
0445CC             0146*   BUF_TURRET_120: equ 396
0445CC             0147*   BUF_TURRET_128: equ 397
0445CC             0148*   BUF_TURRET_136: equ 398
0445CC             0149*   BUF_TURRET_144: equ 399
0445CC             0150*   BUF_TURRET_152: equ 400
0445CC             0151*   BUF_TURRET_160: equ 401
0445CC             0152*   BUF_TURRET_168: equ 402
0445CC             0153*   BUF_TURRET_176: equ 403
0445CC             0154*   BUF_TURRET_184: equ 404
0445CC             0155*   BUF_TURRET_192: equ 405
0445CC             0156*   BUF_TURRET_200: equ 406
0445CC             0157*   BUF_TURRET_208: equ 407
0445CC             0158*   BUF_TURRET_216: equ 408
0445CC             0159*   BUF_TURRET_224: equ 409
0445CC             0160*   BUF_TURRET_232: equ 410
0445CC             0161*   BUF_TURRET_240: equ 411
0445CC             0162*   BUF_TURRET_248: equ 412
0445CC             0163*   
0445CC             0164*   sprites_image_list: ; type; width; height; size; filename; bufferId:
0445CC 01 00 00 10 0165*   	dl 1, 16, 16, 256, fn_crater, 256
       00 00 10 00 
       00 00 01 00 
       D6 50 04 00 
       01 00       
0445DE 01 00 00 10 0166*   	dl 1, 16, 16, 256, fn_crater_0, 257
       00 00 10 00 
       00 00 01 00 
       EB 50 04 01 
       01 00       
0445F0 01 00 00 10 0167*   	dl 1, 16, 16, 256, fn_crater_1, 258
       00 00 10 00 
       00 00 01 00 
       02 51 04 02 
       01 00       
044602 01 00 00 10 0168*   	dl 1, 16, 16, 256, fn_crater_2, 259
       00 00 10 00 
       00 00 01 00 
       19 51 04 03 
       01 00       
044614 01 00 00 10 0169*   	dl 1, 16, 16, 256, fn_crater_3, 260
       00 00 10 00 
       00 00 01 00 
       30 51 04 04 
       01 00       
044626 01 00 00 10 0170*   	dl 1, 16, 16, 256, fn_explosion_a, 261
       00 00 10 00 
       00 00 01 00 
       47 51 04 05 
       01 00       
044638 01 00 00 10 0171*   	dl 1, 16, 16, 256, fn_explosion_b, 262
       00 00 10 00 
       00 00 01 00 
       61 51 04 06 
       01 00       
04464A 01 00 00 10 0172*   	dl 1, 16, 16, 256, fn_explosion_c, 263
       00 00 10 00 
       00 00 01 00 
       7B 51 04 07 
       01 00       
04465C 01 00 00 10 0173*   	dl 1, 16, 16, 256, fn_explosion_d, 264
       00 00 10 00 
       00 00 01 00 
       95 51 04 08 
       01 00       
04466E 01 00 00 10 0174*   	dl 1, 16, 16, 256, fn_explosion_e, 265
       00 00 10 00 
       00 00 01 00 
       AF 51 04 09 
       01 00       
044680 01 00 00 10 0175*   	dl 1, 16, 16, 256, fn_fireball_2_000, 266
       00 00 10 00 
       00 00 01 00 
       C9 51 04 0A 
       01 00       
044692 01 00 00 10 0176*   	dl 1, 16, 16, 256, fn_fireball_2_008, 267
       00 00 10 00 
       00 00 01 00 
       E6 51 04 0B 
       01 00       
0446A4 01 00 00 10 0177*   	dl 1, 16, 16, 256, fn_fireball_2_016, 268
       00 00 10 00 
       00 00 01 00 
       03 52 04 0C 
       01 00       
0446B6 01 00 00 10 0178*   	dl 1, 16, 16, 256, fn_fireball_2_024, 269
       00 00 10 00 
       00 00 01 00 
       20 52 04 0D 
       01 00       
0446C8 01 00 00 10 0179*   	dl 1, 16, 16, 256, fn_fireball_2_032, 270
       00 00 10 00 
       00 00 01 00 
       3D 52 04 0E 
       01 00       
0446DA 01 00 00 10 0180*   	dl 1, 16, 16, 256, fn_fireball_2_040, 271
       00 00 10 00 
       00 00 01 00 
       5A 52 04 0F 
       01 00       
0446EC 01 00 00 10 0181*   	dl 1, 16, 16, 256, fn_fireball_2_048, 272
       00 00 10 00 
       00 00 01 00 
       77 52 04 10 
       01 00       
0446FE 01 00 00 10 0182*   	dl 1, 16, 16, 256, fn_fireball_2_056, 273
       00 00 10 00 
       00 00 01 00 
       94 52 04 11 
       01 00       
044710 01 00 00 10 0183*   	dl 1, 16, 16, 256, fn_fireball_2_064, 274
       00 00 10 00 
       00 00 01 00 
       B1 52 04 12 
       01 00       
044722 01 00 00 10 0184*   	dl 1, 16, 16, 256, fn_fireball_2_072, 275
       00 00 10 00 
       00 00 01 00 
       CE 52 04 13 
       01 00       
044734 01 00 00 10 0185*   	dl 1, 16, 16, 256, fn_fireball_2_080, 276
       00 00 10 00 
       00 00 01 00 
       EB 52 04 14 
       01 00       
044746 01 00 00 10 0186*   	dl 1, 16, 16, 256, fn_fireball_2_088, 277
       00 00 10 00 
       00 00 01 00 
       08 53 04 15 
       01 00       
044758 01 00 00 10 0187*   	dl 1, 16, 16, 256, fn_fireball_2_096, 278
       00 00 10 00 
       00 00 01 00 
       25 53 04 16 
       01 00       
04476A 01 00 00 10 0188*   	dl 1, 16, 16, 256, fn_fireball_2_104, 279
       00 00 10 00 
       00 00 01 00 
       42 53 04 17 
       01 00       
04477C 01 00 00 10 0189*   	dl 1, 16, 16, 256, fn_fireball_2_112, 280
       00 00 10 00 
       00 00 01 00 
       5F 53 04 18 
       01 00       
04478E 01 00 00 10 0190*   	dl 1, 16, 16, 256, fn_fireball_2_120, 281
       00 00 10 00 
       00 00 01 00 
       7C 53 04 19 
       01 00       
0447A0 01 00 00 10 0191*   	dl 1, 16, 16, 256, fn_fireball_2_128, 282
       00 00 10 00 
       00 00 01 00 
       99 53 04 1A 
       01 00       
0447B2 01 00 00 10 0192*   	dl 1, 16, 16, 256, fn_fireball_2_136, 283
       00 00 10 00 
       00 00 01 00 
       B6 53 04 1B 
       01 00       
0447C4 01 00 00 10 0193*   	dl 1, 16, 16, 256, fn_fireball_2_144, 284
       00 00 10 00 
       00 00 01 00 
       D3 53 04 1C 
       01 00       
0447D6 01 00 00 10 0194*   	dl 1, 16, 16, 256, fn_fireball_2_152, 285
       00 00 10 00 
       00 00 01 00 
       F0 53 04 1D 
       01 00       
0447E8 01 00 00 10 0195*   	dl 1, 16, 16, 256, fn_fireball_2_160, 286
       00 00 10 00 
       00 00 01 00 
       0D 54 04 1E 
       01 00       
0447FA 01 00 00 10 0196*   	dl 1, 16, 16, 256, fn_fireball_2_168, 287
       00 00 10 00 
       00 00 01 00 
       2A 54 04 1F 
       01 00       
04480C 01 00 00 10 0197*   	dl 1, 16, 16, 256, fn_fireball_2_176, 288
       00 00 10 00 
       00 00 01 00 
       47 54 04 20 
       01 00       
04481E 01 00 00 10 0198*   	dl 1, 16, 16, 256, fn_fireball_2_184, 289
       00 00 10 00 
       00 00 01 00 
       64 54 04 21 
       01 00       
044830 01 00 00 10 0199*   	dl 1, 16, 16, 256, fn_fireball_2_192, 290
       00 00 10 00 
       00 00 01 00 
       81 54 04 22 
       01 00       
044842 01 00 00 10 0200*   	dl 1, 16, 16, 256, fn_fireball_2_200, 291
       00 00 10 00 
       00 00 01 00 
       9E 54 04 23 
       01 00       
044854 01 00 00 10 0201*   	dl 1, 16, 16, 256, fn_fireball_2_208, 292
       00 00 10 00 
       00 00 01 00 
       BB 54 04 24 
       01 00       
044866 01 00 00 10 0202*   	dl 1, 16, 16, 256, fn_fireball_2_216, 293
       00 00 10 00 
       00 00 01 00 
       D8 54 04 25 
       01 00       
044878 01 00 00 10 0203*   	dl 1, 16, 16, 256, fn_fireball_2_224, 294
       00 00 10 00 
       00 00 01 00 
       F5 54 04 26 
       01 00       
04488A 01 00 00 10 0204*   	dl 1, 16, 16, 256, fn_fireball_2_232, 295
       00 00 10 00 
       00 00 01 00 
       12 55 04 27 
       01 00       
04489C 01 00 00 10 0205*   	dl 1, 16, 16, 256, fn_fireball_2_240, 296
       00 00 10 00 
       00 00 01 00 
       2F 55 04 28 
       01 00       
0448AE 01 00 00 10 0206*   	dl 1, 16, 16, 256, fn_fireball_2_248, 297
       00 00 10 00 
       00 00 01 00 
       4C 55 04 29 
       01 00       
0448C0 01 00 00 10 0207*   	dl 1, 16, 16, 256, fn_fireball_3_000, 298
       00 00 10 00 
       00 00 01 00 
       69 55 04 2A 
       01 00       
0448D2 01 00 00 10 0208*   	dl 1, 16, 16, 256, fn_fireball_3_008, 299
       00 00 10 00 
       00 00 01 00 
       86 55 04 2B 
       01 00       
0448E4 01 00 00 10 0209*   	dl 1, 16, 16, 256, fn_fireball_3_016, 300
       00 00 10 00 
       00 00 01 00 
       A3 55 04 2C 
       01 00       
0448F6 01 00 00 10 0210*   	dl 1, 16, 16, 256, fn_fireball_3_024, 301
       00 00 10 00 
       00 00 01 00 
       C0 55 04 2D 
       01 00       
044908 01 00 00 10 0211*   	dl 1, 16, 16, 256, fn_fireball_3_032, 302
       00 00 10 00 
       00 00 01 00 
       DD 55 04 2E 
       01 00       
04491A 01 00 00 10 0212*   	dl 1, 16, 16, 256, fn_fireball_3_040, 303
       00 00 10 00 
       00 00 01 00 
       FA 55 04 2F 
       01 00       
04492C 01 00 00 10 0213*   	dl 1, 16, 16, 256, fn_fireball_3_048, 304
       00 00 10 00 
       00 00 01 00 
       17 56 04 30 
       01 00       
04493E 01 00 00 10 0214*   	dl 1, 16, 16, 256, fn_fireball_3_056, 305
       00 00 10 00 
       00 00 01 00 
       34 56 04 31 
       01 00       
044950 01 00 00 10 0215*   	dl 1, 16, 16, 256, fn_fireball_3_064, 306
       00 00 10 00 
       00 00 01 00 
       51 56 04 32 
       01 00       
044962 01 00 00 10 0216*   	dl 1, 16, 16, 256, fn_fireball_3_072, 307
       00 00 10 00 
       00 00 01 00 
       6E 56 04 33 
       01 00       
044974 01 00 00 10 0217*   	dl 1, 16, 16, 256, fn_fireball_3_080, 308
       00 00 10 00 
       00 00 01 00 
       8B 56 04 34 
       01 00       
044986 01 00 00 10 0218*   	dl 1, 16, 16, 256, fn_fireball_3_088, 309
       00 00 10 00 
       00 00 01 00 
       A8 56 04 35 
       01 00       
044998 01 00 00 10 0219*   	dl 1, 16, 16, 256, fn_fireball_3_096, 310
       00 00 10 00 
       00 00 01 00 
       C5 56 04 36 
       01 00       
0449AA 01 00 00 10 0220*   	dl 1, 16, 16, 256, fn_fireball_3_104, 311
       00 00 10 00 
       00 00 01 00 
       E2 56 04 37 
       01 00       
0449BC 01 00 00 10 0221*   	dl 1, 16, 16, 256, fn_fireball_3_112, 312
       00 00 10 00 
       00 00 01 00 
       FF 56 04 38 
       01 00       
0449CE 01 00 00 10 0222*   	dl 1, 16, 16, 256, fn_fireball_3_120, 313
       00 00 10 00 
       00 00 01 00 
       1C 57 04 39 
       01 00       
0449E0 01 00 00 10 0223*   	dl 1, 16, 16, 256, fn_fireball_3_128, 314
       00 00 10 00 
       00 00 01 00 
       39 57 04 3A 
       01 00       
0449F2 01 00 00 10 0224*   	dl 1, 16, 16, 256, fn_fireball_3_136, 315
       00 00 10 00 
       00 00 01 00 
       56 57 04 3B 
       01 00       
044A04 01 00 00 10 0225*   	dl 1, 16, 16, 256, fn_fireball_3_144, 316
       00 00 10 00 
       00 00 01 00 
       73 57 04 3C 
       01 00       
044A16 01 00 00 10 0226*   	dl 1, 16, 16, 256, fn_fireball_3_152, 317
       00 00 10 00 
       00 00 01 00 
       90 57 04 3D 
       01 00       
044A28 01 00 00 10 0227*   	dl 1, 16, 16, 256, fn_fireball_3_160, 318
       00 00 10 00 
       00 00 01 00 
       AD 57 04 3E 
       01 00       
044A3A 01 00 00 10 0228*   	dl 1, 16, 16, 256, fn_fireball_3_168, 319
       00 00 10 00 
       00 00 01 00 
       CA 57 04 3F 
       01 00       
044A4C 01 00 00 10 0229*   	dl 1, 16, 16, 256, fn_fireball_3_176, 320
       00 00 10 00 
       00 00 01 00 
       E7 57 04 40 
       01 00       
044A5E 01 00 00 10 0230*   	dl 1, 16, 16, 256, fn_fireball_3_184, 321
       00 00 10 00 
       00 00 01 00 
       04 58 04 41 
       01 00       
044A70 01 00 00 10 0231*   	dl 1, 16, 16, 256, fn_fireball_3_192, 322
       00 00 10 00 
       00 00 01 00 
       21 58 04 42 
       01 00       
044A82 01 00 00 10 0232*   	dl 1, 16, 16, 256, fn_fireball_3_200, 323
       00 00 10 00 
       00 00 01 00 
       3E 58 04 43 
       01 00       
044A94 01 00 00 10 0233*   	dl 1, 16, 16, 256, fn_fireball_3_208, 324
       00 00 10 00 
       00 00 01 00 
       5B 58 04 44 
       01 00       
044AA6 01 00 00 10 0234*   	dl 1, 16, 16, 256, fn_fireball_3_216, 325
       00 00 10 00 
       00 00 01 00 
       78 58 04 45 
       01 00       
044AB8 01 00 00 10 0235*   	dl 1, 16, 16, 256, fn_fireball_3_224, 326
       00 00 10 00 
       00 00 01 00 
       95 58 04 46 
       01 00       
044ACA 01 00 00 10 0236*   	dl 1, 16, 16, 256, fn_fireball_3_232, 327
       00 00 10 00 
       00 00 01 00 
       B2 58 04 47 
       01 00       
044ADC 01 00 00 10 0237*   	dl 1, 16, 16, 256, fn_fireball_3_240, 328
       00 00 10 00 
       00 00 01 00 
       CF 58 04 48 
       01 00       
044AEE 01 00 00 10 0238*   	dl 1, 16, 16, 256, fn_fireball_3_248, 329
       00 00 10 00 
       00 00 01 00 
       EC 58 04 49 
       01 00       
044B00 01 00 00 05 0239*   	dl 1, 5, 13, 65, fn_laser_a, 330
       00 00 0D 00 
       00 41 00 00 
       09 59 04 4A 
       01 00       
044B12 01 00 00 05 0240*   	dl 1, 5, 13, 65, fn_laser_b, 331
       00 00 0D 00 
       00 41 00 00 
       1F 59 04 4B 
       01 00       
044B24 01 00 00 10 0241*   	dl 1, 16, 16, 256, fn_lightning_h_0, 332
       00 00 10 00 
       00 00 01 00 
       35 59 04 4C 
       01 00       
044B36 01 00 00 10 0242*   	dl 1, 16, 16, 256, fn_lightning_h_1, 333
       00 00 10 00 
       00 00 01 00 
       51 59 04 4D 
       01 00       
044B48 01 00 00 10 0243*   	dl 1, 16, 16, 256, fn_pad, 334
       00 00 10 00 
       00 00 01 00 
       6D 59 04 4E 
       01 00       
044B5A 01 00 00 10 0244*   	dl 1, 16, 16, 256, fn_seeker_000, 335
       00 00 10 00 
       00 00 01 00 
       7F 59 04 4F 
       01 00       
044B6C 01 00 00 10 0245*   	dl 1, 16, 16, 256, fn_seeker_008, 336
       00 00 10 00 
       00 00 01 00 
       98 59 04 50 
       01 00       
044B7E 01 00 00 10 0246*   	dl 1, 16, 16, 256, fn_seeker_016, 337
       00 00 10 00 
       00 00 01 00 
       B1 59 04 51 
       01 00       
044B90 01 00 00 10 0247*   	dl 1, 16, 16, 256, fn_seeker_024, 338
       00 00 10 00 
       00 00 01 00 
       CA 59 04 52 
       01 00       
044BA2 01 00 00 10 0248*   	dl 1, 16, 16, 256, fn_seeker_032, 339
       00 00 10 00 
       00 00 01 00 
       E3 59 04 53 
       01 00       
044BB4 01 00 00 10 0249*   	dl 1, 16, 16, 256, fn_seeker_040, 340
       00 00 10 00 
       00 00 01 00 
       FC 59 04 54 
       01 00       
044BC6 01 00 00 10 0250*   	dl 1, 16, 16, 256, fn_seeker_048, 341
       00 00 10 00 
       00 00 01 00 
       15 5A 04 55 
       01 00       
044BD8 01 00 00 10 0251*   	dl 1, 16, 16, 256, fn_seeker_056, 342
       00 00 10 00 
       00 00 01 00 
       2E 5A 04 56 
       01 00       
044BEA 01 00 00 10 0252*   	dl 1, 16, 16, 256, fn_seeker_064, 343
       00 00 10 00 
       00 00 01 00 
       47 5A 04 57 
       01 00       
044BFC 01 00 00 10 0253*   	dl 1, 16, 16, 256, fn_seeker_072, 344
       00 00 10 00 
       00 00 01 00 
       60 5A 04 58 
       01 00       
044C0E 01 00 00 10 0254*   	dl 1, 16, 16, 256, fn_seeker_080, 345
       00 00 10 00 
       00 00 01 00 
       79 5A 04 59 
       01 00       
044C20 01 00 00 10 0255*   	dl 1, 16, 16, 256, fn_seeker_088, 346
       00 00 10 00 
       00 00 01 00 
       92 5A 04 5A 
       01 00       
044C32 01 00 00 10 0256*   	dl 1, 16, 16, 256, fn_seeker_096, 347
       00 00 10 00 
       00 00 01 00 
       AB 5A 04 5B 
       01 00       
044C44 01 00 00 10 0257*   	dl 1, 16, 16, 256, fn_seeker_104, 348
       00 00 10 00 
       00 00 01 00 
       C4 5A 04 5C 
       01 00       
044C56 01 00 00 10 0258*   	dl 1, 16, 16, 256, fn_seeker_112, 349
       00 00 10 00 
       00 00 01 00 
       DD 5A 04 5D 
       01 00       
044C68 01 00 00 10 0259*   	dl 1, 16, 16, 256, fn_seeker_120, 350
       00 00 10 00 
       00 00 01 00 
       F6 5A 04 5E 
       01 00       
044C7A 01 00 00 10 0260*   	dl 1, 16, 16, 256, fn_seeker_128, 351
       00 00 10 00 
       00 00 01 00 
       0F 5B 04 5F 
       01 00       
044C8C 01 00 00 10 0261*   	dl 1, 16, 16, 256, fn_seeker_136, 352
       00 00 10 00 
       00 00 01 00 
       28 5B 04 60 
       01 00       
044C9E 01 00 00 10 0262*   	dl 1, 16, 16, 256, fn_seeker_144, 353
       00 00 10 00 
       00 00 01 00 
       41 5B 04 61 
       01 00       
044CB0 01 00 00 10 0263*   	dl 1, 16, 16, 256, fn_seeker_152, 354
       00 00 10 00 
       00 00 01 00 
       5A 5B 04 62 
       01 00       
044CC2 01 00 00 10 0264*   	dl 1, 16, 16, 256, fn_seeker_160, 355
       00 00 10 00 
       00 00 01 00 
       73 5B 04 63 
       01 00       
044CD4 01 00 00 10 0265*   	dl 1, 16, 16, 256, fn_seeker_168, 356
       00 00 10 00 
       00 00 01 00 
       8C 5B 04 64 
       01 00       
044CE6 01 00 00 10 0266*   	dl 1, 16, 16, 256, fn_seeker_176, 357
       00 00 10 00 
       00 00 01 00 
       A5 5B 04 65 
       01 00       
044CF8 01 00 00 10 0267*   	dl 1, 16, 16, 256, fn_seeker_184, 358
       00 00 10 00 
       00 00 01 00 
       BE 5B 04 66 
       01 00       
044D0A 01 00 00 10 0268*   	dl 1, 16, 16, 256, fn_seeker_192, 359
       00 00 10 00 
       00 00 01 00 
       D7 5B 04 67 
       01 00       
044D1C 01 00 00 10 0269*   	dl 1, 16, 16, 256, fn_seeker_200, 360
       00 00 10 00 
       00 00 01 00 
       F0 5B 04 68 
       01 00       
044D2E 01 00 00 10 0270*   	dl 1, 16, 16, 256, fn_seeker_208, 361
       00 00 10 00 
       00 00 01 00 
       09 5C 04 69 
       01 00       
044D40 01 00 00 10 0271*   	dl 1, 16, 16, 256, fn_seeker_216, 362
       00 00 10 00 
       00 00 01 00 
       22 5C 04 6A 
       01 00       
044D52 01 00 00 10 0272*   	dl 1, 16, 16, 256, fn_seeker_224, 363
       00 00 10 00 
       00 00 01 00 
       3B 5C 04 6B 
       01 00       
044D64 01 00 00 10 0273*   	dl 1, 16, 16, 256, fn_seeker_232, 364
       00 00 10 00 
       00 00 01 00 
       54 5C 04 6C 
       01 00       
044D76 01 00 00 10 0274*   	dl 1, 16, 16, 256, fn_seeker_240, 365
       00 00 10 00 
       00 00 01 00 
       6D 5C 04 6D 
       01 00       
044D88 01 00 00 10 0275*   	dl 1, 16, 16, 256, fn_seeker_248, 366
       00 00 10 00 
       00 00 01 00 
       86 5C 04 6E 
       01 00       
044D9A 01 00 00 10 0276*   	dl 1, 16, 16, 256, fn_ship_0l, 367
       00 00 10 00 
       00 00 01 00 
       9F 5C 04 6F 
       01 00       
044DAC 01 00 00 10 0277*   	dl 1, 16, 16, 256, fn_ship_1c, 368
       00 00 10 00 
       00 00 01 00 
       B5 5C 04 70 
       01 00       
044DBE 01 00 00 10 0278*   	dl 1, 16, 16, 256, fn_ship_2r, 369
       00 00 10 00 
       00 00 01 00 
       CB 5C 04 71 
       01 00       
044DD0 01 00 00 08 0279*   	dl 1, 8, 8, 64, fn_ship_small, 370
       00 00 08 00 
       00 40 00 00 
       E1 5C 04 72 
       01 00       
044DE2 01 00 00 10 0280*   	dl 1, 16, 16, 256, fn_test_stripes, 371
       00 00 10 00 
       00 00 01 00 
       FA 5C 04 73 
       01 00       
044DF4 01 00 00 10 0281*   	dl 1, 16, 16, 256, fn_tile_blank, 372
       00 00 10 00 
       00 00 01 00 
       15 5D 04 74 
       01 00       
044E06 01 00 00 10 0282*   	dl 1, 16, 16, 256, fn_tile_pad_0, 373
       00 00 10 00 
       00 00 01 00 
       2E 5D 04 75 
       01 00       
044E18 01 00 00 10 0283*   	dl 1, 16, 16, 256, fn_tile_pad_1, 374
       00 00 10 00 
       00 00 01 00 
       47 5D 04 76 
       01 00       
044E2A 01 00 00 10 0284*   	dl 1, 16, 16, 256, fn_tile_pad_2, 375
       00 00 10 00 
       00 00 01 00 
       60 5D 04 77 
       01 00       
044E3C 01 00 00 10 0285*   	dl 1, 16, 16, 256, fn_tile_pad_3, 376
       00 00 10 00 
       00 00 01 00 
       79 5D 04 78 
       01 00       
044E4E 01 00 00 10 0286*   	dl 1, 16, 16, 256, fn_tile_pad_4, 377
       00 00 10 00 
       00 00 01 00 
       92 5D 04 79 
       01 00       
044E60 01 00 00 10 0287*   	dl 1, 16, 16, 256, fn_tile_pad_5, 378
       00 00 10 00 
       00 00 01 00 
       AB 5D 04 7A 
       01 00       
044E72 01 00 00 10 0288*   	dl 1, 16, 16, 256, fn_tile_pad_6, 379
       00 00 10 00 
       00 00 01 00 
       C4 5D 04 7B 
       01 00       
044E84 01 00 00 10 0289*   	dl 1, 16, 16, 256, fn_tile_pad_7, 380
       00 00 10 00 
       00 00 01 00 
       DD 5D 04 7C 
       01 00       
044E96 01 00 00 10 0290*   	dl 1, 16, 16, 256, fn_turret_000, 381
       00 00 10 00 
       00 00 01 00 
       F6 5D 04 7D 
       01 00       
044EA8 01 00 00 10 0291*   	dl 1, 16, 16, 256, fn_turret_008, 382
       00 00 10 00 
       00 00 01 00 
       0F 5E 04 7E 
       01 00       
044EBA 01 00 00 10 0292*   	dl 1, 16, 16, 256, fn_turret_016, 383
       00 00 10 00 
       00 00 01 00 
       28 5E 04 7F 
       01 00       
044ECC 01 00 00 10 0293*   	dl 1, 16, 16, 256, fn_turret_024, 384
       00 00 10 00 
       00 00 01 00 
       41 5E 04 80 
       01 00       
044EDE 01 00 00 10 0294*   	dl 1, 16, 16, 256, fn_turret_032, 385
       00 00 10 00 
       00 00 01 00 
       5A 5E 04 81 
       01 00       
044EF0 01 00 00 10 0295*   	dl 1, 16, 16, 256, fn_turret_040, 386
       00 00 10 00 
       00 00 01 00 
       73 5E 04 82 
       01 00       
044F02 01 00 00 10 0296*   	dl 1, 16, 16, 256, fn_turret_048, 387
       00 00 10 00 
       00 00 01 00 
       8C 5E 04 83 
       01 00       
044F14 01 00 00 10 0297*   	dl 1, 16, 16, 256, fn_turret_056, 388
       00 00 10 00 
       00 00 01 00 
       A5 5E 04 84 
       01 00       
044F26 01 00 00 10 0298*   	dl 1, 16, 16, 256, fn_turret_064, 389
       00 00 10 00 
       00 00 01 00 
       BE 5E 04 85 
       01 00       
044F38 01 00 00 10 0299*   	dl 1, 16, 16, 256, fn_turret_072, 390
       00 00 10 00 
       00 00 01 00 
       D7 5E 04 86 
       01 00       
044F4A 01 00 00 10 0300*   	dl 1, 16, 16, 256, fn_turret_080, 391
       00 00 10 00 
       00 00 01 00 
       F0 5E 04 87 
       01 00       
044F5C 01 00 00 10 0301*   	dl 1, 16, 16, 256, fn_turret_088, 392
       00 00 10 00 
       00 00 01 00 
       09 5F 04 88 
       01 00       
044F6E 01 00 00 10 0302*   	dl 1, 16, 16, 256, fn_turret_096, 393
       00 00 10 00 
       00 00 01 00 
       22 5F 04 89 
       01 00       
044F80 01 00 00 10 0303*   	dl 1, 16, 16, 256, fn_turret_104, 394
       00 00 10 00 
       00 00 01 00 
       3B 5F 04 8A 
       01 00       
044F92 01 00 00 10 0304*   	dl 1, 16, 16, 256, fn_turret_112, 395
       00 00 10 00 
       00 00 01 00 
       54 5F 04 8B 
       01 00       
044FA4 01 00 00 10 0305*   	dl 1, 16, 16, 256, fn_turret_120, 396
       00 00 10 00 
       00 00 01 00 
       6D 5F 04 8C 
       01 00       
044FB6 01 00 00 10 0306*   	dl 1, 16, 16, 256, fn_turret_128, 397
       00 00 10 00 
       00 00 01 00 
       86 5F 04 8D 
       01 00       
044FC8 01 00 00 10 0307*   	dl 1, 16, 16, 256, fn_turret_136, 398
       00 00 10 00 
       00 00 01 00 
       9F 5F 04 8E 
       01 00       
044FDA 01 00 00 10 0308*   	dl 1, 16, 16, 256, fn_turret_144, 399
       00 00 10 00 
       00 00 01 00 
       B8 5F 04 8F 
       01 00       
044FEC 01 00 00 10 0309*   	dl 1, 16, 16, 256, fn_turret_152, 400
       00 00 10 00 
       00 00 01 00 
       D1 5F 04 90 
       01 00       
044FFE 01 00 00 10 0310*   	dl 1, 16, 16, 256, fn_turret_160, 401
       00 00 10 00 
       00 00 01 00 
       EA 5F 04 91 
       01 00       
045010 01 00 00 10 0311*   	dl 1, 16, 16, 256, fn_turret_168, 402
       00 00 10 00 
       00 00 01 00 
       03 60 04 92 
       01 00       
045022 01 00 00 10 0312*   	dl 1, 16, 16, 256, fn_turret_176, 403
       00 00 10 00 
       00 00 01 00 
       1C 60 04 93 
       01 00       
045034 01 00 00 10 0313*   	dl 1, 16, 16, 256, fn_turret_184, 404
       00 00 10 00 
       00 00 01 00 
       35 60 04 94 
       01 00       
045046 01 00 00 10 0314*   	dl 1, 16, 16, 256, fn_turret_192, 405
       00 00 10 00 
       00 00 01 00 
       4E 60 04 95 
       01 00       
045058 01 00 00 10 0315*   	dl 1, 16, 16, 256, fn_turret_200, 406
       00 00 10 00 
       00 00 01 00 
       67 60 04 96 
       01 00       
04506A 01 00 00 10 0316*   	dl 1, 16, 16, 256, fn_turret_208, 407
       00 00 10 00 
       00 00 01 00 
       80 60 04 97 
       01 00       
04507C 01 00 00 10 0317*   	dl 1, 16, 16, 256, fn_turret_216, 408
       00 00 10 00 
       00 00 01 00 
       99 60 04 98 
       01 00       
04508E 01 00 00 10 0318*   	dl 1, 16, 16, 256, fn_turret_224, 409
       00 00 10 00 
       00 00 01 00 
       B2 60 04 99 
       01 00       
0450A0 01 00 00 10 0319*   	dl 1, 16, 16, 256, fn_turret_232, 410
       00 00 10 00 
       00 00 01 00 
       CB 60 04 9A 
       01 00       
0450B2 01 00 00 10 0320*   	dl 1, 16, 16, 256, fn_turret_240, 411
       00 00 10 00 
       00 00 01 00 
       E4 60 04 9B 
       01 00       
0450C4 01 00 00 10 0321*   	dl 1, 16, 16, 256, fn_turret_248, 412
       00 00 10 00 
       00 00 01 00 
       FD 60 04 9C 
       01 00       
0450D6             0322*   
0450D6             0323*   ; files_list: ; filename:
0450D6 73 70 72 69 0324*   fn_crater: db "sprites/crater.rgba2",0
       74 65 73 2F 
       63 72 61 74 
       65 72 2E 72 
       67 62 61 32 
       00          
0450EB 73 70 72 69 0325*   fn_crater_0: db "sprites/crater_0.rgba2",0
       74 65 73 2F 
       63 72 61 74 
       65 72 5F 30 
       2E 72 67 62 
       61 32 00    
045102 73 70 72 69 0326*   fn_crater_1: db "sprites/crater_1.rgba2",0
       74 65 73 2F 
       63 72 61 74 
       65 72 5F 31 
       2E 72 67 62 
       61 32 00    
045119 73 70 72 69 0327*   fn_crater_2: db "sprites/crater_2.rgba2",0
       74 65 73 2F 
       63 72 61 74 
       65 72 5F 32 
       2E 72 67 62 
       61 32 00    
045130 73 70 72 69 0328*   fn_crater_3: db "sprites/crater_3.rgba2",0
       74 65 73 2F 
       63 72 61 74 
       65 72 5F 33 
       2E 72 67 62 
       61 32 00    
045147 73 70 72 69 0329*   fn_explosion_a: db "sprites/explosion_a.rgba2",0
       74 65 73 2F 
       65 78 70 6C 
       6F 73 69 6F 
       6E 5F 61 2E 
       72 67 62 61 
       32 00       
045161 73 70 72 69 0330*   fn_explosion_b: db "sprites/explosion_b.rgba2",0
       74 65 73 2F 
       65 78 70 6C 
       6F 73 69 6F 
       6E 5F 62 2E 
       72 67 62 61 
       32 00       
04517B 73 70 72 69 0331*   fn_explosion_c: db "sprites/explosion_c.rgba2",0
       74 65 73 2F 
       65 78 70 6C 
       6F 73 69 6F 
       6E 5F 63 2E 
       72 67 62 61 
       32 00       
045195 73 70 72 69 0332*   fn_explosion_d: db "sprites/explosion_d.rgba2",0
       74 65 73 2F 
       65 78 70 6C 
       6F 73 69 6F 
       6E 5F 64 2E 
       72 67 62 61 
       32 00       
0451AF 73 70 72 69 0333*   fn_explosion_e: db "sprites/explosion_e.rgba2",0
       74 65 73 2F 
       65 78 70 6C 
       6F 73 69 6F 
       6E 5F 65 2E 
       72 67 62 61 
       32 00       
0451C9 73 70 72 69 0334*   fn_fireball_2_000: db "sprites/fireball_2_000.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 30 
       30 30 2E 72 
       67 62 61 32 
       00          
0451E6 73 70 72 69 0335*   fn_fireball_2_008: db "sprites/fireball_2_008.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 30 
       30 38 2E 72 
       67 62 61 32 
       00          
045203 73 70 72 69 0336*   fn_fireball_2_016: db "sprites/fireball_2_016.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 30 
       31 36 2E 72 
       67 62 61 32 
       00          
045220 73 70 72 69 0337*   fn_fireball_2_024: db "sprites/fireball_2_024.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 30 
       32 34 2E 72 
       67 62 61 32 
       00          
04523D 73 70 72 69 0338*   fn_fireball_2_032: db "sprites/fireball_2_032.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 30 
       33 32 2E 72 
       67 62 61 32 
       00          
04525A 73 70 72 69 0339*   fn_fireball_2_040: db "sprites/fireball_2_040.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 30 
       34 30 2E 72 
       67 62 61 32 
       00          
045277 73 70 72 69 0340*   fn_fireball_2_048: db "sprites/fireball_2_048.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 30 
       34 38 2E 72 
       67 62 61 32 
       00          
045294 73 70 72 69 0341*   fn_fireball_2_056: db "sprites/fireball_2_056.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 30 
       35 36 2E 72 
       67 62 61 32 
       00          
0452B1 73 70 72 69 0342*   fn_fireball_2_064: db "sprites/fireball_2_064.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 30 
       36 34 2E 72 
       67 62 61 32 
       00          
0452CE 73 70 72 69 0343*   fn_fireball_2_072: db "sprites/fireball_2_072.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 30 
       37 32 2E 72 
       67 62 61 32 
       00          
0452EB 73 70 72 69 0344*   fn_fireball_2_080: db "sprites/fireball_2_080.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 30 
       38 30 2E 72 
       67 62 61 32 
       00          
045308 73 70 72 69 0345*   fn_fireball_2_088: db "sprites/fireball_2_088.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 30 
       38 38 2E 72 
       67 62 61 32 
       00          
045325 73 70 72 69 0346*   fn_fireball_2_096: db "sprites/fireball_2_096.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 30 
       39 36 2E 72 
       67 62 61 32 
       00          
045342 73 70 72 69 0347*   fn_fireball_2_104: db "sprites/fireball_2_104.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 31 
       30 34 2E 72 
       67 62 61 32 
       00          
04535F 73 70 72 69 0348*   fn_fireball_2_112: db "sprites/fireball_2_112.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 31 
       31 32 2E 72 
       67 62 61 32 
       00          
04537C 73 70 72 69 0349*   fn_fireball_2_120: db "sprites/fireball_2_120.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 31 
       32 30 2E 72 
       67 62 61 32 
       00          
045399 73 70 72 69 0350*   fn_fireball_2_128: db "sprites/fireball_2_128.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 31 
       32 38 2E 72 
       67 62 61 32 
       00          
0453B6 73 70 72 69 0351*   fn_fireball_2_136: db "sprites/fireball_2_136.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 31 
       33 36 2E 72 
       67 62 61 32 
       00          
0453D3 73 70 72 69 0352*   fn_fireball_2_144: db "sprites/fireball_2_144.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 31 
       34 34 2E 72 
       67 62 61 32 
       00          
0453F0 73 70 72 69 0353*   fn_fireball_2_152: db "sprites/fireball_2_152.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 31 
       35 32 2E 72 
       67 62 61 32 
       00          
04540D 73 70 72 69 0354*   fn_fireball_2_160: db "sprites/fireball_2_160.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 31 
       36 30 2E 72 
       67 62 61 32 
       00          
04542A 73 70 72 69 0355*   fn_fireball_2_168: db "sprites/fireball_2_168.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 31 
       36 38 2E 72 
       67 62 61 32 
       00          
045447 73 70 72 69 0356*   fn_fireball_2_176: db "sprites/fireball_2_176.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 31 
       37 36 2E 72 
       67 62 61 32 
       00          
045464 73 70 72 69 0357*   fn_fireball_2_184: db "sprites/fireball_2_184.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 31 
       38 34 2E 72 
       67 62 61 32 
       00          
045481 73 70 72 69 0358*   fn_fireball_2_192: db "sprites/fireball_2_192.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 31 
       39 32 2E 72 
       67 62 61 32 
       00          
04549E 73 70 72 69 0359*   fn_fireball_2_200: db "sprites/fireball_2_200.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 32 
       30 30 2E 72 
       67 62 61 32 
       00          
0454BB 73 70 72 69 0360*   fn_fireball_2_208: db "sprites/fireball_2_208.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 32 
       30 38 2E 72 
       67 62 61 32 
       00          
0454D8 73 70 72 69 0361*   fn_fireball_2_216: db "sprites/fireball_2_216.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 32 
       31 36 2E 72 
       67 62 61 32 
       00          
0454F5 73 70 72 69 0362*   fn_fireball_2_224: db "sprites/fireball_2_224.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 32 
       32 34 2E 72 
       67 62 61 32 
       00          
045512 73 70 72 69 0363*   fn_fireball_2_232: db "sprites/fireball_2_232.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 32 
       33 32 2E 72 
       67 62 61 32 
       00          
04552F 73 70 72 69 0364*   fn_fireball_2_240: db "sprites/fireball_2_240.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 32 
       34 30 2E 72 
       67 62 61 32 
       00          
04554C 73 70 72 69 0365*   fn_fireball_2_248: db "sprites/fireball_2_248.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 32 5F 32 
       34 38 2E 72 
       67 62 61 32 
       00          
045569 73 70 72 69 0366*   fn_fireball_3_000: db "sprites/fireball_3_000.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 30 
       30 30 2E 72 
       67 62 61 32 
       00          
045586 73 70 72 69 0367*   fn_fireball_3_008: db "sprites/fireball_3_008.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 30 
       30 38 2E 72 
       67 62 61 32 
       00          
0455A3 73 70 72 69 0368*   fn_fireball_3_016: db "sprites/fireball_3_016.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 30 
       31 36 2E 72 
       67 62 61 32 
       00          
0455C0 73 70 72 69 0369*   fn_fireball_3_024: db "sprites/fireball_3_024.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 30 
       32 34 2E 72 
       67 62 61 32 
       00          
0455DD 73 70 72 69 0370*   fn_fireball_3_032: db "sprites/fireball_3_032.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 30 
       33 32 2E 72 
       67 62 61 32 
       00          
0455FA 73 70 72 69 0371*   fn_fireball_3_040: db "sprites/fireball_3_040.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 30 
       34 30 2E 72 
       67 62 61 32 
       00          
045617 73 70 72 69 0372*   fn_fireball_3_048: db "sprites/fireball_3_048.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 30 
       34 38 2E 72 
       67 62 61 32 
       00          
045634 73 70 72 69 0373*   fn_fireball_3_056: db "sprites/fireball_3_056.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 30 
       35 36 2E 72 
       67 62 61 32 
       00          
045651 73 70 72 69 0374*   fn_fireball_3_064: db "sprites/fireball_3_064.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 30 
       36 34 2E 72 
       67 62 61 32 
       00          
04566E 73 70 72 69 0375*   fn_fireball_3_072: db "sprites/fireball_3_072.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 30 
       37 32 2E 72 
       67 62 61 32 
       00          
04568B 73 70 72 69 0376*   fn_fireball_3_080: db "sprites/fireball_3_080.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 30 
       38 30 2E 72 
       67 62 61 32 
       00          
0456A8 73 70 72 69 0377*   fn_fireball_3_088: db "sprites/fireball_3_088.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 30 
       38 38 2E 72 
       67 62 61 32 
       00          
0456C5 73 70 72 69 0378*   fn_fireball_3_096: db "sprites/fireball_3_096.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 30 
       39 36 2E 72 
       67 62 61 32 
       00          
0456E2 73 70 72 69 0379*   fn_fireball_3_104: db "sprites/fireball_3_104.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 31 
       30 34 2E 72 
       67 62 61 32 
       00          
0456FF 73 70 72 69 0380*   fn_fireball_3_112: db "sprites/fireball_3_112.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 31 
       31 32 2E 72 
       67 62 61 32 
       00          
04571C 73 70 72 69 0381*   fn_fireball_3_120: db "sprites/fireball_3_120.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 31 
       32 30 2E 72 
       67 62 61 32 
       00          
045739 73 70 72 69 0382*   fn_fireball_3_128: db "sprites/fireball_3_128.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 31 
       32 38 2E 72 
       67 62 61 32 
       00          
045756 73 70 72 69 0383*   fn_fireball_3_136: db "sprites/fireball_3_136.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 31 
       33 36 2E 72 
       67 62 61 32 
       00          
045773 73 70 72 69 0384*   fn_fireball_3_144: db "sprites/fireball_3_144.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 31 
       34 34 2E 72 
       67 62 61 32 
       00          
045790 73 70 72 69 0385*   fn_fireball_3_152: db "sprites/fireball_3_152.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 31 
       35 32 2E 72 
       67 62 61 32 
       00          
0457AD 73 70 72 69 0386*   fn_fireball_3_160: db "sprites/fireball_3_160.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 31 
       36 30 2E 72 
       67 62 61 32 
       00          
0457CA 73 70 72 69 0387*   fn_fireball_3_168: db "sprites/fireball_3_168.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 31 
       36 38 2E 72 
       67 62 61 32 
       00          
0457E7 73 70 72 69 0388*   fn_fireball_3_176: db "sprites/fireball_3_176.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 31 
       37 36 2E 72 
       67 62 61 32 
       00          
045804 73 70 72 69 0389*   fn_fireball_3_184: db "sprites/fireball_3_184.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 31 
       38 34 2E 72 
       67 62 61 32 
       00          
045821 73 70 72 69 0390*   fn_fireball_3_192: db "sprites/fireball_3_192.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 31 
       39 32 2E 72 
       67 62 61 32 
       00          
04583E 73 70 72 69 0391*   fn_fireball_3_200: db "sprites/fireball_3_200.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 32 
       30 30 2E 72 
       67 62 61 32 
       00          
04585B 73 70 72 69 0392*   fn_fireball_3_208: db "sprites/fireball_3_208.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 32 
       30 38 2E 72 
       67 62 61 32 
       00          
045878 73 70 72 69 0393*   fn_fireball_3_216: db "sprites/fireball_3_216.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 32 
       31 36 2E 72 
       67 62 61 32 
       00          
045895 73 70 72 69 0394*   fn_fireball_3_224: db "sprites/fireball_3_224.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 32 
       32 34 2E 72 
       67 62 61 32 
       00          
0458B2 73 70 72 69 0395*   fn_fireball_3_232: db "sprites/fireball_3_232.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 32 
       33 32 2E 72 
       67 62 61 32 
       00          
0458CF 73 70 72 69 0396*   fn_fireball_3_240: db "sprites/fireball_3_240.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 32 
       34 30 2E 72 
       67 62 61 32 
       00          
0458EC 73 70 72 69 0397*   fn_fireball_3_248: db "sprites/fireball_3_248.rgba2",0
       74 65 73 2F 
       66 69 72 65 
       62 61 6C 6C 
       5F 33 5F 32 
       34 38 2E 72 
       67 62 61 32 
       00          
045909 73 70 72 69 0398*   fn_laser_a: db "sprites/laser_a.rgba2",0
       74 65 73 2F 
       6C 61 73 65 
       72 5F 61 2E 
       72 67 62 61 
       32 00       
04591F 73 70 72 69 0399*   fn_laser_b: db "sprites/laser_b.rgba2",0
       74 65 73 2F 
       6C 61 73 65 
       72 5F 62 2E 
       72 67 62 61 
       32 00       
045935 73 70 72 69 0400*   fn_lightning_h_0: db "sprites/lightning_h_0.rgba2",0
       74 65 73 2F 
       6C 69 67 68 
       74 6E 69 6E 
       67 5F 68 5F 
       30 2E 72 67 
       62 61 32 00 
045951 73 70 72 69 0401*   fn_lightning_h_1: db "sprites/lightning_h_1.rgba2",0
       74 65 73 2F 
       6C 69 67 68 
       74 6E 69 6E 
       67 5F 68 5F 
       31 2E 72 67 
       62 61 32 00 
04596D 73 70 72 69 0402*   fn_pad: db "sprites/pad.rgba2",0
       74 65 73 2F 
       70 61 64 2E 
       72 67 62 61 
       32 00       
04597F 73 70 72 69 0403*   fn_seeker_000: db "sprites/seeker_000.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 30 
       30 30 2E 72 
       67 62 61 32 
       00          
045998 73 70 72 69 0404*   fn_seeker_008: db "sprites/seeker_008.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 30 
       30 38 2E 72 
       67 62 61 32 
       00          
0459B1 73 70 72 69 0405*   fn_seeker_016: db "sprites/seeker_016.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 30 
       31 36 2E 72 
       67 62 61 32 
       00          
0459CA 73 70 72 69 0406*   fn_seeker_024: db "sprites/seeker_024.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 30 
       32 34 2E 72 
       67 62 61 32 
       00          
0459E3 73 70 72 69 0407*   fn_seeker_032: db "sprites/seeker_032.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 30 
       33 32 2E 72 
       67 62 61 32 
       00          
0459FC 73 70 72 69 0408*   fn_seeker_040: db "sprites/seeker_040.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 30 
       34 30 2E 72 
       67 62 61 32 
       00          
045A15 73 70 72 69 0409*   fn_seeker_048: db "sprites/seeker_048.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 30 
       34 38 2E 72 
       67 62 61 32 
       00          
045A2E 73 70 72 69 0410*   fn_seeker_056: db "sprites/seeker_056.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 30 
       35 36 2E 72 
       67 62 61 32 
       00          
045A47 73 70 72 69 0411*   fn_seeker_064: db "sprites/seeker_064.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 30 
       36 34 2E 72 
       67 62 61 32 
       00          
045A60 73 70 72 69 0412*   fn_seeker_072: db "sprites/seeker_072.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 30 
       37 32 2E 72 
       67 62 61 32 
       00          
045A79 73 70 72 69 0413*   fn_seeker_080: db "sprites/seeker_080.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 30 
       38 30 2E 72 
       67 62 61 32 
       00          
045A92 73 70 72 69 0414*   fn_seeker_088: db "sprites/seeker_088.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 30 
       38 38 2E 72 
       67 62 61 32 
       00          
045AAB 73 70 72 69 0415*   fn_seeker_096: db "sprites/seeker_096.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 30 
       39 36 2E 72 
       67 62 61 32 
       00          
045AC4 73 70 72 69 0416*   fn_seeker_104: db "sprites/seeker_104.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 31 
       30 34 2E 72 
       67 62 61 32 
       00          
045ADD 73 70 72 69 0417*   fn_seeker_112: db "sprites/seeker_112.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 31 
       31 32 2E 72 
       67 62 61 32 
       00          
045AF6 73 70 72 69 0418*   fn_seeker_120: db "sprites/seeker_120.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 31 
       32 30 2E 72 
       67 62 61 32 
       00          
045B0F 73 70 72 69 0419*   fn_seeker_128: db "sprites/seeker_128.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 31 
       32 38 2E 72 
       67 62 61 32 
       00          
045B28 73 70 72 69 0420*   fn_seeker_136: db "sprites/seeker_136.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 31 
       33 36 2E 72 
       67 62 61 32 
       00          
045B41 73 70 72 69 0421*   fn_seeker_144: db "sprites/seeker_144.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 31 
       34 34 2E 72 
       67 62 61 32 
       00          
045B5A 73 70 72 69 0422*   fn_seeker_152: db "sprites/seeker_152.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 31 
       35 32 2E 72 
       67 62 61 32 
       00          
045B73 73 70 72 69 0423*   fn_seeker_160: db "sprites/seeker_160.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 31 
       36 30 2E 72 
       67 62 61 32 
       00          
045B8C 73 70 72 69 0424*   fn_seeker_168: db "sprites/seeker_168.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 31 
       36 38 2E 72 
       67 62 61 32 
       00          
045BA5 73 70 72 69 0425*   fn_seeker_176: db "sprites/seeker_176.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 31 
       37 36 2E 72 
       67 62 61 32 
       00          
045BBE 73 70 72 69 0426*   fn_seeker_184: db "sprites/seeker_184.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 31 
       38 34 2E 72 
       67 62 61 32 
       00          
045BD7 73 70 72 69 0427*   fn_seeker_192: db "sprites/seeker_192.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 31 
       39 32 2E 72 
       67 62 61 32 
       00          
045BF0 73 70 72 69 0428*   fn_seeker_200: db "sprites/seeker_200.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 32 
       30 30 2E 72 
       67 62 61 32 
       00          
045C09 73 70 72 69 0429*   fn_seeker_208: db "sprites/seeker_208.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 32 
       30 38 2E 72 
       67 62 61 32 
       00          
045C22 73 70 72 69 0430*   fn_seeker_216: db "sprites/seeker_216.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 32 
       31 36 2E 72 
       67 62 61 32 
       00          
045C3B 73 70 72 69 0431*   fn_seeker_224: db "sprites/seeker_224.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 32 
       32 34 2E 72 
       67 62 61 32 
       00          
045C54 73 70 72 69 0432*   fn_seeker_232: db "sprites/seeker_232.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 32 
       33 32 2E 72 
       67 62 61 32 
       00          
045C6D 73 70 72 69 0433*   fn_seeker_240: db "sprites/seeker_240.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 32 
       34 30 2E 72 
       67 62 61 32 
       00          
045C86 73 70 72 69 0434*   fn_seeker_248: db "sprites/seeker_248.rgba2",0
       74 65 73 2F 
       73 65 65 6B 
       65 72 5F 32 
       34 38 2E 72 
       67 62 61 32 
       00          
045C9F 73 70 72 69 0435*   fn_ship_0l: db "sprites/ship_0l.rgba2",0
       74 65 73 2F 
       73 68 69 70 
       5F 30 6C 2E 
       72 67 62 61 
       32 00       
045CB5 73 70 72 69 0436*   fn_ship_1c: db "sprites/ship_1c.rgba2",0
       74 65 73 2F 
       73 68 69 70 
       5F 31 63 2E 
       72 67 62 61 
       32 00       
045CCB 73 70 72 69 0437*   fn_ship_2r: db "sprites/ship_2r.rgba2",0
       74 65 73 2F 
       73 68 69 70 
       5F 32 72 2E 
       72 67 62 61 
       32 00       
045CE1 73 70 72 69 0438*   fn_ship_small: db "sprites/ship_small.rgba2",0
       74 65 73 2F 
       73 68 69 70 
       5F 73 6D 61 
       6C 6C 2E 72 
       67 62 61 32 
       00          
045CFA 73 70 72 69 0439*   fn_test_stripes: db "sprites/test_stripes.rgba2",0
       74 65 73 2F 
       74 65 73 74 
       5F 73 74 72 
       69 70 65 73 
       2E 72 67 62 
       61 32 00    
045D15 73 70 72 69 0440*   fn_tile_blank: db "sprites/tile_blank.rgba2",0
       74 65 73 2F 
       74 69 6C 65 
       5F 62 6C 61 
       6E 6B 2E 72 
       67 62 61 32 
       00          
045D2E 73 70 72 69 0441*   fn_tile_pad_0: db "sprites/tile_pad_0.rgba2",0
       74 65 73 2F 
       74 69 6C 65 
       5F 70 61 64 
       5F 30 2E 72 
       67 62 61 32 
       00          
045D47 73 70 72 69 0442*   fn_tile_pad_1: db "sprites/tile_pad_1.rgba2",0
       74 65 73 2F 
       74 69 6C 65 
       5F 70 61 64 
       5F 31 2E 72 
       67 62 61 32 
       00          
045D60 73 70 72 69 0443*   fn_tile_pad_2: db "sprites/tile_pad_2.rgba2",0
       74 65 73 2F 
       74 69 6C 65 
       5F 70 61 64 
       5F 32 2E 72 
       67 62 61 32 
       00          
045D79 73 70 72 69 0444*   fn_tile_pad_3: db "sprites/tile_pad_3.rgba2",0
       74 65 73 2F 
       74 69 6C 65 
       5F 70 61 64 
       5F 33 2E 72 
       67 62 61 32 
       00          
045D92 73 70 72 69 0445*   fn_tile_pad_4: db "sprites/tile_pad_4.rgba2",0
       74 65 73 2F 
       74 69 6C 65 
       5F 70 61 64 
       5F 34 2E 72 
       67 62 61 32 
       00          
045DAB 73 70 72 69 0446*   fn_tile_pad_5: db "sprites/tile_pad_5.rgba2",0
       74 65 73 2F 
       74 69 6C 65 
       5F 70 61 64 
       5F 35 2E 72 
       67 62 61 32 
       00          
045DC4 73 70 72 69 0447*   fn_tile_pad_6: db "sprites/tile_pad_6.rgba2",0
       74 65 73 2F 
       74 69 6C 65 
       5F 70 61 64 
       5F 36 2E 72 
       67 62 61 32 
       00          
045DDD 73 70 72 69 0448*   fn_tile_pad_7: db "sprites/tile_pad_7.rgba2",0
       74 65 73 2F 
       74 69 6C 65 
       5F 70 61 64 
       5F 37 2E 72 
       67 62 61 32 
       00          
045DF6 73 70 72 69 0449*   fn_turret_000: db "sprites/turret_000.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 30 
       30 30 2E 72 
       67 62 61 32 
       00          
045E0F 73 70 72 69 0450*   fn_turret_008: db "sprites/turret_008.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 30 
       30 38 2E 72 
       67 62 61 32 
       00          
045E28 73 70 72 69 0451*   fn_turret_016: db "sprites/turret_016.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 30 
       31 36 2E 72 
       67 62 61 32 
       00          
045E41 73 70 72 69 0452*   fn_turret_024: db "sprites/turret_024.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 30 
       32 34 2E 72 
       67 62 61 32 
       00          
045E5A 73 70 72 69 0453*   fn_turret_032: db "sprites/turret_032.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 30 
       33 32 2E 72 
       67 62 61 32 
       00          
045E73 73 70 72 69 0454*   fn_turret_040: db "sprites/turret_040.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 30 
       34 30 2E 72 
       67 62 61 32 
       00          
045E8C 73 70 72 69 0455*   fn_turret_048: db "sprites/turret_048.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 30 
       34 38 2E 72 
       67 62 61 32 
       00          
045EA5 73 70 72 69 0456*   fn_turret_056: db "sprites/turret_056.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 30 
       35 36 2E 72 
       67 62 61 32 
       00          
045EBE 73 70 72 69 0457*   fn_turret_064: db "sprites/turret_064.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 30 
       36 34 2E 72 
       67 62 61 32 
       00          
045ED7 73 70 72 69 0458*   fn_turret_072: db "sprites/turret_072.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 30 
       37 32 2E 72 
       67 62 61 32 
       00          
045EF0 73 70 72 69 0459*   fn_turret_080: db "sprites/turret_080.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 30 
       38 30 2E 72 
       67 62 61 32 
       00          
045F09 73 70 72 69 0460*   fn_turret_088: db "sprites/turret_088.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 30 
       38 38 2E 72 
       67 62 61 32 
       00          
045F22 73 70 72 69 0461*   fn_turret_096: db "sprites/turret_096.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 30 
       39 36 2E 72 
       67 62 61 32 
       00          
045F3B 73 70 72 69 0462*   fn_turret_104: db "sprites/turret_104.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 31 
       30 34 2E 72 
       67 62 61 32 
       00          
045F54 73 70 72 69 0463*   fn_turret_112: db "sprites/turret_112.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 31 
       31 32 2E 72 
       67 62 61 32 
       00          
045F6D 73 70 72 69 0464*   fn_turret_120: db "sprites/turret_120.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 31 
       32 30 2E 72 
       67 62 61 32 
       00          
045F86 73 70 72 69 0465*   fn_turret_128: db "sprites/turret_128.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 31 
       32 38 2E 72 
       67 62 61 32 
       00          
045F9F 73 70 72 69 0466*   fn_turret_136: db "sprites/turret_136.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 31 
       33 36 2E 72 
       67 62 61 32 
       00          
045FB8 73 70 72 69 0467*   fn_turret_144: db "sprites/turret_144.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 31 
       34 34 2E 72 
       67 62 61 32 
       00          
045FD1 73 70 72 69 0468*   fn_turret_152: db "sprites/turret_152.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 31 
       35 32 2E 72 
       67 62 61 32 
       00          
045FEA 73 70 72 69 0469*   fn_turret_160: db "sprites/turret_160.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 31 
       36 30 2E 72 
       67 62 61 32 
       00          
046003 73 70 72 69 0470*   fn_turret_168: db "sprites/turret_168.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 31 
       36 38 2E 72 
       67 62 61 32 
       00          
04601C 73 70 72 69 0471*   fn_turret_176: db "sprites/turret_176.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 31 
       37 36 2E 72 
       67 62 61 32 
       00          
046035 73 70 72 69 0472*   fn_turret_184: db "sprites/turret_184.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 31 
       38 34 2E 72 
       67 62 61 32 
       00          
04604E 73 70 72 69 0473*   fn_turret_192: db "sprites/turret_192.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 31 
       39 32 2E 72 
       67 62 61 32 
       00          
046067 73 70 72 69 0474*   fn_turret_200: db "sprites/turret_200.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 32 
       30 30 2E 72 
       67 62 61 32 
       00          
046080 73 70 72 69 0475*   fn_turret_208: db "sprites/turret_208.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 32 
       30 38 2E 72 
       67 62 61 32 
       00          
046099 73 70 72 69 0476*   fn_turret_216: db "sprites/turret_216.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 32 
       31 36 2E 72 
       67 62 61 32 
       00          
0460B2 73 70 72 69 0477*   fn_turret_224: db "sprites/turret_224.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 32 
       32 34 2E 72 
       67 62 61 32 
       00          
0460CB 73 70 72 69 0478*   fn_turret_232: db "sprites/turret_232.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 32 
       33 32 2E 72 
       67 62 61 32 
       00          
0460E4 73 70 72 69 0479*   fn_turret_240: db "sprites/turret_240.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 32 
       34 30 2E 72 
       67 62 61 32 
       00          
0460FD 73 70 72 69 0480*   fn_turret_248: db "sprites/turret_248.rgba2",0
       74 65 73 2F 
       74 75 72 72 
       65 74 5F 32 
       34 38 2E 72 
       67 62 61 32 
       00          
046116             0055        include "images_ui.inc"
046116             0001*   ; Generated by make_images.py
046116             0002*   
046116             0003*   ui_num_images: equ 43
046116             0004*   
046116             0005*   ; buffer_ids:
046116             0006*   BUF_BAR_H_0: equ 0
046116             0007*   BUF_BAR_H_1: equ 1
046116             0008*   BUF_BAR_H_2: equ 2
046116             0009*   BUF_BAR_V_0: equ 3
046116             0010*   BUF_BAR_V_1: equ 4
046116             0011*   BUF_BAR_V_2: equ 5
046116             0012*   BUF_BEZEL_L: equ 6
046116             0013*   BUF_BEZEL_R: equ 7
046116             0014*   BUF_CREDITS: equ 8
046116             0015*   BUF_CTL_PANEL_L: equ 9
046116             0016*   BUF_CTL_PANEL_R: equ 10
046116             0017*   BUF_JERRY_CAN: equ 11
046116             0018*   BUF_MFD_ARMS: equ 12
046116             0019*   BUF_MFD_BEZEL: equ 13
046116             0020*   BUF_MFD_BG: equ 14
046116             0021*   BUF_MFD_GUN_0: equ 15
046116             0022*   BUF_MFD_GUN_1: equ 16
046116             0023*   BUF_MFD_GUN_2: equ 17
046116             0024*   BUF_MFD_GUN_3: equ 18
046116             0025*   BUF_MFD_GUN_4: equ 19
046116             0026*   BUF_MFD_GUN_5: equ 20
046116             0027*   BUF_MFD_MAVERICK_0: equ 21
046116             0028*   BUF_MFD_MAVERICK_1: equ 22
046116             0029*   BUF_MFD_MAVERICK_2: equ 23
046116             0030*   BUF_MFD_MAVERICK_3: equ 24
046116             0031*   BUF_MFD_MAVERICK_4: equ 25
046116             0032*   BUF_MFD_MAVERICK_5: equ 26
046116             0033*   BUF_MFD_SIDEWINDER_0: equ 27
046116             0034*   BUF_MFD_SIDEWINDER_1: equ 28
046116             0035*   BUF_MFD_SIDEWINDER_2: equ 29
046116             0036*   BUF_MFD_SIDEWINDER_3: equ 30
046116             0037*   BUF_MFD_SIDEWINDER_4: equ 31
046116             0038*   BUF_MFD_SIDEWINDER_5: equ 32
046116             0039*   BUF_MFD_SPARROW_0: equ 33
046116             0040*   BUF_MFD_SPARROW_1: equ 34
046116             0041*   BUF_MFD_SPARROW_2: equ 35
046116             0042*   BUF_MFD_SPARROW_3: equ 36
046116             0043*   BUF_MFD_SPARROW_4: equ 37
046116             0044*   BUF_MFD_SPARROW_5: equ 38
046116             0045*   BUF_POWER: equ 39
046116             0046*   BUF_SHIELD: equ 40
046116             0047*   BUF_SPLASH_BG: equ 41
046116             0048*   BUF_SPLASH_LOGO: equ 42
046116             0049*   
046116             0050*   ui_image_list: ; type; width; height; size; filename; bufferId:
046116 01 00 00 80 0051*   	dl 1, 128, 8, 1024, fn_bar_h_0, 0
       00 00 08 00 
       00 00 04 00 
       1C 64 04 00 
       00 00       
046128 01 00 00 80 0052*   	dl 1, 128, 8, 1024, fn_bar_h_1, 1
       00 00 08 00 
       00 00 04 00 
       2D 64 04 01 
       00 00       
04613A 01 00 00 80 0053*   	dl 1, 128, 8, 1024, fn_bar_h_2, 2
       00 00 08 00 
       00 00 04 00 
       3E 64 04 02 
       00 00       
04614C 01 00 00 08 0054*   	dl 1, 8, 128, 1024, fn_bar_v_0, 3
       00 00 80 00 
       00 00 04 00 
       4F 64 04 03 
       00 00       
04615E 01 00 00 08 0055*   	dl 1, 8, 128, 1024, fn_bar_v_1, 4
       00 00 80 00 
       00 00 04 00 
       60 64 04 04 
       00 00       
046170 01 00 00 08 0056*   	dl 1, 8, 128, 1024, fn_bar_v_2, 5
       00 00 80 00 
       00 00 04 00 
       71 64 04 05 
       00 00       
046182 01 00 00 80 0057*   	dl 1, 128, 304, 38912, fn_bezel_l, 6
       00 00 30 01 
       00 00 98 00 
       82 64 04 06 
       00 00       
046194 01 00 00 80 0058*   	dl 1, 128, 304, 38912, fn_bezel_r, 7
       00 00 30 01 
       00 00 98 00 
       93 64 04 07 
       00 00       
0461A6 01 00 00 10 0059*   	dl 1, 16, 16, 256, fn_credits, 8
       00 00 10 00 
       00 00 01 00 
       A4 64 04 08 
       00 00       
0461B8 01 00 00 80 0060*   	dl 1, 128, 128, 16384, fn_ctl_panel_l, 9
       00 00 80 00 
       00 00 40 00 
       B5 64 04 09 
       00 00       
0461CA 01 00 00 80 0061*   	dl 1, 128, 128, 16384, fn_ctl_panel_r, 10
       00 00 80 00 
       00 00 40 00 
       CA 64 04 0A 
       00 00       
0461DC 01 00 00 10 0062*   	dl 1, 16, 16, 256, fn_jerry_can, 11
       00 00 10 00 
       00 00 01 00 
       DF 64 04 0B 
       00 00       
0461EE 01 00 00 24 0063*   	dl 1, 36, 18, 648, fn_mfd_arms, 12
       00 00 12 00 
       00 88 02 00 
       F2 64 04 0C 
       00 00       
046200 01 00 00 60 0064*   	dl 1, 96, 96, 9216, fn_mfd_bezel, 13
       00 00 60 00 
       00 00 24 00 
       04 65 04 0D 
       00 00       
046212 01 00 00 40 0065*   	dl 1, 64, 64, 4096, fn_mfd_bg, 14
       00 00 40 00 
       00 00 10 00 
       17 65 04 0E 
       00 00       
046224 01 00 00 01 0066*   	dl 1, 1, 6, 6, fn_mfd_gun_0, 15
       00 00 06 00 
       00 06 00 00 
       27 65 04 0F 
       00 00       
046236 01 00 00 01 0067*   	dl 1, 1, 6, 6, fn_mfd_gun_1, 16
       00 00 06 00 
       00 06 00 00 
       3A 65 04 10 
       00 00       
046248 01 00 00 01 0068*   	dl 1, 1, 6, 6, fn_mfd_gun_2, 17
       00 00 06 00 
       00 06 00 00 
       4D 65 04 11 
       00 00       
04625A 01 00 00 01 0069*   	dl 1, 1, 6, 6, fn_mfd_gun_3, 18
       00 00 06 00 
       00 06 00 00 
       60 65 04 12 
       00 00       
04626C 01 00 00 01 0070*   	dl 1, 1, 6, 6, fn_mfd_gun_4, 19
       00 00 06 00 
       00 06 00 00 
       73 65 04 13 
       00 00       
04627E 01 00 00 01 0071*   	dl 1, 1, 6, 6, fn_mfd_gun_5, 20
       00 00 06 00 
       00 06 00 00 
       86 65 04 14 
       00 00       
046290 01 00 00 04 0072*   	dl 1, 4, 6, 24, fn_mfd_maverick_0, 21
       00 00 06 00 
       00 18 00 00 
       99 65 04 15 
       00 00       
0462A2 01 00 00 04 0073*   	dl 1, 4, 6, 24, fn_mfd_maverick_1, 22
       00 00 06 00 
       00 18 00 00 
       B1 65 04 16 
       00 00       
0462B4 01 00 00 04 0074*   	dl 1, 4, 6, 24, fn_mfd_maverick_2, 23
       00 00 06 00 
       00 18 00 00 
       C9 65 04 17 
       00 00       
0462C6 01 00 00 04 0075*   	dl 1, 4, 6, 24, fn_mfd_maverick_3, 24
       00 00 06 00 
       00 18 00 00 
       E1 65 04 18 
       00 00       
0462D8 01 00 00 04 0076*   	dl 1, 4, 6, 24, fn_mfd_maverick_4, 25
       00 00 06 00 
       00 18 00 00 
       F9 65 04 19 
       00 00       
0462EA 01 00 00 04 0077*   	dl 1, 4, 6, 24, fn_mfd_maverick_5, 26
       00 00 06 00 
       00 18 00 00 
       11 66 04 1A 
       00 00       
0462FC 01 00 00 03 0078*   	dl 1, 3, 6, 18, fn_mfd_sidewinder_0, 27
       00 00 06 00 
       00 12 00 00 
       29 66 04 1B 
       00 00       
04630E 01 00 00 03 0079*   	dl 1, 3, 6, 18, fn_mfd_sidewinder_1, 28
       00 00 06 00 
       00 12 00 00 
       43 66 04 1C 
       00 00       
046320 01 00 00 03 0080*   	dl 1, 3, 6, 18, fn_mfd_sidewinder_2, 29
       00 00 06 00 
       00 12 00 00 
       5D 66 04 1D 
       00 00       
046332 01 00 00 03 0081*   	dl 1, 3, 6, 18, fn_mfd_sidewinder_3, 30
       00 00 06 00 
       00 12 00 00 
       77 66 04 1E 
       00 00       
046344 01 00 00 03 0082*   	dl 1, 3, 6, 18, fn_mfd_sidewinder_4, 31
       00 00 06 00 
       00 12 00 00 
       91 66 04 1F 
       00 00       
046356 01 00 00 03 0083*   	dl 1, 3, 6, 18, fn_mfd_sidewinder_5, 32
       00 00 06 00 
       00 12 00 00 
       AB 66 04 20 
       00 00       
046368 01 00 00 03 0084*   	dl 1, 3, 7, 21, fn_mfd_sparrow_0, 33
       00 00 07 00 
       00 15 00 00 
       C5 66 04 21 
       00 00       
04637A 01 00 00 03 0085*   	dl 1, 3, 7, 21, fn_mfd_sparrow_1, 34
       00 00 07 00 
       00 15 00 00 
       DC 66 04 22 
       00 00       
04638C 01 00 00 03 0086*   	dl 1, 3, 7, 21, fn_mfd_sparrow_2, 35
       00 00 07 00 
       00 15 00 00 
       F3 66 04 23 
       00 00       
04639E 01 00 00 03 0087*   	dl 1, 3, 7, 21, fn_mfd_sparrow_3, 36
       00 00 07 00 
       00 15 00 00 
       0A 67 04 24 
       00 00       
0463B0 01 00 00 03 0088*   	dl 1, 3, 7, 21, fn_mfd_sparrow_4, 37
       00 00 07 00 
       00 15 00 00 
       21 67 04 25 
       00 00       
0463C2 01 00 00 03 0089*   	dl 1, 3, 7, 21, fn_mfd_sparrow_5, 38
       00 00 07 00 
       00 15 00 00 
       38 67 04 26 
       00 00       
0463D4 01 00 00 10 0090*   	dl 1, 16, 16, 256, fn_power, 39
       00 00 10 00 
       00 00 01 00 
       4F 67 04 27 
       00 00       
0463E6 01 00 00 10 0091*   	dl 1, 16, 16, 256, fn_shield, 40
       00 00 10 00 
       00 00 01 00 
       5E 67 04 28 
       00 00       
0463F8 01 00 00 40 0092*   	dl 1, 320, 240, 76800, fn_splash_bg, 41
       01 00 F0 00 
       00 00 2C 01 
       6E 67 04 29 
       00 00       
04640A 01 00 00 A0 0093*   	dl 1, 160, 106, 16960, fn_splash_logo, 42
       00 00 6A 00 
       00 40 42 00 
       81 67 04 2A 
       00 00       
04641C             0094*   
04641C             0095*   ; files_list: ; filename:
04641C 75 69 2F 62 0096*   fn_bar_h_0: db "ui/bar_h_0.rgba2",0
       61 72 5F 68 
       5F 30 2E 72 
       67 62 61 32 
       00          
04642D 75 69 2F 62 0097*   fn_bar_h_1: db "ui/bar_h_1.rgba2",0
       61 72 5F 68 
       5F 31 2E 72 
       67 62 61 32 
       00          
04643E 75 69 2F 62 0098*   fn_bar_h_2: db "ui/bar_h_2.rgba2",0
       61 72 5F 68 
       5F 32 2E 72 
       67 62 61 32 
       00          
04644F 75 69 2F 62 0099*   fn_bar_v_0: db "ui/bar_v_0.rgba2",0
       61 72 5F 76 
       5F 30 2E 72 
       67 62 61 32 
       00          
046460 75 69 2F 62 0100*   fn_bar_v_1: db "ui/bar_v_1.rgba2",0
       61 72 5F 76 
       5F 31 2E 72 
       67 62 61 32 
       00          
046471 75 69 2F 62 0101*   fn_bar_v_2: db "ui/bar_v_2.rgba2",0
       61 72 5F 76 
       5F 32 2E 72 
       67 62 61 32 
       00          
046482 75 69 2F 62 0102*   fn_bezel_l: db "ui/bezel_l.rgba2",0
       65 7A 65 6C 
       5F 6C 2E 72 
       67 62 61 32 
       00          
046493 75 69 2F 62 0103*   fn_bezel_r: db "ui/bezel_r.rgba2",0
       65 7A 65 6C 
       5F 72 2E 72 
       67 62 61 32 
       00          
0464A4 75 69 2F 63 0104*   fn_credits: db "ui/credits.rgba2",0
       72 65 64 69 
       74 73 2E 72 
       67 62 61 32 
       00          
0464B5 75 69 2F 63 0105*   fn_ctl_panel_l: db "ui/ctl_panel_l.rgba2",0
       74 6C 5F 70 
       61 6E 65 6C 
       5F 6C 2E 72 
       67 62 61 32 
       00          
0464CA 75 69 2F 63 0106*   fn_ctl_panel_r: db "ui/ctl_panel_r.rgba2",0
       74 6C 5F 70 
       61 6E 65 6C 
       5F 72 2E 72 
       67 62 61 32 
       00          
0464DF 75 69 2F 6A 0107*   fn_jerry_can: db "ui/jerry_can.rgba2",0
       65 72 72 79 
       5F 63 61 6E 
       2E 72 67 62 
       61 32 00    
0464F2 75 69 2F 6D 0108*   fn_mfd_arms: db "ui/mfd_arms.rgba2",0
       66 64 5F 61 
       72 6D 73 2E 
       72 67 62 61 
       32 00       
046504 75 69 2F 6D 0109*   fn_mfd_bezel: db "ui/mfd_bezel.rgba2",0
       66 64 5F 62 
       65 7A 65 6C 
       2E 72 67 62 
       61 32 00    
046517 75 69 2F 6D 0110*   fn_mfd_bg: db "ui/mfd_bg.rgba2",0
       66 64 5F 62 
       67 2E 72 67 
       62 61 32 00 
046527 75 69 2F 6D 0111*   fn_mfd_gun_0: db "ui/mfd_gun_0.rgba2",0
       66 64 5F 67 
       75 6E 5F 30 
       2E 72 67 62 
       61 32 00    
04653A 75 69 2F 6D 0112*   fn_mfd_gun_1: db "ui/mfd_gun_1.rgba2",0
       66 64 5F 67 
       75 6E 5F 31 
       2E 72 67 62 
       61 32 00    
04654D 75 69 2F 6D 0113*   fn_mfd_gun_2: db "ui/mfd_gun_2.rgba2",0
       66 64 5F 67 
       75 6E 5F 32 
       2E 72 67 62 
       61 32 00    
046560 75 69 2F 6D 0114*   fn_mfd_gun_3: db "ui/mfd_gun_3.rgba2",0
       66 64 5F 67 
       75 6E 5F 33 
       2E 72 67 62 
       61 32 00    
046573 75 69 2F 6D 0115*   fn_mfd_gun_4: db "ui/mfd_gun_4.rgba2",0
       66 64 5F 67 
       75 6E 5F 34 
       2E 72 67 62 
       61 32 00    
046586 75 69 2F 6D 0116*   fn_mfd_gun_5: db "ui/mfd_gun_5.rgba2",0
       66 64 5F 67 
       75 6E 5F 35 
       2E 72 67 62 
       61 32 00    
046599 75 69 2F 6D 0117*   fn_mfd_maverick_0: db "ui/mfd_maverick_0.rgba2",0
       66 64 5F 6D 
       61 76 65 72 
       69 63 6B 5F 
       30 2E 72 67 
       62 61 32 00 
0465B1 75 69 2F 6D 0118*   fn_mfd_maverick_1: db "ui/mfd_maverick_1.rgba2",0
       66 64 5F 6D 
       61 76 65 72 
       69 63 6B 5F 
       31 2E 72 67 
       62 61 32 00 
0465C9 75 69 2F 6D 0119*   fn_mfd_maverick_2: db "ui/mfd_maverick_2.rgba2",0
       66 64 5F 6D 
       61 76 65 72 
       69 63 6B 5F 
       32 2E 72 67 
       62 61 32 00 
0465E1 75 69 2F 6D 0120*   fn_mfd_maverick_3: db "ui/mfd_maverick_3.rgba2",0
       66 64 5F 6D 
       61 76 65 72 
       69 63 6B 5F 
       33 2E 72 67 
       62 61 32 00 
0465F9 75 69 2F 6D 0121*   fn_mfd_maverick_4: db "ui/mfd_maverick_4.rgba2",0
       66 64 5F 6D 
       61 76 65 72 
       69 63 6B 5F 
       34 2E 72 67 
       62 61 32 00 
046611 75 69 2F 6D 0122*   fn_mfd_maverick_5: db "ui/mfd_maverick_5.rgba2",0
       66 64 5F 6D 
       61 76 65 72 
       69 63 6B 5F 
       35 2E 72 67 
       62 61 32 00 
046629 75 69 2F 6D 0123*   fn_mfd_sidewinder_0: db "ui/mfd_sidewinder_0.rgba2",0
       66 64 5F 73 
       69 64 65 77 
       69 6E 64 65 
       72 5F 30 2E 
       72 67 62 61 
       32 00       
046643 75 69 2F 6D 0124*   fn_mfd_sidewinder_1: db "ui/mfd_sidewinder_1.rgba2",0
       66 64 5F 73 
       69 64 65 77 
       69 6E 64 65 
       72 5F 31 2E 
       72 67 62 61 
       32 00       
04665D 75 69 2F 6D 0125*   fn_mfd_sidewinder_2: db "ui/mfd_sidewinder_2.rgba2",0
       66 64 5F 73 
       69 64 65 77 
       69 6E 64 65 
       72 5F 32 2E 
       72 67 62 61 
       32 00       
046677 75 69 2F 6D 0126*   fn_mfd_sidewinder_3: db "ui/mfd_sidewinder_3.rgba2",0
       66 64 5F 73 
       69 64 65 77 
       69 6E 64 65 
       72 5F 33 2E 
       72 67 62 61 
       32 00       
046691 75 69 2F 6D 0127*   fn_mfd_sidewinder_4: db "ui/mfd_sidewinder_4.rgba2",0
       66 64 5F 73 
       69 64 65 77 
       69 6E 64 65 
       72 5F 34 2E 
       72 67 62 61 
       32 00       
0466AB 75 69 2F 6D 0128*   fn_mfd_sidewinder_5: db "ui/mfd_sidewinder_5.rgba2",0
       66 64 5F 73 
       69 64 65 77 
       69 6E 64 65 
       72 5F 35 2E 
       72 67 62 61 
       32 00       
0466C5 75 69 2F 6D 0129*   fn_mfd_sparrow_0: db "ui/mfd_sparrow_0.rgba2",0
       66 64 5F 73 
       70 61 72 72 
       6F 77 5F 30 
       2E 72 67 62 
       61 32 00    
0466DC 75 69 2F 6D 0130*   fn_mfd_sparrow_1: db "ui/mfd_sparrow_1.rgba2",0
       66 64 5F 73 
       70 61 72 72 
       6F 77 5F 31 
       2E 72 67 62 
       61 32 00    
0466F3 75 69 2F 6D 0131*   fn_mfd_sparrow_2: db "ui/mfd_sparrow_2.rgba2",0
       66 64 5F 73 
       70 61 72 72 
       6F 77 5F 32 
       2E 72 67 62 
       61 32 00    
04670A 75 69 2F 6D 0132*   fn_mfd_sparrow_3: db "ui/mfd_sparrow_3.rgba2",0
       66 64 5F 73 
       70 61 72 72 
       6F 77 5F 33 
       2E 72 67 62 
       61 32 00    
046721 75 69 2F 6D 0133*   fn_mfd_sparrow_4: db "ui/mfd_sparrow_4.rgba2",0
       66 64 5F 73 
       70 61 72 72 
       6F 77 5F 34 
       2E 72 67 62 
       61 32 00    
046738 75 69 2F 6D 0134*   fn_mfd_sparrow_5: db "ui/mfd_sparrow_5.rgba2",0
       66 64 5F 73 
       70 61 72 72 
       6F 77 5F 35 
       2E 72 67 62 
       61 32 00    
04674F 75 69 2F 70 0135*   fn_power: db "ui/power.rgba2",0
       6F 77 65 72 
       2E 72 67 62 
       61 32 00    
04675E 75 69 2F 73 0136*   fn_shield: db "ui/shield.rgba2",0
       68 69 65 6C 
       64 2E 72 67 
       62 61 32 00 
04676E 75 69 2F 73 0137*   fn_splash_bg: db "ui/splash_bg.rgba2",0
       70 6C 61 73 
       68 5F 62 67 
       2E 72 67 62 
       61 32 00    
046781 75 69 2F 73 0138*   fn_splash_logo: db "ui/splash_logo.rgba2",0
       70 6C 61 73 
       68 5F 6C 6F 
       67 6F 2E 72 
       67 62 61 32 
       00          
046796             0056        include "levels.inc"
046796 FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF       
046800             0002*   
046800             0003*   ; tileset indices
046800             0004*   tiles_dg: equ 0
046800             0005*   ; tiles_xevious: equ 1
046800 00 00 00    0006*   tileset_ptr_idx: dl 0
046803             0007*   tileset_ptrs:
046803             0008*       ; dl tiles_xevious_levels
046803 14 69 04    0009*       dl tileset_00_levels
046806 00 00 00    0010*   tileset_ptrs_end: dl 0 ; list terminator
046809             0011*   
046809             0012*   ; get a pointer to the current tileset
046809             0013*   ; inputs: tileset_ptr_idx
046809             0014*   ; returns: ix = pointer to tileset levels lut
046809             0015*   get_tileset_ptr:
046809 3A 00 68 04 0016*       ld a,(tileset_ptr_idx)
04680D 57          0017*       ld d,a ; d = tileset index
04680E 1E 03       0018*       ld e,3 ; three bytes per index record
046810 ED 5C       0019*       mlt de ; offset into tileset_ptrs lut
046812 DD 21 03 68 0020*       ld ix,tileset_ptrs
       04          
046817 DD 19       0021*       add ix,de ; ix = pointer to tileset_ptrs record
046819 C9          0022*       ret
04681A             0023*   ; end get_tileset_ptr
04681A             0024*   
04681A             0025*   ; intialize a tileset
04681A             0026*   ; inputs: a = index into tileset_ptrs
04681A             0027*   init_tileset:
04681A 32 00 68 04 0028*       ld (tileset_ptr_idx),a ; store new tileset index
04681E CD 09 68 04 0029*       call get_tileset_ptr ; ix = pointer to tileset_ptrs record
046822 DD 37 00    0030*       ld ix,(ix) ; ix = pointer to tileset levels lut
046825 DD 7E FF    0031*       ld a,(ix-1) ; number of levels in the tileset
046828 32 58 68 04 0032*       ld (num_levels),a
04682C AF          0033*       xor a ; reset current level to zero
04682D 32 57 68 04 0034*       ld (cur_level),a
046831 C3 91 68 04 0035*       jp init_level
046835             0036*   ; end init_tileset
046835             0037*   
046835             0038*   next_tileset:
046835 21 00 68 04 0039*       ld hl,tileset_ptr_idx
046839 34          0040*       inc (hl) ; bump to next index
04683A CD 09 68 04 0041*       call get_tileset_ptr ; ix = pointer to tileset_ptrs record
04683E DD 27 00    0042*       ld hl,(ix) ; ix = pointer to tileset levels lut
046841             0043*       sign_hlu ; check for list terminator (0)
046841 19          0001*M1     add hl,de ; 1 cycle
046842 B7          0002*M1     or a ; clear flags ; 1 cycle
046843 ED 52       0003*M1     sbc hl,de ; 2 cycles
046845             0004*M1     ; 4 cycles total
046845 C2 53 68 04 0044*       jp nz,@F ; not end of list
046849 3E FF       0045*       ld a,-1 ; will wrap around to zero on the next iteration
04684B 32 00 68 04 0046*       ld (tileset_ptr_idx),a
04684F C3 35 68 04 0047*       jp next_tileset ; try again
046853             0048*   @@:
046853 C3 1A 68 04 0049*       jp init_tileset
046857             0050*   ; end next_tileset
046857             0051*   
046857 00          0052*   cur_level: db 0
046858 00          0053*   num_levels: db 0
046859             0054*   
046859             0055*   ; get a pointer to the current level lookup record
046859             0056*   ; inputs: tileset_ptr_idx, cur_level
046859             0057*   ; returns: ix = pointer to level definition
046859             0058*   get_level_ptr:
046859 CD 09 68 04 0059*       call get_tileset_ptr
04685D DD 37 00    0060*       ld ix,(ix) ; ix = pointer to tileset levels lut
046860 3A 57 68 04 0061*       ld a,(cur_level)
046864 57          0062*       ld d,a ; d = level index
046865 1E 03       0063*       ld e,3 ; three bytes per level record
046867 ED 5C       0064*       mlt de ; offset into tileset levels lut
046869 DD 19       0065*       add ix,de ; ix = pointer to level record
04686B C9          0066*       ret
04686C             0067*   ; end get_level_ptr
04686C             0068*   
04686C             0069*   ; advance to the next level in the current tileset
04686C             0070*   ; inputs: tileset_ptr_idx, cur_level
04686C             0071*   next_level:
04686C             0072*   ; update starting score
04686C 2A 4D 80 04 0073*       ld hl,(player_score)
046870 22 53 80 04 0074*       ld (player_starting_score),hl
046874             0075*   ; set up pointers to next map definition
046874 21 57 68 04 0076*       ld hl,cur_level
046878 34          0077*       inc (hl) ; bump to next level
046879 CD 59 68 04 0078*       call get_level_ptr ; ix points to current level lookup record
04687D DD 27 00    0079*       ld hl,(ix) ; hl = pointer to next level lookup record
046880             0080*       sign_hlu ; check for list terminator (0)
046880 19          0001*M1     add hl,de ; 1 cycle
046881 B7          0002*M1     or a ; clear flags ; 1 cycle
046882 ED 52       0003*M1     sbc hl,de ; 2 cycles
046884             0004*M1     ; 4 cycles total
046884 C2 91 68 04 0081*       jp nz,@F ; not end of list
046888 AF          0082*       xor a ; reset level to zero
046889 32 57 68 04 0083*       ld (cur_level),a
04688D C3 35 68 04 0084*       jp next_tileset ; try next tileset
046891             0085*   @@: ; fall through to init_level
046891             0086*   ; end next_level
046891             0087*   
046891             0088*   ; inputs: ix pointed to tileset level definition
046891             0089*   init_level:
046891             0090*   ; set pointers
046891 CD 59 68 04 0091*       call get_level_ptr ; ix points to level lookup record
046895 DD 37 00    0092*       ld ix,(ix) ; ix points to level definition
046898             0093*   ; set tiles_cols
046898 DD 7E 00    0094*       ld a,(ix+0)
04689B 32 06 8D 04 0095*       ld (tiles_cols),a
04689F             0096*   ; set tiles_row counter
04689F DD 7E 01    0097*       ld a,(ix+1)
0468A2 32 03 8D 04 0098*       ld (tiles_row),a
0468A6             0099*   ; set cur_baseBufferId
0468A6 DD 27 04    0100*       ld hl,(ix+4)
0468A9 22 07 8D 04 0101*       ld (cur_baseBufferId),hl
0468AD             0102*   ; set tiles_row_defs
0468AD ED 32 07    0103*       lea ix,ix+7 ; ix points to definition of first tile of first row
0468B0 DD 22 00 8D 0104*       ld (tiles_row_defs),ix
       04          
0468B5             0105*   ; reset tile rows and plot coordinates
0468B5 21 FF FF FF 0106*       ld hl,-1
0468B9 22 12 8E 04 0107*       ld (bg_y_plot),hl
0468BD 23          0108*       inc hl
0468BE 22 03 8D 04 0109*       ld (tiles_row),hl
0468C2 22 0B 8D 04 0110*       ld (tiles_x_plot),hl
0468C6 21 F1 FF FF 0111*       ld hl,-15
0468CA 22 0F 8D 04 0112*       ld (tiles_y_plot),hl
0468CE             0113*   ; print_level:
0468CE             0114*   level_x: equ 48
0468CE             0115*   level_y: equ 0
0468CE 0E 30       0116*       ld c,level_x
0468D0 06 00       0117*       ld b,level_y
0468D2 CD 37 16 04 0118*       call vdu_move_cursor
0468D6 CD 00 01 04 0119*       call printInline
0468DA 4C 65 76 65 0120*       asciz "Level: "
       6C 3A 20 00 
0468E2 3A 57 68 04 0121*       ld a,(cur_level)
0468E6 CD 00 95 04 0122*       call printHexA
0468EA             0123*   ; draw initial background tiles
0468EA 21 00 04 00 0124*       ld hl,BUF_BG_STARS_0
0468EE CD 38 17 04 0125*       call vdu_buff_select
0468F2 01 00 00 00 0126*       ld bc,0
0468F6 11 00 00 00 0127*       ld de,field_top
0468FA CD 20 1B 04 0128*       call vdu_plot_bmp
0468FE 21 04 04 00 0129*       ld hl,BUF_BG_STARS_4
046902 CD 38 17 04 0130*       call vdu_buff_select
046906 01 00 00 00 0131*       ld bc,0
04690A 11 00 01 00 0132*       ld de,field_top+256
04690E CD 20 1B 04 0133*       call vdu_plot_bmp
046912 C9          0134*       ret
046913             0135*   ; end init_level
046913             0057        include "levels_tileset_0.inc"
046913             0001*   ; Generated from tiles/dg/dg0_03.tmx
046913             0002*   
046913 01          0003*   tileset_00_num_levels: db 1
046914             0004*   
046914             0005*   tileset_00_levels:
046914 1A 69 04    0006*   	dl tileset_00_level_00
046917 00 00 00    0007*   	dl 0 ; list terminator
04691A             0008*   
04691A             0009*   tileset_00_level_00: ; Level 0
04691A 10          0010*   	db 16          ; num cols
04691B 00 01 00    0011*   	dl 256          ; num rows
04691E 00 02 00    0012*   	dl 512 ; base bufferId
046921 F8 F8 F8 F8 0013*   	db 248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248
       F8 F8 F8 F8 
       F8 F8 F8 F8 
       F8 F8 F8 F8 
046931 00 00 00 00 0014*   	db 000,000,000,000,000,000,147,000,089,090,091,000,147,000,000,000
       00 00 93 00 
       59 5A 5B 00 
       93 00 00 00 
046941 00 CE CF D0 0015*   	db 000,206,207,208,000,000,147,000,073,005,075,000,147,000,000,000
       00 00 93 00 
       49 05 4B 00 
       93 00 00 00 
046951 81 BE 79 A7 0016*   	db 129,190,121,167,216,216,182,145,057,058,059,145,147,000,000,000
       D8 D8 B6 91 
       39 3A 3B 91 
       93 00 00 00 
046961 00 AE AF B0 0017*   	db 000,174,175,176,000,206,183,208,000,000,000,206,207,207,208,000
       00 CE B7 D0 
       00 00 00 CE 
       CF CF D0 00 
046971 00 00 83 00 0018*   	db 000,000,131,000,000,190,156,171,220,220,220,220,186,192,192,129
       00 BE 9C AB 
       DC DC DC DC 
       BA C0 C0 81 
046981 00 00 83 00 0019*   	db 000,000,131,000,000,174,184,176,000,000,000,131,219,191,131,000
       00 AE B8 B0 
       00 00 00 83 
       DB BF 83 00 
046991 00 CE CF D0 0020*   	db 000,206,207,208,000,000,215,000,000,000,000,131,187,191,131,000
       00 00 D7 00 
       00 00 00 83 
       BB BF 83 00 
0469A1 81 BE 69 A7 0021*   	db 129,190,105,167,216,216,166,129,129,129,129,131,136,137,131,000
       D8 D8 A6 81 
       81 81 81 83 
       88 89 83 00 
0469B1 00 AE AF B0 0022*   	db 000,174,175,176,000,000,131,000,000,000,000,131,134,135,131,000
       00 00 83 00 
       00 00 00 83 
       86 87 83 00 
0469C1 00 00 83 00 0023*   	db 000,000,131,000,000,000,131,000,000,000,000,131,134,135,131,000
       00 00 83 00 
       00 00 00 83 
       86 87 83 00 
0469D1 00 00 83 00 0024*   	db 000,000,131,000,000,000,131,000,000,000,000,131,150,151,131,000
       00 00 83 00 
       00 00 00 83 
       96 97 83 00 
0469E1 00 CE CF D0 0025*   	db 000,206,207,208,000,000,131,000,000,000,000,131,150,151,131,000
       00 00 83 00 
       00 00 00 83 
       96 97 83 00 
0469F1 81 BE 79 A7 0026*   	db 129,190,121,167,216,216,231,216,216,216,216,168,154,155,131,000
       D8 D8 E7 D8 
       D8 D8 D8 A8 
       9A 9B 83 00 
046A01 00 AE AF B0 0027*   	db 000,174,175,176,000,206,183,208,000,000,000,174,175,175,176,000
       00 CE B7 D0 
       00 00 00 AE 
       AF AF B0 00 
046A11 00 00 83 00 0028*   	db 000,000,131,000,000,190,156,192,000,000,000,000,131,000,000,000
       00 BE 9C C0 
       00 00 00 00 
       83 00 00 00 
046A21 00 00 83 00 0029*   	db 000,000,131,000,000,174,184,176,000,000,000,000,131,000,000,000
       00 AE B8 B0 
       00 00 00 00 
       83 00 00 00 
046A31 00 CE CF D0 0030*   	db 000,206,207,208,000,000,215,000,000,206,140,140,140,140,208,000
       00 00 D7 00 
       00 CE 8C 8C 
       8C 8C D0 00 
046A41 81 BE 79 A7 0031*   	db 129,190,121,167,216,216,166,000,000,140,081,082,083,084,140,129
       D8 D8 A6 00 
       00 8C 51 52 
       53 54 8C 81 
046A51 00 AE AF B0 0032*   	db 000,174,175,176,000,000,131,000,000,140,065,092,093,068,140,000
       00 00 83 00 
       00 8C 41 5C 
       5D 44 8C 00 
046A61 00 00 83 00 0033*   	db 000,000,131,000,000,000,131,129,129,140,049,076,077,052,140,000
       00 00 83 81 
       81 8C 31 4C 
       4D 34 8C 00 
046A71 00 00 83 00 0034*   	db 000,000,131,000,000,000,131,000,000,140,033,034,035,036,140,129
       00 00 83 00 
       00 8C 21 22 
       23 24 8C 81 
046A81 00 CE CF D0 0035*   	db 000,206,207,208,000,000,131,000,000,174,140,140,140,140,176,000
       00 00 83 00 
       00 AE 8C 8C 
       8C 8C B0 00 
046A91 81 BE 69 A7 0036*   	db 129,190,105,167,216,216,182,000,000,000,000,000,000,000,000,000
       D8 D8 B6 00 
       00 00 00 00 
       00 00 00 00 
046AA1 00 AE AF B0 0037*   	db 000,174,175,176,000,206,183,208,000,000,000,000,000,000,000,000
       00 CE B7 D0 
       00 00 00 00 
       00 00 00 00 
046AB1 00 00 83 00 0038*   	db 000,000,131,000,000,190,156,192,009,010,010,010,010,010,010,011
       00 BE 9C C0 
       09 0A 0A 0A 
       0A 0A 0A 0B 
046AC1 00 00 83 00 0039*   	db 000,000,131,000,000,174,184,176,000,000,000,000,000,000,000,000
       00 AE B8 B0 
       00 00 00 00 
       00 00 00 00 
046AD1 00 CE CF D0 0040*   	db 000,206,207,208,000,000,215,145,145,081,082,088,083,084,145,145
       00 00 D7 91 
       91 51 52 58 
       53 54 91 91 
046AE1 81 BE 79 A7 0041*   	db 129,190,121,167,216,216,166,000,000,065,156,248,156,068,000,000
       D8 D8 A6 00 
       00 41 9C F8 
       9C 44 00 00 
046AF1 00 AE AF B4 0042*   	db 000,174,175,180,000,000,147,000,000,071,248,001,248,087,000,000
       00 00 93 00 
       00 47 F8 01 
       F8 57 00 00 
046B01 00 00 00 D3 0043*   	db 000,000,000,211,000,000,147,000,000,049,156,248,156,052,000,000
       00 00 93 00 
       00 31 9C F8 
       9C 34 00 00 
046B11 91 91 91 D3 0044*   	db 145,145,145,211,145,145,145,145,145,033,034,072,035,036,145,145
       91 91 91 91 
       91 21 22 48 
       23 24 91 91 
046B21 BF 93 98 D3 0045*   	db 191,147,152,211,153,147,191,191,191,147,191,191,191,147,191,191
       99 93 BF BF 
       BF 93 BF BF 
       BF 93 BF BF 
046B31 BF 93 96 D3 0046*   	db 191,147,150,211,151,147,191,191,191,147,191,191,191,147,191,191
       97 93 BF BF 
       BF 93 BF BF 
       BF 93 BF BF 
046B41 BF 93 96 04 0047*   	db 191,147,150,004,151,147,191,191,191,147,191,191,191,147,191,191
       97 93 BF BF 
       BF 93 BF BF 
       BF 93 BF BF 
046B51 BF 93 96 04 0048*   	db 191,147,150,004,151,147,191,191,191,147,191,191,191,147,191,191
       97 93 BF BF 
       BF 93 BF BF 
       BF 93 BF BF 
046B61 BF 93 86 DB 0049*   	db 191,147,134,219,135,147,191,191,191,147,191,191,191,147,191,191
       87 93 BF BF 
       BF 93 BF BF 
       BF 93 BF BF 
046B71 BF 93 8A DB 0050*   	db 191,147,138,219,139,147,191,191,191,147,191,191,191,147,191,191
       8B 93 BF BF 
       BF 93 BF BF 
       BF 93 BF BF 
046B81 91 91 91 DB 0051*   	db 145,145,145,219,145,145,145,145,145,145,145,145,145,145,145,145
       91 91 91 91 
       91 91 91 91 
       91 91 91 91 
046B91 00 83 00 DB 0052*   	db 000,131,000,219,000,131,000,000,000,131,000,000,000,131,000,000
       00 83 00 00 
       00 83 00 00 
       00 83 00 00 
046BA1 00 83 00 DB 0053*   	db 000,131,000,219,000,131,000,000,000,131,000,000,000,131,000,000
       00 83 00 00 
       00 83 00 00 
       00 83 00 00 
046BB1 DC DC DC EC 0054*   	db 220,220,220,236,220,220,220,220,220,220,220,235,220,220,220,220
       DC DC DC DC 
       DC DC DC EB 
       DC DC DC DC 
046BC1 00 83 00 00 0055*   	db 000,131,000,000,000,131,000,136,137,131,000,219,000,131,000,000
       00 83 00 88 
       89 83 00 DB 
       00 83 00 00 
046BD1 00 83 00 00 0056*   	db 000,131,000,000,000,131,000,134,135,131,000,219,000,131,000,000
       00 83 00 86 
       87 83 00 DB 
       00 83 00 00 
046BE1 00 83 00 00 0057*   	db 000,131,000,000,000,131,000,150,151,131,000,219,000,131,000,000
       00 83 00 96 
       97 83 00 DB 
       00 83 00 00 
046BF1 00 83 00 00 0058*   	db 000,131,000,000,000,131,000,154,155,131,000,187,000,131,000,000
       00 83 00 9A 
       9B 83 00 BB 
       00 83 00 00 
046C01 81 81 81 81 0059*   	db 129,129,129,129,129,129,129,184,129,129,136,137,129,129,129,129
       81 81 81 B8 
       81 81 88 89 
       81 81 81 81 
046C11 BF BF D0 00 0060*   	db 191,191,208,000,000,206,191,215,191,191,134,135,009,010,010,011
       00 CE BF D7 
       BF BF 86 87 
       09 0A 0A 0B 
046C21 BF BF BF D0 0061*   	db 191,191,191,208,206,191,191,215,191,191,134,135,191,191,191,191
       CE BF BF D7 
       BF BF 86 87 
       BF BF BF BF 
046C31 59 5A 5B BF 0062*   	db 089,090,091,191,191,004,191,215,191,191,150,151,191,191,248,191
       BF 04 BF D7 
       BF BF 96 97 
       BF BF F8 BF 
046C41 49 05 4B BF 0063*   	db 073,005,075,191,191,004,167,200,191,191,150,151,191,248,001,248
       BF 04 A7 C8 
       BF BF 96 97 
       BF F8 01 F8 
046C51 39 3A 3B BF 0064*   	db 057,058,059,191,191,004,191,215,191,191,154,155,191,191,248,191
       BF 04 BF D7 
       BF BF 9A 9B 
       BF BF F8 BF 
046C61 BF BF BF B0 0065*   	db 191,191,191,176,174,191,191,215,191,191,184,191,191,191,191,191
       AE BF BF D7 
       BF BF B8 BF 
       BF BF BF BF 
046C71 BF BF B0 00 0066*   	db 191,191,176,000,000,174,191,165,216,216,232,216,216,216,216,216
       00 AE BF A5 
       D8 D8 E8 D8 
       D8 D8 D8 D8 
046C81 00 00 00 00 0067*   	db 000,000,000,000,000,000,131,000,131,000,000,000,000,000,000,000
       00 00 83 00 
       83 00 00 00 
       00 00 00 00 
046C91 81 81 81 81 0068*   	db 129,129,129,129,129,129,131,000,131,000,000,000,000,000,000,000
       81 81 83 00 
       83 00 00 00 
       00 00 00 00 
046CA1 00 00 00 00 0069*   	db 000,000,000,000,000,000,131,000,131,000,000,000,000,000,000,000
       00 00 83 00 
       83 00 00 00 
       00 00 00 00 
046CB1 00 00 00 00 0070*   	db 000,000,000,000,000,000,131,000,131,129,129,129,129,129,129,129
       00 00 83 00 
       83 81 81 81 
       81 81 81 81 
046CC1 00 00 00 00 0071*   	db 000,000,000,000,000,000,131,000,131,000,000,000,000,000,000,000
       00 00 83 00 
       83 00 00 00 
       00 00 00 00 
046CD1 00 00 00 00 0072*   	db 000,000,000,000,000,000,131,000,131,000,000,000,000,000,000,000
       00 00 83 00 
       83 00 00 00 
       00 00 00 00 
046CE1 95 95 95 95 0073*   	db 149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149
       95 95 95 95 
       95 95 95 95 
       95 95 95 95 
046CF1 00 00 00 00 0074*   	db 000,000,000,000,000,206,191,191,191,208,000,000,000,000,000,000
       00 CE BF BF 
       BF D0 00 00 
       00 00 00 00 
046D01 BF BF BF BF 0075*   	db 191,191,191,191,191,191,089,090,091,191,191,191,191,191,191,191
       BF BF 59 5A 
       5B BF BF BF 
       BF BF BF BF 
046D11 BF BF BF BF 0076*   	db 191,191,191,191,191,191,073,005,075,191,191,191,191,191,191,191
       BF BF 49 05 
       4B BF BF BF 
       BF BF BF BF 
046D21 BF BF BF BF 0077*   	db 191,191,191,191,191,191,057,058,059,191,191,191,191,191,191,191
       BF BF 39 3A 
       3B BF BF BF 
       BF BF BF BF 
046D31 00 00 00 00 0078*   	db 000,000,000,000,000,174,191,191,191,176,000,000,000,000,000,000
       00 AE BF BF 
       BF B0 00 00 
       00 00 00 00 
046D41 85 85 85 85 0079*   	db 133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133
       85 85 85 85 
       85 85 85 85 
       85 85 85 85 
046D51 00 00 83 00 0080*   	db 000,000,131,000,131,000,000,000,131,000,000,000,000,000,147,000
       83 00 00 00 
       83 00 00 00 
       00 00 93 00 
046D61 00 00 83 00 0081*   	db 000,000,131,000,131,000,000,000,131,000,000,000,000,000,147,000
       83 00 00 00 
       83 00 00 00 
       00 00 93 00 
046D71 00 00 83 00 0082*   	db 000,000,131,000,131,000,000,000,131,000,000,000,000,206,207,208
       83 00 00 00 
       83 00 00 00 
       00 CE CF D0 
046D81 00 00 83 00 0083*   	db 000,000,131,000,131,000,000,000,131,000,000,000,206,191,248,191
       83 00 00 00 
       83 00 00 00 
       CE BF F8 BF 
046D91 81 81 81 81 0084*   	db 129,129,129,129,129,129,129,129,129,129,129,129,190,248,001,248
       81 81 81 81 
       81 81 81 81 
       BE F8 01 F8 
046DA1 00 00 83 00 0085*   	db 000,000,131,000,131,000,000,000,131,000,000,000,174,191,248,191
       83 00 00 00 
       83 00 00 00 
       AE BF F8 BF 
046DB1 00 00 83 00 0086*   	db 000,000,131,000,131,000,000,000,131,000,000,000,000,190,191,191
       83 00 00 00 
       83 00 00 00 
       00 BE BF BF 
046DC1 00 00 83 00 0087*   	db 000,000,131,000,131,000,000,000,131,000,000,000,000,190,191,191
       83 00 00 00 
       83 00 00 00 
       00 BE BF BF 
046DD1 00 00 83 00 0088*   	db 000,000,131,000,131,000,000,000,131,000,000,000,206,191,191,191
       83 00 00 00 
       83 00 00 00 
       CE BF BF BF 
046DE1 00 CE 09 0A 0089*   	db 000,206,009,010,011,208,000,000,131,000,000,206,191,191,191,191
       0B D0 00 00 
       83 00 00 CE 
       BF BF BF BF 
046DF1 BF BF 59 5A 0090*   	db 191,191,089,090,091,191,191,191,191,191,191,191,191,191,092,093
       5B BF BF BF 
       BF BF BF BF 
       BF BF 5C 5D 
046E01 BF BF 49 05 0091*   	db 191,191,073,005,075,191,191,191,191,191,191,191,191,191,076,077
       4B BF BF BF 
       BF BF BF BF 
       BF BF 4C 4D 
046E11 BF BF 39 3A 0092*   	db 191,191,057,058,059,191,191,191,191,191,191,191,191,191,191,191
       3B BF BF BF 
       BF BF BF BF 
       BF BF BF BF 
046E21 00 AE BF BF 0093*   	db 000,174,191,191,191,191,191,191,191,191,176,000,174,175,175,175
       BF BF BF BF 
       BF BF B0 00 
       AE AF AF AF 
046E31 00 00 83 00 0094*   	db 000,000,131,000,131,000,174,191,191,191,000,000,000,000,131,000
       83 00 AE BF 
       BF BF 00 00 
       00 00 83 00 
046E41 00 00 83 00 0095*   	db 000,000,131,000,131,000,000,191,191,191,000,000,000,000,131,000
       83 00 00 BF 
       BF BF 00 00 
       00 00 83 00 
046E51 00 00 83 00 0096*   	db 000,000,131,000,131,000,000,191,191,191,000,000,000,000,131,000
       83 00 00 BF 
       BF BF 00 00 
       00 00 83 00 
046E61 84 84 84 84 0097*   	db 132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132
       84 84 84 84 
       84 84 84 84 
       84 84 84 84 
046E71 00 00 00 00 0098*   	db 000,000,000,000,000,000,000,191,191,191,000,000,000,000,000,000
       00 00 00 BF 
       BF BF 00 00 
       00 00 00 00 
046E81 00 00 00 00 0099*   	db 000,000,000,000,000,000,000,191,191,191,000,000,000,000,000,000
       00 00 00 BF 
       BF BF 00 00 
       00 00 00 00 
046E91 00 00 00 00 0100*   	db 000,000,000,000,000,000,000,191,191,191,000,000,000,000,000,000
       00 00 00 BF 
       BF BF 00 00 
       00 00 00 00 
046EA1 00 CE CF CF 0101*   	db 000,206,207,207,208,000,000,009,010,011,000,000,000,000,000,000
       D0 00 00 09 
       0A 0B 00 00 
       00 00 00 00 
046EB1 00 BE 98 99 0102*   	db 000,190,152,153,192,000,000,191,248,191,000,000,000,000,000,000
       C0 00 00 BF 
       F8 BF 00 00 
       00 00 00 00 
046EC1 00 BE 96 97 0103*   	db 000,190,150,151,192,145,145,248,001,248,000,000,000,000,000,000
       C0 91 91 F8 
       01 F8 00 00 
       00 00 00 00 
046ED1 00 BE 96 97 0104*   	db 000,190,150,151,192,000,000,191,248,191,000,000,000,000,000,000
       C0 00 00 BF 
       F8 BF 00 00 
       00 00 00 00 
046EE1 00 BE 96 97 0105*   	db 000,190,150,151,192,000,000,191,191,191,000,000,000,000,000,000
       C0 00 00 BF 
       BF BF 00 00 
       00 00 00 00 
046EF1 00 BE 8A 8B 0106*   	db 000,190,138,139,192,145,145,191,191,191,000,000,000,000,000,000
       C0 91 91 BF 
       BF BF 00 00 
       00 00 00 00 
046F01 00 AE BF BC 0107*   	db 000,174,191,188,176,000,000,191,191,191,000,206,207,207,208,000
       B0 00 00 BF 
       BF BF 00 CE 
       CF CF D0 00 
046F11 00 00 BE DB 0108*   	db 000,000,190,219,000,000,000,191,191,191,145,190,152,153,192,000
       00 00 00 BF 
       BF BF 91 BE 
       98 99 C0 00 
046F21 BF BF BF DB 0109*   	db 191,191,191,219,208,000,206,191,191,191,000,190,150,151,192,000
       D0 00 CE BF 
       BF BF 00 BE 
       96 97 C0 00 
046F31 59 5A 5B DB 0110*   	db 089,090,091,219,191,191,191,191,167,216,216,168,150,151,192,000
       BF BF BF BF 
       A7 D8 D8 A8 
       96 97 C0 00 
046F41 49 05 4B AA 0111*   	db 073,005,075,170,191,191,191,191,191,191,000,190,150,151,192,000
       BF BF BF BF 
       BF BF 00 BE 
       96 97 C0 00 
046F51 39 3A 3B BF 0112*   	db 057,058,059,191,191,191,191,191,191,191,145,190,138,139,192,000
       BF BF BF BF 
       BF BF 91 BE 
       8A 8B C0 00 
046F61 BF BF B0 93 0113*   	db 191,191,176,147,000,000,174,191,191,191,000,174,188,175,176,000
       00 00 AE BF 
       BF BF 00 AE 
       BC AF B0 00 
046F71 00 00 00 93 0114*   	db 000,000,000,147,000,000,000,191,008,191,000,000,219,192,000,000
       00 00 00 BF 
       08 BF 00 00 
       DB C0 00 00 
046F81 00 00 00 93 0115*   	db 000,000,000,147,000,000,000,191,008,220,220,220,170,192,000,000
       00 00 00 BF 
       08 DC DC DC 
       AA C0 00 00 
046F91 00 00 00 93 0116*   	db 000,000,000,147,000,000,000,191,008,191,175,175,175,176,000,000
       00 00 00 BF 
       08 BF AF AF 
       AF B0 00 00 
046FA1 00 00 00 93 0117*   	db 000,000,000,147,000,000,000,191,191,191,000,000,000,000,000,000
       00 00 00 BF 
       BF BF 00 00 
       00 00 00 00 
046FB1 00 00 CE CF 0118*   	db 000,000,206,207,208,000,000,191,191,191,000,000,000,000,000,000
       D0 00 00 BF 
       BF BF 00 00 
       00 00 00 00 
046FC1 00 CE BF F8 0119*   	db 000,206,191,248,191,208,000,191,191,191,208,000,206,191,191,191
       BF D0 00 BF 
       BF BF D0 00 
       CE BF BF BF 
046FD1 81 BE F8 01 0120*   	db 129,190,248,001,248,191,191,191,191,191,191,191,191,089,090,091
       F8 BF BF BF 
       BF BF BF BF 
       BF 59 5A 5B 
046FE1 00 AE AF F8 0121*   	db 000,174,175,248,191,191,191,191,191,191,191,191,191,073,005,075
       BF BF BF BF 
       BF BF BF BF 
       BF 49 05 4B 
046FF1 00 00 AE BF 0122*   	db 000,000,174,191,176,000,174,191,191,191,191,191,191,057,058,059
       B0 00 AE BF 
       BF BF BF BF 
       BF 39 3A 3B 
047001 00 00 00 83 0123*   	db 000,000,000,131,000,000,000,000,131,000,000,000,174,191,191,191
       00 00 00 00 
       83 00 00 00 
       AE BF BF BF 
047011 7A 7B 7A 7B 0124*   	db 122,123,122,123,122,123,122,123,122,123,122,123,122,123,122,123
       7A 7B 7A 7B 
       7A 7B 7A 7B 
       7A 7B 7A 7B 
047021 6A 6B 6A 6B 0125*   	db 106,107,106,107,106,107,106,107,106,107,106,107,106,107,106,107
       6A 6B 6A 6B 
       6A 6B 6A 6B 
       6A 6B 6A 6B 
047031 00 93 00 93 0126*   	db 000,147,000,147,000,000,000,000,000,000,147,000,147,000,000,147
       00 00 00 00 
       00 00 93 00 
       93 00 00 93 
047041 00 93 00 93 0127*   	db 000,147,000,147,000,000,000,000,000,000,147,000,147,000,000,147
       00 00 00 00 
       00 00 93 00 
       93 00 00 93 
047051 00 93 00 93 0128*   	db 000,147,000,147,108,108,108,108,108,108,147,000,147,000,000,147
       6C 6C 6C 6C 
       6C 6C 93 00 
       93 00 00 93 
047061 00 93 00 93 0129*   	db 000,147,000,147,000,000,000,000,000,000,147,000,147,108,108,108
       00 00 00 00 
       00 00 93 00 
       93 6C 6C 6C 
047071 00 93 00 93 0130*   	db 000,147,000,147,000,000,000,000,000,000,147,000,147,000,000,147
       00 00 00 00 
       00 00 93 00 
       93 00 00 93 
047081 00 93 00 93 0131*   	db 000,147,000,147,000,000,000,000,000,000,147,000,147,000,000,147
       00 00 00 00 
       00 00 93 00 
       93 00 00 93 
047091 CE BF BF BF 0132*   	db 206,191,191,191,208,000,000,000,000,206,191,191,191,208,206,191
       D0 00 00 00 
       00 CE BF BF 
       BF D0 CE BF 
0470A1 BF 59 5A 5B 0133*   	db 191,089,090,091,191,191,191,191,191,191,089,090,091,191,191,191
       BF BF BF BF 
       BF BF 59 5A 
       5B BF BF BF 
0470B1 BF 49 05 4B 0134*   	db 191,073,005,075,191,191,191,191,191,191,073,005,075,191,191,191
       BF BF BF BF 
       BF BF 49 05 
       4B BF BF BF 
0470C1 BF 39 3A 3B 0135*   	db 191,057,058,059,191,191,191,191,191,191,057,058,059,191,191,191
       BF BF BF BF 
       BF BF 39 3A 
       3B BF BF BF 
0470D1 AE BF BF BF 0136*   	db 174,191,191,191,176,000,000,000,000,174,191,191,191,176,174,191
       B0 00 00 00 
       00 AE BF BF 
       BF B0 AE BF 
0470E1 00 00 00 00 0137*   	db 000,000,000,000,000,000,000,000,000,000,131,000,000,000,000,000
       00 00 00 00 
       00 00 83 00 
       00 00 00 00 
0470F1 00 00 00 00 0138*   	db 000,000,000,000,000,000,000,000,000,000,131,000,000,000,000,000
       00 00 00 00 
       00 00 83 00 
       00 00 00 00 
047101 00 00 00 00 0139*   	db 000,000,000,000,000,000,000,000,000,000,131,000,000,000,000,000
       00 00 00 00 
       00 00 83 00 
       00 00 00 00 
047111 00 00 00 00 0140*   	db 000,000,000,000,000,000,000,000,000,206,248,208,000,000,000,000
       00 00 00 00 
       00 CE F8 D0 
       00 00 00 00 
047121 09 0A 0A 0A 0141*   	db 009,010,010,010,010,010,010,010,011,248,001,248,145,145,145,145
       0A 0A 0A 0A 
       0B F8 01 F8 
       91 91 91 91 
047131 00 00 00 00 0142*   	db 000,000,000,000,000,000,000,000,000,174,248,176,000,000,000,000
       00 00 00 00 
       00 AE F8 B0 
       00 00 00 00 
047141 00 00 00 00 0143*   	db 000,000,000,000,000,000,000,000,000,000,000,000,000,000,000,000
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
047151 00 00 00 00 0144*   	db 000,000,000,000,000,000,000,000,000,000,000,000,000,000,000,000
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
047161 00 00 00 00 0145*   	db 000,000,000,000,000,000,000,000,000,000,000,000,000,000,000,000
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
047171 00 00 CE CF 0146*   	db 000,000,206,207,207,207,208,000,000,000,000,000,000,000,000,000
       CF CF D0 00 
       00 00 00 00 
       00 00 00 00 
047181 81 81 BE 59 0147*   	db 129,129,190,089,090,091,192,207,207,207,207,208,000,000,000,000
       5A 5B C0 CF 
       CF CF CF D0 
       00 00 00 00 
047191 00 00 BE 49 0148*   	db 000,000,190,073,005,075,167,216,216,216,216,182,208,000,000,000
       05 4B A7 D8 
       D8 D8 D8 B6 
       D0 00 00 00 
0471A1 81 81 BE 39 0149*   	db 129,129,190,057,058,059,192,176,000,000,000,215,192,000,000,000
       3A 3B C0 B0 
       00 00 00 D7 
       C0 00 00 00 
0471B1 00 00 AE AF 0150*   	db 000,000,174,175,175,175,176,000,000,000,000,215,192,000,000,000
       AF AF B0 00 
       00 00 00 D7 
       C0 00 00 00 
0471C1 00 00 00 83 0151*   	db 000,000,000,131,000,131,000,000,000,000,000,215,192,000,000,000
       00 83 00 00 
       00 00 00 D7 
       C0 00 00 00 
0471D1 00 00 00 83 0152*   	db 000,000,000,131,000,131,000,000,000,000,000,215,192,000,000,000
       00 83 00 00 
       00 00 00 D7 
       C0 00 00 00 
0471E1 00 00 00 83 0153*   	db 000,000,000,131,000,131,000,000,000,000,000,215,192,000,000,000
       00 83 00 00 
       00 00 00 D7 
       C0 00 00 00 
0471F1 00 00 00 83 0154*   	db 000,000,000,131,000,131,000,000,000,206,207,207,207,208,000,000
       00 83 00 00 
       00 CE CF CF 
       CF D0 00 00 
047201 81 81 81 81 0155*   	db 129,129,129,129,129,129,129,129,129,190,089,090,091,192,129,129
       81 81 81 81 
       81 BE 59 5A 
       5B C0 81 81 
047211 00 00 00 00 0156*   	db 000,000,000,000,000,000,000,000,000,190,073,005,075,192,000,000
       00 00 00 00 
       00 BE 49 05 
       4B C0 00 00 
047221 81 81 81 81 0157*   	db 129,129,129,129,129,129,129,129,129,190,057,058,059,192,129,129
       81 81 81 81 
       81 BE 39 3A 
       3B C0 81 81 
047231 00 00 00 83 0158*   	db 000,000,000,131,000,131,000,000,000,174,175,180,175,176,000,000
       00 83 00 00 
       00 AE AF B4 
       AF B0 00 00 
047241 00 00 00 83 0159*   	db 000,000,000,131,000,131,000,000,000,000,191,179,000,000,000,000
       00 83 00 00 
       00 00 BF B3 
       00 00 00 00 
047251 09 0A 0A 0A 0160*   	db 009,010,010,010,010,010,010,010,010,010,010,010,010,010,010,011
       0A 0A 0A 0A 
       0A 0A 0A 0A 
       0A 0A 0A 0B 
047261 00 00 00 83 0161*   	db 000,000,000,131,000,131,000,000,000,000,191,180,000,000,000,000
       00 83 00 00 
       00 00 BF B4 
       00 00 00 00 
047271 00 00 CE CF 0162*   	db 000,000,206,207,207,207,208,000,000,000,191,211,000,000,000,000
       CF CF D0 00 
       00 00 BF D3 
       00 00 00 00 
047281 00 00 BE 59 0163*   	db 000,000,190,089,090,091,192,000,000,000,191,211,000,000,000,000
       5A 5B C0 00 
       00 00 BF D3 
       00 00 00 00 
047291 00 00 BE 49 0164*   	db 000,000,190,073,005,075,192,000,000,206,191,248,208,000,000,000
       05 4B C0 00 
       00 CE BF F8 
       D0 00 00 00 
0472A1 81 81 BE 39 0165*   	db 129,129,190,057,058,059,171,220,220,220,248,001,248,145,145,145
       3A 3B AB DC 
       DC DC F8 01 
       F8 91 91 91 
0472B1 00 83 AE AF 0166*   	db 000,131,174,175,175,175,176,000,000,000,174,248,176,000,000,000
       AF AF B0 00 
       00 00 AE F8 
       B0 00 00 00 
0472C1 00 83 00 83 0167*   	db 000,131,000,131,000,000,000,000,000,000,000,000,000,000,000,000
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
0472D1 CE CF CF CF 0168*   	db 206,207,207,207,208,000,000,000,000,000,000,000,000,000,000,000
       D0 00 00 00 
       00 00 00 00 
       00 00 00 00 
0472E1 09 0A 0A 0A 0169*   	db 009,010,010,010,011,000,000,000,000,000,000,000,000,000,000,000
       0B 00 00 00 
       00 00 00 00 
       00 00 00 00 
0472F1 BE CF CF CF 0170*   	db 190,207,207,207,192,000,000,000,000,000,000,000,000,000,000,000
       C0 00 00 00 
       00 00 00 00 
       00 00 00 00 
047301 BE BF 04 BF 0171*   	db 190,191,004,191,192,000,000,000,000,000,000,000,000,000,000,000
       C0 00 00 00 
       00 00 00 00 
       00 00 00 00 
047311 BE BF 04 BF 0172*   	db 190,191,004,191,191,000,000,206,207,207,207,208,000,000,000,000
       BF 00 00 CE 
       CF CF CF D0 
       00 00 00 00 
047321 BE BF 04 BF 0173*   	db 190,191,004,191,192,129,129,190,089,090,091,192,000,000,000,000
       C0 81 81 BE 
       59 5A 5B C0 
       00 00 00 00 
047331 AE AF AF AF 0174*   	db 174,175,175,175,176,000,000,190,073,005,075,167,216,216,182,000
       B0 00 00 BE 
       49 05 4B A7 
       D8 D8 B6 00 
047341 00 00 00 00 0175*   	db 000,000,000,000,000,000,000,190,057,058,059,192,000,000,215,000
       00 00 00 BE 
       39 3A 3B C0 
       00 00 D7 00 
047351 00 00 00 00 0176*   	db 000,000,000,000,000,000,000,174,175,175,175,176,000,000,215,000
       00 00 00 AE 
       AF AF AF B0 
       00 00 D7 00 
047361 00 00 00 00 0177*   	db 000,000,000,000,000,000,000,000,147,000,147,000,000,000,215,000
       00 00 00 00 
       93 00 93 00 
       00 00 D7 00 
047371 00 00 00 00 0178*   	db 000,000,000,000,000,000,000,000,147,000,147,000,000,000,215,000
       00 00 00 00 
       93 00 93 00 
       00 00 D7 00 
047381 00 00 00 00 0179*   	db 000,000,000,000,000,000,000,000,147,000,147,000,000,000,215,000
       00 00 00 00 
       93 00 93 00 
       00 00 D7 00 
047391 00 00 00 00 0180*   	db 000,000,000,000,000,000,000,000,147,000,147,000,000,000,215,000
       00 00 00 00 
       93 00 93 00 
       00 00 D7 00 
0473A1 00 00 00 00 0181*   	db 000,000,000,000,000,000,000,000,147,000,147,000,000,000,215,000
       00 00 00 00 
       93 00 93 00 
       00 00 D7 00 
0473B1 CF CF CF D0 0182*   	db 207,207,207,208,000,000,000,000,147,000,147,000,206,207,183,207
       00 00 00 00 
       93 00 93 00 
       CE CF B7 CF 
0473C1 59 5A 5B C0 0183*   	db 089,090,091,192,145,145,145,145,145,145,145,145,190,089,090,091
       91 91 91 91 
       91 91 91 91 
       BE 59 5A 5B 
0473D1 49 05 4B C0 0184*   	db 073,005,075,192,000,000,000,000,147,000,147,000,190,073,005,075
       00 00 00 00 
       93 00 93 00 
       BE 49 05 4B 
0473E1 39 3A 3B C0 0185*   	db 057,058,059,192,145,145,145,145,145,145,145,145,190,057,058,059
       91 91 91 91 
       91 91 91 91 
       BE 39 3A 3B 
0473F1 BF B4 AF B0 0186*   	db 191,180,175,176,206,207,207,207,208,000,147,000,174,175,175,175
       CE CF CF CF 
       D0 00 93 00 
       AE AF AF AF 
047401 BF D3 00 00 0187*   	db 191,211,000,000,009,010,010,010,011,000,147,000,000,000,000,000
       09 0A 0A 0A 
       0B 00 93 00 
       00 00 00 00 
047411 BF D3 00 00 0188*   	db 191,211,000,000,190,207,207,207,192,000,147,000,000,000,000,000
       BE CF CF CF 
       C0 00 93 00 
       00 00 00 00 
047421 BF D3 00 00 0189*   	db 191,211,000,000,190,191,008,191,192,000,152,153,145,145,145,145
       BE BF 08 BF 
       C0 00 98 99 
       91 91 91 91 
047431 BF D3 00 00 0190*   	db 191,211,000,000,190,191,008,191,191,000,150,151,000,000,000,000
       BE BF 08 BF 
       BF 00 96 97 
       00 00 00 00 
047441 BF D3 00 00 0191*   	db 191,211,000,000,190,191,008,191,192,000,150,151,000,000,000,000
       BE BF 08 BF 
       C0 00 96 97 
       00 00 00 00 
047451 BF D3 00 00 0192*   	db 191,211,000,000,174,175,175,175,176,000,134,135,000,000,000,000
       AE AF AF AF 
       B0 00 86 87 
       00 00 00 00 
047461 BF D3 00 00 0193*   	db 191,211,000,000,000,000,000,000,000,000,134,135,000,000,000,000
       00 00 00 00 
       00 00 86 87 
       00 00 00 00 
047471 BF D3 00 CE 0194*   	db 191,211,000,206,207,207,207,208,000,000,138,139,129,129,129,129
       CF CF CF D0 
       00 00 8A 8B 
       81 81 81 81 
047481 BF A1 A4 BE 0195*   	db 191,161,164,190,089,090,091,192,000,000,188,147,000,000,000,000
       59 5A 5B C0 
       00 00 BC 93 
       00 00 00 00 
047491 AE AF BF BE 0196*   	db 174,175,191,190,073,005,075,171,220,220,170,147,000,000,000,000
       49 05 4B AB 
       DC DC AA 93 
       00 00 00 00 
0474A1 00 00 AE BE 0197*   	db 000,000,174,190,057,058,059,192,000,000,000,147,000,000,000,000
       39 3A 3B C0 
       00 00 00 93 
       00 00 00 00 
0474B1 00 00 00 AE 0198*   	db 000,000,000,174,175,175,175,191,129,129,129,129,129,129,129,129
       AF AF AF BF 
       81 81 81 81 
       81 81 81 81 
0474C1 00 00 00 00 0199*   	db 000,000,000,000,147,000,000,000,000,000,000,147,000,147,000,000
       93 00 00 00 
       00 00 00 93 
       00 93 00 00 
0474D1 00 00 00 00 0200*   	db 000,000,000,000,147,000,000,000,000,000,000,147,000,147,000,000
       93 00 00 00 
       00 00 00 93 
       00 93 00 00 
0474E1 09 0A 0A 0A 0201*   	db 009,010,010,010,010,010,010,010,010,010,010,010,010,010,010,011
       0A 0A 0A 0A 
       0A 0A 0A 0A 
       0A 0A 0A 0B 
0474F1 00 00 00 00 0202*   	db 000,000,000,000,147,000,000,000,000,000,000,147,000,147,000,000
       93 00 00 00 
       00 00 00 93 
       00 93 00 00 
047501 00 CE CF CF 0203*   	db 000,206,207,207,207,208,000,000,000,000,000,147,000,147,000,000
       CF D0 00 00 
       00 00 00 93 
       00 93 00 00 
047511 00 BE BF F8 0204*   	db 000,190,191,248,191,192,000,000,000,000,000,147,000,147,000,000
       BF C0 00 00 
       00 00 00 93 
       00 93 00 00 
047521 00 BE F8 01 0205*   	db 000,190,248,001,248,192,000,000,000,000,206,207,207,207,208,000
       F8 C0 00 00 
       00 00 CE CF 
       CF CF D0 00 
047531 00 AE BF F8 0206*   	db 000,174,191,248,191,176,000,000,000,000,190,089,090,091,192,000
       BF B0 00 00 
       00 00 BE 59 
       5A 5B C0 00 
047541 00 00 AE BC 0207*   	db 000,000,174,188,176,000,000,000,000,185,172,073,005,075,192,000
       B0 00 00 00 
       00 B9 AC 49 
       05 4B C0 00 
047551 00 00 00 DB 0208*   	db 000,000,000,219,000,000,000,000,000,219,190,057,058,059,192,000
       00 00 00 00 
       00 DB BE 39 
       3A 3B C0 00 
047561 00 00 00 DB 0209*   	db 000,000,000,219,000,000,000,000,000,219,174,175,175,175,176,000
       00 00 00 00 
       00 DB AE AF 
       AF AF B0 00 
047571 00 00 00 DB 0210*   	db 000,000,000,219,000,000,000,000,000,219,000,000,000,000,000,000
       00 00 00 00 
       00 DB 00 00 
       00 00 00 00 
047581 00 B9 DC EC 0211*   	db 000,185,220,236,220,220,220,220,220,204,000,000,000,000,000,000
       DC DC DC DC 
       DC CC 00 00 
       00 00 00 00 
047591 00 DB 00 00 0212*   	db 000,219,000,000,000,000,000,000,000,219,000,000,000,000,000,000
       00 00 00 00 
       00 DB 00 00 
       00 00 00 00 
0475A1 00 DB 00 00 0213*   	db 000,219,000,000,000,000,000,000,000,219,000,000,000,000,000,000
       00 00 00 00 
       00 DB 00 00 
       00 00 00 00 
0475B1 00 DB 00 00 0214*   	db 000,219,000,000,000,000,000,000,000,219,000,000,000,000,000,000
       00 00 00 00 
       00 DB 00 00 
       00 00 00 00 
0475C1 00 DB 00 00 0215*   	db 000,219,000,000,000,000,000,000,000,219,000,000,000,000,000,000
       00 00 00 00 
       00 DB 00 00 
       00 00 00 00 
0475D1 DC AA 00 00 0216*   	db 220,170,000,000,000,000,000,000,000,219,000,000,000,000,000,000
       00 00 00 00 
       00 DB 00 00 
       00 00 00 00 
0475E1 00 00 00 00 0217*   	db 000,000,000,000,000,000,000,000,000,219,000,000,000,000,000,000
       00 00 00 00 
       00 DB 00 00 
       00 00 00 00 
0475F1 00 00 00 00 0218*   	db 000,000,000,000,000,000,000,206,207,187,207,208,000,000,000,000
       00 00 00 CE 
       CF BB CF D0 
       00 00 00 00 
047601 81 81 81 81 0219*   	db 129,129,129,129,129,129,129,190,089,090,091,192,129,129,129,129
       81 81 81 BE 
       59 5A 5B C0 
       81 81 81 81 
047611 00 00 00 00 0220*   	db 000,000,000,000,000,000,000,190,073,005,075,192,000,000,000,000
       00 00 00 BE 
       49 05 4B C0 
       00 00 00 00 
047621 00 00 00 00 0221*   	db 000,000,000,000,000,000,000,190,057,058,059,192,000,000,000,000
       00 00 00 BE 
       39 3A 3B C0 
       00 00 00 00 
047631 00 00 00 00 0222*   	db 000,000,000,000,000,000,000,174,175,175,175,176,000,000,000,000
       00 00 00 AE 
       AF AF AF B0 
       00 00 00 00 
047641 00 00 00 00 0223*   	db 000,000,000,000,000,000,000,000,131,000,000,000,000,000,000,000
       00 00 00 00 
       83 00 00 00 
       00 00 00 00 
047651 00 00 00 00 0224*   	db 000,000,000,000,000,000,000,000,131,129,129,129,129,129,129,129
       00 00 00 00 
       83 81 81 81 
       81 81 81 81 
047661 00 00 00 00 0225*   	db 000,000,000,000,000,000,000,000,131,000,000,000,000,000,000,000
       00 00 00 00 
       83 00 00 00 
       00 00 00 00 
047671 00 00 00 00 0226*   	db 000,000,000,000,000,000,000,000,131,000,000,000,000,000,000,000
       00 00 00 00 
       83 00 00 00 
       00 00 00 00 
047681 81 81 81 81 0227*   	db 129,129,129,129,129,129,129,129,131,000,000,000,000,000,000,000
       81 81 81 81 
       83 00 00 00 
       00 00 00 00 
047691 00 00 00 00 0228*   	db 000,000,000,000,000,000,000,000,131,000,000,000,000,000,000,000
       00 00 00 00 
       83 00 00 00 
       00 00 00 00 
0476A1 00 00 00 00 0229*   	db 000,000,000,000,000,000,000,000,131,000,000,000,000,000,000,000
       00 00 00 00 
       83 00 00 00 
       00 00 00 00 
0476B1 00 00 00 00 0230*   	db 000,000,000,000,000,000,000,000,131,129,129,129,129,129,129,129
       00 00 00 00 
       83 81 81 81 
       81 81 81 81 
0476C1 BF BF BF D0 0231*   	db 191,191,191,208,000,000,000,000,131,000,000,000,000,000,000,000
       00 00 00 00 
       83 00 00 00 
       00 00 00 00 
0476D1 59 5A 5B BF 0232*   	db 089,090,091,191,000,000,000,000,131,000,000,000,000,000,000,000
       00 00 00 00 
       83 00 00 00 
       00 00 00 00 
0476E1 49 05 4B BF 0233*   	db 073,005,075,191,000,000,000,000,131,000,000,152,153,145,145,145
       00 00 00 00 
       83 00 00 98 
       99 91 91 91 
0476F1 39 3A 3B BF 0234*   	db 057,058,059,191,000,000,000,000,131,000,000,150,151,000,000,000
       00 00 00 00 
       83 00 00 96 
       97 00 00 00 
047701 BF BF BF BF 0235*   	db 191,191,191,191,000,000,206,207,207,207,208,150,151,000,000,000
       00 00 CE CF 
       CF CF D0 96 
       97 00 00 00 
047711 00 00 BF BF 0236*   	db 000,000,191,191,191,191,191,191,248,191,192,150,151,145,145,145
       BF BF BF BF 
       F8 BF C0 96 
       97 91 91 91 
047721 00 00 BF BF 0237*   	db 000,000,191,191,191,191,191,248,001,248,192,134,135,000,000,000
       BF BF BF F8 
       01 F8 C0 86 
       87 00 00 00 
047731 00 00 AE BF 0238*   	db 000,000,174,191,191,191,191,191,248,191,192,134,135,000,000,000
       BF BF BF BF 
       F8 BF C0 86 
       87 00 00 00 
047741 00 00 00 83 0239*   	db 000,000,000,131,000,000,174,175,175,175,176,134,135,000,000,000
       00 00 AE AF 
       AF AF B0 86 
       87 00 00 00 
047751 00 00 00 83 0240*   	db 000,000,000,131,000,000,000,000,131,000,000,134,135,000,000,000
       00 00 00 00 
       83 00 00 86 
       87 00 00 00 
047761 6A 6B 6C 6B 0241*   	db 106,107,108,107,108,106,107,108,131,000,000,138,139,145,145,145
       6C 6A 6B 6C 
       83 00 00 8A 
       8B 91 91 91 
047771 00 00 00 83 0242*   	db 000,000,000,131,000,000,000,000,131,000,000,191,191,000,000,000
       00 00 00 00 
       83 00 00 BF 
       BF 00 00 00 
047781 00 00 00 83 0243*   	db 000,000,000,131,000,000,000,000,131,000,000,191,191,000,000,000
       00 00 00 00 
       83 00 00 BF 
       BF 00 00 00 
047791 00 00 00 83 0244*   	db 000,000,000,131,000,000,000,000,131,206,207,207,207,208,000,000
       00 00 00 00 
       83 CE CF CF 
       CF D0 00 00 
0477A1 00 00 00 83 0245*   	db 000,000,000,131,000,000,000,000,131,190,089,090,091,192,145,145
       00 00 00 00 
       83 BE 59 5A 
       5B C0 91 91 
0477B1 00 00 00 83 0246*   	db 000,000,000,131,000,000,000,000,131,190,073,005,075,192,000,000
       00 00 00 00 
       83 BE 49 05 
       4B C0 00 00 
0477C1 81 81 81 83 0247*   	db 129,129,129,131,129,129,129,129,131,190,057,058,059,192,145,145
       81 81 81 81 
       83 BE 39 3A 
       3B C0 91 91 
0477D1 00 00 00 83 0248*   	db 000,000,000,131,000,000,000,000,131,174,175,175,175,176,000,000
       00 00 00 00 
       83 AE AF AF 
       AF B0 00 00 
0477E1 00 00 00 83 0249*   	db 000,000,000,131,000,000,000,000,131,000,000,000,131,000,000,000
       00 00 00 00 
       83 00 00 00 
       83 00 00 00 
0477F1 09 0A 0A 0A 0250*   	db 009,010,010,010,010,010,010,010,010,010,010,010,010,010,010,011
       0A 0A 0A 0A 
       0A 0A 0A 0A 
       0A 0A 0A 0B 
047801 85 85 85 85 0251*   	db 133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133
       85 85 85 85 
       85 85 85 85 
       85 85 85 85 
047811 00 00 93 00 0252*   	db 000,000,147,000,000,000,147,000,000,000,147,000,000,147,000,000
       00 00 93 00 
       00 00 93 00 
       00 93 00 00 
047821 7A 7B 93 7A 0253*   	db 122,123,147,122,123,122,147,122,123,122,147,122,123,147,122,123
       7B 7A 93 7A 
       7B 7A 93 7A 
       7B 93 7A 7B 
047831 6A 6B 93 6A 0254*   	db 106,107,147,106,107,106,147,106,107,106,147,106,107,147,106,107
       6B 6A 93 6A 
       6B 6A 93 6A 
       6B 93 6A 6B 
047841 00 00 93 00 0255*   	db 000,000,147,000,000,000,147,000,000,000,147,000,000,147,000,000
       00 00 93 00 
       00 00 93 00 
       00 93 00 00 
047851 00 00 93 00 0256*   	db 000,000,147,000,000,000,147,000,000,000,147,000,000,147,000,000
       00 00 93 00 
       00 00 93 00 
       00 93 00 00 
047861 94 94 94 94 0257*   	db 148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148
       94 94 94 94 
       94 94 94 94 
       94 94 94 94 
047871 59 5A 5B BF 0258*   	db 089,090,091,191,191,191,191,191,191,191,191,191,191,089,090,091
       BF BF BF BF 
       BF BF BF BF 
       BF 59 5A 5B 
047881 49 05 4B BF 0259*   	db 073,005,075,191,008,191,191,191,191,191,004,191,191,073,005,075
       08 BF BF BF 
       BF BF 04 BF 
       BF 49 05 4B 
047891 39 3A 3B BF 0260*   	db 057,058,059,191,008,191,191,191,191,191,004,191,191,057,058,059
       08 BF BF BF 
       BF BF 04 BF 
       BF 39 3A 3B 
0478A1 BF BF BF BF 0261*   	db 191,191,191,191,008,191,191,191,191,191,004,191,191,191,191,191
       08 BF BF BF 
       BF BF 04 BF 
       BF BF BF BF 
0478B1 BF BF BF BF 0262*   	db 191,191,191,191,191,248,191,191,191,191,191,248,191,191,191,191
       BF F8 BF BF 
       BF BF BF F8 
       BF BF BF BF 
0478C1 BF BF BF BF 0263*   	db 191,191,191,191,248,001,248,191,191,191,248,001,248,191,191,191
       F8 01 F8 BF 
       BF BF F8 01 
       F8 BF BF BF 
0478D1 BF BF BF BF 0264*   	db 191,191,191,191,191,248,191,191,191,191,191,248,191,191,191,191
       BF F8 BF BF 
       BF BF BF F8 
       BF BF BF BF 
0478E1 59 5A 5B BF 0265*   	db 089,090,091,191,191,191,191,191,191,191,191,191,191,089,090,091
       BF BF BF BF 
       BF BF BF BF 
       BF 59 5A 5B 
0478F1 49 05 4B BF 0266*   	db 073,005,075,191,191,191,191,191,191,191,191,191,191,073,005,075
       BF BF BF BF 
       BF BF BF BF 
       BF 49 05 4B 
047901 39 3A 3B BF 0267*   	db 057,058,059,191,191,191,191,191,191,191,191,191,191,057,058,059
       BF BF BF BF 
       BF BF BF BF 
       BF 39 3A 3B 
047911 84 84 84 84 0268*   	db 132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132
       84 84 84 84 
       84 84 84 84 
       84 84 84 84 
047921             0058        include "player_state.inc"
047921             0001*   player_defaults:
047921 05          0002*       db player               ; type
047922 6F 01 00    0003*       dl BUF_SHIP_0L          ; base_bufferId
047925 87 79 04    0004*       dl do_player            ; move_program
047928 40          0005*       db %01000000            ; collisions bit 6 signals sprite alive
047929 10          0006*       db 16                   ; dim_x
04792A 10          0007*       db 16                   ; dim_y
04792B 01          0008*       db 1                    ; num_orientations
04792C 01          0009*       db 1                    ; num_animations
04792D 00          0010*       db 0                    ; animation
04792E 00          0011*       db 0                    ; animation_timer
04792F 00          0012*       db 0                    ; move_timer
047930 00          0013*       db 0                    ; move_step
047931 00          0014*       db 0                    ; points
047932 00          0015*       db 0                    ; shield_damage
047933 00          0016*       db 0                    ; frame
047934             0017*   
047934 16 7A 04    0018*   player_state:  dl player_alive
047937 03          0019*   player_ships: db 3 ; integer
047938             0020*   player_speed: equ 3*256 ; pixels per frame 16.8 fixed
047938             0021*   
047938             0022*   draw_player_ships:
047938             0023*   ; activate mfd
047938 DD 21 BB 7B 0024*       ld ix,mfd_bg_r
       04          
04793D CD CA 7B 04 0025*       call mfd_activate
047941             0026*   ; blank out previously drawn ships
047941 AF          0027*       xor a ; color mode 0
047942 0E 00       0028*       ld c,c_black
047944 CD 8D 16 04 0029*       call vdu_gcol
047948 01 00 00 00 0030*       ld bc,0
04794C 11 00 00 00 0031*       ld de,0
047950 DD 21 3F 00 0032*       ld ix,63
       00          
047955 FD 21 0F 00 0033*       ld iy,15
       00          
04795A CD 5D 1B 04 0034*       call vdu_plot_rf
04795E             0035*   ; draw the ships remaining
04795E 21 72 01 00 0036*       ld hl,BUF_SHIP_SMALL
047962 CD 38 17 04 0037*       call vdu_buff_select
047966 3A 37 79 04 0038*       ld a,(player_ships) ; loop counter
04796A 01 04 00 00 0039*       ld bc,4 ; starting x-coordinate
04796E             0040*   @loop:
04796E F5          0041*       push af ; back up loop counter
04796F C5          0042*       push bc ; save x-coordinate
047970 11 04 00 00 0043*       ld de,4 ; y-coordinate
047974 CD 20 1B 04 0044*       call vdu_plot_bmp
047978 C1          0045*       pop bc ; restore x-coordinate
047979 21 0C 00 00 0046*       ld hl,12 ; bump x-coords
04797D 09          0047*       add hl,bc
04797E E5          0048*       push hl
04797F C1          0049*       pop bc ; bc = new x-coordinate
047980 F1          0050*       pop af
047981 3D          0051*       dec a
047982 C2 6E 79 04 0052*       jp nz,@loop
047986 C9          0053*       ret
047987             0054*   ; end draw_player_ships
047987             0055*   
047987             0056*   do_player:
047987 2A 34 79 04 0057*       ld hl,(player_state)
04798B             0058*       CALL_HL
04798B 01 91 79 04 0001*M1     ld bc,$+6 ; Address of first instruction after the jump
04798F C5          0002*M1     push bc ; which constitutes the return address
047990 E9          0003*M1     jp (hl) ; Jump to the address in HL
047991 C9          0059*       ret
047992             0060*   ; end do_player
047992             0061*   
047992             0062*   ; set initial player position
047992             0063*   ; inputs: none,everything is hardcoded
047992             0064*   ; outputs: player_x/y set to bottom-left corner of screen
047992             0065*   ; destroys: pretty much everything
047992             0066*   player_init:
047992 3A 8B 80 04 0067*       ld a,(player_shields_max)
047996 32 8A 80 04 0068*       ld (player_shields),a
04799A 3A 1E 7F 04 0069*       ld a,(laser_power_max)
04799E 32 1C 7F 04 0070*       ld (laser_power),a
0479A2 3A E2 7C 04 0071*       ld a,(player_fuel_max)
0479A6 32 E0 7C 04 0072*       ld (player_fuel),a
0479AA             0073*   ; set all to zero so they will update
0479AA AF          0074*       xor a
0479AB 32 1D 7F 04 0075*       ld (laser_power_last),a
0479AF 32 8C 80 04 0076*       ld (player_shields_last),a
0479B3 32 E1 7C 04 0077*       ld (player_fuel_last),a
0479B7             0078*   ; set player sprite record with defaults
0479B7 DD 21 2A A1 0079*       ld ix,player_begin
       04          
0479BC 21 21 79 04 0080*       ld hl,player_defaults
0479C0 01 00 00 00 0081*       ld bc,0*256
0479C4 11 00 30 01 0082*       ld de,sprite_bottom*256
0479C8 3E 01       0083*       ld a,1
0479CA CD 9C 81 04 0084*       call spawn_sprite_from_coords
0479CE D2 F9 79 04 0085*       jp nc,@draw
0479D2 DD CB 16 BE 0086*       res 7,(ix+sprite_type)
0479D6             0087*   ; load sprite frames
0479D6 DD 7E 00    0088*       ld a,(ix+sprite_id)
0479D9 CD 00 1C 04 0089*       call vdu_sprite_select
0479DD CD 13 1C 04 0090*       call vdu_sprite_clear_frames
0479E1 21 6F 01 00 0091*       ld hl,BUF_SHIP_0L
0479E5 CD 55 1D 04 0092*       call vdu_sprite_add_buff
0479E9 21 70 01 00 0093*       ld hl,BUF_SHIP_1C
0479ED CD 55 1D 04 0094*       call vdu_sprite_add_buff
0479F1 21 71 01 00 0095*       ld hl,BUF_SHIP_2R
0479F5 CD 55 1D 04 0096*       call vdu_sprite_add_buff
0479F9             0097*   @draw:
0479F9 01 00 00 00 0098*       ld bc,0*256
0479FD 11 00 30 01 0099*       ld de,sprite_bottom*256
047A01 CD CC 1C 04 0100*       call vdu_sprite_move_abs168
047A05 CD 76 1C 04 0101*       call vdu_sprite_show
047A09 21 16 7A 04 0102*       ld hl,player_alive
047A0D 22 34 79 04 0103*       ld (player_state),hl
047A11 DD CB 1D F6 0104*       set sprite_alive,(ix+sprite_collisions)
047A15 C9          0105*       ret
047A16             0106*   ; end player_init
047A16             0107*   
047A16             0108*   player_alive:
047A16 CD 00 7E 04 0109*       call player_input
047A1A CD 88 7F 04 0110*       call player_move_weapons
047A1E C9          0111*       ret
047A1F             0112*   ; end player_alive
047A1F             0113*   
047A1F             0114*   player_dying:
047A1F             0115*   ; DEBUG
047A1F             0116*   ; decrement lives
047A1F 3A 37 79 04 0117*       ld a,(player_ships)
047A23 3D          0118*       dec a
047A24 CA 31 84 04 0119*       jp z,game_over
047A28 32 37 79 04 0120*       ld (player_ships),a
047A2C CD 38 79 04 0121*       call draw_player_ships
047A30             0122*   ; reset the sprite table
047A30 CD 04 81 04 0123*       call table_init
047A34 21 2A A0 04 0124*       ld hl,table_base
047A38 22 DF 80 04 0125*       ld (table_pointer),hl
047A3C             0126*   ; initialize sprites and active tiles table
047A3C CD 3C 81 04 0127*       call sprites_init
047A40 CD 04 81 04 0128*       call table_init
047A44 CD 10 8B 04 0129*       call tile_table_init
047A48             0130*   ; reset player score to what it was at the start of the level
047A48 2A 53 80 04 0131*       ld hl,(player_starting_score)
047A4C 22 4D 80 04 0132*       ld (player_score),hl
047A50             0133*   ; set gfx origin and viewport to playing field window
047A50 01 80 00 00 0134*       ld bc,origin_left
047A54 11 40 00 00 0135*       ld de,origin_top
047A58 CD D0 16 04 0136*       call vdu_set_gfx_origin
047A5C 01 00 00 00 0137*       ld bc,field_left
047A60 11 00 00 00 0138*       ld de,field_top
047A64 DD 21 FF 00 0139*       ld ix,field_right
       00          
047A69 FD 21 3F 01 0140*       ld iy,field_bottom
       00          
047A6E CD EB 16 04 0141*       call vdu_set_gfx_viewport
047A72 CD 5E 16 04 0142*       call vdu_clg
047A76             0143*   ; restart the level
047A76 21 57 68 04 0144*       ld hl,cur_level
047A7A 35          0145*       dec (hl) ; decrement level so it will be incremented back to the same level
047A7B CD 6C 68 04 0146*       call next_level
047A7F             0147*   ; spawn player sprite at starting position
047A7F CD 92 79 04 0148*       call player_init
047A83             0149*   ; set the game state to playing
047A83 21 55 86 04 0150*       ld hl,game_playing
047A87 22 00 84 04 0151*       ld (game_state), hl
047A8B             0152*   ; set game playing substates
047A8B 21 16 7A 04 0153*       ld hl,player_alive
047A8F 22 34 79 04 0154*       ld (player_state), hl
047A93 21 8A 23 04 0155*       ld hl,enemies_alive
047A97 22 7C 23 04 0156*       ld (enemies_state), hl
047A9B C9          0157*       ret
047A9C             0158*   ; END DEBUG
047A9C             0159*   
047A9C 21 96 23 04 0160*       ld hl,enemies_despawning
047AA0 22 7C 23 04 0161*       ld (enemies_state),hl
047AA4 C9          0162*       ret
047AA5             0163*   ; end player_dying
047AA5             0164*   
047AA5             0165*   player_dead:
047AA5 CD 88 7F 04 0166*       call player_move_weapons
047AA9 C9          0167*       ret
047AAA             0168*   ; end player_dead
047AAA             0169*   
047AAA             0170*   
047AAA             0171*   kill_player:
047AAA 21 1F 7A 04 0172*       ld hl,player_dying
047AAE 22 34 79 04 0173*       ld (player_state),hl
047AB2 C9          0174*       ret
047AB3             0175*   ; end kill_player
047AB3             0176*   
047AB3             0059        include "player_cockpit.inc"
047AB3             0001*   ; offsets into control panel element definitions
047AB3             0002*   panel_bufferId: equ 0
047AB3             0003*   panel_x0: equ 3
047AB3             0004*   panel_y0: equ 6
047AB3             0005*   panel_x1: equ 9
047AB3             0006*   panel_y1: equ 12
047AB3             0007*   
047AB3             0008*   ctl_panel_l:
047AB3 09 00 00    0009*       dl BUF_CTL_PANEL_L ; bufferId
047AB6 00 00 00    0010*       dl 0 ; x0
047AB9 00 01 00    0011*       dl 256 ; y0
047ABC 80 00 00    0012*       dl 0+128 ; x1
047ABF 80 01 00    0013*       dl 256+128 ; y1
047AC2             0014*   
047AC2             0015*   ctl_panel_r:
047AC2 0A 00 00    0016*       dl BUF_CTL_PANEL_R ; bufferId
047AC5 80 01 00    0017*       dl 384 ; x0
047AC8 00 01 00    0018*       dl 256 ; y0
047ACB 00 02 00    0019*       dl 384+128 ; x1
047ACE 80 01 00    0020*       dl 256+128 ; y1
047AD1             0021*   
047AD1             0022*   mfd_bezel_l:
047AD1 0D 00 00    0023*       dl BUF_MFD_BEZEL ; bufferId
047AD4 18 00 00    0024*       dl 24 ; x0
047AD7 18 01 00    0025*       dl 280 ; y0
047ADA 78 00 00    0026*       dl 24+96 ; x1
047ADD 78 01 00    0027*       dl 280+96 ; y1
047AE0             0028*   
047AE0             0029*   mfd_bezel_r:
047AE0 0D 00 00    0030*       dl BUF_MFD_BEZEL ; bufferId
047AE3 88 01 00    0031*       dl 392 ; x0
047AE6 18 01 00    0032*       dl 280 ; y0
047AE9 E8 01 00    0033*       dl 392+96 ; x1
047AEC 78 01 00    0034*       dl 280+96 ; y1
047AEF             0035*   
047AEF             0036*   draw_player_cockpit:
047AEF DD 21 B3 7A 0037*       ld ix,ctl_panel_l
       04          
047AF4 CD 8B 7B 04 0038*       call draw_player_ctl_panel
047AF8 DD 21 C2 7A 0039*       ld ix,ctl_panel_r
       04          
047AFD CD 8B 7B 04 0040*       call draw_player_ctl_panel
047B01 DD 21 D1 7A 0041*       ld ix,mfd_bezel_l
       04          
047B06 CD 8B 7B 04 0042*       call draw_player_ctl_panel
047B0A DD 21 9D 7B 0043*       ld ix,mfd_bg_l
       04          
047B0F CD 8B 7B 04 0044*       call draw_player_ctl_panel
047B13 DD 21 AC 7B 0045*       ld ix,mfd_arms_l
       04          
047B18 CD 8B 7B 04 0046*       call draw_player_ctl_panel
047B1C DD 21 E0 7A 0047*       ld ix,mfd_bezel_r
       04          
047B21 CD 8B 7B 04 0048*       call draw_player_ctl_panel
047B25 DD 21 BB 7B 0049*       ld ix,mfd_bg_r
       04          
047B2A CD 8B 7B 04 0050*       call draw_player_ctl_panel
047B2E             0051*   
047B2E 21 28 00 00 0052*       ld hl,BUF_SHIELD
047B32 CD 38 17 04 0053*       call vdu_buff_select
047B36 01 EC 01 00 0054*       ld bc,492
047B3A 11 70 01 00 0055*       ld de,368
047B3E CD 20 1B 04 0056*       call vdu_plot_bmp
047B42 21 27 00 00 0057*       ld hl,BUF_POWER
047B46 CD 38 17 04 0058*       call vdu_buff_select
047B4A 01 04 00 00 0059*       ld bc,4
047B4E 11 70 01 00 0060*       ld de,368
047B52 CD 20 1B 04 0061*       call vdu_plot_bmp
047B56 21 08 00 00 0062*       ld hl,BUF_CREDITS
047B5A CD 38 17 04 0063*       call vdu_buff_select
047B5E 01 80 01 00 0064*       ld bc,384
047B62 11 05 01 00 0065*       ld de,261
047B66 CD 20 1B 04 0066*       call vdu_plot_bmp
047B6A 21 0B 00 00 0067*       ld hl,BUF_JERRY_CAN
047B6E CD 38 17 04 0068*       call vdu_buff_select
047B72 01 6E 00 00 0069*       ld bc,110
047B76 11 02 01 00 0070*       ld de,258
047B7A CD 20 1B 04 0071*       call vdu_plot_bmp
047B7E             0072*   
047B7E CD 9F 80 04 0073*       call init_bar_shields
047B82 CD 34 7F 04 0074*       call init_bar_laser
047B86 CD C7 7C 04 0075*       call init_bar_fuel
047B8A             0076*   
047B8A C9          0077*       ret
047B8B             0078*   ; end draw_player_cockpit
047B8B             0079*   
047B8B             0080*   draw_player_ctl_panel:
047B8B DD 27 00    0081*       ld hl,(ix+panel_bufferId)
047B8E CD 38 17 04 0082*       call vdu_buff_select
047B92 DD 07 03    0083*       ld bc,(ix+panel_x0)
047B95 DD 17 06    0084*       ld de,(ix+panel_y0)
047B98 CD 20 1B 04 0085*       call vdu_plot_bmp
047B9C C9          0086*       ret
047B9D             0087*   ; end draw_player_ctl_panel
047B9D             0088*   
047B9D             0089*   mfd_bg_l:
047B9D 0E 00 00    0090*       dl BUF_MFD_BG ; bufferId
047BA0 28 00 00    0091*       dl 40 ; x0
047BA3 28 01 00    0092*       dl 296 ; y0
047BA6 67 00 00    0093*       dl 40+63 ; x1
047BA9 67 01 00    0094*       dl 296+63 ; y1
047BAC             0095*   
047BAC             0096*   mfd_arms_l:
047BAC 0C 00 00    0097*       dl BUF_MFD_ARMS ; bufferId
047BAF 36 00 00    0098*       dl 54 ; x0
047BB2 40 01 00    0099*       dl 320 ; y0
047BB5 59 00 00    0100*       dl 54+35 ; x1
047BB8 51 01 00    0101*       dl 320+17 ; y1
047BBB             0102*   
047BBB             0103*   mfd_bg_r:
047BBB 0E 00 00    0104*       dl BUF_MFD_BG ; bufferId
047BBE 98 01 00    0105*       dl 408 ; x0
047BC1 28 01 00    0106*       dl 296 ; y0
047BC4 D7 01 00    0107*       dl 408+63 ; x1
047BC7 67 01 00    0108*       dl 296+63 ; y1
047BCA             0109*   
047BCA             0110*   mfd_activate:
047BCA DD E5       0111*       push ix ; preserve pointer
047BCC DD 07 03    0112*       ld bc,(ix+panel_x0)
047BCF DD 17 06    0113*       ld de,(ix+panel_y0)
047BD2 CD D0 16 04 0114*       call vdu_set_gfx_origin
047BD6 01 00 00 00 0115*       ld bc,0
047BDA 11 00 00 00 0116*       ld de,0
047BDE DD 21 3F 00 0117*       ld ix,63
       00          
047BE3 FD 21 3F 00 0118*       ld iy,63
       00          
047BE8 CD EB 16 04 0119*       call vdu_set_gfx_viewport
047BEC DD E1       0120*       pop ix ; restore pointer
047BEE C9          0121*       ret
047BEF             0122*   ; end mfd_activate
047BEF             0123*   
047BEF             0124*   mfd_init:
047BEF DD 27 00    0125*       ld hl,(ix+panel_bufferId)
047BF2 CD 38 17 04 0126*       call vdu_buff_select
047BF6 01 00 00 00 0127*       ld bc,0
047BFA 11 00 00 00 0128*       ld de,0
047BFE CD 20 1B 04 0129*       call vdu_plot_bmp
047C02 C9          0130*       ret
047C03             0131*   ; end mfd_init
047C03             0132*   
047C03             0133*   bar_val: equ 0 ; current value
047C03             0134*   bar_x0: equ panel_x0
047C03             0135*   bar_y0: equ panel_y0
047C03             0136*   bar_x1: equ panel_x1
047C03             0137*   bar_y1: equ panel_y1
047C03             0138*   bar_y: equ 15 ; y-plot coordinate
047C03             0139*   bar_x: equ 15 ; x-plot coordinate
047C03             0140*   
047C03             0141*   bar_yellow: equ 33
047C03             0142*   bar_red: equ 17
047C03             0143*   
047C03             0144*   ; update a vertical bar display
047C03             0145*   ; inputs: ix points to bar structure
047C03             0146*   ;         bar_val set by caller
047C03             0147*   ; prerequisite: bar_init called before first use
047C03             0148*   bar_update_v:
047C03             0149*   ; set gfx viewport
047C03 DD E5       0150*       push ix ; preserve pointer
047C05 DD 07 03    0151*       ld bc,(ix+bar_x0)
047C08 DD 17 06    0152*       ld de,(ix+bar_y0)
047C0B DD 31 0C    0153*       ld iy,(ix+bar_y1)
047C0E DD 37 09    0154*       ld ix,(ix+bar_x1)
047C11 CD EB 16 04 0155*       call vdu_set_gfx_viewport
047C15 DD E1       0156*       pop ix ; restore pointer
047C17             0157*   ; select the color based on the value thresholds
047C17 DD 17 00    0158*       ld de,(ix+bar_val)
047C1A 21 EF FF FF 0159*       ld hl,-bar_red
047C1E 19          0160*       add hl,de
047C1F D2 3C 7C 04 0161*       jp nc,@red
047C23 21 DF FF FF 0162*       ld hl,-bar_yellow
047C27 19          0163*       add hl,de
047C28 D2 34 7C 04 0164*       jp nc,@yellow
047C2C 21 05 00 00 0165*       ld hl,BUF_BAR_V_2 ; green
047C30 C3 40 7C 04 0166*       jp @select
047C34             0167*   @yellow:
047C34 21 04 00 00 0168*       ld hl,BUF_BAR_V_1 ; yellow
047C38 C3 40 7C 04 0169*       jp @select
047C3C             0170*   @red:
047C3C 21 03 00 00 0171*       ld hl,BUF_BAR_V_0 ; red
047C40             0172*   @select:
047C40 CD 38 17 04 0173*       call vdu_buff_select
047C44             0174*   ; get x-plot position
047C44 DD 07 03    0175*       ld bc,(ix+bar_x0)
047C47             0176*   ; compute y-plot position
047C47 DD 17 00    0177*       ld de,(ix+bar_val)
047C4A 21 40 00 00 0178*       ld hl,64
047C4E AF          0179*       xor a ; clear carry
047C4F ED 52       0180*       sbc hl,de
047C51 DD 17 0F    0181*       ld de,(ix+bar_y)
047C54 19          0182*       add hl,de
047C55 7D          0183*       ld a,l
047C56 E6 FC       0184*       and %11111100 ; round to nearest 4 pixels
047C58 6F          0185*       ld l,a
047C59 EB          0186*       ex de,hl
047C5A CD 20 1B 04 0187*       call vdu_plot_bmp
047C5E C9          0188*       ret
047C5F             0189*   ; end bar_update_v
047C5F             0190*   
047C5F             0191*   ; update a horizontal bar display
047C5F             0192*   ; inputs: ix points to bar structure
047C5F             0193*   ;         bar_val set by caller
047C5F             0194*   ; prerequisite: bar_init called before first use
047C5F             0195*   bar_update_h:
047C5F             0196*   ; set gfx viewport
047C5F DD E5       0197*       push ix ; preserve pointer
047C61 DD 07 03    0198*       ld bc,(ix+bar_x0)
047C64 DD 17 06    0199*       ld de,(ix+bar_y0)
047C67 DD 31 0C    0200*       ld iy,(ix+bar_y1)
047C6A DD 37 09    0201*       ld ix,(ix+bar_x1)
047C6D CD EB 16 04 0202*       call vdu_set_gfx_viewport
047C71 DD E1       0203*       pop ix ; restore pointer
047C73             0204*   ; select the color based on the value thresholds
047C73 DD 17 00    0205*       ld de,(ix+bar_val)
047C76 21 EF FF FF 0206*       ld hl,-bar_red
047C7A 19          0207*       add hl,de
047C7B D2 98 7C 04 0208*       jp nc,@red
047C7F 21 DF FF FF 0209*       ld hl,-bar_yellow
047C83 19          0210*       add hl,de
047C84 D2 90 7C 04 0211*       jp nc,@yellow
047C88 21 02 00 00 0212*       ld hl,BUF_BAR_H_2 ; green
047C8C C3 9C 7C 04 0213*       jp @select
047C90             0214*   @yellow:
047C90 21 01 00 00 0215*       ld hl,BUF_BAR_H_1 ; yellow
047C94 C3 9C 7C 04 0216*       jp @select
047C98             0217*   @red:
047C98 21 00 00 00 0218*       ld hl,BUF_BAR_H_0 ; red
047C9C             0219*   @select:
047C9C CD 38 17 04 0220*       call vdu_buff_select
047CA0             0221*   ; compute x-plot position
047CA0 DD 27 00    0222*       ld hl,(ix+bar_val)
047CA3 DD 07 0F    0223*       ld bc,(ix+bar_x)
047CA6 09          0224*       add hl,bc
047CA7 7D          0225*       ld a,l
047CA8 E6 FC       0226*       and %11111100 ; round to nearest 4 pixels
047CAA 6F          0227*       ld l,a
047CAB E5          0228*       push hl
047CAC C1          0229*       pop bc
047CAD             0230*   ; get y-plot position
047CAD DD 17 06    0231*       ld de,(ix+bar_y0)
047CB0 CD 20 1B 04 0232*       call vdu_plot_bmp
047CB4 C9          0233*       ret
047CB5             0234*   ; end bar_update_h
047CB5             0060        include "player_fuel.inc"
047CB5             0001*   
047CB5             0002*   bar_fuel:
047CB5 00 00 00    0003*       dl 0 ; value
047CB8 30 00 00    0004*       dl 48 ; x0
047CBB 08 01 00    0005*       dl 264 ; y0
047CBE 6F 00 00    0006*       dl 48+63 ; x1
047CC1 0F 01 00    0007*       dl 264+7 ; y1
047CC4 F0 FF FF    0008*       dl 48-64 ; x-plot coordinate
047CC7             0009*   
047CC7             0010*   init_bar_fuel:
047CC7 3A E4 7C 04 0011*       ld a,(discharge_fuel_timer_max)
047CCB 32 E3 7C 04 0012*       ld (discharge_fuel_timer),a
047CCF DD 21 B5 7C 0013*       ld ix,bar_fuel
       04          
047CD4 3A E2 7C 04 0014*       ld a,(player_fuel_max)
047CD8 DD 77 00    0015*       ld (ix+bar_val),a
047CDB CD 5F 7C 04 0016*       call bar_update_h
047CDF C9          0017*       ret
047CE0             0018*   ; end init_bar_fuel
047CE0             0019*   
047CE0 40          0020*   player_fuel: db 64 ; integer
047CE1 00          0021*   player_fuel_last: db 0 ; integer
047CE2 40          0022*   player_fuel_max: db 64 ; integer
047CE3 00          0023*   discharge_fuel_timer: db 0
047CE4 40          0024*   discharge_fuel_timer_max: db 64 ;
047CE5             0025*   discharge_fuel:
047CE5             0026*   ; check fuel timer
047CE5 21 E3 7C 04 0027*       ld hl,discharge_fuel_timer
047CE9 35          0028*       dec (hl)
047CEA C0          0029*       ret nz ; not time to discharge fuel so return
047CEB             0030*   ; reset fuel discharge timer
047CEB 3A E4 7C 04 0031*       ld a,(discharge_fuel_timer_max)
047CEF 77          0032*       ld (hl),a
047CF0             0033*   ; discharge fuel
047CF0 21 E0 7C 04 0034*       ld hl,player_fuel
047CF4 35          0035*       dec (hl)
047CF5 CA FE 7C 04 0036*       jp z,@no_fuel
047CF9 FA FE 7C 04 0037*       jp m,@no_fuel
047CFD C9          0038*       ret ; fuel not zero so return
047CFE             0039*   @no_fuel:
047CFE 36 00       0040*       ld (hl),0 ; TODO: implement out-of-fuel handler
047D00 C9          0041*       ret
047D01             0042*   ; end discharge_fuel
047D01             0043*   
047D01             0044*   draw_fuel:
047D01 CD E5 7C 04 0045*       call discharge_fuel
047D05 21 E1 7C 04 0046*       ld hl,player_fuel_last
047D09 3A E0 7C 04 0047*       ld a,(player_fuel)
047D0D BE          0048*       cp (hl)
047D0E C8          0049*       ret z ; no change to update
047D0F 77          0050*       ld (hl),a
047D10 DD 21 B5 7C 0051*       ld ix,bar_fuel
       04          
047D15 DD 77 00    0052*       ld (ix+bar_val),a ; TODO: this is redundant
047D18 CD 5F 7C 04 0053*       call bar_update_h
047D1C C9          0054*       ret
047D1D             0055*   ; end draw_fuel
047D1D             0061        include "player_input.inc"
047D1D FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF    
047E00             0002*   
047E00             0003*   ; UART ports for reading joystick input
047E00             0004*   ; bit tests: 0 means actuated, 1 means not actuated
047E00             0005*   portC: 	EQU 	$9E ; reads dpad input
047E00             0006*   joy1_u: equ 1
047E00             0007*   joy1_d: equ 3
047E00             0008*   joy1_l: equ 5
047E00             0009*   joy1_r: equ 7
047E00             0010*   portD: 	EQU 	$A2 ; reads buttons
047E00             0011*   btn1_a: equ 5
047E00             0012*   
047E00             0013*   ; process player keyboard input, set player bitmap
047E00             0014*   ; velocities and draw player bitmap at updated coordinates
047E00             0015*   ; Inputs: player_x/y set at desired position
047E00             0016*   ; Returns: player bitmap drawn at updated position
047E00             0017*   ; Destroys: probably everything except maybe iy
047E00             0018*   ; NOTE: in mode 9 we draw the ship as a sprite, not a bitmap
047E00             0019*   ; TODO: requires sprite implementation
047E00             0020*   player_input:
047E00             0021*   ; point to player sprite record
047E00 FD 21 2A A1 0022*       ld iy,player_begin
       04          
047E05 FD 22 DF 80 0023*       ld (table_pointer),iy
       04          
047E0A             0024*   ; reset player component velocities to zero as the default
047E0A 21 00 00 00 0025*       ld hl,0
047E0E FD 2F 07    0026*       ld (iy+sprite_xvel),hl
047E11 FD 2F 0A    0027*       ld (iy+sprite_yvel),hl
047E14             0028*   ; make ship the active sprite
047E14 FD 7E 00    0029*       ld a,(iy+sprite_id)
047E17 CD 00 1C 04 0030*       call vdu_sprite_select
047E1B             0031*   ; check for keypresses and branch accordingly
047E1B             0032*       MOSCALL    mos_getkbmap ;ix = pointer to MOS virtual keys table
047E1B 3E 1E       0001*M1 			LD	A, function
047E1D 5B CF       0002*M1 			RST.LIL	08h
047E1F             0033*   ; do player directional input
047E1F AF          0034*       xor a ; clear flags
047E20 DB 9E       0035*       in a,(portC) ; read dpad input
047E22 57          0036*       ld d,a ; save dpad input
047E23 3E 01       0037*       ld a,1 ; set ship's default animation to center
047E25             0038*   ; 26 Left: move player left
047E25 DD CB 03 4E 0039*       bit 1,(ix+3)
047E29 C2 37 7E 04 0040*       jp nz,@F
047E2D             0041*   ; test dpad left
047E2D CB 6A       0042*       bit joy1_l,d
047E2F CA 37 7E 04 0043*       jp z,@F
047E33 C3 43 7E 04 0044*       jp @right
047E37             0045*   @@:
047E37 FD 27 07    0046*       ld hl,(iy+sprite_xvel)
047E3A 01 00 FD FF 0047*       ld bc,-player_speed
047E3E 09          0048*       add hl,bc
047E3F FD 2F 07    0049*       ld (iy+sprite_xvel),hl
047E42 3D          0050*       dec a ; set ship's animation to left
047E43             0051*   @right:
047E43             0052*   ; 122 Right: move player right
047E43 DD CB 0F 4E 0053*       bit 1,(ix+15)
047E47 C2 55 7E 04 0054*       jp nz,@F
047E4B             0055*   ; test dpad right
047E4B CB 7A       0056*       bit joy1_r,d
047E4D CA 55 7E 04 0057*       jp z,@F
047E51 C3 61 7E 04 0058*       jp @up
047E55             0059*   @@:
047E55 FD 27 07    0060*       ld hl,(iy+sprite_xvel)
047E58 01 00 03 00 0061*       ld bc,player_speed
047E5C 09          0062*       add hl,bc
047E5D FD 2F 07    0063*       ld (iy+sprite_xvel),hl
047E60 3C          0064*       inc a ; set ship's animation to right
047E61             0065*   @up:
047E61             0066*   ; 58 Up: move player up
047E61 DD CB 07 4E 0067*       bit 1,(ix+7)
047E65 C2 73 7E 04 0068*       jp nz,@F
047E69             0069*   ; test dpad up
047E69 CB 4A       0070*       bit joy1_u,d
047E6B CA 73 7E 04 0071*       jp z,@F
047E6F C3 7E 7E 04 0072*       jp @dn
047E73             0073*   @@:
047E73 FD 27 0A    0074*       ld hl,(iy+sprite_yvel)
047E76 01 00 FD FF 0075*       ld bc,-player_speed
047E7A 09          0076*       add hl,bc
047E7B FD 2F 0A    0077*       ld (iy+sprite_yvel),hl
047E7E             0078*   @dn:
047E7E             0079*   ; 42 Down: move player down
047E7E DD CB 05 4E 0080*       bit 1,(ix+5)
047E82 C2 90 7E 04 0081*       jp nz,@F
047E86             0082*   ; test dpad down
047E86 CB 5A       0083*       bit joy1_d,d
047E88 CA 90 7E 04 0084*       jp z,@F
047E8C C3 9B 7E 04 0085*       jp @frame
047E90             0086*   @@:
047E90 FD 27 0A    0087*       ld hl,(iy+sprite_yvel)
047E93 01 00 03 00 0088*       ld bc,player_speed
047E97 09          0089*       add hl,bc
047E98 FD 2F 0A    0090*       ld (iy+sprite_yvel),hl
047E9B             0091*   @frame:
047E9B             0092*   ; a should land here loaded with the correct frame
047E9B CD 63 1C 04 0093*       call vdu_sprite_select_frame
047E9F             0094*   ; draw player at updated position
047E9F FD 21 2A A1 0095*       ld iy,player_begin
       04          
047EA4 FD 22 DF 80 0096*       ld (table_pointer),iy
       04          
047EA9 CD 8F 82 04 0097*       call move_sprite
047EAD FD 07 01    0098*       ld bc,(iy+sprite_x)
047EB0 FD 17 04    0099*       ld de,(iy+sprite_y)
047EB3 CD CC 1C 04 0100*       call vdu_sprite_move_abs168
047EB7             0101*   
047EB7             0102*   ; process player laser fire
047EB7             0103*   ; do player fire button input
047EB7             0104*   ; read joystick fire button
047EB7 AF          0105*       xor a ; clear flags
047EB8 DB A2       0106*       in a,(portD) ; read joypad fire button input
047EBA CB 6F       0107*       bit btn1_a,a
047EBC CA 94 7F 04 0108*       jp z,player_spawn_laser
047EC0             0109*   ; 99 Space: fire main weapon
047EC0 DD CB 0C 56 0110*       bit 2,(ix+12)
047EC4 C2 94 7F 04 0111*       jp nz,player_spawn_laser
047EC8             0112*   ; no fire button pressed so go home
047EC8 C9          0113*       ret
047EC9             0114*   ; end player_input
047EC9             0062        include "player_laser.inc"
047EC9 FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF    
047F00             0002*   
047F00             0003*   laser_defaults:
047F00 06          0004*       db player_air        ; type
047F01 4A 01 00    0005*       dl BUF_LASER_A	    ; base_bufferId
047F04 F1 7F 04    0006*       dl move_player_laser	; move_program
047F07 40          0007*       db %01000000            ; collisions bit 6 signals sprite alive
047F08 05          0008*       db 5	                ; dim_x
047F09 0D          0009*       db 13                   ; dim_y
047F0A 01          0010*       db 1                    ; num_orientations
047F0B 02          0011*       db 2                    ; num_animations
047F0C 00          0012*       db 0	                ; animation
047F0D 02          0013*       db laser_animation_timer_reset ; animation_timer
047F0E 00          0014*       db 0	                ; move_timer
047F0F 00          0015*       db 0	                ; move_step
047F10 00          0016*       db 0	                ; points
047F11 00          0017*       db 0	                ; shield_damage
047F12 00          0018*       db 0                    ; frame
047F13             0019*   
047F13             0020*   
047F13             0021*   player_lasers_max: equ 4
047F13             0022*   laser_speed: equ 4*256 ; 6 pixels per frame 16.8 fixed
047F13             0023*   tmr_laser: ds 6 ; rate timer for firing laser
       FF FF FF FF 
       FF FF 
047F19 0C 00 00    0024*   tmr_laser_reset: dl 120/10
047F1C             0025*   laser_animation_timer_reset: equ 2 ; animate every two frames
047F1C             0026*   
047F1C 40          0027*   laser_power: db 64 ; integer
047F1D 00          0028*   laser_power_last: db 0 ; integer
047F1E 40          0029*   laser_power_max: db 64 ; integer
047F1F 04          0030*   laser_power_per_shot: db 4 ; integer
047F20 00          0031*   charge_laser_timer: db 0
047F21 06          0032*   charge_laser_timer_max: db 6
047F22             0033*   bar_laser:
047F22 00 00 00    0034*       dl 0 ; value
047F25 08 00 00    0035*       dl 8 ; x0
047F28 30 01 00    0036*       dl 304 ; y0
047F2B 0F 00 00    0037*       dl 8+7 ; x1
047F2E 6F 01 00    0038*       dl 304+63 ; y1
047F31 F0 00 00    0039*       dl 304-64 ; y-plot coordinate
047F34             0040*   
047F34             0041*   init_bar_laser:
047F34 3A 21 7F 04 0042*       ld a,(charge_laser_timer_max)
047F38 32 20 7F 04 0043*       ld (charge_laser_timer),a
047F3C DD 21 22 7F 0044*       ld ix,bar_laser
       04          
047F41 3A 1E 7F 04 0045*       ld a,(laser_power_max)
047F45 DD 77 00    0046*       ld (ix+bar_val),a
047F48 CD 03 7C 04 0047*       call bar_update_v
047F4C C9          0048*       ret
047F4D             0049*   ; end init_bar_laser
047F4D             0050*   
047F4D             0051*   init_player_laser:
047F4D             0052*   ; set pointer to laser sprite table
047F4D FD 21 2A A0 0053*       ld iy,player_weapons_begin
       04          
047F52 FD 7E 00    0054*       ld a,(iy+sprite_id) ; sprite id
047F55 1E 04       0055*       ld e,player_lasers_max ; sprite loop counter
047F57             0056*   ; define laser sprites
047F57             0057*   @sprites_loop:
047F57 F5          0058*       push af
047F58 D5          0059*       push de
047F59 CD 00 1C 04 0060*   	call vdu_sprite_select
047F5D CD 13 1C 04 0061*   	call vdu_sprite_clear_frames
047F61 21 4A 01 00 0062*   	ld hl,BUF_LASER_A
047F65 06 02       0063*   	ld b,2 ; two bitmaps for laser
047F67             0064*   @frames_loop:
047F67 C5          0065*   	push bc
047F68 E5          0066*   	push hl
047F69 CD 55 1D 04 0067*   	call vdu_sprite_add_buff
047F6D E1          0068*   	pop hl
047F6E 23          0069*   	inc hl
047F6F C1          0070*   	pop bc
047F70 10 F5       0071*   	djnz @frames_loop
047F72 D1          0072*       pop de ; sprite loop counter
047F73 F1          0073*       pop af ; sprite id
047F74 3C          0074*       inc a
047F75 1D          0075*       dec e
047F76 C2 57 7F 04 0076*       jp nz,@sprites_loop
047F7A             0077*   ; set laser firing timer to zero
047F7A FD 21 13 7F 0078*       ld iy,tmr_laser
       04          
047F7F 21 00 00 00 0079*       ld hl,0
047F83 CD 16 15 04 0080*       call timestamp_tmr_set
047F87 C9          0081*       ret
047F88             0082*   ; end init_player_laser
047F88             0083*   
047F88             0084*   player_move_weapons:
047F88             0085*   ; initialize pointers and loop counter
047F88 FD 21 2A A0 0086*       ld iy,player_weapons_begin ; set iy to first record in table
       04          
047F8D 06 04       0087*       ld b,player_lasers_max ; loop counter
047F8F CD 0E 82 04 0088*       call move_sprite_group
047F93 C9          0089*       ret
047F94             0090*   ; end player_move_weapons
047F94             0091*   
047F94             0092*   player_spawn_laser:
047F94             0093*    ; check laser spawn timer
047F94 FD 21 13 7F 0094*       ld iy,tmr_laser
       04          
047F99 CD 21 15 04 0095*       call timestamp_tmr_get
047F9D F0          0096*       ret p ; not time to fire
047F9E             0097*   ; check laser power
047F9E 3A 1C 7F 04 0098*       ld a,(laser_power)
047FA2 21 1F 7F 04 0099*       ld hl,laser_power_per_shot
047FA6 96          0100*       sub (hl) ; units of power per laser shot
047FA7 D8          0101*       ret c ; not enough power to fire
047FA8             0102*   ; update power to reflect firing
047FA8 32 1C 7F 04 0103*       ld (laser_power),a
047FAC             0104*   ; reset timer
047FAC 2A 19 7F 04 0105*       ld hl,(tmr_laser_reset)
047FB0 CD 16 15 04 0106*       call timestamp_tmr_set
047FB4             0107*   ; fire the laser
047FB4 DD 21 2A A0 0108*       ld ix,player_weapons_begin
       04          
047FB9 06 04       0109*       ld b,player_lasers_max
047FBB FD 21 2A A1 0110*       ld iy,player_begin
       04          
047FC0 FD 22 DF 80 0111*       ld (table_pointer),iy
       04          
047FC5 21 00 7F 04 0112*       ld hl,laser_defaults
047FC9 CD DC 81 04 0113*       call spawn_sprite_from_sprite
047FCD D0          0114*       ret nc ; no carry means no free sprite slots, so we go home
047FCE             0115*   ; other specific initialization
047FCE             0116*   ; ------------------------------------------------
047FCE FD 21 2A A1 0117*       ld iy,player_begin
       04          
047FD3             0118*   ; x-coordinate
047FD3 FD 27 01    0119*       ld hl,(iy+sprite_x)
047FD6 11 00 05 00 0120*       ld de,5*256 ; horizontal center with player sprite
047FDA 19          0121*       add hl,de
047FDB DD 2F 01    0122*       ld (ix+sprite_x),hl
047FDE             0123*   ; y-coordinate
047FDE FD 27 04    0124*       ld hl,(iy+sprite_y)
047FE1 11 00 FA FF 0125*       ld de,-6*256 ; set laser y a few pixels above player
047FE5 19          0126*       add hl,de
047FE6 DD 2F 04    0127*       ld (ix+sprite_y),hl
047FE9             0128*   ; set laser velocity
047FE9 21 00 FC FF 0129*       ld hl,-laser_speed
047FED DD 2F 0A    0130*       ld (ix+sprite_yvel),hl
047FF0 C9          0131*       ret
047FF1             0132*   ; end player_spawn_laser
047FF1             0133*   
047FF1             0134*   move_player_laser:
047FF1             0135*   ; run the movement program for the laser
047FF1 CD 8F 82 04 0136*       call move_sprite
047FF5 3A E2 80 04 0137*       ld a,(sprite_screen_edge)
047FF9 E6 08       0138*       and a,collide_top ; check collision with top of screen
047FFB CA 03 80 04 0139*       jp z,@F ; still on screen
047FFF C3 28 81 04 0140*       jp table_deactivate_sprite
048003             0141*   @@: ; check animation timer
048003 FD 35 23    0142*       dec (iy+sprite_animation_timer)
048006 C2 1A 80 04 0143*       jp nz,@F
04800A 3E 02       0144*       ld a,laser_animation_timer_reset
04800C FD 77 23    0145*       ld (iy+sprite_animation_timer),a
04800F FD 7E 00    0146*       ld a,(iy+sprite_id)
048012 CD 00 1C 04 0147*       call vdu_sprite_select
048016 CD 47 1C 04 0148*       call vdu_sprite_next_frame
04801A             0149*   @@: ; all done
04801A C9          0150*       ret
04801B             0151*   ; end move_player_laser
04801B             0152*   
04801B             0153*   charge_laser:
04801B             0154*   ; check laser timer
04801B 21 20 7F 04 0155*       ld hl,charge_laser_timer
04801F 35          0156*       dec (hl)
048020 C0          0157*       ret nz
048021 3A 21 7F 04 0158*       ld a,(charge_laser_timer_max)
048025 77          0159*       ld (hl),a
048026 21 1C 7F 04 0160*       ld hl,laser_power
04802A 34          0161*       inc (hl)
04802B 3E 40       0162*       ld a,64
04802D BE          0163*       cp (hl)
04802E D0          0164*       ret nc
04802F 77          0165*       ld (hl),a
048030 C9          0166*       ret
048031             0167*   ; end charge_laser
048031             0168*   draw_laser:
048031 CD 1B 80 04 0169*       call charge_laser
048035 21 1D 7F 04 0170*       ld hl,laser_power_last
048039 3A 1C 7F 04 0171*       ld a,(laser_power)
04803D BE          0172*       cp (hl)
04803E C8          0173*       ret z ; no change to update
04803F 77          0174*       ld (hl),a
048040 DD 21 22 7F 0175*       ld ix,bar_laser
       04          
048045 DD 77 00    0176*       ld (ix+bar_val),a ; TODO: this is redundant
048048 CD 03 7C 04 0177*       call bar_update_v
04804C C9          0178*       ret
04804D             0063        include "player_score.inc"
04804D             0001*   ; scores are unsigned integers
04804D 00 00 00    0002*   player_score: dl 0
048050 00 00 00    0003*   player_score_last: dl 0 ; if equal to player_score, no need to update
048053 00 00 00    0004*   player_starting_score: dl 0 ; to reset after restarting a map
048056             0005*   
048056             0006*   ; inputs: iy set to sprite/tile record being tallied
048056             0007*   ; outputs: hl,player_score = updated score
048056             0008*   ; destroys: hl,de
048056             0009*   update_score:
048056 11 00 00 00 0010*       ld de,0 ; clear deu and d
04805A FD 5E 26    0011*       ld e,(iy+sprite_points)
04805D 2A 4D 80 04 0012*       ld hl,(player_score)
048061 19          0013*       add hl,de
048062 22 4D 80 04 0014*       ld (player_score),hl
048066 C9          0015*       ret
048067             0016*   ; end update_score
048067             0017*   
048067             0018*   ; text coordinates for score display
048067             0019*   score_x: equ 50
048067             0020*   score_y: equ 33
048067             0021*   ; inputs: none
048067             0022*   print_score:
048067 2A 50 80 04 0023*       ld hl,(player_score_last)
04806B ED 5B 4D 80 0024*       ld de,(player_score)
       04          
048070 ED 53 50 80 0025*       ld (player_score_last),de
       04          
048075 AF          0026*       xor a ; clear carry
048076 ED 52       0027*       sbc hl,de
048078 C8          0028*       ret z ; no change to update
048079 0E 32       0029*       ld c,score_x
04807B 06 21       0030*       ld b,score_y
04807D CD 37 16 04 0031*       call vdu_move_cursor
048081 2A 4D 80 04 0032*       ld hl,(player_score)
048085 CD 53 01 04 0033*       call printDec
048089 C9          0034*       ret
04808A             0035*   ; end print_score
04808A             0064        include "player_shields.inc"
04808A             0001*   
04808A 40          0002*   player_shields: db 64 ; integer
04808B             0003*   ; max player shields,binary
04808B             0004*   ; can increase with power-ups (todo)
04808B 40          0005*   player_shields_max: db 64 ; integer
04808C 00          0006*   player_shields_last: db 0 ; integer
04808D             0007*   bar_shields:
04808D 00 00 00    0008*       dl 0 ; value
048090 F0 01 00    0009*       dl 496 ; x0
048093 30 01 00    0010*       dl 304 ; y0
048096 F7 01 00    0011*       dl 496+7 ; x1
048099 6F 01 00    0012*       dl 304+63 ; y1
04809C F0 00 00    0013*       dl 304-64 ; y-plot coordinate
04809F             0014*   
04809F             0015*   init_bar_shields:
04809F DD 21 8D 80 0016*       ld ix,bar_shields
       04          
0480A4 2A 8B 80 04 0017*       ld hl,(player_shields_max)
0480A8 DD 2F 00    0018*       ld (ix+bar_val),hl
0480AB CD 03 7C 04 0019*       call bar_update_v
0480AF C9          0020*       ret
0480B0             0021*   ; end init_bar_shields
0480B0             0022*   
0480B0             0023*   ; inputs: iy set to sprite/tile record being tallied
0480B0             0024*   ; outputs: hl,player_shields = updated shields
0480B0             0025*   ; destroys: hl,de
0480B0             0026*   update_shields:
0480B0 FD 6E 27    0027*       ld l,(iy+sprite_shield_damage)
0480B3 3A 8A 80 04 0028*       ld a,(player_shields)
0480B7 85          0029*       add a,l
0480B8 F2 BD 80 04 0030*       jp p,@have_shields
0480BC AF          0031*       xor a ; set to zero
0480BD             0032*   @have_shields:
0480BD 32 8A 80 04 0033*       ld (player_shields),a
0480C1 B7          0034*       or a ; check for zero
0480C2 CA AA 7A 04 0035*       jp z,kill_player
0480C6 C9          0036*       ret
0480C7             0037*   ; end update_shields
0480C7             0038*   
0480C7             0039*   draw_shields:
0480C7 21 8C 80 04 0040*       ld hl,player_shields_last
0480CB 3A 8A 80 04 0041*       ld a,(player_shields)
0480CF BE          0042*       cp (hl)
0480D0 C8          0043*       ret z ; no change to update
0480D1 77          0044*       ld (hl),a
0480D2 DD 21 8D 80 0045*       ld ix,bar_shields
       04          
0480D7 DD 77 00    0046*       ld (ix+bar_val),a ; TODO: this is redundant
0480DA CD 03 7C 04 0047*       call bar_update_v
0480DE C9          0048*       ret
0480DF             0065        include "screen.inc"
0480DF             0001*   
0480DF             0002*   screen_right: equ 511
0480DF             0003*   screen_bottom: equ 383
0480DF             0004*   origin_top: equ 64
0480DF             0005*   origin_left: equ 128
0480DF             0006*   field_top: equ 0
0480DF             0007*   field_bottom: equ screen_bottom-origin_top
0480DF             0008*   field_left: equ 0
0480DF             0009*   field_right: equ 255
0480DF             0010*   sprite_top: equ field_top
0480DF             0011*   sprite_bottom: equ field_bottom-15
0480DF             0012*   sprite_left: equ field_left
0480DF             0013*   sprite_right: equ field_right-15
0480DF             0014*   tile_bottom: equ screen_bottom+1
0480DF             0066        include "sprites.inc"
0480DF             0001*   ; sprite_type
0480DF             0002*   enemy_dead: equ 0
0480DF             0003*   enemy_air: equ 1
0480DF             0004*   enemy_ground: equ 2
0480DF             0005*   enemy_projectile: equ 3
0480DF             0006*   explosion: equ 4
0480DF             0007*   player: equ 5
0480DF             0008*   player_air: equ 6
0480DF             0009*   player_ground: equ 7
0480DF             0010*   
0480DF             0011*   ; ###### SPRITE TABLE FIELD INDICES ######
0480DF             0012*   table_record_size:         equ  64; 40 bytes ;40 bytes per sprite record
0480DF             0013*   sprite_id:                 equ   0; 1 bytes ;unique spriteId, zero-based
0480DF             0014*   ; sprite state variables
0480DF             0015*   sprite_state_variables:    equ   1; beginning of sprite state variables
0480DF             0016*   sprite_x:                  equ   1; 3 bytes ;16.8 fractional x position in pixels
0480DF             0017*   sprite_y:                  equ   4; 3 bytes ;16.8 fractional y position in pixels
0480DF             0018*   sprite_xvel:               equ   7; 3 bytes ;x-component velocity, 16.8 fixed, pixels
0480DF             0019*   sprite_yvel:               equ  10; 3 bytes ;y-component velocity, 16.8 fixed, pixels
0480DF             0020*   sprite_vel:                equ  13; 3 bytes ;velocity px/frame (16.8 fixed)
0480DF             0021*   sprite_heading:            equ  16; 3 bytes ;sprite movement direction deg256 16.8 fixed
0480DF             0022*   sprite_orientation:        equ  19; 3 bytes ;orientation bits
0480DF             0023*   ; sprite definition variables
0480DF             0024*   sprite_definitions:        equ  22; beginnning of sprite definition variables
0480DF             0025*   sprite_type:               equ  22; 1 bytes ;type of sprite as defined in enemies.inc
0480DF             0026*   sprite_base_bufferId:      equ  23; 3 bytes ;bitmap bufferId
0480DF             0027*   sprite_move_program:       equ  26; 3 bytes ;address of sprite's behavior subroutine
0480DF             0028*   sprite_collisions:         equ  29; 1 bytes ;see collisions.inc constants for bit definitions
0480DF             0029*   sprite_dim_x:              equ  30; 1 bytes ;sprite width in pixels
0480DF             0030*   sprite_dim_y:              equ  31; 1 bytes ;sprite height in pixels
0480DF             0031*   sprite_num_orientations:   equ  32; 1 bytes ;number of orientations for this sprite
0480DF             0032*   sprite_num_animations:     equ  33; 1 bytes ;number of animations for this sprite
0480DF             0033*   sprite_animation:          equ  34; 1 bytes ;current animation index, zero-based
0480DF             0034*   sprite_animation_timer:    equ  35; 1 bytes ;when hits zero, draw next animation
0480DF             0035*   sprite_move_timer:         equ  36; 1 bytes ;when zero, go to next move program, or step
0480DF             0036*   sprite_move_step:          equ  37; 1 bytes ;stage in a move program sequence, varies
0480DF             0037*   sprite_points:             equ  38; 1 bytes ;points awarded for killing this sprite type
0480DF             0038*   sprite_shield_damage:      equ  39; 1 bytes ;shield points deducted for collision
0480DF             0039*   sprite_frame:              equ  40; 1 bytes ;current animation frame
0480DF             0040*   
0480DF             0041*   ; ###### SPRITE TABLE VARIABLES ######
0480DF             0042*   ; pointer to top address of current record, initialized to table_base
0480DF 2A A0 04    0043*   table_pointer: dl table_base
0480E2             0044*   
0480E2             0045*   ; flag indicating collision with screen edge
0480E2 00          0046*   sprite_screen_edge: db #00
0480E3             0047*   
0480E3             0048*   ; ######### COLLISION SPRITE PARAMETERS ##########
0480E3             0049*   ; integer coordinates are all that are needed for collision calculations
0480E3 00          0050*   collision_x: db 0x00
0480E4 00          0051*   collision_y: db 0x00
0480E5 00          0052*   collision_dim_x: db 0x00
0480E6 00          0053*   collision_dim_y: db 0x00
0480E7             0054*   
0480E7             0055*   ; scratch variables
0480E7 00          0056*   x: db 0x00 ; 8-bit signed integer
0480E8 00          0057*   y: db 0x00 ; 8-bit signed integer
0480E9 00 00 00    0058*   x0: dl 0x000000 ; 16.8 signed fixed place
0480EC 00 00 00    0059*   y0: dl 0x000000 ; 16.8 signed fixed place
0480EF 00 00 00    0060*   incx1: dl 0x000000 ; 16.8 signed fixed place
0480F2 00 00 00    0061*   incy1: dl 0x000000 ; 16.8 signed fixed place
0480F5 00 00 00    0062*   incx2: dl 0x000000 ; 16.8 signed fixed place
0480F8 00 00 00    0063*   incy2: dl 0x000000 ; 16.8 signed fixed place
0480FB             0064*   
0480FB             0065*   ; sprite_heading: dl 0x000000 ; signed fixed 16.8
0480FB 00 00 00    0066*   radius: dl 0x000000 ; signed fixed 16.8 (but should always be positive)
0480FE 00 00 00    0067*   sin_sprite_heading: dl 0x000000 ; signed fixed 16.8
048101 00 00 00    0068*   cos_sprite_heading: dl 0x000000 ; signed fixed 16.8
048104             0069*   
048104             0070*   table_init:
048104             0071*   ; clear the sprite table
048104 AF          0072*       xor a ; write zeroes to sprite table
048105 21 2A A0 04 0073*       ld hl,table_base ; address to copy from
048109 01 00 05 00 0074*       ld bc,table_end-table_base ; number of bytes to clear
04810D CD E6 03 04 0075*       call clear_mem
048111             0076*   ; write sprite ids
048111 DD 21 2A A0 0077*       ld ix,table_base
       04          
048116 AF          0078*       xor a ; sprite id
048117 0E 00       0079*       ld c,0 ; sprite type
048119 06 14       0080*       ld b,table_num_records ; loop counter
04811B             0081*   @loop:
04811B DD 77 00    0082*       ld (ix+sprite_id),a
04811E DD 71 16    0083*       ld (ix+sprite_type),c
048121 ED 32 40    0084*       lea ix,ix+table_record_size
048124 3C          0085*       inc a
048125 10 F4       0086*       djnz @loop
048127 C9          0087*       ret
048128             0088*   ; end table_init
048128             0089*   
048128             0090*   ; deactivate the sprite with the given id
048128             0091*   ; inputs: iy set to sprite record
048128             0092*   ; outputs: nothing
048128             0093*   ; destroys: a,hl
048128             0094*   table_deactivate_sprite:
048128 FD 7E 00    0095*       ld a,(iy+sprite_id) ; get spriteId
04812B CD 00 1C 04 0096*       call vdu_sprite_select ; select sprite
04812F CD 84 1C 04 0097*       call vdu_sprite_hide
048133 FD CB 1D B6 0098*       res sprite_alive,(iy+sprite_collisions)
048137 FD CB 1D BE 0099*       res sprite_just_died,(iy+sprite_collisions)
04813B C9          0100*       ret
04813C             0101*   ; end table_deactivate_sprite
04813C             0102*   
04813C             0103*   sprites_init:
04813C             0104*   ; initialize sprites
04813C CD 34 1D 04 0105*   	call vdu_sprite_reset ; clear sprite data in vdp
048140 AF          0106*   	xor a ; loop counter / sprite id
048141             0107*   @sprite_loop:
048141 F5          0108*   	push af ; save loop counter / sprite id
048142 CD 00 1C 04 0109*   	call vdu_sprite_select
048146 21 00 01 00 0110*   	ld hl,BUF_CRATER ; can be anything, but why not a smoking hole in the ground?
04814A CD 55 1D 04 0111*   	call vdu_sprite_add_buff
04814E F1          0112*   	pop af ; restore loop counter / sprite id
04814F 3C          0113*       inc a
048150 FE 14       0114*       cp table_num_records
048152 C2 41 81 04 0115*       jp nz,@sprite_loop
048156 CD 34 1C 04 0116*   	call vdu_sprite_activate
04815A             0117*   
04815A             0118*   ; define player sprite
04815A 3A 2A A1 04 0119*   	ld a,(player_begin+sprite_id)
04815E CD 00 1C 04 0120*   	call vdu_sprite_select
048162 CD 13 1C 04 0121*   	call vdu_sprite_clear_frames
048166 21 6F 01 00 0122*   	ld hl,BUF_SHIP_0L
04816A 01 03 00 00 0123*   	ld bc,3 ; three bitmaps for player ship
04816E             0124*   @sprite_player_loop:
04816E C5          0125*   	push bc
04816F E5          0126*   	push hl
048170 CD 55 1D 04 0127*   	call vdu_sprite_add_buff
048174 E1          0128*   	pop hl
048175 23          0129*   	inc hl
048176 C1          0130*   	pop bc
048177 10 F5       0131*   	djnz @sprite_player_loop
048179             0132*   
048179             0133*   ; define player weapon sprites
048179 CD 4D 7F 04 0134*       call init_player_laser
04817D             0135*   
04817D             0136*   ; define enemy sprites
04817D CD C7 25 04 0137*       call init_enemy_seekers
048181 CD 8A 24 04 0138*       call init_enemy_fireballs
048185             0139*   
048185             0140*   ; define explosion sprites
048185 CD 86 26 04 0141*       call init_explosions
048189 C9          0142*       ret
04818A             0143*   ; end sprites_init
04818A             0144*   
04818A             0145*   ; gets the next available sprite id for a particular sprite group
04818A             0146*   ; inputs; ix = pointer to sprite group, b = number of records in sprite group
04818A             0147*   ; returns: if new sprite available, a = sprite id, ix pointing to new sprite vars, carry set
04818A             0148*   ;      otherwise, a = 0, carry flag reset, ix pointing to highest sprite vars
04818A             0149*   ; destroys: a,b,c,hl,ix
04818A             0150*   table_get_next_id:
04818A             0151*   @loop:
04818A DD CB 1D 76 0152*       bit sprite_alive,(ix+sprite_collisions)
04818E 28 07       0153*       jr z,@found
048190 ED 32 40    0154*       lea ix,ix+table_record_size
048193 10 F5       0155*       djnz @loop
048195             0156*   @notfound:
048195 AF          0157*       xor a ; a = 0 and reset carry flag indicating that we didn't find a free sprite
048196 C9          0158*       ret
048197             0159*   @found:
048197             0160*   ; return sprite id
048197 DD 7E 00    0161*       ld a,(ix+sprite_id)
04819A 37          0162*       scf ; sets carry flag indicating we found a free sprite
04819B C9          0163*       ret ; done
04819C             0164*   ; end table_get_next_id
04819C             0165*   
04819C             0166*   ; create a new sprite at the prescribed coordinates
04819C             0167*   ; inputs: hl = pointer to new sprite default settings, ub.c, ud.e = x,y position
04819C             0168*   ;         ix = pointer to sprite group, a = number of records in sprite group
04819C             0169*   ; returns: if new sprite available, a = sprite id, ix pointing to new sprite vars, carry set
04819C             0170*   ;      otherwise, a = 0, carry flag reset, ix pointing to highest sprite vars
04819C             0171*   spawn_sprite_from_coords:
04819C ED 43 D6 81 0172*       ld (@sprite_x),bc ; store x-coordinate
       04          
0481A1 ED 53 D9 81 0173*       ld (@sprite_y),de ; store y-coordinate
       04          
0481A6 47          0174*       ld b,a ; number of records in sprite group
0481A7 E5          0175*       push hl ; back up pointer to new sprite defaults
0481A8 CD 8A 81 04 0176*       call table_get_next_id ; if available: a = new sprite id, ix = pointer to new sprite vars
0481AC E1          0177*       pop hl ; restore pointer to new sprite defaults
0481AD D0          0178*       ret nc ; no carry means no free sprite slots, so we go home
0481AE             0179*   ; copy default settings to new sprite
0481AE DD E5       0180*       push ix ; back up pointer to new sprite record
0481B0 ED 32 16    0181*       lea ix,ix+sprite_definitions ; bump pointer to copy to
0481B3 DD E5       0182*       push ix ; pointer to default sprite settings
0481B5 D1          0183*       pop de ; address to copy to
0481B6 01 2A 00 00 0184*       ld bc,table_record_size-sprite_definitions ; number of bytes to copy
0481BA ED B0       0185*       ldir ; copies defaults to new sprite record
0481BC DD E1       0186*       pop ix ; restore pointer to new sprite record
0481BE             0187*   ; copy sprite position from existing sprite
0481BE 2A D6 81 04 0188*       ld hl,(@sprite_x)
0481C2 DD 2F 01    0189*       ld (ix+sprite_x),hl
0481C5 2A D9 81 04 0190*       ld hl,(@sprite_y)
0481C9 DD 2F 04    0191*       ld (ix+sprite_y),hl
0481CC             0192*   ; return to caller
0481CC DD CB 16 FE 0193*       set 7,(ix+sprite_type) ; set just spawned flag
0481D0 DD CB 1D F6 0194*       set sprite_alive,(ix+sprite_collisions) ; set sprite alive flag
0481D4 37          0195*       scf ; set carry flag to indicate success
0481D5 C9          0196*       ret
0481D6 00 00 00    0197*   @sprite_x: dl 0 ; new sprite x-coordinate
0481D9 00 00 00    0198*   @sprite_y: dl 0 ; new sprite y-coordinate
0481DC             0199*   ; end spawn_sprite_from_coords
0481DC             0200*   
0481DC             0201*   ; create a new sprite at the same location as an existing sprite
0481DC             0202*   ; inputs: hl = pointer to new sprite default settings, table_pointer = existing sprite
0481DC             0203*   ;         ix = pointer to sprite group, b = number of records in sprite group
0481DC             0204*   ; returns: if new sprite available, a = sprite id, ix pointing to new sprite vars, carry set
0481DC             0205*   ;      otherwise, a = 0, carry flag reset, ix pointing to highest sprite vars
0481DC             0206*   spawn_sprite_from_sprite:
0481DC E5          0207*       push hl ; back up pointer to new sprite defaults
0481DD CD 8A 81 04 0208*       call table_get_next_id ; if available: a = new sprite id, ix = pointer to new sprite vars
0481E1 E1          0209*       pop hl ; restore pointer to new sprite defaults
0481E2 D0          0210*       ret nc ; no carry means no free sprite slots, so we go home
0481E3             0211*   ; copy default settings to new sprite
0481E3 DD E5       0212*       push ix ; back up pointer to new sprite record
0481E5 ED 32 16    0213*       lea ix,ix+sprite_definitions ; bump pointer to copy to
0481E8 DD E5       0214*       push ix ; pointer to default sprite settings
0481EA D1          0215*       pop de ; address to copy to
0481EB 01 2A 00 00 0216*       ld bc,table_record_size-sprite_definitions ; number of bytes to copy
0481EF ED B0       0217*       ldir ; copies defaults to new sprite record
0481F1 DD E1       0218*       pop ix ; restore pointer to new sprite record
0481F3             0219*   ; copy sprite position from existing sprite
0481F3 FD 2A DF 80 0220*       ld iy,(table_pointer) ; get existing sprite record
       04          
0481F8 FD 27 01    0221*       ld hl,(iy+sprite_x)
0481FB DD 2F 01    0222*       ld (ix+sprite_x),hl
0481FE FD 27 04    0223*       ld hl,(iy+sprite_y)
048201 DD 2F 04    0224*       ld (ix+sprite_y),hl
048204             0225*   ; return to caller
048204 DD CB 16 FE 0226*       set 7,(ix+sprite_type) ; set just spawned flag
048208 DD CB 1D F6 0227*       set sprite_alive,(ix+sprite_collisions) ; set sprite alive flag
04820C 37          0228*       scf ; set carry flag to indicate success
04820D C9          0229*       ret
04820E             0230*   ; end spawn_sprite_from_sprite
04820E             0231*   
04820E             0232*   ; call the behavior subroutines for a specified sprite group
04820E             0233*   ; inputs: iy = pointer to sprite group, b = number of records in sprite group
04820E             0234*   move_sprite_group:
04820E C5          0235*       push bc ; backup loop counter
04820F FD E5       0236*       push iy ; backup table pointer
048211             0237*   @move_loop:
048211 FD 22 DF 80 0238*       ld (table_pointer),iy ; update table pointer
       04          
048216 C5          0239*       push bc ; backup loop counter
048217             0240*   ; check top bit of sprite_type to see if sprite is just spawned
048217 FD CB 16 7E 0241*       bit 7,(iy+sprite_type)
04821B C2 50 82 04 0242*       jp nz,@next_record ; if just spawned, skip to next record
04821F             0243*   ; check sprite_just_died bit
04821F FD CB 1D 7E 0244*       bit sprite_just_died,(iy+sprite_collisions)
048223 C2 87 82 04 0245*       jp nz,@sprite_died ; if just died, deactivate sprite
048227             0246*   ; check sprite_alive bit to see if sprite is active
048227 FD CB 1D 76 0247*       bit sprite_alive,(iy+sprite_collisions)
04822B CA 50 82 04 0248*       jp z,@next_record ; ... skip to next record
04822F             0249*   ; otherwise move the sprite
04822F FD 27 1A    0250*       ld hl,(iy+sprite_move_program) ; load the behavior subroutine address
048232             0251*       CALL_HL ; run the behavior subroutine
048232 01 38 82 04 0001*M1     ld bc,$+6 ; Address of first instruction after the jump
048236 C5          0002*M1     push bc ; which constitutes the return address
048237 E9          0003*M1     jp (hl) ; Jump to the address in HL
048238 FD 7E 00    0252*       ld a,(iy+sprite_id) ; get spriteId
04823B CD 00 1C 04 0253*       call vdu_sprite_select ; select sprite
04823F FD 7E 28    0254*       ld a,(iy+sprite_frame)
048242 CD 63 1C 04 0255*       call vdu_sprite_select_frame
048246 FD 07 01    0256*       ld bc,(iy+sprite_x)
048249 FD 17 04    0257*       ld de,(iy+sprite_y)
04824C CD CC 1C 04 0258*       call vdu_sprite_move_abs168
048250             0259*   ; fall through to @next_record
048250             0260*   @next_record:
048250 ED 33 40    0261*       lea iy,iy+table_record_size
048253 AF          0262*       xor a ; clears carry flag
048254 32 E2 80 04 0263*       ld (sprite_screen_edge),a ; clear screen edge collision flag
048258 C1          0264*       pop bc ; get back our loop counter
048259 10 B6       0265*       djnz @move_loop ; loop until we've checked all the records
04825B             0266*   ; reset all just spawned flags
04825B FD E1       0267*       pop iy ; get back table pointer
04825D C1          0268*       pop bc ; get back loop counter
04825E             0269*   @reset_just_spawned:
04825E C5          0270*       push bc ; back up loop counter
04825F FD CB 16 7E 0271*       bit 7,(iy+sprite_type) ; check if just spawned
048263 CA 80 82 04 0272*       jp z,@F
048267 FD CB 16 BE 0273*       res 7,(iy+sprite_type) ; clear just spawned flag
04826B FD 7E 00    0274*       ld a,(iy+sprite_id)
04826E CD 00 1C 04 0275*       call vdu_sprite_select
048272 FD 07 01    0276*       ld bc,(iy+sprite_x)
048275 FD 17 04    0277*       ld de,(iy+sprite_y)
048278 CD CC 1C 04 0278*       call vdu_sprite_move_abs168
04827C CD 76 1C 04 0279*       call vdu_sprite_show
048280             0280*   @@:
048280 ED 33 40    0281*       lea iy,iy+table_record_size
048283 C1          0282*       pop bc ; get back loop counter
048284 10 D8       0283*       djnz @reset_just_spawned
048286 C9          0284*       ret
048287             0285*   @sprite_died:
048287 CD 28 81 04 0286*       call table_deactivate_sprite
04828B C3 50 82 04 0287*       jp @next_record
04828F             0288*   ; end move_sprite_group
04828F             0289*   
04828F             0290*   ; compute a sprite's new position based on its component x,y velocities
04828F             0291*   ; with screen boundary checking and update its sprite table record accordingly
04828F             0292*   ; inputs: table_pointer set to sprite record
04828F             0293*   ; returns: updated x, y positions and edge collision flags in sprite_screen_edge
04828F             0294*   ; destroys: everything
04828F             0295*   ; note: actual rendering of sprite must be handled by caller
04828F             0296*   move_sprite:
04828F FD 2A DF 80 0297*       ld iy,(table_pointer)
       04          
048294             0298*   ; x-axis movement
048294 FD 27 01    0299*       ld hl,(iy+sprite_x)
048297 FD 17 07    0300*       ld de,(iy+sprite_xvel)
04829A 19          0301*       add hl,de
04829B FD 2F 01    0302*       ld (iy+sprite_x),hl
04829E             0303*   ; y-axis movement
04829E FD 27 04    0304*       ld hl,(iy+sprite_y)
0482A1 FD 17 0A    0305*       ld de,(iy+sprite_yvel)
0482A4 19          0306*       add hl,de
0482A5 FD 2F 04    0307*       ld (iy+sprite_y),hl
0482A8             0308*   ; detect screen edge collisions
0482A8 AF          0309*       xor a ; reset screen edge collision flag and clear carry
0482A9 32 E2 80 04 0310*       ld (sprite_screen_edge),a
0482AD             0311*   ; y-axis first since we already have it in hl
0482AD 11 00 00 00 0312*       ld de,-sprite_top*256
0482B1 ED 5A       0313*       adc hl,de
0482B3 FA DD 82 04 0314*       jp m,@top
0482B7 ED 52       0315*       sbc hl,de ; hl back to original value
0482B9 11 00 D0 FE 0316*       ld de,-sprite_bottom*256
0482BD ED 5A       0317*       adc hl,de
0482BF F2 E7 82 04 0318*       jp p,@bottom
0482C3             0319*   @xaxis:
0482C3 FD 27 01    0320*       ld hl,(iy+sprite_x)
0482C6 11 00 00 00 0321*       ld de,-sprite_left*256
0482CA ED 5A       0322*       adc hl,de
0482CC FA 02 83 04 0323*       jp m,@left
0482D0 ED 52       0324*       sbc hl,de ; hl back to original value
0482D2 11 00 10 FF 0325*       ld de,-sprite_right*256
0482D6 ED 5A       0326*       adc hl,de
0482D8 F2 10 83 04 0327*       jp p,@right
0482DC             0328*   ; no edge collisions so go home
0482DC C9          0329*       ret
0482DD             0330*   @top:
0482DD 3E 08       0331*       ld a,collide_top
0482DF 21 00 00 00 0332*       ld hl,sprite_top*256
0482E3 C3 ED 82 04 0333*       jp @collide_y
0482E7             0334*   @bottom:
0482E7 3E 04       0335*       ld a,collide_bottom
0482E9 21 00 30 01 0336*       ld hl,sprite_bottom*256
0482ED             0337*   @collide_y:
0482ED 32 E2 80 04 0338*       ld (sprite_screen_edge),a
0482F1 FD 2F 04    0339*       ld (iy+sprite_y),hl
0482F4             0340*   ; reverse y-axis velocity
0482F4 FD 27 0A    0341*       ld hl,(iy+sprite_yvel)
0482F7 CD 16 05 04 0342*       call neg_hlu
0482FB FD 2F 0A    0343*       ld (iy+sprite_yvel),hl
0482FE             0344*   ; go check for x-axis collisions
0482FE C3 C3 82 04 0345*       jp @xaxis
048302             0346*   @left:
048302 3A E2 80 04 0347*       ld a,(sprite_screen_edge)
048306 F6 02       0348*       or a,collide_left
048308 21 00 00 00 0349*       ld hl,sprite_left*256
04830C C3 1A 83 04 0350*       jp @collide_x
048310             0351*   @right:
048310 3A E2 80 04 0352*       ld a,(sprite_screen_edge)
048314 F6 01       0353*       or a,collide_right
048316 21 00 F0 00 0354*       ld hl,sprite_right*256
04831A             0355*   @collide_x:
04831A 32 E2 80 04 0356*       ld (sprite_screen_edge),a
04831E FD 2F 01    0357*       ld (iy+sprite_x),hl
048321             0358*   ; reverse x-axis velocity
048321 FD 27 07    0359*       ld hl,(iy+sprite_xvel)
048324 CD 16 05 04 0360*       call neg_hlu
048328 FD 2F 07    0361*       ld (iy+sprite_xvel),hl
04832B             0362*   ; final collision flag to a and return
04832B 3A E2 80 04 0363*       ld a,(sprite_screen_edge)
04832F C9          0364*       ret
048330             0365*   ; end move_sprite
048330             0366*   
048330             0367*   sprite_compute_velocities:
048330 FD 27 10    0368*       ld hl,(iy+sprite_heading)
048333 FD 17 0D    0369*       ld de,(iy+sprite_vel)
048336 CD A0 07 04 0370*       call polar_to_cartesian
04833A FD 2A DF 80 0371*       ld iy,(table_pointer)
       04          
04833F FD 0F 07    0372*       ld (iy+sprite_xvel),bc ; save x-velocity component
048342 FD 1F 0A    0373*       ld (iy+sprite_yvel),de ; save y-velocity component
048345 C9          0374*       ret
048346             0375*   ; end sprite_compute_velocities
048346             0376*   
048346             0377*   ; compute animation frame based on sprite_animation and sprite_heading
048346             0378*   ; inputs: table_pointer set to sprite record
048346             0379*   ; outputs: a, sprite_frame set to animation frame
048346             0380*   ; destroys: a,hl
048346             0381*   sprite_frame_heading_animation:
048346 FD 7E 11    0382*       ld a,(iy+sprite_heading+1) ; we want the integer portion
048349 CB 3F       0383*       srl a ; divide integer portion by 8
04834B CB 3F       0384*       srl a
04834D CB 3F       0385*       srl a
04834F FD 66 22    0386*       ld h,(iy+sprite_animation)
048352 2E 20       0387*       ld l,32 ; 32 orientation frames per animation
048354 ED 6C       0388*       mlt hl ; hl = offset from base animation
048356 85          0389*       add a,l ; modulo256 since sprite_frame is only 1 byte
048357 FD 77 28    0390*       ld (iy+sprite_frame),a
04835A C9          0391*       ret
04835B             0392*   ; end sprite_frame_heading_animation
04835B             0393*   
04835B             0394*   ; compute animation frame based on sprite_heading
04835B             0395*   ; inputs: table_pointer set to sprite record
04835B             0396*   ; outputs: a, sprite_frame set to animation frame
04835B             0397*   ; destroys: a,hl
04835B             0398*   sprite_frame_heading:
04835B FD 7E 11    0399*       ld a,(iy+sprite_heading+1) ; we want the integer portion
04835E CB 3F       0400*       srl a ; divide integer portion by 8
048360 CB 3F       0401*       srl a
048362 CB 3F       0402*       srl a
048364 FD 77 28    0403*       ld (iy+sprite_frame),a
048367 C9          0404*       ret
048368             0405*   ; end sprite_frame_heading
048368             0406*   
048368             0407*   ; load a sprite with animation bitmaps
048368             0408*   ; inputs: a = sprite id, hl = base bufferId, bc = number of frames, sprite_select
048368             0409*   sprite_load_frames:
048368             0410*   ; back up input parameters
048368 E5          0411*       push hl ; base bufferId
048369 C5          0412*       push bc ; bc = number of frames
04836A CD 13 1C 04 0413*       call vdu_sprite_clear_frames
04836E C1          0414*       pop bc ; bc = number of frames
04836F E1          0415*       pop hl ; = base bufferId
048370             0416*   @load_frames:
048370 C5          0417*       push bc ; back up loop counter
048371 E5          0418*       push hl ; back up base bufferId
048372 CD 55 1D 04 0419*       call vdu_sprite_add_buff
048376 E1          0420*       pop hl ; restore base bufferId
048377 23          0421*       inc hl ; bump it to the next frame
048378             0422*   ; decrement loop counter
048378 C1          0423*       pop bc
048379 0B          0424*       dec bc
04837A 79          0425*       ld a,c
04837B B7          0426*       or a
04837C C2 70 83 04 0427*       jp nz,@load_frames
048380 78          0428*       ld a,b
048381 B7          0429*       or a
048382 C2 70 83 04 0430*       jp nz,@load_frames
048386 C9          0431*       ret
048387             0432*   ; end sprite_load_frames
048387             0067        include "state.inc"
048387 FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF          
048400             0002*   
048400             0003*   ; Game state variables
048400 0E 84 04    0004*   game_state:  dl game_main_menu
048403             0005*   
048403             0006*   do_game:
048403 2A 00 84 04 0007*       ld hl,(game_state)   ; Load the current game state
048407             0008*       CALL_HL                ; Call the corresponding state handler
048407 01 0D 84 04 0001*M1     ld bc,$+6 ; Address of first instruction after the jump
04840B C5          0002*M1     push bc ; which constitutes the return address
04840C E9          0003*M1     jp (hl) ; Jump to the address in HL
04840D C9          0009*       ret
04840E             0010*   
04840E             0011*   ; ========================
04840E             0012*   ; Main Game States
04840E             0013*   ; ========================
04840E             0014*   
04840E             0015*   game_main_menu:
04840E             0016*       ; Handle main menu options
04840E             0017*       ; Example: Check input for "Start Game"
04840E CD A5 84 04 0018*       call check_input_menu
048412 C2 F7 84 04 0019*       jp nz, game_init ; Start game on selection
048416 C9          0020*       ret
048417             0021*   
048417             0022*   
048417             0023*   
048417             0024*   game_paused:
048417             0025*       ; Pause menu logic
048417 CD A8 84 04 0026*       call check_input_pause
04841B C2 55 86 04 0027*       jp nz, game_playing ; Resume game
04841F CA 0E 84 04 0028*       jp z, game_main_menu ; Exit to main menu
048423 C9          0029*       ret
048424             0030*   
048424             0031*   game_level_transition:
048424             0032*       ; Handle level transitions
048424 CD A9 84 04 0033*       call load_next_level
048428 21 55 86 04 0034*       ld hl, game_playing
04842C 22 00 84 04 0035*       ld (game_state), hl
048430 C9          0036*       ret
048431             0037*   
048431             0038*   game_over:
048431 CD 00 16 04 0039*       call vdu_home_cursor
048435 CD 00 01 04 0040*       call printInline
048439 47 61 6D 65 0041*       asciz "Game Over!\r\nPress any key to continue..."
       20 4F 76 65 
       72 21 0D 0A 
       50 72 65 73 
       73 20 61 6E 
       79 20 6B 65 
       79 20 74 6F 
       20 63 6F 6E 
       74 69 6E 75 
       65 2E 2E 2E 
       00          
048462 21 F7 84 04 0042*       ld hl,game_init
048466 22 00 84 04 0043*       ld (game_state),hl
04846A C9          0044*       ret
04846B             0045*   
04846B             0046*   game_victory:
04846B             0047*       ; Display victory screen
04846B CD AB 84 04 0048*       call display_victory
04846F C2 0E 84 04 0049*       jp nz, game_main_menu ; Return to main menu on input
048473 C9          0050*       ret
048474             0051*   
048474             0052*   ; ========================
048474             0053*   ; Supporting States
048474             0054*   ; ========================
048474             0055*   
048474             0056*   game_loading:
048474             0057*       ; Show loading screen while preparing assets
048474 CD AC 84 04 0058*       call load_resources
048478 21 F7 84 04 0059*       ld hl, game_init
04847C 22 00 84 04 0060*       ld (game_state), hl
048480 C9          0061*       ret
048481             0062*   
048481             0063*   game_cutscene:
048481             0064*       ; Play a non-interactive cutscene
048481 CD AD 84 04 0065*       call play_cutscene
048485 C2 55 86 04 0066*       jp nz, game_playing ; Return to gameplay after cutscene
048489 C9          0067*       ret
04848A             0068*   
04848A             0069*   game_inventory:
04848A             0070*       ; Open inventory or shop
04848A CD AE 84 04 0071*       call display_inventory
04848E C2 55 86 04 0072*       jp nz, game_playing ; Return to gameplay after inventory close
048492 C9          0073*       ret
048493             0074*   
048493             0075*   game_map:
048493             0076*       ; Display map or quest
048493 CD AF 84 04 0077*       call display_map
048497 C2 55 86 04 0078*       jp nz, game_playing ; Return to gameplay after map close
04849B C9          0079*       ret
04849C             0080*   
04849C             0081*   game_exit:
04849C             0082*       ; Handle exit logic
04849C CD B0 84 04 0083*       call save_game
0484A0 C3 B1 84 04 0084*       jp exit_game         ; Safely shut down
0484A4 C9          0085*       ret
0484A5             0086*   
0484A5             0087*   ; ========================
0484A5             0088*   ; Sub-state branching (Example for player state)
0484A5             0089*   ; ========================
0484A5             0090*   
0484A5             0091*   
0484A5             0092*   
0484A5             0093*   
0484A5             0094*   check_input_menu:
0484A5 C9          0095*       ret
0484A6             0096*   
0484A6             0097*   update_game_world:
0484A6 C9          0098*       ret
0484A7             0099*   
0484A7             0100*   check_game_events:
0484A7 C9          0101*       ret
0484A8             0102*   
0484A8             0103*   check_input_pause:
0484A8 C9          0104*       ret
0484A9             0105*   
0484A9             0106*   load_next_level:
0484A9 C9          0107*       ret
0484AA             0108*   
0484AA             0109*   display_game_over:
0484AA C9          0110*       ret
0484AB             0111*   
0484AB             0112*   display_victory:
0484AB C9          0113*       ret
0484AC             0114*   
0484AC             0115*   load_resources:
0484AC C9          0116*       ret
0484AD             0117*   
0484AD             0118*   play_cutscene:
0484AD C9          0119*       ret
0484AE             0120*   
0484AE             0121*   display_inventory:
0484AE C9          0122*       ret
0484AF             0123*   
0484AF             0124*   display_map:
0484AF C9          0125*       ret
0484B0             0126*   
0484B0             0127*   save_game:
0484B0 C9          0128*       ret
0484B1             0129*   
0484B1             0130*   exit_game:
0484B1 C9          0131*       ret
0484B2             0132*   
0484B2             0068        include "state_game_init.inc"
0484B2 57 65 6C 63 0001*   hello_world: asciz "Welcome to Purple Nurples!"
       6F 6D 65 20 
       74 6F 20 50 
       75 72 70 6C 
       65 20 4E 75 
       72 70 6C 65 
       73 21 00    
0484CD 4C 6F 61 64 0002*   loading_time: asciz "Loading time:"
       69 6E 67 20 
       74 69 6D 65 
       3A 00       
0484DB 50 72 65 73 0003*   loading_complete: asciz "Press any key to continue."
       73 20 61 6E 
       79 20 6B 65 
       79 20 74 6F 
       20 63 6F 6E 
       74 69 6E 75 
       65 2E 00    
0484F6 00          0004*   game_assets_loaded: db 0 ; non-zero when assets are loaded
0484F7             0005*   
0484F7             0006*   game_init:
0484F7             0007*   ; check whether assets are loaded
0484F7 3A F6 84 04 0008*       ld a,(game_assets_loaded)
0484FB B7          0009*       or a
0484FC C2 82 85 04 0010*       jp nz,@assets_loaded
048500             0011*   ; clear all buffers
048500 CD 2A 18 04 0012*       call vdu_clear_all_buffers
048504             0013*   ; load fonts
048504 CD 00 11 04 0014*   	call fonts_load
048508             0015*   ; select font
048508 21 02 FA 00 0016*       ld hl,computer_pixel_7_8x16
04850C 3E 01       0017*       ld a,1 ; flags
04850E CD 00 1A 04 0018*       call vdu_font_select
048512             0019*   ; print loading ui message
048512 CD 4B 16 04 0020*       call vdu_cls
048516 21 6A 1D 04 0021*       ld hl,loading_ui
04851A CD 07 01 04 0022*       call printString
04851E CD 50 16 04 0023*       call vdu_flip
048522             0024*   ; load UI images
048522 CD CA 12 04 0025*       call load_ui_images
048526             0026*   ; set up the display
048526 3E 08       0027*       ld a,8;+128 ; 136   320   240   64    60hz double-buffered
048528             0028*       ; ld a,20 ;  512   384   64    60hz single-buffered
048528 CD 14 17 04 0029*       call vdu_set_screen_mode
04852C AF          0030*       xor a
04852D CD 25 17 04 0031*       call vdu_set_scaling
048531             0032*   ; ; enable additional audio channels
048531             0033*   ; 	call vdu_enable_channels
048531             0034*   ; set text background color
048531 3E 9A       0035*       ld a,26+128 ; violet
048533 CD 7C 16 04 0036*       call vdu_colour_text
048537             0037*   ; set text foreground color
048537 3E 2F       0038*       ld a,47 ; aaaaff lavenderish
048539 CD 7C 16 04 0039*       call vdu_colour_text
04853D             0040*   ; set gfx bg color
04853D AF          0041*       xor a ; plotting mode 0
04853E 3E 9A       0042*       ld a,26+128 ; violet
048540 CD 8D 16 04 0043*       call vdu_gcol
048544 CD 4B 16 04 0044*       call vdu_cls
048548             0045*   ; set the cursor off
048548 CD 13 16 04 0046*       call vdu_cursor_off
04854C             0047*   ; VDU 28, left, bottom, right, top: Set text viewport **
04854C             0048*   ; MIND THE LITTLE-ENDIANESS
04854C             0049*   ; inputs: c=left,b=bottom,e=right,d=top
04854C 0E 00       0050*       ld c,0 ; left
04854E 16 00       0051*       ld d,0 ; top
048550 1E 27       0052*       ld e,39 ; right
048552 06 00       0053*       ld b,0; bottom
048554 CD A4 16 04 0054*       call vdu_set_txt_viewport
048558             0055*   ; load background and sprite images
048558 CD 09 12 04 0056*       call img_load_init
04855C CD FF 12 04 0057*       call load_backgrounds
048560 CD DD 12 04 0058*       call load_sprite_images
048564             0059*   ; load tileset_ptrs
048564 CD EE 12 04 0060*       call load_tilesets
048568             0061*   ; ; load sound effects ; TODO
048568             0062*   ; 	ld bc,SFX_num_buffers
048568             0063*   ; 	ld hl,SFX_buffer_id_lut
048568             0064*   ; 	ld (cur_buffer_id_lut),hl
048568             0065*   ; 	ld hl,SFX_load_routines_table
048568             0066*   ; 	ld (cur_load_jump_table),hl
048568             0067*   ; 	call sfx_load_main
048568             0068*   ; print loading complete message and wait for user keypress
048568 3E 01       0069*       ld a,1
04856A 32 F6 84 04 0070*       ld (game_assets_loaded),a
04856E CD 4B 16 04 0071*       call vdu_cls
048572 21 DB 84 04 0072*       ld hl,loading_complete
048576 CD 07 01 04 0073*       call printString
04857A CD 50 16 04 0074*       call vdu_flip
04857E CD E1 03 04 0075*       call waitKeypress
048582             0076*   @assets_loaded:
048582             0077*   ; set up display for gameplay
048582 3E 14       0078*       ld a,20
048584 CD 14 17 04 0079*       call vdu_set_screen_mode
048588 AF          0080*       xor a
048589 CD 25 17 04 0081*       call vdu_set_scaling
04858D CD 13 16 04 0082*       call vdu_cursor_off
048591             0083*   ; select font
048591 21 03 FA 00 0084*       ld hl,Lat2_VGA8_8x8
048595 3E 01       0085*       ld a,1 ; flags
048597 CD 00 1A 04 0086*       call vdu_font_select
04859B             0087*   ; plot bezel art
04859B 21 06 00 00 0088*       ld hl,BUF_BEZEL_L
04859F CD 38 17 04 0089*       call vdu_buff_select
0485A3 01 00 00 00 0090*       ld bc,0
0485A7 11 00 00 00 0091*       ld de,0
0485AB CD 20 1B 04 0092*       call vdu_plot_bmp
0485AF 21 07 00 00 0093*       ld hl,BUF_BEZEL_R
0485B3 CD 38 17 04 0094*       call vdu_buff_select
0485B7 01 80 01 00 0095*       ld bc,384
0485BB 11 00 00 00 0096*       ld de,0
0485BF CD 20 1B 04 0097*       call vdu_plot_bmp
0485C3             0098*   ; draw player cockpit
0485C3 CD EF 7A 04 0099*       call draw_player_cockpit
0485C7             0100*   ; set gfx origin and viewport to playing field window
0485C7 01 80 00 00 0101*       ld bc,origin_left
0485CB 11 40 00 00 0102*       ld de,origin_top
0485CF CD D0 16 04 0103*       call vdu_set_gfx_origin
0485D3 01 00 00 00 0104*       ld bc,field_left
0485D7 11 00 00 00 0105*       ld de,field_top
0485DB DD 21 FF 00 0106*       ld ix,field_right
       00          
0485E0 FD 21 3F 01 0107*       ld iy,field_bottom
       00          
0485E5 CD EB 16 04 0108*       call vdu_set_gfx_viewport
0485E9             0109*   ; set background color
0485E9 3E 9A       0110*       ld a,26+128 ; violet
0485EB CD 8D 16 04 0111*       call vdu_gcol
0485EF CD 5E 16 04 0112*       call vdu_clg
0485F3             0113*   ; VDU 28, left, bottom, right, top: Set text viewport **
0485F3 0E 00       0114*       ld c,0 ; left
0485F5 16 00       0115*       ld d,0 ; top
0485F7 1E 3E       0116*       ld e,62 ; right
0485F9 06 30       0117*       ld b,48; bottom
0485FB CD A4 16 04 0118*       call vdu_set_txt_viewport
0485FF             0119*   ; initialize the global timestamp
0485FF CD F9 14 04 0120*       call timestamp_tick
048603             0121*   ; reset the sprite table
048603 CD 04 81 04 0122*       call table_init
048607 21 2A A0 04 0123*       ld hl,table_base
04860B 22 DF 80 04 0124*       ld (table_pointer),hl
04860F             0125*   ; initialize sprites and active tiles table
04860F CD 3C 81 04 0126*       call sprites_init
048613 CD 04 81 04 0127*       call table_init
048617 CD 10 8B 04 0128*       call tile_table_init
04861B             0129*   ; initialize the first level
04861B 3E 00       0130*       ld a,tiles_dg
04861D CD 1A 68 04 0131*       call init_tileset
048621             0132*   ; initialize player
048621 21 00 00 00 0133*       ld hl,0
048625 22 4D 80 04 0134*       ld (player_score),hl
048629 2B          0135*       dec hl ; anything but zero so print_score will update
04862A 22 50 80 04 0136*       ld (player_score_last),hl
04862E 3E 03       0137*       ld a,3
048630 32 37 79 04 0138*       ld (player_ships),a
048634 CD 92 79 04 0139*       call player_init
048638 CD 38 79 04 0140*       call draw_player_ships
04863C             0141*   ; set the game state to playing
04863C 21 55 86 04 0142*       ld hl,game_playing
048640 22 00 84 04 0143*       ld (game_state), hl
048644             0144*   ; set game playing substates
048644 21 16 7A 04 0145*       ld hl,player_alive
048648 22 34 79 04 0146*       ld (player_state), hl
04864C 21 8A 23 04 0147*       ld hl,enemies_alive
048650 22 7C 23 04 0148*       ld (enemies_state), hl
048654             0149*   ; done initializing
048654 C9          0150*       ret
048655             0151*   ; end game_init
048655             0069        include "state_game_playing.inc"
048655             0001*   ; main game state
048655             0002*   game_playing:
048655             0003*   ; Main gameplay loop
048655             0004*   
048655             0005*   ; plot tiles
048655 CD 12 8D 04 0006*       call tiles_plot
048659             0007*   
048659             0008*   ; set gfx viewport to playing field window
048659 01 00 00 00 0009*       ld bc,field_left
04865D 11 00 00 00 0010*       ld de,field_top
048661 DD 21 FF 00 0011*       ld ix,field_right
       00          
048666 FD 21 3F 01 0012*       ld iy,field_bottom
       00          
04866B CD EB 16 04 0013*       call vdu_set_gfx_viewport
04866F             0014*   
04866F             0015*   ; process movement and collisions
04866F CD 87 79 04 0016*       call do_player
048673 CD 7F 23 04 0017*       call do_enemies
048677 CD 7A 26 04 0018*       call move_explosions
04867B CD 94 8E 04 0019*       call move_tiles
04867F             0020*   
04867F             0021*   ; update UI
04867F 01 00 00 00 0022*       ld bc,0
048683 11 00 00 00 0023*       ld de,0
048687 CD D0 16 04 0024*       call vdu_set_gfx_origin
04868B CD 67 80 04 0025*       call print_score
04868F CD C7 80 04 0026*       call draw_shields
048693 CD 31 80 04 0027*       call draw_laser
048697 CD 01 7D 04 0028*       call draw_fuel
04869B C9          0029*       ret
04869C             0030*   
04869C             0070        include "targeting.inc"
04869C FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
048700             0002*   
048700             0003*   ; compute orientation to player
048700             0004*   ; based on relative positions
048700             0005*   ; returns: uh.l 16.8 fixed angle256 to player
048700             0006*   ;    ub.c and ud.e as 16.8 signed fixed point numbers
048700             0007*   ;    representing delta-x/y *to* target respectively
048700             0008*   ; inputs: iy pointed at sprite record
048700             0009*   ; destroys: everything except iy (sprite record pointer)
048700             0010*   orientation_to_player:
048700 DD 21 2A A1 0011*       ld ix,player_begin
       04          
048705             0012*   ; compute dx
048705 DD 27 01    0013*       ld hl,(ix+sprite_x)
048708 FD 17 01    0014*       ld de,(iy+sprite_x)
04870B B7          0015*       or a ; clear carry
04870C ED 52       0016*       sbc hl,de ; dx
04870E E5          0017*       push hl ; save dx
04870F             0018*   ; compute dy
04870F DD 27 04    0019*       ld hl,(ix+sprite_y)
048712 FD 17 04    0020*       ld de,(iy+sprite_y)
048715 B7          0021*       or a ; clear carry
048716 ED 52       0022*       sbc hl,de ; dy
048718 EB          0023*       ex de,hl ; de = dy
048719             0024*   ; compute angle to player
048719 C1          0025*       pop bc ; dx (was hl)
04871A C5          0026*       push bc ; save dx
04871B D5          0027*       push de ; save dy
04871C CD 9A 08 04 0028*       call atan2_168fast ; uh.l = angle to player
048720 3E E0       0029*       ld a,%11100000
048722 A5          0030*       and l ; round angle to nearest 32th of a circle
048723 6F          0031*       ld l,a
048724 22 52 87 04 0032*       ld (Bearing_t),hl ; return angle to player
048728 D1          0033*       pop de ; restore dy
048729 C1          0034*       pop bc ; restore dx
04872A C9          0035*       ret
04872B             0036*   ; end orientation_to_player
04872B             0037*   
04872B             0038*   ; compute orientation to player
04872B             0039*   ; based on relative positions
04872B             0040*   ; returns: uh.l 16.8 fixed angle256 to player
04872B             0041*   ;    ub.c and ud.e as 16.8 signed fixed point numbers
04872B             0042*   ;    representing delta-x/y *to* target respectively
04872B             0043*   ; inputs: iy pointed at tile record
04872B             0044*   ; destroys: everything except iy (tile record pointer)
04872B             0045*   tile_orientation_to_player:
04872B DD 21 2A A1 0046*       ld ix,player_begin
       04          
048730             0047*   ; compute dx
048730 DD 27 01    0048*       ld hl,(ix+sprite_x)
048733 FD 17 01    0049*       ld de,(iy+tile_x)
048736 B7          0050*       or a ; clear carry
048737 ED 52       0051*       sbc hl,de ; dx
048739 E5          0052*       push hl ; save dx
04873A             0053*   ; compute dy
04873A DD 27 04    0054*       ld hl,(ix+sprite_y)
04873D FD 17 04    0055*       ld de,(iy+tile_y)
048740 B7          0056*       or a ; clear carry
048741 ED 52       0057*       sbc hl,de ; dy
048743 EB          0058*       ex de,hl ; de = dy
048744             0059*   ; compute angle to player
048744 C1          0060*       pop bc ; dx (was hl)
048745 CD 9A 08 04 0061*       call atan2_168fast ; uh.l = angle to player
048749 3E E0       0062*       ld a,%11100000
04874B A5          0063*       and l ; round angle to nearest 32th of a circle
04874C 6F          0064*       ld l,a
04874D 22 52 87 04 0065*       ld (Bearing_t),hl
048751 C9          0066*       ret
048752             0067*   ; end tile_orientation_to_player
048752             0068*   
048752             0069*   ; targeting_computer variables fixed 16.8 format
048752 00 00 00    0070*   Bearing_t: dl 0x000000 ; angle to target
048755 00 00 00    0071*   Heading_t: dl 0x000000 ; angle of target motion
048758 00 00 00    0072*   Vp: dl 0x000000 ; velocity of projectile
04875B 00 00 00    0073*   Vp_x: dl 0x000000 ; x component of projectile velocity
04875E 00 00 00    0074*   Vp_y: dl 0x000000 ; y component of projectile velocity
048761 00 00 00    0075*   Vt: dl 0x000000 ; velocity of target
048764 00 00 00    0076*   Vt_x: dl 0x000000 ; x component of target velocity
048767 00 00 00    0077*   Vt_y: dl 0x000000 ; y component of target velocity
04876A 00 00 00    0078*   Heading_p: dl 0x000000 ; angle of projectile motion
04876D 00 00 00    0079*   lead_angle: dl 0x000000 ; lead angle
048770             0080*   
048770             0081*   ; Inputs:   Vp velocity of projectile set,
048770             0082*   ;           iy pointed to sprite record,
048770             0083*   ;           player position and velocities correctly set
048770             0084*   ; Outputs:  uh.l is the 16.8 fixed firing angle256
048770             0085*   ;           ub.c and ud.e are the 16.8 fixed x,y component projectile velocities
048770             0086*   ; https://old.robowiki.net/cgi-bin/robowiki?LinearTargeting
048770             0087*   targeting_computer:
048770 DD 21 2A A1 0088*       ld ix,player_begin
       04          
048775             0089*   ; ; compute target velocity from x,y component velocities
048775             0090*   ;     ld bc,(ix+sprite_xvel)
048775             0091*   ;     ld de,(ix+sprite_yvel)
048775             0092*   ;     ld hl,-1*256 ; account for vertical ground movement
048775             0093*   ;     add hl,de
048775             0094*   ;     ex de,hl ; ud.e = player_yvel-1
048775             0095*   ;     call cartesian_to_polar_sm ; uh.l = Heading_t, ud.e = Vt
048775             0096*   ;     ld (Heading_t),hl ; PASSES
048775             0097*   ;     ld (Vt),de ; PASSES
048775             0098*   ; ; Bearing_t should have been set by prerequisite call to orientation_to_player
048775             0099*   ; ; compute Heading_t-Bearing_t PASSES
048775             0100*   ;     ld de,(Bearing_t)
048775             0101*   ;     and a ; clear carry
048775             0102*   ;     sbc hl,de ; Uh.l = Heading_t-Bearing_t
048775             0103*   ; ; compute sin(Heading_t-Bearing_t)
048775             0104*   ;     call sin168 ; uh.l = sin(Heading_t-Bearing_t)
048775             0105*   ; ; compute (Vt*sin(Heading_t-Bearing_t))
048775             0106*   ;     ld de,(Vt)
048775             0107*   ;     call smul168 ; uh.l = (Vt*sin(Heading_t-Bearing_t))
048775             0108*   ; ; compute (Vt * sin(Heading_t-Bearing_t)) / Vp
048775             0109*   ;     ld de,(Vp)
048775             0110*   ;     call sdiv168 ; ud.e = (Vt*sin(Heading_t-Bearing_t)) / Vp
048775             0111*   ;     ex de,hl ; uh.l = (Vt*sin(Heading_t-Bearing_t)) / Vp
048775             0112*   ; ; answer is in radians, convert to degrees256
048775             0113*   ;     ld de,0x0028BE ; 40.74 = 57.29578*256/360
048775             0114*   ;     call smul168 ; uh.l = angle in degrees256
048775             0115*   ;     ld (lead_angle),hl ; TODO: fix this
048775             0116*   ; ; add lead angle to target bearing
048775             0117*   ;     ld de,(Bearing_t)
048775             0118*   ;     add hl,de ; h.l = lead angle+target bearing
048775             0119*   
048775 2A 52 87 04 0120*       ld hl,(Bearing_t) ; TODO: fix this
048779             0121*   
048779 E5          0122*       push hl
04877A             0123*   
04877A             0124*   ; compute component projectile velocities
04877A ED 5B 58 87 0125*       ld de,(Vp) ; Vp should have been set by caller
       04          
04877F CD A0 07 04 0126*       call polar_to_cartesian ; ub.c = Vp_x, ud.e = Vp_y
048783 ED 43 5B 87 0127*       ld (Vp_x),bc
       04          
048788             0128*       ; inc d ; account for vertical ground movement
048788 ED 53 5E 87 0129*       ld (Vp_y),de
       04          
04878D E1          0130*       pop hl ; uh.l = lead angle+target bearing
04878E 22 6A 87 04 0131*       ld (Heading_p),hl
048792             0132*   
048792 C9          0133*       ret
048793             0134*   
048793             0135*   ; debug print the results
048793             0136*       PUSH_ALL
048793 08          0001*M1     ex af,af'
048794 D9          0002*M1     exx
048795 F5          0003*M1     push af
048796 E5          0004*M1     push hl
048797 C5          0005*M1     push bc
048798 D5          0006*M1     push de
048799             0007*M1 
048799 08          0008*M1     ex af,af'
04879A D9          0009*M1     exx
04879B F5          0010*M1     push af
04879C E5          0011*M1     push hl
04879D C5          0012*M1     push bc
04879E D5          0013*M1     push de
04879F DD E5       0014*M1     push ix
0487A1 FD E5       0015*M1     push iy
0487A3 CD 00 16 04 0137*       call vdu_home_cursor
0487A7 CD 1C 01 04 0138*       call printNewLine
0487AB CD 00 01 04 0139*       call printInline
0487AF 42 74 20 00 0140*       asciz "Bt "
0487B3 2A 52 87 04 0141*       ld hl,(Bearing_t)
0487B7 CD 78 02 04 0142*       call print_s168_hl
0487BB             0143*   
0487BB             0144*       ; call printInline
0487BB             0145*       ; asciz "\r\nHt "
0487BB             0146*       ; ld hl,(Heading_t)
0487BB             0147*       ; call print_s168_hl
0487BB             0148*   
0487BB             0149*       ; call printInline
0487BB             0150*       ; asciz "\r\nVt "
0487BB             0151*       ; ld hl,(Vt)
0487BB             0152*       ; call print_s168_hl
0487BB             0153*   
0487BB             0154*       ; call printInline
0487BB             0155*       ; asciz "\r\nVtx"
0487BB             0156*       ; ld hl,(ix+sprite_xvel)
0487BB             0157*       ; call print_s168_hl
0487BB             0158*   
0487BB             0159*       ; call printInline
0487BB             0160*       ; asciz "\r\nVty"
0487BB             0161*       ; ld hl,(ix+sprite_yvel)
0487BB             0162*       ; ld de,-1*256 ; account for vertical ground movement
0487BB             0163*       ; add hl,de
0487BB             0164*       ; call print_s168_hl
0487BB             0165*   
0487BB CD 00 01 04 0166*       call printInline
0487BF 0D 0A 4C 64 0167*       asciz "\r\nLda"
       61 00       
0487C5 2A 6D 87 04 0168*       ld hl,(lead_angle)
0487C9 CD 78 02 04 0169*       call print_s168_hl
0487CD             0170*   
0487CD CD 00 01 04 0171*       call printInline
0487D1 0D 0A 48 70 0172*       asciz "\r\nHp "
       20 00       
0487D7 2A 6A 87 04 0173*       ld hl,(Heading_p)
0487DB CD 78 02 04 0174*       call print_s168_hl
0487DF             0175*   
0487DF             0176*       ; call printInline
0487DF             0177*       ; asciz "\r\nVp "
0487DF             0178*       ; ld hl,(Vp)
0487DF             0179*       ; call print_s168_hl
0487DF             0180*   
0487DF             0181*       ; call printInline
0487DF             0182*       ; asciz "\r\nVpx"
0487DF             0183*       ; ld hl,(Vp_x)
0487DF             0184*       ; call print_s168_hl
0487DF             0185*   
0487DF             0186*       ; call printInline
0487DF             0187*       ; asciz "\r\nVpy"
0487DF             0188*       ; ld hl,(Vp_y)
0487DF             0189*       ; call print_s168_hl
0487DF             0190*   
0487DF             0191*       POP_ALL
0487DF FD E1       0001*M1     pop iy
0487E1 DD E1       0002*M1     pop ix
0487E3 D1          0003*M1     pop de
0487E4 C1          0004*M1     pop bc
0487E5 E1          0005*M1     pop hl
0487E6 F1          0006*M1     pop af
0487E7 08          0007*M1     ex af,af'
0487E8 D9          0008*M1     exx
0487E9             0009*M1 
0487E9 D1          0010*M1     pop de
0487EA C1          0011*M1     pop bc
0487EB E1          0012*M1     pop hl
0487EC F1          0013*M1     pop af
0487ED 08          0014*M1     ex af,af'
0487EE D9          0015*M1     exx
0487EF C9          0192*       ret
0487F0             0071        include "tile_table.inc"
0487F0             0001*   ; ###### tile TABLE FIELD INDICES ######
0487F0             0002*   tile_table_record_size:         equ  64; 41 bytes ;41 bytes per tile record
0487F0             0003*   tile_id:                 equ   0; 1 bytes ;unique tileId, zero-based
0487F0             0004*   ; tile state variables
0487F0             0005*   tile_state_variables:    equ   1; beginning of tile state variables
0487F0             0006*   tile_x:                  equ   1; 3 bytes ;16.8 fractional x position in pixels
0487F0             0007*   tile_y:                  equ   4; 3 bytes ;16.8 fractional y position in pixels
0487F0             0008*   tile_xvel:               equ   7; 3 bytes ;x-component velocity, 16.8 fixed, pixels
0487F0             0009*   tile_yvel:               equ  10; 3 bytes ;y-component velocity, 16.8 fixed, pixels
0487F0             0010*   tile_vel:                equ  13; 3 bytes ;velocity px/frame (16.8 fixed)
0487F0             0011*   tile_heading:            equ  16; 3 bytes ;tile movement direction deg256 16.8 fixed
0487F0             0012*   tile_orientation:        equ  19; 3 bytes ;orientation bits
0487F0             0013*   ; tile definition variables
0487F0             0014*   tile_definitions:        equ  22; beginnning of tile definition variables
0487F0             0015*   tile_type:               equ  22; 1 bytes ;type of tile as defined in enemies.inc
0487F0             0016*   tile_base_bufferId:      equ  23; 3 bytes ;bitmap bufferId
0487F0             0017*   tile_move_program:       equ  26; 3 bytes ;address of tile's behavior subroutine
0487F0             0018*   tile_collisions:         equ  29; 1 bytes ;see collisions.inc constants for bit definitions
0487F0             0019*   tile_dim_x:              equ  30; 1 bytes ;tile width in pixels
0487F0             0020*   tile_dim_y:              equ  31; 1 bytes ;tile height in pixels
0487F0             0021*   tile_num_orientations:   equ  32; 1 bytes ;number of orientations for this tile
0487F0             0022*   tile_num_animations:     equ  33; 1 bytes ;number of animations for this tile
0487F0             0023*   tile_animation:          equ  34; 1 bytes ;current animation index, zero-based
0487F0             0024*   tile_animation_timer:    equ  35; 1 bytes ;when hits zero, draw next animation
0487F0             0025*   tile_move_timer:         equ  36; 1 bytes ;when zero, go to next move program, or step
0487F0             0026*   tile_move_step:          equ  37; 1 bytes ;stage in a move program sequence, varies
0487F0             0027*   tile_points:             equ  38; 1 bytes ;points awarded for killing this tile type
0487F0             0028*   tile_shield_damage:      equ  39; 1 bytes ;shield points deducted for collision
0487F0             0029*   tile_frame:              equ  40; 1 bytes ;current animation frame
0487F0             0030*   
0487F0             0031*   ; ###### tile TABLE VARIABLES ######
0487F0 FF FF FF FF 0032*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
048800 00 00 00 00 0033*   tile_stack: blkb 256*3,0 ; stack of pointers to tile records
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
       00 00 00 00 
048B00 00 00 00    0034*       dl 0 ; list terminator
048B03             0035*   tile_stack_end:
048B03 00 88 04    0036*   tile_stack_pointer: dl tile_stack ; pointer to current stack record, initialized to tile_stack
048B06 2A A5 04    0037*   tile_table_pointer: dl tile_table_base ; pointer to top address of current record, initialized to tile_table_base
048B09 00 00 00    0038*   num_active_tiles: dl 0 ; how many active tiles
048B0C 00          0039*   next_tile_id: db 0 ; next available tile id
048B0D 00 00 00    0040*   new_tile_table_pointer: dl 0 ; pointer to new tile record
048B10             0041*   
048B10             0042*   tile_table_init:
048B10             0043*   ; reset num active tiles
048B10 21 00 00 00 0044*       ld hl,0
048B14 22 09 8B 04 0045*       ld (num_active_tiles),hl
048B18             0046*   ; reset next tile id
048B18 AF          0047*       xor a
048B19 32 0C 8B 04 0048*       ld (next_tile_id),a
048B1D             0049*   ; clear the tile stack
048B1D AF          0050*       xor a ; write zeroes to tile stack
048B1E 21 00 88 04 0051*       ld hl,tile_stack
048B22 01 03 03 00 0052*       ld bc,tile_stack_end-tile_stack
048B26 CD E6 03 04 0053*       call clear_mem
048B2A             0054*   ; clear the tile table
048B2A AF          0055*       xor a ; write zeroes to tile table
048B2B 21 2A A5 04 0056*       ld hl,tile_table_base ; address to copy from
048B2F 01 00 40 00 0057*       ld bc,tile_table_end-tile_table_base ; number of bytes to clear
048B33 CD E6 03 04 0058*       call clear_mem
048B37             0059*   ; write tile ids
048B37 DD 21 2A A5 0060*       ld ix,tile_table_base
       04          
048B3C AF          0061*       xor a ; tile id
048B3D 06 00       0062*       ld b,0 ; loop counter
048B3F             0063*   @loop:
048B3F DD 77 00    0064*       ld (ix+tile_id),a
048B42 ED 32 40    0065*       lea ix,ix+table_record_size
048B45 3C          0066*       inc a
048B46 10 F7       0067*       djnz @loop
048B48             0068*   ; set pointers to top of tile stack and tile table
048B48 21 0C 8B 04 0069*       ld hl,next_tile_id
048B4C 3E FF       0070*       ld a,255 ; will wrap around to 0 on first call to create active tile
048B4E 77          0071*       ld (hl),a
048B4F 21 2A A5 04 0072*       ld hl,tile_table_base
048B53 22 06 8B 04 0073*       ld (tile_table_pointer),hl
048B57 21 00 88 04 0074*       ld hl,tile_stack
048B5B 22 03 8B 04 0075*       ld (tile_stack_pointer),hl
048B5F C9          0076*       ret
048B60             0077*   ; end tile_table_init
048B60             0078*   
048B60             0079*   ; gets the next available tile id
048B60             0080*   ; inputs; none
048B60             0081*   ; returns: if new tile available, a = tile id, ix pointing to new tile vars, carry set
048B60             0082*   ;      otherwise, a = 0, carry flag reset, ix pointing to highest tile vars
048B60             0083*   ; destroys: a,hl,ix
048B60             0084*   ; affects: on success, bumps num_active_tiles by one, adds a tile pointer to the top of the tile stack
048B60             0085*   tile_table_get_next_id:
048B60 21 09 8B 04 0086*       ld hl,num_active_tiles
048B64 34          0087*       inc (hl)
048B65 C2 6C 8B 04 0088*       jp nz,@F ; check rollover to > 256 active tiles
048B69 35          0089*       dec (hl) ; undo increment
048B6A AF          0090*       xor a ; reset carry flag indicating that we didn't find a free tile
048B6B C9          0091*       ret
048B6C             0092*   @@:
048B6C 7E          0093*       ld a,(hl) ; number of active tiles
048B6D             0094*   ; point ix to next tile record
048B6D 21 0C 8B 04 0095*       ld hl,next_tile_id
048B71 34          0096*       inc (hl)
048B72 56          0097*       ld d,(hl) ; index into tile table
048B73 1E 40       0098*       ld e,tile_table_record_size
048B75 ED 5C       0099*       mlt de ; de is now the offset to the table entry
048B77 DD 21 2A A5 0100*       ld ix,tile_table_base ; point to base address of tile table
       04          
048B7C DD 19       0101*       add ix,de ; ix is now the address of the table entry
048B7E             0102*   ; add tile pointer to tile stack
048B7E 21 00 88 04 0103*       ld hl,tile_stack
048B82 57          0104*       ld d,a ; number of active tiles
048B83 15          0105*       dec d ; zero-based index
048B84 1E 03       0106*       ld e,3 ; three bytes per tile record
048B86 ED 5C       0107*       mlt de ; offset into tile stack
048B88 19          0108*       add hl,de ; hl points to top of the active tiles
048B89 ED 3F       0109*       ld (hl),ix
048B8B             0110*   ; return tile id
048B8B DD 7E 00    0111*       ld a,(ix+tile_id)
048B8E 37          0112*       scf ; sets carry flag indicating we found a free tile
048B8F C9          0113*       ret ; done
048B90             0114*   ; end tile_table_get_next_id
048B90             0115*   
048B90             0116*   ; deactivate the tile with the given id
048B90             0117*   ; inputs: tile_stack_pointer set to record to remove
048B90             0118*   ; outputs: decrements num_active_tiles by one, tile_stack_pointer set to record above removed record, removes tile pointer from the tile stack, shifts stack records above it down one position
048B90             0119*   ; destroys: a,hl,bc,de
048B90             0120*   table_deactivate_tile:
048B90             0121*   ; compute address to copy from
048B90 2A 03 8B 04 0122*       ld hl,(tile_stack_pointer)
048B94 23          0123*       inc hl
048B95 23          0124*       inc hl
048B96 23          0125*       inc hl
048B97 E5          0126*       push hl ; save copy from address
048B98             0127*   ; compute bytes to copy
048B98 3A 09 8B 04 0128*       ld a,(num_active_tiles)
048B9C 6F          0129*       ld l,a
048B9D 26 03       0130*       ld h,3
048B9F ED 6C       0131*       mlt hl
048BA1 11 00 88 04 0132*       ld de,tile_stack
048BA5 19          0133*       add hl,de ; hl = bottom of stack address
048BA6 ED 5B 03 8B 0134*       ld de,(tile_stack_pointer)
       04          
048BAB B7          0135*       or a ; clear carry
048BAC ED 52       0136*       sbc hl,de ; hl = bytes to copy
048BAE E5          0137*       push hl
048BAF C1          0138*       pop bc ; bytes to copy
048BB0             0139*   ; compute target address
048BB0 ED 5B 03 8B 0140*       ld de,(tile_stack_pointer)
       04          
048BB5             0141*   ; copy bytes
048BB5 E1          0142*       pop hl ; copy from address
048BB6 ED B0       0143*       ldir
048BB8             0144*   ; update stack pointer and active tile count
048BB8 21 09 8B 04 0145*       ld hl,num_active_tiles
048BBC 35          0146*       dec (hl)
048BBD 2A 03 8B 04 0147*       ld hl,(tile_stack_pointer)
048BC1 2B          0148*       dec hl
048BC2 2B          0149*       dec hl
048BC3 2B          0150*       dec hl
048BC4 22 03 8B 04 0151*       ld (tile_stack_pointer),hl
048BC8 C9          0152*       ret
048BC9             0153*   ; end table_deactivate_tile
048BC9             0154*   
048BC9             0155*   ; spawn a new active tile at the prescribed location
048BC9             0156*   ; inputs: hl = pointer to new tile default settings, tiles_x_plot, tiles_y_plot = x,y position
048BC9             0157*   ; returns: if new tile available, a = tile id, ix pointing to new tile vars, carry set
048BC9             0158*   ;      otherwise, a = 0, carry flag reset, ix pointing to highest tile vars
048BC9             0159*   ; destroys: a,hl,bc,de,ix
048BC9             0160*   ; affects: on success, bumps num_active_tiles by one, adds a tile pointer to the top of the tile stack
048BC9             0161*   spawn_active_tile:
048BC9 E5          0162*       push hl ; back up pointer to new tile defaults
048BCA CD 60 8B 04 0163*       call tile_table_get_next_id ; if available: a = new tile id, ix = pointer to new tile vars
048BCE E1          0164*       pop hl ; restore pointer to new tile defaults
048BCF D0          0165*       ret nc ; no carry means no free tile slots, so we go home
048BD0             0166*   ; copy default settings to new tile
048BD0 DD 22 0D 8B 0167*       ld (new_tile_table_pointer),ix ; save pointer to new tile record
       04          
048BD5 ED 32 16    0168*       lea ix,ix+tile_definitions ; bump pointer to copy to
048BD8 DD E5       0169*       push ix ; pointer to default tile settings
048BDA D1          0170*       pop de ; address to copy to
048BDB 01 2A 00 00 0171*       ld bc,tile_table_record_size-tile_definitions ; number of bytes to copy
048BDF ED B0       0172*       ldir ; copies defaults to new tile record
048BE1             0173*   ; copy tile position from inputs
048BE1 DD 2A 0D 8B 0174*       ld ix,(new_tile_table_pointer) ; reset pointer to new tile record
       04          
048BE6 2A 0A 8D 04 0175*       ld hl,(tiles_x_plot-1) ; shift up one byte to get 16.8 fixed point
048BEA DD 2F 01    0176*       ld (ix+tile_x),hl
048BED 2A 0E 8D 04 0177*       ld hl,(tiles_y_plot-1) ; shift up one byte to get 16.8 fixed point
048BF1 DD 2F 04    0178*       ld (ix+tile_y),hl
048BF4             0179*   ; set default tile velocities
048BF4 21 00 00 00 0180*       ld hl,0
048BF8 DD 2F 07    0181*       ld (ix+tile_xvel),hl
048BFB 21 00 01 00 0182*       ld hl,1*256 ; 1 pixel per frame
048BFF DD 2F 0A    0183*       ld (ix+tile_yvel),hl
048C02             0184*   ; return to caller
048C02 DD CB 16 FE 0185*       set 7,(ix+sprite_type) ; set just spawned flag
048C06 DD CB 1D F6 0186*       set sprite_alive,(ix+sprite_collisions) ; set sprite alive flag
048C0A 37          0187*       scf ; set carry flag to indicate success
048C0B C9          0188*       ret
048C0C             0189*   ; end spawn_active_tile
048C0C             0190*   
048C0C             0191*   ; spawn a new active tile at the prescribed location
048C0C             0192*   ; inputs: iy pointer to current hl = pointer to new tile default settings
048C0C             0193*   ; returns: if new tile available, a = tile id, ix pointing to new tile vars, carry set
048C0C             0194*   ;      otherwise, a = 0, carry flag reset, ix pointing to highest tile vars
048C0C             0195*   ; destroys: a,hl,bc,de,ix
048C0C             0196*   ; affects: on success, bumps num_active_tiles by one, adds a tile pointer to the top of the tile stack
048C0C             0197*   spawn_active_tile_from_sprite:
048C0C E5          0198*       push hl ; back up pointer to new tile defaults
048C0D CD 60 8B 04 0199*       call tile_table_get_next_id ; if available: a = new tile id, ix = pointer to new tile vars
048C11 E1          0200*       pop hl ; restore pointer to new tile defaults
048C12 D0          0201*       ret nc ; no carry means no free tile slots, so we go home
048C13             0202*   ; copy default settings to new tile
048C13 DD 22 0D 8B 0203*       ld (new_tile_table_pointer),ix ; save pointer to new tile record
       04          
048C18 ED 32 16    0204*       lea ix,ix+tile_definitions ; bump pointer to copy to
048C1B DD E5       0205*       push ix ; pointer to default tile settings
048C1D D1          0206*       pop de ; address to copy to
048C1E 01 2A 00 00 0207*       ld bc,tile_table_record_size-tile_definitions ; number of bytes to copy
048C22 ED B0       0208*       ldir ; copies defaults to new tile record
048C24             0209*   ; copy tile position from existing sprite
048C24 DD 2A 0D 8B 0210*       ld ix,(new_tile_table_pointer) ; reset pointer to new tile record
       04          
048C29 FD 2A DF 80 0211*       ld iy,(table_pointer) ; get existing sprite record
       04          
048C2E FD 27 01    0212*       ld hl,(iy+sprite_x)
048C31 DD 2F 01    0213*       ld (ix+tile_x),hl
048C34 FD 27 04    0214*       ld hl,(iy+sprite_y)
048C37 DD 2F 04    0215*       ld (ix+tile_y),hl
048C3A             0216*   ; set default tile velocities
048C3A 21 00 00 00 0217*       ld hl,0
048C3E DD 2F 07    0218*       ld (ix+tile_xvel),hl
048C41 21 00 01 00 0219*       ld hl,1*256 ; 1 pixel per frame
048C45 DD 2F 0A    0220*       ld (ix+tile_yvel),hl
048C48             0221*   ; return to caller
048C48 DD CB 16 FE 0222*       set 7,(ix+sprite_type) ; set just spawned flag
048C4C DD CB 1D F6 0223*       set sprite_alive,(ix+sprite_collisions) ; set sprite alive flag
048C50 37          0224*       scf ; set carry flag to indicate success
048C51 C9          0225*       ret
048C52             0226*   ; end spawn_active_tile_from_sprite
048C52             0227*   
048C52             0228*   ; compute animation frame based on tile_animation and tile_heading
048C52             0229*   ; inputs: iy set to tile record
048C52             0230*   ; outputs: a, tile_frame set to animation frame
048C52             0231*   ; destroys: a,hl
048C52             0232*   tile_frame_heading_animation:
048C52 FD 7E 11    0233*       ld a,(iy+tile_heading+1) ; we want the integer portion
048C55 CB 3F       0234*       srl a ; divide integer portion by 8
048C57 CB 3F       0235*       srl a
048C59 CB 3F       0236*       srl a
048C5B FD 66 22    0237*       ld h,(iy+tile_animation)
048C5E 2E 20       0238*       ld l,32 ; 32 orientation frames per animation
048C60 ED 6C       0239*       mlt hl ; hl = offset from base animation
048C62 85          0240*       add a,l ; modulo256 since tile_frame is only 1 byte
048C63 FD 77 28    0241*       ld (iy+tile_frame),a
048C66 C9          0242*       ret
048C67             0243*   ; end tile_frame_heading_animation
048C67             0244*   
048C67             0245*   ; compute animation frame based on tile_heading
048C67             0246*   ; inputs: iy set to tile record
048C67             0247*   ; outputs: a, tile_frame set to animation frame
048C67             0248*   ; destroys: a,hl
048C67             0249*   tile_frame_heading:
048C67 FD 7E 11    0250*       ld a,(iy+tile_heading+1) ; we want the integer portion
048C6A CB 3F       0251*       srl a ; divide integer portion by 8
048C6C CB 3F       0252*       srl a
048C6E CB 3F       0253*       srl a
048C70 FD 77 28    0254*       ld (iy+tile_frame),a
048C73 C9          0255*       ret
048C74             0256*   ; end tile_frame_heading
048C74             0072        include "tiles.inc"
048C74 FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
048D00 00 00 00    0002*   tiles_row_defs: dl 0x000000 ; pointer to current row tiles definitions
048D03 00 00 00    0003*   tiles_row: dl 0 ; decrements each time a row is drawn. level is over when hits zero
048D06             0004*       ; initialize to zero for a maximum of 256 rows in a level
048D06 00          0005*   tiles_cols: db 0 ; number of tile columns in the current level
048D07             0006*   
048D07 00 00 00    0007*   cur_baseBufferId: dl 0
048D0A 00          0008*       db 0 ; padding for byte-shifting
048D0B 00 00 00    0009*   tiles_x_plot: dl 0
048D0E 00          0010*       db 0 ; padding for byte-shifting
048D0F F1 FF FF    0011*   tiles_y_plot: dl -15
048D12             0012*   
048D12             0013*   tiles_plot:
048D12             0014*   ; set gfx origin to playing field window
048D12 01 80 00 00 0015*       ld bc,origin_left
048D16 11 40 00 00 0016*       ld de,origin_top
048D1A CD D0 16 04 0017*       call vdu_set_gfx_origin
048D1E             0018*   ; set gfx viewport to playing field window
048D1E 01 00 00 00 0019*       ld bc,field_left
048D22 11 00 00 00 0020*       ld de,field_top
048D26 DD 21 FF 00 0021*       ld ix,field_right
       00          
048D2B FD 21 3F 01 0022*       ld iy,field_bottom
       00          
048D30 CD EB 16 04 0023*       call vdu_set_gfx_viewport
048D34             0024*   ; move the background down one pixel
048D34 3E 02       0025*       ld a,2 ; current gfx viewport
048D36 2E 02       0026*       ld l,2 ; direction=down
048D38 26 01       0027*       ld h,1 ; speed=1 px
048D3A CD 63 16 04 0028*       call vdu_scroll_down
048D3E             0029*   ; set gfx viewport to one scanline to optimise plotting tiles
048D3E 01 00 00 00 0030*       ld bc,0 ; leftmost x-coord
048D42 11 00 00 00 0031*       ld de,0 ; topmost y-coord
048D46 DD 21 FF 00 0032*       ld ix,255 ; rightmost x-coord
       00          
048D4B FD 21 00 00 0033*       ld iy,0 ; bottommost y-coord
       00          
048D50 CD EB 16 04 0034*       call vdu_set_gfx_viewport
048D54             0035*   ; plot the background
048D54 CD 18 8E 04 0036*       call bg_plot
048D58             0037*   ; initialize tiles loop
048D58 21 00 00 00 0038*       ld hl,0 ; init plotting x-coordinate
048D5C 22 0B 8D 04 0039*       ld (tiles_x_plot),hl
048D60 2A 00 8D 04 0040*       ld hl,(tiles_row_defs)
048D64 3A 06 8D 04 0041*       ld a,(tiles_cols)
048D68 47          0042*       ld b,a ; column loop counter
048D69             0043*   @loop:
048D69 C5          0044*       push bc ; save the loop counter
048D6A             0045*   ; read the tile defintion for the current column
048D6A 7E          0046*       ld a,(hl) ; a has tile definition
048D6B E5          0047*       push hl ; save pointer to tile definition
048D6C 2A 07 8D 04 0048*       ld hl,(cur_baseBufferId) ; hl base buffer id of tileset
048D70 6F          0049*       ld l,a ; a is the offset from the base so hl is now the bufferId of the tile
048D71 CD 38 17 04 0050*       call vdu_buff_select ; tile bitmap buffer is now active
048D75             0051*   ; plot the active bitmap
048D75 ED 4B 0B 8D 0052*       ld bc,(tiles_x_plot)
       04          
048D7A ED 5B 0F 8D 0053*       ld de,(tiles_y_plot)
       04          
048D7F CD 20 1B 04 0054*       call vdu_plot_bmp
048D83             0055*   ; bump x-coords the width of one tile and save it
048D83 2A 0B 8D 04 0056*       ld hl,(tiles_x_plot)
048D87 01 10 00 00 0057*       ld bc,16
048D8B 09          0058*       add hl,bc
048D8C 22 0B 8D 04 0059*       ld (tiles_x_plot),hl
048D90             0060*   ; prepare to loop to next column
048D90 E1          0061*       pop hl ; get back pointer to tile def
048D91 23          0062*       inc hl ; bump it to the next column
048D92 C1          0063*       pop bc ; snag our loop counter
048D93 10 D4       0064*       djnz @loop
048D95             0065*   ; increment tiles plotting y-coordinate
048D95             0066*   ; (we use ix b/c we want to preserve hl for the next step)
048D95 DD 2A 0F 8D 0067*       ld ix,(tiles_y_plot)
       04          
048D9A 11 01 00 00 0068*       ld de,1
048D9E DD 19       0069*       add ix,de
048DA0 DD 22 0F 8D 0070*       ld (tiles_y_plot),ix
       04          
048DA5 DD 7D       0071*       ld a,ixl
048DA7 FE 01       0072*       cp 1
048DA9 C0          0073*       ret nz
048DAA             0074*   ; do active tiles
048DAA E5          0075*       push hl ; save pointer to next row tile def
048DAB CD CE 8D 04 0076*       call do_active_tiles
048DAF E1          0077*       pop hl ; get back pointer to next row tile def
048DB0             0078*   ; time to bump tiles_row_defs to next row
048DB0             0079*   ; (hl was already there at the end of the loop)
048DB0 22 00 8D 04 0080*       ld (tiles_row_defs),hl
048DB4             0081*   ; reset coords to plot next row of tiles
048DB4 21 00 00 00 0082*       ld hl,0
048DB8 22 0B 8D 04 0083*       ld (tiles_x_plot),hl
048DBC 21 F1 FF FF 0084*       ld hl,-15
048DC0 22 0F 8D 04 0085*       ld (tiles_y_plot),hl
048DC4             0086*   ; decrement tiles row counter
048DC4 21 03 8D 04 0087*       ld hl,tiles_row
048DC8 35          0088*       dec (hl)
048DC9 C0          0089*       ret nz
048DCA             0090*   @inc_level:
048DCA C3 6C 68 04 0091*       jp next_level
048DCE             0092*   ; end tiles_plot
048DCE             0093*   
048DCE             0094*   do_active_tiles:
048DCE             0095*   ; initialize tiles loop
048DCE 21 00 00 00 0096*       ld hl,0 ; init plotting x-coordinate
048DD2 22 0B 8D 04 0097*       ld (tiles_x_plot),hl
048DD6 2A 00 8D 04 0098*       ld hl,(tiles_row_defs)
048DDA 3A 06 8D 04 0099*       ld a,(tiles_cols)
048DDE 47          0100*       ld b,a ; column loop counter
048DDF             0101*   @loop:
048DDF C5          0102*       push bc ; save the loop counter
048DE0             0103*   ; read the tile defintion for the current column
048DE0 7E          0104*       ld a,(hl) ; a has tile definition
048DE1 E5          0105*       push hl ; save pointer to tile definition
048DE2 B7          0106*       or a ; check for null tile
048DE3 CA FF 8D 04 0107*       jp z,@next_tile ; skip to next tile if null
048DE7 FE 11       0108*       cp 17 ; carry reset if active tile
048DE9 D2 FF 8D 04 0109*       jp nc,@next_tile ; skip to next tile if not active
048DED             0110*   ; call the tile activation routine
048DED 21 50 8E 04 0111*       ld hl,tile_activation_routines
048DF1 16 03       0112*       ld d,3 ; three bytes per table entry
048DF3 5F          0113*       ld e,a ; a is the tile type
048DF4 ED 5C       0114*       mlt de ; de is now the offset to the table entry
048DF6 19          0115*       add hl,de ; hl is now the address of the table entry
048DF7 ED 27       0116*       ld hl,(hl) ; hl is now the activation routine address
048DF9             0117*       CALL_HL ; call the activation routine
048DF9 01 FF 8D 04 0001*M1     ld bc,$+6 ; Address of first instruction after the jump
048DFD C5          0002*M1     push bc ; which constitutes the return address
048DFE E9          0003*M1     jp (hl) ; Jump to the address in HL
048DFF             0118*   @next_tile:
048DFF             0119*   ; bump x-coords the width of one tile and save it
048DFF 2A 0B 8D 04 0120*       ld hl,(tiles_x_plot)
048E03 01 10 00 00 0121*       ld bc,16
048E07 09          0122*       add hl,bc
048E08 22 0B 8D 04 0123*       ld (tiles_x_plot),hl
048E0C             0124*   ; prepare to loop to next column
048E0C E1          0125*       pop hl ; get back pointer to tile def
048E0D 23          0126*       inc hl ; bump it to the next column
048E0E C1          0127*       pop bc ; snag our loop counter
048E0F 10 CE       0128*       djnz @loop
048E11 C9          0129*       ret ; done
048E12             0130*   ; end do_active_tiles
048E12             0131*   
048E12 FF FF FF    0132*   bg_y_plot: dl -1
048E15 00 04 00    0133*   bg_bufferId: dl BUF_BG_STARS_0 ; default bufferId for background tiles
048E18             0134*   
048E18             0135*   bg_plot:
048E18             0136*   ; load current bg tile bufferId as default
048E18 2A 15 8E 04 0137*       ld hl,(bg_bufferId)
048E1C             0138*   ; check whether it is time for a new background tile
048E1C 3A 12 8E 04 0139*       ld a,(bg_y_plot)
048E20 3C          0140*       inc a
048E21 32 12 8E 04 0141*       ld (bg_y_plot),a
048E25 C2 3D 8E 04 0142*       jp nz,@F ; not time for a new tile so draw current one
048E29             0143*   ; load the next background tile
048E29 21 00 04 00 0144*       ld hl,BUF_BG_STARS_0
048E2D CD AE 05 04 0145*       call rand_8
048E31 E6 07       0146*       and %0000111
048E33 85          0147*       add a,l
048E34 6F          0148*       ld l,a
048E35 3E 00       0149*       ld a,0
048E37 8C          0150*       adc a,h
048E38 67          0151*       ld h,a
048E39 22 15 8E 04 0152*       ld (bg_bufferId),hl
048E3D             0153*   @@:
048E3D CD 38 17 04 0154*       call vdu_buff_select
048E41 01 00 00 00 0155*       ld bc,0
048E45 ED 5B 12 8E 0156*       ld de,(bg_y_plot)
       04          
048E4A 13          0157*       inc de
048E4B CD 20 1B 04 0158*       call vdu_plot_bmp
048E4F C9          0159*       ret
048E50             0160*   ; end bg_plot
048E50             0073        include "tiles_active.inc"
048E50             0001*   
048E50             0002*   ; ###### TODO: NEW CODE TO IMPLEMENT ######
048E50             0003*   tile_pad_small: equ 1
048E50             0004*   tile_pad_med: equ 2
048E50             0005*   tile_pad_large: equ 3
048E50             0006*   tile_charge_shields: equ 4
048E50             0007*   tile_turret_fireball: equ 5
048E50             0008*   tile_laser_turret: equ 6
048E50             0009*   tile_twin_laser_turret: equ 7
048E50             0010*   tile_charge_fuel: equ 8
048E50             0011*   tile_electrode: equ 9
048E50             0012*   tile_lightning: equ 10
048E50             0013*   ; tile_electrode_r: equ 11 ; same as tile_electrode
048E50             0014*   tile_12: equ 12
048E50             0015*   tile_13: equ 13
048E50             0016*   tile_14: equ 14
048E50             0017*   tile_15: equ 15
048E50             0018*   tile_crater: equ 16
048E50             0019*   
048E50             0020*   tile_activation_routines:
048E50 80 8E 04    0021*       dl activate_null_tile ; dummy spacer since tiled is 1-based
048E53 13 93 04    0022*       dl activate_pad_small
048E56 80 8E 04    0023*       dl activate_null_tile
048E59 80 8E 04    0024*       dl activate_null_tile
048E5C 80 8E 04    0025*       dl activate_null_tile
048E5F 13 94 04    0026*       dl activate_turret_fireball
048E62 80 8E 04    0027*       dl activate_null_tile
048E65 80 8E 04    0028*       dl activate_null_tile
048E68 80 8E 04    0029*       dl activate_null_tile
048E6B 13 91 04    0030*       dl activate_electrode
048E6E 13 92 04    0031*       dl activate_lightning
048E71 13 91 04    0032*       dl activate_electrode
048E74 80 8E 04    0033*       dl activate_null_tile
048E77 80 8E 04    0034*       dl activate_null_tile
048E7A 80 8E 04    0035*       dl activate_null_tile
048E7D 13 90 04    0036*       dl activate_crater
048E80             0037*   ; end tile_activation_routines
048E80             0038*   
048E80             0039*   activate_null_tile:
048E80 C9          0040*       ret ; dummy routine, do nothing
048E81             0041*   move_active_tile:
048E81             0042*   ; y-axis movement
048E81 FD 27 04    0043*       ld hl,(iy+tile_y)
048E84 FD 17 0A    0044*       ld de,(iy+tile_yvel)
048E87 19          0045*       add hl,de
048E88 FD 2F 04    0046*       ld (iy+tile_y),hl
048E8B             0047*   ; detect screen edge collisions
048E8B             0048*   ; y-axis bottom is all we need to test
048E8B 11 00 80 FE 0049*       ld de,-tile_bottom*256
048E8F ED 5A       0050*       adc hl,de
048E91 F8          0051*       ret m ; still on screen so do nothing further
048E92 AF          0052*       xor a ; signal caller that tile has scrolled off screen
048E93 C9          0053*       ret
048E94             0054*   ; end move_active_tile
048E94             0055*   
048E94             0056*   move_tiles:
048E94             0057*   ; initialize pointers and loop counter
048E94 FD 21 00 88 0058*       ld iy,tile_stack ; set iy to first record in table
       04          
048E99             0059*   @move_loop:
048E99 FD 22 03 8B 0060*       ld (tile_stack_pointer),iy ; update stack pointer
       04          
048E9E FD 7E 02    0061*       ld a,(iy+2)
048EA1 B7          0062*       or a ; will be zero if at end of stack
048EA2 C8          0063*       ret z ; end of stack so we're done
048EA3             0064*   ; point iy to tile record
048EA3 FD 37 00    0065*       ld iy,(iy) ; iy points to the current tile record
048EA6 FD 22 06 8B 0066*       ld (tile_table_pointer),iy ; update table pointer
       04          
048EAB             0067*   ; check top bit of tile_type to see if tile is just spawned
048EAB FD CB 16 7E 0068*       bit 7,(iy+tile_type)
048EAF C2 CD 8E 04 0069*       jp nz,@just_spawned ; if just spawned, skip to next record
048EB3             0070*   ; check sprite_alive bit to see if tile is active
048EB3 FD CB 1D 76 0071*       bit sprite_alive,(iy+sprite_collisions)
048EB7 C8          0072*       ret z ; end of stack so we're done
048EB8             0073*   ; otherwise we prepare to move the tile
048EB8 FD 27 1A    0074*       ld hl,(iy+tile_move_program) ; load the behavior subroutine address
048EBB             0075*       CALL_HL
048EBB 01 C1 8E 04 0001*M1     ld bc,$+6 ; Address of first instruction after the jump
048EBF C5          0002*M1     push bc ; which constitutes the return address
048EC0 E9          0003*M1     jp (hl) ; Jump to the address in HL
048EC1             0076*    ; get back stack pointer and loop
048EC1             0077*   @next_record:
048EC1 FD 2A 03 8B 0078*       ld iy,(tile_stack_pointer)
       04          
048EC6 ED 33 03    0079*       lea iy,iy+3 ; next tile stack record
048EC9 C3 99 8E 04 0080*       jp @move_loop ; loop until we've checked all the records
048ECD             0081*   @just_spawned:
048ECD FD CB 16 BE 0082*       res 7,(iy+tile_type) ; clear just spawned flag
048ED1 C3 C1 8E 04 0083*       jp @next_record
048ED5             0084*   ; end move_tiles
048ED5             0085*   
048ED5             0086*   draw_active_tile:
048ED5 FD 27 17    0087*       ld hl,(iy+tile_base_bufferId)
048ED8 FD 7E 28    0088*       ld a,(iy+tile_frame)
048EDB 85          0089*       add a,l ; TODO: with a little work we could make all tile base buffer ids align to 256
048EDC 6F          0090*       ld l,a
048EDD 3E 00       0091*       ld a,0 ; preserve carry
048EDF 8C          0092*       adc a,h
048EE0 67          0093*       ld h,a
048EE1 CD 38 17 04 0094*       call vdu_buff_select ; buffer id of animation frame
048EE5 FD 07 01    0095*       ld bc,(iy+tile_x)
048EE8 FD 17 04    0096*       ld de,(iy+tile_y)
048EEB CD 3C 1B 04 0097*       call vdu_plot_bmp168
048EEF C9          0098*       ret
048EF0             0099*   ; end draw_active_tile
048EF0             0100*   
048EF0             0101*   ; create a new sprite at the same location as the current tile
048EF0             0102*   ; inputs: hl = pointer to new sprite default settings, tile_table_pointer = current tile
048EF0             0103*   ;         ix = pointer to sprite group, b = number of records in sprite group
048EF0             0104*   spawn_sprite_from_tile:
048EF0 E5          0105*       push hl ; back up pointer to new sprite defaults
048EF1 CD 8A 81 04 0106*       call table_get_next_id ; if available: a = new sprite id, ix = pointer to new sprite vars
048EF5 E1          0107*       pop hl ; restore pointer to new sprite defaults
048EF6 D0          0108*       ret nc ; no carry means no free sprite slots, so we go home
048EF7             0109*   ; copy default settings to new sprite
048EF7 DD E5       0110*       push ix ; back up pointer to new sprite record
048EF9 ED 32 16    0111*       lea ix,ix+sprite_definitions ; bump pointer to copy to
048EFC DD E5       0112*       push ix ; pointer to default sprite settings
048EFE D1          0113*       pop de ; address to copy to
048EFF 01 2A 00 00 0114*       ld bc,table_record_size-sprite_definitions ; number of bytes to copy
048F03 ED B0       0115*       ldir ; copies defaults to new sprite record
048F05 DD E1       0116*       pop ix ; restore pointer to new sprite record
048F07             0117*   ; copy sprite position from existing tile
048F07 FD 2A 06 8B 0118*       ld iy,(tile_table_pointer) ; get existing tile record
       04          
048F0C FD 27 01    0119*       ld hl,(iy+tile_x)
048F0F DD 2F 01    0120*       ld (ix+sprite_x),hl
048F12 FD 27 04    0121*       ld hl,(iy+tile_y)
048F15 DD 2F 04    0122*       ld (ix+sprite_y),hl
048F18             0123*   ; return to caller
048F18 DD CB 16 FE 0124*       set 7,(ix+sprite_type) ; set just spawned flag
048F1C DD CB 1D F6 0125*       set sprite_alive,(ix+sprite_collisions) ; set sprite alive flag
048F20 37          0126*       scf ; set carry flag to indicate success
048F21 C9          0127*       ret
048F22             0128*   ; end spawn_sprite_from_tile
048F22             0129*   
048F22             0130*   ; create a new tile at the same location as the current tile
048F22             0131*   ; inputs: tile_table_pointer = current tile
048F22             0132*   spawn_active_tile_from_tile:
048F22             0133*   ; copy default settings to new tile
048F22 DD 2A 06 8B 0134*       ld ix,(tile_table_pointer) ; get existing tile record
       04          
048F27 ED 32 16    0135*       lea ix,ix+tile_definitions ; bump pointer to copy to
048F2A DD E5       0136*       push ix ; pointer to default tile settings
048F2C D1          0137*       pop de ; address to copy to
048F2D 01 2A 00 00 0138*       ld bc,tile_table_record_size-tile_definitions ; number of bytes to copy
048F31 ED B0       0139*       ldir ; copies defaults to new tile record
048F33 DD 2A 06 8B 0140*       ld ix,(tile_table_pointer) ; restore pointer to new tile record
       04          
048F38 C9          0141*       ret
048F39             0142*   ; end spawn_active_tile_from_tile
048F39             0074        include "tile_crater.inc"
048F39 FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF    
049000             0002*   crater_defaults:
049000 10          0003*       db tile_crater          ; type
049001 05 01 00    0004*       dl BUF_EXPLOSION_A      ; base_bufferId
049004 1C 90 04    0005*       dl move_crater          ; move_program
049007 40          0006*       db %01000000            ; collisions bit 6 signals sprite alive
049008 10          0007*       db 16                   ; dim_x
049009 10          0008*       db 16                   ; dim_y
04900A 01          0009*       db 1                    ; num_orientations
04900B 04          0010*       db 4                    ; num_animations
04900C 05          0011*       db 5	                ; animation
04900D 08          0012*       db 8                    ; animation_timer
04900E 00          0013*       db 0                    ; move_timer
04900F 00          0014*       db 0                    ; move_step
049010 00          0015*       db 0                    ; points
049011 00          0016*       db 0                    ; shield_damage
049012 00          0017*       db 0                    ; frame
049013             0018*   
049013             0019*   activate_crater:
049013 21 00 90 04 0020*       ld hl,crater_defaults
049017 CD 22 8F 04 0021*       call spawn_active_tile_from_tile
04901B             0022*   ; other specific initialization
04901B C9          0023*       ret
04901C             0024*   ; end activate_crater
04901C             0025*   
04901C             0026*   move_crater:
04901C CD 81 8E 04 0027*       call move_active_tile
049020 CA 90 8B 04 0028*       jp z,table_deactivate_tile
049024             0029*   ; do animation
049024 FD 35 23    0030*       dec (iy+tile_animation_timer)
049027 C0          0031*       ret nz ; not time to animate
049028 FD 35 22    0032*       dec (iy+sprite_animation) ; check whether time to transition to crater
04902B CC 41 90 04 0033*       call z,@make_crater
04902F 3E 08       0034*       ld a,8
049031 FD 77 23    0035*       ld (iy+tile_animation_timer),a
049034 FD 7E 28    0036*       ld a,(iy+tile_frame)
049037 3C          0037*       inc a
049038 E6 03       0038*       and %00000011 ; modulo 4
04903A FD 77 28    0039*       ld (iy+tile_frame),a
04903D C3 D5 8E 04 0040*       jp draw_active_tile
049041             0041*   @make_crater:
049041 21 01 01 00 0042*       ld hl,BUF_CRATER_0
049045 FD 2F 17    0043*       ld (iy+tile_base_bufferId),hl
049048 3E FF       0044*       ld a,-1 ; will wrap to zero on return
04904A FD 77 28    0045*       ld (iy+tile_frame),a
04904D C9          0046*       ret
04904E             0047*   ; end move_crater
04904E             0075        include "tile_electrode.inc"
04904E FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF       
049100             0002*   electrode_defaults:
049100 09          0003*       db 9                    ; type
049101 74 01 00    0004*       dl BUF_TILE_BLANK       ; base_bufferId
049104 1C 91 04    0005*       dl move_electrode       ; move_program
049107 40          0006*       db %01000000            ; collisions bit 6 signals sprite alive
049108 10          0007*       db 16                   ; dim_x
049109 10          0008*       db 16                   ; dim_y
04910A 01          0009*       db 1                    ; num_orientations
04910B 01          0010*       db 1                    ; num_animations
04910C 00          0011*       db 0                    ; animation
04910D 00          0012*       db 0                    ; animation_timer
04910E 00          0013*       db 0                    ; move_timer
04910F 00          0014*       db 0                    ; move_step
049110 05          0015*       db 5                    ; points
049111 FC          0016*       db -4                   ; shield_damage
049112 00          0017*       db 0                    ; frame
049113             0018*   
049113             0019*   activate_electrode:
049113 21 00 91 04 0020*       ld hl,electrode_defaults
049117             0021*   ; get next available active tile id
049117 CD C9 8B 04 0022*       call spawn_active_tile
04911B             0023*       ; ret nc ; no carry means no free active tile slots, so we go home
04911B             0024*   ; other specific initialization
04911B C9          0025*       ret
04911C             0026*   ; end activate_electrode
04911C             0027*   
04911C             0028*   move_electrode:
04911C CD 81 8E 04 0029*       call move_active_tile
049120 CA 90 8B 04 0030*       jp z,table_deactivate_tile
049124 CD 68 23 04 0031*       call check_enemy_collision_player
049128 C2 34 91 04 0032*       jp nz,@laser ; no collision so check laser collision
04912C CD B0 80 04 0033*       call update_shields
049130 C3 41 91 04 0034*       jp kill_electrode
049134             0035*   @laser:
049134 CD 5C 23 04 0036*       call check_enemy_collision_laser
049138 C0          0037*       ret nz ; no collision so we're done
049139 CD 56 80 04 0038*       call update_score
04913D C3 41 91 04 0039*       jp kill_electrode
049141             0040*   ; end move_electrode
049141             0041*   
049141             0042*   kill_electrode:
049141             0043*   ; activate blank tile bitmap
049141 21 74 01 00 0044*       ld hl,BUF_TILE_BLANK
049145 CD 38 17 04 0045*       call vdu_buff_select
049149             0046*   ; save y-coordinate of collision tile
049149 FD 27 04    0047*       ld hl,(iy+tile_y)
04914C 22 FB 91 04 0048*       ld (@tile_y),hl
049150             0049*   ; initialize pointers
049150 2A 03 8B 04 0050*       ld hl,(tile_stack_pointer)
049154 ED 27       0051*       ld hl,(hl) ; pointer to this tile table record
049156 E5          0052*       push hl ; save pointer to this tile table record
049157 DD 21 00 88 0053*       ld ix,tile_stack ; set ix to first record in table
       04          
04915C             0054*   @check_loop:
04915C DD 22 F8 91 0055*       ld (@tile_stack_pointer),ix ; update stack pointer
       04          
049161 DD 7E 02    0056*       ld a,(ix+2)
049164 B7          0057*       or a ; will be zero if at end of stack
049165 CA D1 91 04 0058*       jp z,@done ; end of stack so we're done
049169             0059*   ; point ix to tile record
049169 DD 37 00    0060*       ld ix,(ix) ; ix points to the tile record being checked
04916C             0061*   ; check top bit of tile_type to see if tile is just spawned
04916C DD CB 16 7E 0062*       bit 7,(ix+tile_type)
049170 C2 C5 91 04 0063*       jp nz,@next_record ; if just spawned, skip to next record
049174             0064*   ; check sprite_alive bit to see if tile is active
049174 DD CB 1D 76 0065*       bit sprite_alive,(ix+sprite_collisions)
049178 C8          0066*       ret z ; end of stack so we're done
049179             0067*   ; check tile type
049179 DD 7E 16    0068*       ld a,(ix+tile_type)
04917C FE 0A       0069*       cp tile_lightning ; check if tile is lightning
04917E C2 C5 91 04 0070*       jp nz,@next_record ; if not an electrode, skip to next record
049182             0071*   ; check tile position
049182 FD 2A F8 91 0072*       ld iy,(@tile_stack_pointer)
       04          
049187 FD 22 03 8B 0073*       ld (tile_stack_pointer),iy
       04          
04918C FD 37 00    0074*       ld iy,(iy) ; pointer to tile record to kill
04918F FD 22 06 8B 0075*       ld (tile_table_pointer),iy
       04          
049194 DD 27 04    0076*       ld hl,(ix+tile_y)
049197 ED 5B FB 91 0077*       ld de,(@tile_y)
       04          
04919C B7          0078*       or a ; clear carry
04919D E5          0079*       push hl
04919E ED 52       0080*       sbc hl,de
0491A0 E1          0081*       pop hl
0491A1 CA B1 91 04 0082*       jp z,@kill_it
0491A5 01 00 01 00 0083*       ld bc,1*256
0491A9 09          0084*       add hl,bc
0491AA B7          0085*       or a
0491AB ED 52       0086*       sbc hl,de
0491AD C2 C5 91 04 0087*       jp nz,@next_record
0491B1             0088*   @kill_it: ; deactivate tile and replace with inactive blank tile
0491B1 FD 07 01    0089*       ld bc,(iy+tile_x) ; get x position (ud.e already has y-position)
0491B4 CD 3C 1B 04 0090*       call vdu_plot_bmp168 ; plot blank tile (bitmap was activated at beginning of proc)
0491B8 CD 90 8B 04 0091*       call table_deactivate_tile
0491BC DD 2A F8 91 0092*       ld ix,(@tile_stack_pointer) ; get back stack pointer
       04          
0491C1 C3 5C 91 04 0093*       jp @check_loop ; deactivate tile naturally advances to next record
0491C5             0094*    ; get back stack pointer and loop
0491C5             0095*   @next_record:
0491C5 DD 2A F8 91 0096*       ld ix,(@tile_stack_pointer)
       04          
0491CA ED 32 03    0097*       lea ix,ix+3 ; next tile stack record
0491CD C3 5C 91 04 0098*       jp @check_loop ; loop until we've checked all the records
0491D1             0099*   @done:
0491D1             0100*   ; find this tile record in the tile stack
0491D1 D1          0101*       pop de ; restore pointer to this tile table record (was hl)
0491D2 FD 21 00 88 0102*       ld iy,tile_stack ; set ix to first record in table
       04          
0491D7             0103*   @find_loop:
0491D7 FD 27 00    0104*       ld hl,(iy)
0491DA ED 33 03    0105*       lea iy,iy+3 ; next tile stack record
0491DD B7          0106*       or a ; clear carry
0491DE ED 52       0107*       sbc hl,de ; if not the same address, loop
0491E0 C2 D7 91 04 0108*       jp nz,@find_loop
0491E4 ED 33 FD    0109*       lea iy,iy-3 ; back up to the record we want
0491E7 FD 22 03 8B 0110*       ld (tile_stack_pointer),iy ; update stack pointer
       04          
0491EC FD 37 00    0111*       ld iy,(iy) ; iy points to the tile stack record
0491EF FD 22 06 8B 0112*       ld (tile_table_pointer),iy ; set pointer to this tile record
       04          
0491F4 C3 13 90 04 0113*       jp activate_crater
0491F8 00 88 04    0114*   @tile_stack_pointer: dl tile_stack ; pointer to current stack record, initialized to tile_stack
0491FB 00 00 00    0115*   @tile_y: dl 0 ; y position of tiles to kill
0491FE             0116*   ; end move_electrode
0491FE             0076        include "tile_lightning.inc"
0491FE FF FF       0001*       align 256
049200             0002*   lightning_defaults:
049200 0A          0003*       db tile_lightning       ; type
049201 4C 01 00    0004*       dl BUF_LIGHTNING_H_0    ; base_bufferId
049204 1D 92 04    0005*       dl move_lightning       ; move_program
049207 40          0006*       db %01000000            ; collisions bit 6 signals sprite alive
049208 10          0007*       db 16                   ; dim_x
049209 10          0008*       db 16                   ; dim_y
04920A 01          0009*       db 1                    ; num_orientations
04920B 02          0010*       db 2                    ; num_animations
04920C 00          0011*       db 0                    ; animation
04920D 08          0012*       db 8                    ; animation_timer
04920E 00          0013*       db 0                    ; move_timer
04920F 00          0014*       db 0                    ; move_step
049210 00          0015*       db 0                    ; points
049211 FF          0016*       db -1                    ; shield_damage
049212 00          0017*       db 0                    ; frame
049213             0018*   
049213             0019*   activate_lightning:
049213 21 00 92 04 0020*       ld hl,lightning_defaults
049217             0021*   ; get next available active tile id
049217 CD C9 8B 04 0022*       call spawn_active_tile
04921B D0          0023*       ret nc ; no carry means no free active tile slots, so we go home
04921C             0024*   ; other specific initialization
04921C C9          0025*       ret
04921D             0026*   ; end activate_lightning
04921D             0027*   
04921D             0028*   move_lightning:
04921D CD 81 8E 04 0029*       call move_active_tile
049221 CA 90 8B 04 0030*       jp z,table_deactivate_tile
049225 CD 5C 23 04 0031*       call check_enemy_collision_laser ; kills laser on collision but does not die
049229 CD 68 23 04 0032*       call check_enemy_collision_player
04922D C2 35 92 04 0033*       jp nz,@animate ; no collision so do animation
049231 CD B0 80 04 0034*       call update_shields
049235             0035*   @animate:
049235 FD 35 23    0036*       dec (iy+tile_animation_timer)
049238 C0          0037*       ret nz ; not time to animate
049239             0038*   ; reset the animation timer and bump animation
049239 3E 08       0039*       ld a,8
04923B FD 77 23    0040*       ld (iy+tile_animation_timer),a
04923E FD 7E 28    0041*       ld a,(iy+tile_frame)
049241 3C          0042*       inc a
049242 E6 01       0043*       and %00000001 ; modulo 1
049244 FD 77 28    0044*       ld (iy+tile_frame),a
049247 C3 D5 8E 04 0045*       jp draw_active_tile
04924B C9          0046*       ret
04924C             0077        include "tile_pad_small.inc"
04924C FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
049300             0002*   pad_small_defaults:
049300 01          0003*       db tile_pad_small       ; type
049301 75 01 00    0004*       dl BUF_TILE_PAD_0       ; base_bufferId
049304 26 93 04    0005*       dl move_pad_small       ; move_program
049307 40          0006*       db %01000000            ; collisions bit 6 signals sprite alive
049308 10          0007*       db 16                   ; dim_x
049309 10          0008*       db 16                   ; dim_y
04930A 01          0009*       db 1                    ; num_orientations
04930B 01          0010*       db 1                    ; num_animations
04930C 00          0011*       db 0                    ; animation
04930D 10          0012*       db 16                   ; animation_timer
04930E 00          0013*       db 0                    ; move_timer
04930F 00          0014*       db 0                    ; move_step
049310 05          0015*       db 5                    ; points
049311 00          0016*       db 0                    ; shield_damage
049312 00          0017*       db 0                    ; frame
049313             0018*   
049313             0019*   activate_pad_small:
049313 21 00 93 04 0020*       ld hl,pad_small_defaults
049317             0021*   ; get next available active tile id
049317 CD C9 8B 04 0022*       call spawn_active_tile
04931B D0          0023*       ret nc ; no carry means no free active tile slots, so we go home
04931C             0024*   ; other specific initialization
04931C CD AE 05 04 0025*       call rand_8     ; snag a random number
049320 E6 1F       0026*       and %00011111 ; keep only 5 lowest bits (max 31)
049322 DD 77 24    0027*       ld (ix+tile_move_timer),a ; when this hits zero,will spawn a seeker
049325 C9          0028*       ret
049326             0029*   ; end activate_pad_small
049326             0030*   
049326             0031*   move_pad_small:
049326 CD 81 8E 04 0032*       call move_active_tile
04932A CA 90 8B 04 0033*       jp z,table_deactivate_tile
04932E CD 5C 23 04 0034*       call check_enemy_collision_laser
049332 CA 63 93 04 0035*       jp z,kill_pad_small
049336             0036*   ; do animation
049336 FD 35 23    0037*       dec (iy+tile_animation_timer)
049339 C2 4F 93 04 0038*       jp nz,@F
04933D 3E 10       0039*       ld a,16
04933F FD 77 23    0040*       ld (iy+tile_animation_timer),a
049342 FD 7E 28    0041*       ld a,(iy+tile_frame)
049345 3C          0042*       inc a
049346 E6 07       0043*       and %00000111 ; modulo 8
049348 FD 77 28    0044*       ld (iy+tile_frame),a
04934B CD D5 8E 04 0045*       call draw_active_tile
04934F             0046*   @@: ; check whether it is time to spawn a seeker
04934F FD 35 24    0047*       dec (iy+tile_move_timer)
049352 C0          0048*       ret nz
049353             0049*   ; spwan a seeker
049353 CD 14 25 04 0050*       call enemy_spawn_seeker
049357             0051*       ; fall through to reset move timer
049357             0052*   pad_small_reset_move_timer:
049357 CD AE 05 04 0053*       call rand_8     ; snag a random number
04935B E6 1F       0054*       and %00011111   ; keep only 5 lowest bits (max 31)
04935D C6 40       0055*       add a,64 ; range is now 64-127
04935F FD 77 24    0056*       ld (iy+tile_move_timer),a ; when this hits zero,will spawn a seeker
049362 C9          0057*       ret
049363             0058*   
049363             0059*   kill_pad_small:
049363 CD 56 80 04 0060*       call update_score
049367 C3 13 90 04 0061*       jp activate_crater
04936B             0062*   ; end move_pad_small
04936B             0078        include "tile_turret_fireball.inc"
04936B FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF          
049400             0002*   turret_fireball_defaults:
049400 02          0003*       db enemy_ground         ; type
049401 7D 01 00    0004*       dl BUF_TURRET_000       ; base_bufferId
049404 26 94 04    0005*       dl move_turret_fireball ; move_program
049407 40          0006*       db %01000000            ; collisions bit 6 signals sprite alive
049408 10          0007*       db 16                   ; dim_x
049409 10          0008*       db 16                   ; dim_y
04940A 20          0009*       db 32                   ; num_orientations
04940B 01          0010*       db 1                    ; num_animations
04940C 00          0011*       db 0                    ; animation
04940D 00          0012*       db 0                    ; animation_timer
04940E 00          0013*       db 0                    ; move_timer
04940F 00          0014*       db 0                    ; move_step
049410 05          0015*       db 5                    ; points
049411 00          0016*       db 0                    ; shield_damage
049412 00          0017*       db 0                    ; frame
049413             0018*   
049413             0019*   activate_turret_fireball:
049413 21 00 94 04 0020*       ld hl,turret_fireball_defaults
049417             0021*   ; get next available active tile id
049417 CD C9 8B 04 0022*       call spawn_active_tile
04941B D0          0023*       ret nc ; no carry means no free active tile slots, so we go home
04941C             0024*   ; other specific initialization
04941C CD AE 05 04 0025*       call rand_8     ; snag a random number
049420 E6 1F       0026*       and %00011111 ; keep only 5 lowest bits (max 31)
049422 DD 77 24    0027*       ld (ix+tile_move_timer),a ; when this hits zero,will spawn a fireball
049425 C9          0028*       ret
049426             0029*   ; end activate_turret_fireball
049426             0030*   
049426             0031*   move_turret_fireball:
049426 CD 81 8E 04 0032*       call move_active_tile
04942A CA 90 8B 04 0033*       jp z,table_deactivate_tile
04942E CD 5C 23 04 0034*       call check_enemy_collision_laser
049432 CA 65 94 04 0035*       jp z,kill_turret_fireball
049436             0036*   ; target player
049436 CD 2B 87 04 0037*       call tile_orientation_to_player
04943A 21 00 04 00 0038*       ld hl,speed_fireball
04943E 22 58 87 04 0039*       ld (Vp),hl ; param for targeting_computer
049442 CD 70 87 04 0040*       call targeting_computer
049446 FD 2F 10    0041*       ld (iy+tile_heading),hl ; save active tile heading
049449 CD 67 8C 04 0042*       call tile_frame_heading
04944D CD D5 8E 04 0043*       call draw_active_tile
049451             0044*   ; check whether it is time to spawn a fireball
049451 FD 35 24    0045*       dec (iy+tile_move_timer)
049454 C0          0046*       ret nz
049455             0047*   ; spwan a fireball
049455 CD 13 24 04 0048*       call enemy_spawn_fireball
049459             0049*       ; fall through to reset move timer
049459             0050*   turret_fireball_reset_move_timer:
049459 CD AE 05 04 0051*       call rand_8     ; snag a random number
04945D E6 1F       0052*       and %00011111   ; keep only 5 lowest bits (max 31)
04945F C6 18       0053*       add a,24 ; range is now 24-55
049461 FD 77 24    0054*       ld (iy+tile_move_timer),a ; when this hits zero,will spawn a fireball
049464 C9          0055*       ret
049465             0056*   
049465             0057*   kill_turret_fireball:
049465 CD 56 80 04 0058*       call update_score
049469 C3 13 90 04 0059*       jp activate_crater
04946D             0060*   ; end move_turret_fireball
04946D             0079        include "debug.inc"
04946D FF FF FF FF 0001*       align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF    
049500             0002*   
049500             0003*   
049500             0004*   printHexA:
049500 F5          0005*       push af
049501 C5          0006*       push bc
049502 CD 35 01 04 0007*       call printHex8
049506 3E 20       0008*       ld a,' '
049508 5B D7       0009*       rst.lil 10h
04950A C1          0010*       pop bc
04950B F1          0011*       pop af
04950C C9          0012*       ret
04950D             0013*   
04950D             0014*   printHexHL:
04950D F5          0015*       push af
04950E C5          0016*       push bc
04950F CD 2F 01 04 0017*       call printHex16
049513 3E 20       0018*       ld a,' '
049515 5B D7       0019*       rst.lil 10h
049517 C1          0020*       pop bc
049518 F1          0021*       pop af
049519 C9          0022*       ret
04951A             0023*   
04951A             0024*   printHexUHL:
04951A F5          0025*       push af
04951B C5          0026*       push bc
04951C CD 27 01 04 0027*       call printHex24
049520 3E 20       0028*       ld a,' '
049522 5B D7       0029*       rst.lil 10h
049524 C1          0030*       pop bc
049525 F1          0031*       pop af
049526 C9          0032*       ret
049527             0033*   
049527             0034*   printHexAUHL:
049527 F5          0035*       push af
049528 C5          0036*       push bc
049529 CD 35 01 04 0037*       call printHex8
04952D 3E 2E       0038*       ld a,'.'
04952F 5B D7       0039*       rst.lil 10h
049531 CD 27 01 04 0040*       call printHex24
049535 3E 20       0041*       ld a,' '
049537 5B D7       0042*       rst.lil 10h
049539 C1          0043*       pop bc
04953A F1          0044*       pop af
04953B C9          0045*       ret
04953C             0046*   
04953C             0047*   printHexABHL:
04953C             0048*   ; preserve registers
04953C C5          0049*       push bc ; b will be ok c will not
04953D F5          0050*       push af ; will get totally destroyed
04953E             0051*   ; print a
04953E CD 35 01 04 0052*       call printHex8
049542             0053*   ; print b
049542 78          0054*       ld a,b
049543 CD 35 01 04 0055*       call printHex8
049547             0056*   ; print hl
049547 CD 2F 01 04 0057*       call printHex16
04954B             0058*   ; restore registers
04954B F1          0059*       pop af
04954C C1          0060*       pop bc
04954D C9          0061*       ret
04954E             0062*   
04954E             0063*   printHexBHL:
04954E             0064*   ; preserve registers
04954E C5          0065*       push bc ; b will be ok c will not
04954F F5          0066*       push af ; will get totally destroyed
049550             0067*   ; print b
049550 78          0068*       ld a,b
049551 CD 35 01 04 0069*       call printHex8
049555             0070*   ; print hl
049555 CD 2F 01 04 0071*       call printHex16
049559             0072*   ; restore registers
049559 F1          0073*       pop af
04955A C1          0074*       pop bc
04955B C9          0075*       ret
04955C             0076*   
04955C             0077*   printHexCDE:
04955C             0078*   ; preserve registers
04955C C5          0079*       push bc ; b will be ok c will not
04955D F5          0080*       push af ; will get totally destroyed
04955E             0081*   ; print c
04955E 79          0082*       ld a,c
04955F CD 35 01 04 0083*       call printHex8
049563             0084*   ; print de
049563 EB          0085*       ex de,hl
049564 CD 2F 01 04 0086*       call printHex16
049568 EB          0087*       ex de,hl
049569             0088*   ; restore registers
049569 F1          0089*       pop af
04956A C1          0090*       pop bc
04956B C9          0091*       ret
04956C             0092*   
04956C             0093*   printHexUIX:
04956C             0094*   ; store everything in scratch
04956C 22 BC 03 04 0095*       ld (uhl),hl
049570 ED 43 BF 03 0096*       ld (ubc),bc
       04          
049575 ED 53 C2 03 0097*       ld (ude),de
       04          
04957A DD 22 C5 03 0098*       ld (uix),ix
       04          
04957F FD 22 C8 03 0099*       ld (uiy),iy
       04          
049584 F5          0100*       push af ; fml
049585             0101*   
049585 21 53 03 04 0102*       ld hl,str_ixu
049589 CD 07 01 04 0103*       call printString
04958D 2A C5 03 04 0104*       ld hl,(uix)
049591 CD 27 01 04 0105*       call printHex24
049595 CD 1C 01 04 0106*       call printNewLine
049599             0107*   
049599             0108*   ; restore everything
049599 2A BC 03 04 0109*       ld hl, (uhl)
04959D ED 4B BF 03 0110*       ld bc, (ubc)
       04          
0495A2 ED 5B C2 03 0111*       ld de, (ude)
       04          
0495A7 DD 2A C5 03 0112*       ld ix, (uix)
       04          
0495AC FD 2A C8 03 0113*       ld iy, (uiy)
       04          
0495B1 F1          0114*       pop af
0495B2             0115*   ; all done
0495B2 C9          0116*       ret
0495B3             0117*   
0495B3             0118*   
0495B3             0119*   ; print registers to screen in hexidecimal format
0495B3             0120*   ; inputs: none
0495B3             0121*   ; outputs: values of every register printed to screen
0495B3             0122*   ;    values of each register in global scratch memory
0495B3             0123*   ; destroys: nothing
0495B3             0124*   stepRegistersHex:
0495B3             0125*   ; store everything in scratch
0495B3 22 BC 03 04 0126*       ld (uhl),hl
0495B7 ED 43 BF 03 0127*       ld (ubc),bc
       04          
0495BC ED 53 C2 03 0128*       ld (ude),de
       04          
0495C1 DD 22 C5 03 0129*       ld (uix),ix
       04          
0495C6 FD 22 C8 03 0130*       ld (uiy),iy
       04          
0495CB F5          0131*       push af ; fml
0495CC E1          0132*       pop hl ; thanks, zilog
0495CD 22 B9 03 04 0133*       ld (uaf),hl
0495D1 F5          0134*       push af ; dammit
0495D2             0135*   
0495D2             0136*   ; home the cursor
0495D2             0137*       ; call vdu_home_cursor
0495D2             0138*   
0495D2             0139*   ; print each register
0495D2 21 3F 03 04 0140*       ld hl,str_afu
0495D6 CD 07 01 04 0141*       call printString
0495DA 2A B9 03 04 0142*       ld hl,(uaf)
0495DE CD 27 01 04 0143*       call printHex24
0495E2 CD 1C 01 04 0144*       call printNewLine
0495E6             0145*   
0495E6 21 44 03 04 0146*       ld hl,str_hlu
0495EA CD 07 01 04 0147*       call printString
0495EE 2A BC 03 04 0148*       ld hl,(uhl)
0495F2 CD 27 01 04 0149*       call printHex24
0495F6 CD 1C 01 04 0150*       call printNewLine
0495FA             0151*   
0495FA 21 49 03 04 0152*       ld hl,str_bcu
0495FE CD 07 01 04 0153*       call printString
049602 2A BF 03 04 0154*       ld hl,(ubc)
049606 CD 27 01 04 0155*       call printHex24
04960A CD 1C 01 04 0156*       call printNewLine
04960E             0157*   
04960E 21 4E 03 04 0158*       ld hl,str_deu
049612 CD 07 01 04 0159*       call printString
049616 2A C2 03 04 0160*       ld hl,(ude)
04961A CD 27 01 04 0161*       call printHex24
04961E CD 1C 01 04 0162*       call printNewLine
049622             0163*   
049622 21 53 03 04 0164*       ld hl,str_ixu
049626 CD 07 01 04 0165*       call printString
04962A 2A C5 03 04 0166*       ld hl,(uix)
04962E CD 27 01 04 0167*       call printHex24
049632 CD 1C 01 04 0168*       call printNewLine
049636             0169*   
049636 21 58 03 04 0170*       ld hl,str_iyu
04963A CD 07 01 04 0171*       call printString
04963E 2A C8 03 04 0172*       ld hl,(uiy)
049642 CD 27 01 04 0173*       call printHex24
049646 CD 1C 01 04 0174*       call printNewLine
04964A             0175*   
04964A             0176*       ; call vsync
04964A             0177*   
04964A CD 1C 01 04 0178*       call printNewLine
04964E             0179*   
04964E             0180*   ; check for right shift key and quit if pressed
04964E             0181*       MOSCALL mos_getkbmap
04964E 3E 1E       0001*M1 			LD	A, function
049650 5B CF       0002*M1 			RST.LIL	08h
049652             0182*   @stayhere:
049652             0183*   ; 7 RightShift
049652 DD CB 00 76 0184*       bit 6,(ix+0)
049656 20 02       0185*       jr nz,@RightShift
049658 18 F8       0186*       jr @stayhere
04965A             0187*   @RightShift:
04965A DD CB 0E 86 0188*       res 0,(ix+14) ; debounce the key (hopefully)
04965E 3E 80       0189*       ld a,%10000000
049660             0190*       ; call multiPurposeDelay
049660             0191*   
049660             0192*   ; restore everything
049660 2A BC 03 04 0193*       ld hl, (uhl)
049664 ED 4B BF 03 0194*       ld bc, (ubc)
       04          
049669 ED 5B C2 03 0195*       ld de, (ude)
       04          
04966E DD 2A C5 03 0196*       ld ix, (uix)
       04          
049673 FD 2A C8 03 0197*       ld iy, (uiy)
       04          
049678 F1          0198*       pop af
049679             0199*   ; all done
049679 C9          0200*       ret
04967A             0201*   
04967A             0202*   ; print registers to screen in hexidecimal format
04967A             0203*   ; inputs: none
04967A             0204*   ; outputs: values of every register printed to screen
04967A             0205*   ;    values of each register in global scratch memory
04967A             0206*   ; destroys: nothing
04967A             0207*   dumpRegistersHex:
04967A             0208*   ; store everything in scratch
04967A 22 BC 03 04 0209*       ld (uhl),hl
04967E ED 43 BF 03 0210*       ld (ubc),bc
       04          
049683 ED 53 C2 03 0211*       ld (ude),de
       04          
049688 DD 22 C5 03 0212*       ld (uix),ix
       04          
04968D FD 22 C8 03 0213*       ld (uiy),iy
       04          
049692 F5          0214*       push af ; fml
049693 E1          0215*       pop hl ; thanks, zilog
049694 22 B9 03 04 0216*       ld (uaf),hl
049698 F5          0217*       push af ; dammit
049699             0218*   
049699             0219*   ; home the cursor
049699             0220*       ; call vdu_home_cursor
049699             0221*       ; call printNewLine
049699             0222*   
049699             0223*   ; print each register
049699 21 3F 03 04 0224*       ld hl,str_afu
04969D CD 07 01 04 0225*       call printString
0496A1 2A B9 03 04 0226*       ld hl,(uaf)
0496A5 CD 27 01 04 0227*       call printHex24
0496A9 CD 1C 01 04 0228*       call printNewLine
0496AD             0229*   
0496AD 21 44 03 04 0230*       ld hl,str_hlu
0496B1 CD 07 01 04 0231*       call printString
0496B5 2A BC 03 04 0232*       ld hl,(uhl)
0496B9 CD 27 01 04 0233*       call printHex24
0496BD CD 1C 01 04 0234*       call printNewLine
0496C1             0235*   
0496C1 21 49 03 04 0236*       ld hl,str_bcu
0496C5 CD 07 01 04 0237*       call printString
0496C9 2A BF 03 04 0238*       ld hl,(ubc)
0496CD CD 27 01 04 0239*       call printHex24
0496D1 CD 1C 01 04 0240*       call printNewLine
0496D5             0241*   
0496D5 21 4E 03 04 0242*       ld hl,str_deu
0496D9 CD 07 01 04 0243*       call printString
0496DD 2A C2 03 04 0244*       ld hl,(ude)
0496E1 CD 27 01 04 0245*       call printHex24
0496E5 CD 1C 01 04 0246*       call printNewLine
0496E9             0247*   
0496E9 21 53 03 04 0248*       ld hl,str_ixu
0496ED CD 07 01 04 0249*       call printString
0496F1 2A C5 03 04 0250*       ld hl,(uix)
0496F5 CD 27 01 04 0251*       call printHex24
0496F9 CD 1C 01 04 0252*       call printNewLine
0496FD             0253*   
0496FD 21 58 03 04 0254*       ld hl,str_iyu
049701 CD 07 01 04 0255*       call printString
049705 2A C8 03 04 0256*       ld hl,(uiy)
049709 CD 27 01 04 0257*       call printHex24
04970D             0258*   
04970D CD 1C 01 04 0259*       call printNewLine
049711 CD 1C 01 04 0260*       call printNewLine
049715             0261*   ; restore everything
049715 2A BC 03 04 0262*       ld hl, (uhl)
049719 ED 4B BF 03 0263*       ld bc, (ubc)
       04          
04971E ED 5B C2 03 0264*       ld de, (ude)
       04          
049723 DD 2A C5 03 0265*       ld ix, (uix)
       04          
049728 FD 2A C8 03 0266*       ld iy, (uiy)
       04          
04972D F1          0267*       pop af
04972E             0268*   ; all done
04972E C9          0269*       ret
04972F             0270*   
04972F             0271*   dumpRegistersHexPrime:
04972F D9          0272*       exx
049730 08          0273*       ex af,af'
049731 CD 7A 96 04 0274*       call dumpRegistersHex
049735 08          0275*       ex af,af'
049736 D9          0276*       exx
049737 C9          0277*       ret
049738             0278*   
049738             0279*   ; additionally dump prime registers
049738             0280*   ; inputs: none
049738             0281*   ; outputs: values of every register printed to screen
049738             0282*   ; destroys: nothing
049738             0283*   dumpRegistersHexAll:
049738 CD 7A 96 04 0284*       call dumpRegistersHex
04973C 08          0285*       ex af,af'
04973D D9          0286*       exx
04973E CD 7A 96 04 0287*       call dumpRegistersHex
049742 08          0288*       ex af,af'
049743 D9          0289*       exx
049744 C9          0290*       ret
049745             0291*   
049745             0292*   ; print hlu to screen in hexidecimal format
049745             0293*   ; inputs: none
049745             0294*   ; destroys: nothing
049745             0295*   print_hex_hl:
049745 F5          0296*       push af
049746 E5          0297*       push hl
049747 21 44 03 04 0298*       ld hl,str_hlu
04974B CD 07 01 04 0299*       call printString
04974F E1          0300*       pop hl
049750 E5          0301*       push hl
049751 CD 27 01 04 0302*       call printHex24
049755 3E 20       0303*       ld a,' '
049757 5B D7       0304*       rst.lil 10h
049759 E1          0305*       pop hl
04975A F1          0306*       pop af
04975B C9          0307*       ret
04975C             0308*   
04975C             0309*   ; print bcu to screen in hexidecimal format
04975C             0310*   ; inputs: none
04975C             0311*   ; destroys: nothing
04975C             0312*   print_hex_bc:
04975C F5          0313*       push af
04975D E5          0314*       push hl
04975E C5          0315*       push bc
04975F 21 49 03 04 0316*       ld hl,str_bcu
049763 CD 07 01 04 0317*       call printString
049767 E1          0318*       pop hl
049768 E5          0319*       push hl
049769 CD 27 01 04 0320*       call printHex24
04976D 3E 20       0321*       ld a,' '
04976F 5B D7       0322*       rst.lil 10h
049771 C1          0323*       pop bc
049772 E1          0324*       pop hl
049773 F1          0325*       pop af
049774 C9          0326*       ret
049775             0327*   
049775             0328*   ; print deu to screen in hexidecimal format
049775             0329*   ; inputs: none
049775             0330*   ; destroys: nothing
049775             0331*   print_hex_de:
049775 F5          0332*       push af
049776 E5          0333*       push hl
049777 D5          0334*       push de
049778 21 4E 03 04 0335*       ld hl,str_deu
04977C CD 07 01 04 0336*       call printString
049780 E1          0337*       pop hl
049781 E5          0338*       push hl
049782 CD 27 01 04 0339*       call printHex24
049786 3E 20       0340*       ld a,' '
049788 5B D7       0341*       rst.lil 10h
04978A D1          0342*       pop de
04978B E1          0343*       pop hl
04978C F1          0344*       pop af
04978D C9          0345*       ret
04978E             0346*   
04978E             0347*   
04978E             0348*   ; inputs: whatever is in the flags register
04978E             0349*   ; outputs: binary representation of flags
04978E             0350*   ;          with a header so we know which is what
04978E             0351*   ; destroys: nothing
04978E             0352*   ; preserves: everything
04978E             0353*   dumpFlags:
04978E             0354*   ; first we curse zilog for not giving direct access to flags
04978E F5          0355*       push af ; this is so we can send it back unharmed
04978F F5          0356*       push af ; this is so we can pop it to hl
049790             0357*   ; store everything in scratch
049790 22 BC 03 04 0358*       ld (uhl),hl
049794 ED 43 BF 03 0359*       ld (ubc),bc
       04          
049799 ED 53 C2 03 0360*       ld (ude),de
       04          
04979E DD 22 C5 03 0361*       ld (uix),ix
       04          
0497A3 FD 22 C8 03 0362*       ld (uiy),iy
       04          
0497A8             0363*   ; next we print the header
0497A8 21 D4 97 04 0364*       ld hl,@header
0497AC CD 07 01 04 0365*       call printString
0497B0 E1          0366*       pop hl ; flags are now in l
0497B1 7D          0367*       ld a,l ; flags are now in a
0497B2 CD F5 02 04 0368*       call printBin8
0497B6 CD 1C 01 04 0369*       call printNewLine
0497BA             0370*   ; restore everything
0497BA 2A BC 03 04 0371*       ld hl, (uhl)
0497BE ED 4B BF 03 0372*       ld bc, (ubc)
       04          
0497C3 ED 5B C2 03 0373*       ld de, (ude)
       04          
0497C8 DD 2A C5 03 0374*       ld ix, (uix)
       04          
0497CD FD 2A C8 03 0375*       ld iy, (uiy)
       04          
0497D2 F1          0376*       pop af ; send her home the way she came
0497D3 C9          0377*       ret
0497D4             0378*   ; Bit 7 (S): Sign flag
0497D4             0379*   ; Bit 6 (Z): Zero flag
0497D4             0380*   ; Bit 5 (5): Reserved (copy of bit 5 of the result)
0497D4             0381*   ; Bit 4 (H): Half Carry flag
0497D4             0382*   ; Bit 3 (3): Reserved (copy of bit 3 of the result)
0497D4             0383*   ; Bit 2 (PV): Parity/Overflow flag
0497D4             0384*   ; Bit 1 (N): Subtract flag
0497D4             0385*   ; Bit 0 (C): Carry flag
0497D4 53 5A 78 48 0386*   @header: db "SZxHxPNC\r\n",0 ; cr/lf and 0 terminator
       78 50 4E 43 
       0D 0A 00    
0497DF             0387*   
0497DF             0388*   
0497DF             0389*   ; print bytes from an address to the screen in hexidecimal format
0497DF             0390*   ; inputs: hl = address of first byte to print, a = number of bytes to print
0497DF             0391*   ; outputs: values of each byte printed to screen separated by spaces
0497DF             0392*   ; destroys: nothing
0497DF             0393*   dumpMemoryHex:
0497DF             0394*   ; save registers to the stack
0497DF C5          0395*       push bc
0497E0 E5          0396*       push hl
0497E1 F5          0397*       push af
0497E2             0398*   
0497E2             0399*   ; print the address and separator
0497E2 CD 27 01 04 0400*       call printHex24
0497E6 3E 3A       0401*       ld a,':'
0497E8 5B D7       0402*       rst.lil 10h
0497EA 3E 20       0403*       ld a,' '
0497EC 5B D7       0404*       rst.lil 10h
0497EE             0405*   
0497EE             0406*   ; set b to be our loop counter
0497EE F1          0407*       pop af
0497EF 47          0408*       ld b,a
0497F0 E1          0409*       pop hl
0497F1 E5          0410*       push hl
0497F2 F5          0411*       push af
0497F3             0412*   @loop:
0497F3             0413*   ; print the byte
0497F3 7E          0414*       ld a,(hl)
0497F4 CD 35 01 04 0415*       call printHex8
0497F8             0416*   ; print a space
0497F8 3E 20       0417*       ld a,' '
0497FA 5B D7       0418*       rst.lil 10h
0497FC 23          0419*       inc hl
0497FD 10 F4       0420*       djnz @loop
0497FF CD 1C 01 04 0421*       call printNewLine
049803             0422*   
049803             0423*   ; restore everything
049803 F1          0424*       pop af
049804 E1          0425*       pop hl
049805 C1          0426*       pop bc
049806             0427*   
049806             0428*   ; all done
049806 C9          0429*       ret
049807             0430*   
049807             0431*   
049807             0432*   ; print bytes from an address to the screen in binary format
049807             0433*   ; inputs: hl = address of first byte to print, a = number of bytes to print
049807             0434*   ; outputs: values of each byte printed to screen separated by spaces
049807             0435*   ; destroys: nothing
049807             0436*   dumpMemoryBin:
049807             0437*   ; save all registers to the stack
049807 F5          0438*       push af
049808 C5          0439*       push bc
049809 D5          0440*       push de
04980A E5          0441*       push hl
04980B DD E5       0442*       push ix
04980D FD E5       0443*       push iy
04980F             0444*   
04980F             0445*   ; set b to be our loop counter
04980F 47          0446*       ld b,a
049810             0447*   @loop:
049810             0448*   ; print the byte
049810 7E          0449*       ld a,(hl)
049811 E5          0450*       push hl
049812 C5          0451*       push bc
049813 CD F5 02 04 0452*       call printBin8
049817 C1          0453*       pop bc
049818             0454*   ; print a space
049818 3E 20       0455*       ld a,' '
04981A 5B D7       0456*       rst.lil 10h
04981C E1          0457*       pop hl
04981D 23          0458*       inc hl
04981E 10 F0       0459*       djnz @loop
049820 CD 1C 01 04 0460*       call printNewLine
049824             0461*   
049824             0462*   ; restore everything
049824 FD E1       0463*       pop iy
049826 DD E1       0464*       pop ix
049828 E1          0465*       pop hl
049829 D1          0466*       pop de
04982A C1          0467*       pop bc
04982B F1          0468*       pop af
04982C             0469*   ; all done
04982C C9          0470*       ret
04982D             0471*   
04982D             0472*   ; print bytes from an address to the screen in binary format
04982D             0473*   ; with the bits of each byte in reverse order (lsb first)
04982D             0474*   ; inputs: hl = address of first byte to print, a = number of bytes to print
04982D             0475*   ; outputs: values of each byte printed to screen separated by spaces
04982D             0476*   ; destroys: nothing
04982D             0477*   dumpMemoryBinRev:
04982D             0478*   ; save all registers to the stack
04982D F5          0479*       push af
04982E C5          0480*       push bc
04982F D5          0481*       push de
049830 E5          0482*       push hl
049831 DD E5       0483*       push ix
049833 FD E5       0484*       push iy
049835             0485*   
049835             0486*   ; set b to be our loop counter
049835 47          0487*       ld b,a
049836             0488*   @loop:
049836             0489*   ; print the byte
049836 7E          0490*       ld a,(hl)
049837 E5          0491*       push hl
049838 C5          0492*       push bc
049839 CD 1A 03 04 0493*       call printBin8Rev
04983D C1          0494*       pop bc
04983E             0495*   ; print a space
04983E 3E 20       0496*       ld a,' '
049840 5B D7       0497*       rst.lil 10h
049842 E1          0498*       pop hl
049843 23          0499*       inc hl
049844 10 F0       0500*       djnz @loop
049846 CD 1C 01 04 0501*       call printNewLine
04984A             0502*   
04984A             0503*   ; restore everything
04984A FD E1       0504*       pop iy
04984C DD E1       0505*       pop ix
04984E E1          0506*       pop hl
04984F D1          0507*       pop de
049850 C1          0508*       pop bc
049851 F1          0509*       pop af
049852             0510*   ; all done
049852 C9          0511*       ret
049853             0512*   
049853             0513*   DEBUG_PRINT:
049853             0514*       PUSH_ALL
049853 08          0001*M1     ex af,af'
049854 D9          0002*M1     exx
049855 F5          0003*M1     push af
049856 E5          0004*M1     push hl
049857 C5          0005*M1     push bc
049858 D5          0006*M1     push de
049859             0007*M1 
049859 08          0008*M1     ex af,af'
04985A D9          0009*M1     exx
04985B F5          0010*M1     push af
04985C E5          0011*M1     push hl
04985D C5          0012*M1     push bc
04985E D5          0013*M1     push de
04985F DD E5       0014*M1     push ix
049861 FD E5       0015*M1     push iy
049863 0E 00       0515*       ld c,0 ; X
049865 06 00       0516*       ld b,0 ; Y
049867 CD 37 16 04 0517*       call vdu_move_cursor
04986B             0518*       POP_ALL
04986B FD E1       0001*M1     pop iy
04986D DD E1       0002*M1     pop ix
04986F D1          0003*M1     pop de
049870 C1          0004*M1     pop bc
049871 E1          0005*M1     pop hl
049872 F1          0006*M1     pop af
049873 08          0007*M1     ex af,af'
049874 D9          0008*M1     exx
049875             0009*M1 
049875 D1          0010*M1     pop de
049876 C1          0011*M1     pop bc
049877 E1          0012*M1     pop hl
049878 F1          0013*M1     pop af
049879 08          0014*M1     ex af,af'
04987A D9          0015*M1     exx
04987B             0519*       PUSH_ALL
04987B 08          0001*M1     ex af,af'
04987C D9          0002*M1     exx
04987D F5          0003*M1     push af
04987E E5          0004*M1     push hl
04987F C5          0005*M1     push bc
049880 D5          0006*M1     push de
049881             0007*M1 
049881 08          0008*M1     ex af,af'
049882 D9          0009*M1     exx
049883 F5          0010*M1     push af
049884 E5          0011*M1     push hl
049885 C5          0012*M1     push bc
049886 D5          0013*M1     push de
049887 DD E5       0014*M1     push ix
049889 FD E5       0015*M1     push iy
04988B CD 8E 97 04 0520*       call dumpFlags
04988F             0521*       POP_ALL
04988F FD E1       0001*M1     pop iy
049891 DD E1       0002*M1     pop ix
049893 D1          0003*M1     pop de
049894 C1          0004*M1     pop bc
049895 E1          0005*M1     pop hl
049896 F1          0006*M1     pop af
049897 08          0007*M1     ex af,af'
049898 D9          0008*M1     exx
049899             0009*M1 
049899 D1          0010*M1     pop de
04989A C1          0011*M1     pop bc
04989B E1          0012*M1     pop hl
04989C F1          0013*M1     pop af
04989D 08          0014*M1     ex af,af'
04989E D9          0015*M1     exx
04989F             0522*       PUSH_ALL
04989F 08          0001*M1     ex af,af'
0498A0 D9          0002*M1     exx
0498A1 F5          0003*M1     push af
0498A2 E5          0004*M1     push hl
0498A3 C5          0005*M1     push bc
0498A4 D5          0006*M1     push de
0498A5             0007*M1 
0498A5 08          0008*M1     ex af,af'
0498A6 D9          0009*M1     exx
0498A7 F5          0010*M1     push af
0498A8 E5          0011*M1     push hl
0498A9 C5          0012*M1     push bc
0498AA D5          0013*M1     push de
0498AB DD E5       0014*M1     push ix
0498AD FD E5       0015*M1     push iy
0498AF CD 7A 96 04 0523*       call dumpRegistersHex
0498B3             0524*       ; call waitKeypress
0498B3             0525*       POP_ALL
0498B3 FD E1       0001*M1     pop iy
0498B5 DD E1       0002*M1     pop ix
0498B7 D1          0003*M1     pop de
0498B8 C1          0004*M1     pop bc
0498B9 E1          0005*M1     pop hl
0498BA F1          0006*M1     pop af
0498BB 08          0007*M1     ex af,af'
0498BC D9          0008*M1     exx
0498BD             0009*M1 
0498BD D1          0010*M1     pop de
0498BE C1          0011*M1     pop bc
0498BF E1          0012*M1     pop hl
0498C0 F1          0013*M1     pop af
0498C1 08          0014*M1     ex af,af'
0498C2 D9          0015*M1     exx
0498C3 C9          0526*       ret
0498C4             0527*   
0498C4             0528*   DEBUG_PRINT_TILE_TABLE:
0498C4             0529*       PUSH_ALL
0498C4 08          0001*M1     ex af,af'
0498C5 D9          0002*M1     exx
0498C6 F5          0003*M1     push af
0498C7 E5          0004*M1     push hl
0498C8 C5          0005*M1     push bc
0498C9 D5          0006*M1     push de
0498CA             0007*M1 
0498CA 08          0008*M1     ex af,af'
0498CB D9          0009*M1     exx
0498CC F5          0010*M1     push af
0498CD E5          0011*M1     push hl
0498CE C5          0012*M1     push bc
0498CF D5          0013*M1     push de
0498D0 DD E5       0014*M1     push ix
0498D2 FD E5       0015*M1     push iy
0498D4 CD 1C 01 04 0530*       call printNewLine
0498D8 DD 21 00 88 0531*       ld ix,tile_stack
       04          
0498DD DD 37 00    0532*       ld ix,(ix)
0498E0 CD 79 9D 04 0533*       call dump_tile_record
0498E4 CD 1C 01 04 0534*       call printNewLine
0498E8             0535*       POP_ALL
0498E8 FD E1       0001*M1     pop iy
0498EA DD E1       0002*M1     pop ix
0498EC D1          0003*M1     pop de
0498ED C1          0004*M1     pop bc
0498EE E1          0005*M1     pop hl
0498EF F1          0006*M1     pop af
0498F0 08          0007*M1     ex af,af'
0498F1 D9          0008*M1     exx
0498F2             0009*M1 
0498F2 D1          0010*M1     pop de
0498F3 C1          0011*M1     pop bc
0498F4 E1          0012*M1     pop hl
0498F5 F1          0013*M1     pop af
0498F6 08          0014*M1     ex af,af'
0498F7 D9          0015*M1     exx
0498F8 C9          0536*       ret
0498F9             0537*   ; end DEBUG_PRINT_TILE_TABLE
0498F9             0538*   
0498F9             0539*   DEBUG_PRINT_TABLE:
0498F9             0540*       PUSH_ALL
0498F9 08          0001*M1     ex af,af'
0498FA D9          0002*M1     exx
0498FB F5          0003*M1     push af
0498FC E5          0004*M1     push hl
0498FD C5          0005*M1     push bc
0498FE D5          0006*M1     push de
0498FF             0007*M1 
0498FF 08          0008*M1     ex af,af'
049900 D9          0009*M1     exx
049901 F5          0010*M1     push af
049902 E5          0011*M1     push hl
049903 C5          0012*M1     push bc
049904 D5          0013*M1     push de
049905 DD E5       0014*M1     push ix
049907 FD E5       0015*M1     push iy
049909 CD 1C 01 04 0541*       call printNewLine
04990D CD B1 9B 04 0542*       call dump_sprite_record
049911 CD 1C 01 04 0543*       call printNewLine
049915 CD 1C 01 04 0544*       call printNewLine
049919             0545*   
049919 FD E5       0546*       push iy
04991B DD E1       0547*       pop ix
04991D CD B1 9B 04 0548*       call dump_sprite_record
049921 CD 1C 01 04 0549*       call printNewLine
049925 CD 1C 01 04 0550*       call printNewLine
049929             0551*       POP_ALL
049929 FD E1       0001*M1     pop iy
04992B DD E1       0002*M1     pop ix
04992D D1          0003*M1     pop de
04992E C1          0004*M1     pop bc
04992F E1          0005*M1     pop hl
049930 F1          0006*M1     pop af
049931 08          0007*M1     ex af,af'
049932 D9          0008*M1     exx
049933             0009*M1 
049933 D1          0010*M1     pop de
049934 C1          0011*M1     pop bc
049935 E1          0012*M1     pop hl
049936 F1          0013*M1     pop af
049937 08          0014*M1     ex af,af'
049938 D9          0015*M1     exx
049939 C9          0552*       RET
04993A             0553*   
04993A             0554*   DEBUG_WAITKEYPRESS:
04993A             0555*       PUSH_ALL
04993A 08          0001*M1     ex af,af'
04993B D9          0002*M1     exx
04993C F5          0003*M1     push af
04993D E5          0004*M1     push hl
04993E C5          0005*M1     push bc
04993F D5          0006*M1     push de
049940             0007*M1 
049940 08          0008*M1     ex af,af'
049941 D9          0009*M1     exx
049942 F5          0010*M1     push af
049943 E5          0011*M1     push hl
049944 C5          0012*M1     push bc
049945 D5          0013*M1     push de
049946 DD E5       0014*M1     push ix
049948 FD E5       0015*M1     push iy
04994A CD E1 03 04 0556*       call waitKeypress
04994E             0557*       POP_ALL
04994E FD E1       0001*M1     pop iy
049950 DD E1       0002*M1     pop ix
049952 D1          0003*M1     pop de
049953 C1          0004*M1     pop bc
049954 E1          0005*M1     pop hl
049955 F1          0006*M1     pop af
049956 08          0007*M1     ex af,af'
049957 D9          0008*M1     exx
049958             0009*M1 
049958 D1          0010*M1     pop de
049959 C1          0011*M1     pop bc
04995A E1          0012*M1     pop hl
04995B F1          0013*M1     pop af
04995C 08          0014*M1     ex af,af'
04995D D9          0015*M1     exx
04995E C9          0558*       RET
04995F             0559*   
04995F             0560*   DEBUG_PRINT_FIELDS:
04995F             0561*       ; PUSH_ALL
04995F 01 00 00 00 0562*       ld bc,0
049963 4F          0563*       ld c,a
049964 DD 21 2A A0 0564*       ld ix,table_base
       04          
049969 DD 09       0565*       add ix,bc
04996B 06 14       0566*       ld b,table_num_records
04996D             0567*   @@:
04996D DD E5       0568*       push ix
04996F E1          0569*       pop hl
049970 C5          0570*       push bc ; save loop counter
049971 3E 01       0571*       ld a,1 ; print one byte
049973 CD DF 97 04 0572*       call dumpMemoryHex
049977 ED 32 40    0573*       lea ix,ix+table_record_size
04997A C1          0574*       pop bc ; restore loop counter
04997B 10 F0       0575*       djnz @b
04997D             0576*       ; POP_ALL
04997D C9          0577*       ret
04997E             0578*   
04997E             0579*   DEBUG_PRINT_TILE_STACK:
04997E             0580*       PUSH_ALL
04997E 08          0001*M1     ex af,af'
04997F D9          0002*M1     exx
049980 F5          0003*M1     push af
049981 E5          0004*M1     push hl
049982 C5          0005*M1     push bc
049983 D5          0006*M1     push de
049984             0007*M1 
049984 08          0008*M1     ex af,af'
049985 D9          0009*M1     exx
049986 F5          0010*M1     push af
049987 E5          0011*M1     push hl
049988 C5          0012*M1     push bc
049989 D5          0013*M1     push de
04998A DD E5       0014*M1     push ix
04998C FD E5       0015*M1     push iy
04998E 01 00 00 00 0581*       ld bc,0
049992 11 00 00 00 0582*       ld de,0
049996 CD D0 16 04 0583*       call vdu_set_gfx_origin
04999A 01 00 00 00 0584*       ld bc,0
04999E 11 00 00 00 0585*       ld de,0
0499A2 DD 21 7F 00 0586*       ld ix,127
       00          
0499A7 FD 21 F0 00 0587*       ld iy,240
       00          
0499AC CD EB 16 04 0588*       call vdu_set_gfx_viewport
0499B0 CD 5E 16 04 0589*       call vdu_clg
0499B4 CD 00 16 04 0590*       call vdu_home_cursor
0499B8 CD 1C 01 04 0591*       call printNewLine
0499BC CD 1C 01 04 0592*       call printNewLine
0499C0 2A 03 8B 04 0593*       ld hl,(tile_stack_pointer)
0499C4 CD 1A 95 04 0594*       call printHexUHL
0499C8 CD 1C 01 04 0595*       call printNewLine
0499CC 3A 09 8B 04 0596*       ld a,(num_active_tiles)
0499D0 CD 00 95 04 0597*       call printHexA
0499D4 CD 1C 01 04 0598*       call printNewLine
0499D8 A7          0599*       and a
0499D9 CA 07 9A 04 0600*       jp z,@done
0499DD DD 21 00 88 0601*       ld ix,tile_stack
       04          
0499E2 3A 09 8B 04 0602*       ld a,(num_active_tiles)
0499E6 47          0603*       ld b,a
0499E7             0604*   @loop:
0499E7 C5          0605*       push bc
0499E8 DD E5       0606*       push ix
0499EA DD 37 00    0607*       ld ix,(ix)
0499ED DD 7E 00    0608*       ld a,(ix+tile_id)
0499F0 CD 00 95 04 0609*       call printHexA
0499F4 DD 7E 16    0610*       ld a,(ix+tile_type)
0499F7 CD 00 95 04 0611*       call printHexA
0499FB CD 1C 01 04 0612*       call printNewLine
0499FF DD E1       0613*       pop ix
049A01 ED 32 03    0614*       lea ix,ix+3
049A04 C1          0615*       pop bc
049A05 10 E0       0616*       djnz @loop
049A07             0617*   @done:
049A07             0618*       POP_ALL
049A07 FD E1       0001*M1     pop iy
049A09 DD E1       0002*M1     pop ix
049A0B D1          0003*M1     pop de
049A0C C1          0004*M1     pop bc
049A0D E1          0005*M1     pop hl
049A0E F1          0006*M1     pop af
049A0F 08          0007*M1     ex af,af'
049A10 D9          0008*M1     exx
049A11             0009*M1 
049A11 D1          0010*M1     pop de
049A12 C1          0011*M1     pop bc
049A13 E1          0012*M1     pop hl
049A14 F1          0013*M1     pop af
049A15 08          0014*M1     ex af,af'
049A16 D9          0015*M1     exx
049A17 C9          0619*       ret
049A18             0620*   
049A18             0621*   DEBUG_DUMP_PLAYER_RECORD:
049A18             0622*       PUSH_ALL
049A18 08          0001*M1     ex af,af'
049A19 D9          0002*M1     exx
049A1A F5          0003*M1     push af
049A1B E5          0004*M1     push hl
049A1C C5          0005*M1     push bc
049A1D D5          0006*M1     push de
049A1E             0007*M1 
049A1E 08          0008*M1     ex af,af'
049A1F D9          0009*M1     exx
049A20 F5          0010*M1     push af
049A21 E5          0011*M1     push hl
049A22 C5          0012*M1     push bc
049A23 D5          0013*M1     push de
049A24 DD E5       0014*M1     push ix
049A26 FD E5       0015*M1     push iy
049A28 CD 1C 01 04 0623*       call printNewLine
049A2C CD E6 9E 04 0624*       CALL dump_player_record
049A30 CD 1C 01 04 0625*       call printNewLine
049A34             0626*       POP_ALL
049A34 FD E1       0001*M1     pop iy
049A36 DD E1       0002*M1     pop ix
049A38 D1          0003*M1     pop de
049A39 C1          0004*M1     pop bc
049A3A E1          0005*M1     pop hl
049A3B F1          0006*M1     pop af
049A3C 08          0007*M1     ex af,af'
049A3D D9          0008*M1     exx
049A3E             0009*M1 
049A3E D1          0010*M1     pop de
049A3F C1          0011*M1     pop bc
049A40 E1          0012*M1     pop hl
049A41 F1          0013*M1     pop af
049A42 08          0014*M1     ex af,af'
049A43 D9          0015*M1     exx
049A44 C9          0627*       RET
049A45             0628*   
049A45             0629*   DEBUG_PRINT_SHIELDS:
049A45             0630*       PUSH_ALL
049A45 08          0001*M1     ex af,af'
049A46 D9          0002*M1     exx
049A47 F5          0003*M1     push af
049A48 E5          0004*M1     push hl
049A49 C5          0005*M1     push bc
049A4A D5          0006*M1     push de
049A4B             0007*M1 
049A4B 08          0008*M1     ex af,af'
049A4C D9          0009*M1     exx
049A4D F5          0010*M1     push af
049A4E E5          0011*M1     push hl
049A4F C5          0012*M1     push bc
049A50 D5          0013*M1     push de
049A51 DD E5       0014*M1     push ix
049A53 FD E5       0015*M1     push iy
049A55 0E 00       0631*       ld c,0 ; X
049A57 06 00       0632*       ld b,0 ; Y
049A59 CD 37 16 04 0633*       call vdu_move_cursor
049A5D             0634*   
049A5D CD 8E 97 04 0635*       call dumpFlags
049A61 CD 7A 96 04 0636*       call dumpRegistersHex
049A65             0637*   
049A65 DD 21 8D 80 0638*       ld ix,bar_shields
       04          
049A6A             0639*   
049A6A CD 00 01 04 0640*       call printInline
049A6E 76 61 6C 3A 0641*       asciz "val:"
       00          
049A73 DD 27 00    0642*       ld hl,(ix+bar_val)
049A76 CD 53 01 04 0643*       call printDec
049A7A CD 1C 01 04 0644*       call printNewLine
049A7E             0645*   
049A7E CD 00 01 04 0646*       call printInline
049A82 78 30 20 3A 0647*       asciz "x0 :"
       00          
049A87 DD 27 03    0648*       ld hl,(ix+bar_x0)
049A8A CD 53 01 04 0649*       call printDec
049A8E CD 1C 01 04 0650*       call printNewLine
049A92             0651*   
049A92 CD 00 01 04 0652*       call printInline
049A96 79 30 20 3A 0653*       asciz "y0 :"
       00          
049A9B DD 27 06    0654*       ld hl,(ix+bar_y0)
049A9E CD 53 01 04 0655*       call printDec
049AA2 CD 1C 01 04 0656*       call printNewLine
049AA6             0657*   
049AA6 CD 00 01 04 0658*       call printInline
049AAA 78 31 20 3A 0659*       asciz "x1 :"
       00          
049AAF DD 27 09    0660*       ld hl,(ix+bar_x1)
049AB2 CD 53 01 04 0661*       call printDec
049AB6 CD 1C 01 04 0662*       call printNewLine
049ABA             0663*   
049ABA CD 00 01 04 0664*       call printInline
049ABE 79 31 20 3A 0665*       asciz "y1 :"
       00          
049AC3 DD 27 0C    0666*       ld hl,(ix+bar_y1)
049AC6 CD 53 01 04 0667*       call printDec
049ACA CD 1C 01 04 0668*       call printNewLine
049ACE             0669*   
049ACE CD 00 01 04 0670*       call printInline
049AD2 79 20 20 3A 0671*       asciz "y  :"
       00          
049AD7 DD 27 0F    0672*       ld hl,(ix+bar_y)
049ADA CD 53 01 04 0673*       call printDec
049ADE CD 1C 01 04 0674*       call printNewLine
049AE2             0675*   
049AE2             0676*       POP_ALL
049AE2 FD E1       0001*M1     pop iy
049AE4 DD E1       0002*M1     pop ix
049AE6 D1          0003*M1     pop de
049AE7 C1          0004*M1     pop bc
049AE8 E1          0005*M1     pop hl
049AE9 F1          0006*M1     pop af
049AEA 08          0007*M1     ex af,af'
049AEB D9          0008*M1     exx
049AEC             0009*M1 
049AEC D1          0010*M1     pop de
049AED C1          0011*M1     pop bc
049AEE E1          0012*M1     pop hl
049AEF F1          0013*M1     pop af
049AF0 08          0014*M1     ex af,af'
049AF1 D9          0015*M1     exx
049AF2             0677*       ; call waitKeypress
049AF2 C9          0678*       ret
049AF3             0679*   ; end DEBUG_PRINT_SHIELDS
049AF3             0680*   
049AF3             0681*   DEBUG_PRINT_BAR_UPDATE:
049AF3 0E 00       0682*       ld c,0 ; X
049AF5 06 00       0683*       ld b,0 ; Y
049AF7 CD 37 16 04 0684*       call vdu_move_cursor
049AFB             0685*   
049AFB CD 00 01 04 0686*       call printInline
049AFF 78 30 20 20 0687*       asciz "x0  :"
       3A 00       
049B05 21 00 00 00 0688*       ld hl,0 ; clear hlu
049B09 DD 6E 01    0689*       ld l,(ix+@x0-@cmd0+0)
049B0C DD 66 02    0690*       ld h,(ix+@x0-@cmd0+1)
049B0F CD 53 01 04 0691*       call printDec
049B13 CD 1C 01 04 0692*       call printNewLine
049B17             0693*   
049B17 CD 00 01 04 0694*       call printInline
049B1B 79 30 20 20 0695*       asciz "y0  :"
       3A 00       
049B21 21 00 00 00 0696*       ld hl,0 ; clear hlu
049B25 DD 6E 07    0697*       ld l,(ix+@y0-@cmd0+0)
049B28 DD 66 08    0698*       ld h,(ix+@y0-@cmd0+1)
049B2B CD 53 01 04 0699*       call printDec
049B2F CD 1C 01 04 0700*       call printNewLine
049B33             0701*   
049B33 CD 00 01 04 0702*       call printInline
049B37 78 31 20 20 0703*       asciz "x1  :"
       3A 00       
049B3D 21 00 00 00 0704*       ld hl,0 ; clear hlu
049B41 DD 6E 05    0705*       ld l,(ix+@x1-@cmd0+0)
049B44 DD 66 06    0706*       ld h,(ix+@x1-@cmd0+1)
049B47 CD 53 01 04 0707*       call printDec
049B4B CD 1C 01 04 0708*       call printNewLine
049B4F             0709*   
049B4F CD 00 01 04 0710*       call printInline
049B53 79 31 20 20 0711*       asciz "y1  :"
       3A 00       
049B59 21 00 00 00 0712*       ld hl,0 ; clear hlu
049B5D DD 6E 03    0713*       ld l,(ix+@y1-@cmd0+0)
049B60 DD 66 04    0714*       ld h,(ix+@y1-@cmd0+1)
049B63 CD 53 01 04 0715*       call printDec
049B67 CD 1C 01 04 0716*       call printNewLine
049B6B             0717*   
049B6B CD 00 01 04 0718*       call printInline
049B6F 78 32 20 20 0719*       asciz "x2  :"
       3A 00       
049B75 21 00 00 00 0720*       ld hl,0 ; clear hlu
049B79 DD 6E 0B    0721*       ld l,(ix+@x2-@cmd0+0)
049B7C DD 66 0C    0722*       ld h,(ix+@x2-@cmd0+1)
049B7F CD 53 01 04 0723*       call printDec
049B83 CD 1C 01 04 0724*       call printNewLine
049B87             0725*   
049B87 CD 00 01 04 0726*       call printInline
049B8B 58 32 20 79 0727*       asciz "X2 y2:"
       32 3A 00    
049B92 21 00 00 00 0728*       ld hl,0 ; clear hlu
049B96 DD 6E 0D    0729*       ld l,(ix+@y2-@cmd0+0)
049B99 DD 66 0E    0730*       ld h,(ix+@y2-@cmd0+1)
049B9C CD 53 01 04 0731*       call printDec
049BA0 C9          0732*       ret
049BA1 18          0733*   @cmd0:   db 24
049BA2 00 00       0734*   @x0: 	dw 0x0000
049BA4 00 00       0735*   @y1: 	dw 0x0000
049BA6 00 00       0736*   @x1: 	dw 0x0000
049BA8 00 00       0737*   @y0: 	dw 0x0000
049BAA             0738*   ; plot bitmap command
049BAA 19          0739*   @cmd1:   db 25 ; stomped on by @y0 load
049BAB ED          0740*   @mode:  db plot_bmp+dr_abs_fg ; 0xED stomped on by @x2 load
049BAC 00 00       0741*   @x2: 	dw 0x0000
049BAE 00 00       0742*   @y2: 	dw 0x0000
049BB0 00          0743*   @end:  db 0x00 ; padding
049BB1             0744*   ; end DEBUG_PRINT_BAR_UPDATE
049BB1             0745*   
049BB1             0746*   
049BB1             0747*   dump_sprite_record:
049BB1             0748*       ; call vdu_home_cursor
049BB1 CD 00 01 04 0749*       call printInline
049BB5 69 64 20 20 0750*       asciz "id  : "
       3A 20 00    
049BBC DD 7E 00    0751*       ld a,(ix+sprite_id)
049BBF CD 00 95 04 0752*       call printHexA
049BC3             0753*   
049BC3 CD 00 01 04 0754*       call printInline
049BC7 0D 0A 78 20 0755*       asciz "\r\nx   :"
       20 20 3A 00 
049BCF DD 27 01    0756*       ld hl,(ix+sprite_x)
049BD2 CD 78 02 04 0757*       call print_s168_hl
049BD6             0758*   
049BD6 CD 00 01 04 0759*       call printInline
049BDA 0D 0A 79 20 0760*       asciz "\r\ny   :"
       20 20 3A 00 
049BE2 DD 27 04    0761*       ld hl,(ix+sprite_y)
049BE5 CD 78 02 04 0762*       call print_s168_hl
049BE9             0763*   
049BE9 CD 00 01 04 0764*       call printInline
049BED 0D 0A 78 76 0765*       asciz "\r\nxv  :"
       20 20 3A 00 
049BF5 DD 27 07    0766*       ld hl,(ix+sprite_xvel)
049BF8 CD 78 02 04 0767*       call print_s168_hl
049BFC             0768*   
049BFC CD 00 01 04 0769*       call printInline
049C00 0D 0A 79 76 0770*       asciz "\r\nyv  :"
       20 20 3A 00 
049C08 DD 27 0A    0771*       ld hl,(ix+sprite_yvel)
049C0B CD 78 02 04 0772*       call print_s168_hl
049C0F             0773*   
049C0F CD 00 01 04 0774*       call printInline
049C13 0D 0A 76 20 0775*       asciz "\r\nv   :"
       20 20 3A 00 
049C1B DD 27 0D    0776*       ld hl,(ix+sprite_vel)
049C1E CD 78 02 04 0777*       call print_s168_hl
049C22             0778*   
049C22 CD 00 01 04 0779*       call printInline
049C26 0D 0A 68 64 0780*       asciz "\r\nhdg :"
       67 20 3A 00 
049C2E DD 27 10    0781*       ld hl,(ix+sprite_heading)
049C31 CD 78 02 04 0782*       call print_s168_hl
049C35             0783*   
049C35 CD 00 01 04 0784*       call printInline
049C39 0D 0A 6F 72 0785*       asciz "\r\nori :"
       69 20 3A 00 
049C41 DD 27 13    0786*       ld hl,(ix+sprite_orientation)
049C44 CD 78 02 04 0787*       call print_s168_hl
049C48             0788*   
049C48 CD 00 01 04 0789*       call printInline
049C4C 0D 0A 74 79 0790*       asciz "\r\ntyp : "
       70 20 3A 20 
       00          
049C55 DD 7E 16    0791*       ld a,(ix+sprite_type)
049C58 CD 00 95 04 0792*       call printHexA
049C5C             0793*   
049C5C CD 00 01 04 0794*       call printInline
049C60 0D 0A 42 49 0795*       asciz "\r\nBId : "
       64 20 3A 20 
       00          
049C69 DD 27 17    0796*       ld hl,(ix+sprite_base_bufferId)
049C6C CD 27 01 04 0797*       call printHex24
049C70             0798*   
049C70 CD 00 01 04 0799*       call printInline
049C74 0D 0A 6D 50 0800*       asciz "\r\nmPg : "
       67 20 3A 20 
       00          
049C7D DD 27 1A    0801*       ld hl,(ix+sprite_move_program)
049C80 CD 27 01 04 0802*       call printHex24
049C84             0803*   
049C84 CD 00 01 04 0804*       call printInline
049C88 0D 0A 63 6F 0805*       asciz "\r\ncol : "
       6C 20 3A 20 
       00          
049C91 DD 7E 1D    0806*       ld a,(ix+sprite_collisions)
049C94 CD F5 02 04 0807*       call printBin8
049C98             0808*   
049C98 CD 00 01 04 0809*       call printInline
049C9C 0D 0A 73 7A 0810*       asciz "\r\nszx : "
       78 20 3A 20 
       00          
049CA5 DD 7E 1E    0811*       ld a,(ix+sprite_dim_x)
049CA8 CD 00 95 04 0812*       call printHexA
049CAC             0813*   
049CAC CD 00 01 04 0814*       call printInline
049CB0 0D 0A 73 7A 0815*       asciz "\r\nszy : "
       79 20 3A 20 
       00          
049CB9 DD 7E 1F    0816*       ld a,(ix+sprite_dim_y)
049CBC CD 00 95 04 0817*       call printHexA
049CC0             0818*   
049CC0 CD 00 01 04 0819*       call printInline
049CC4 0D 0A 23 6F 0820*       asciz "\r\n#ori: "
       72 69 3A 20 
       00          
049CCD DD 7E 20    0821*       ld a,(ix+sprite_num_orientations)
049CD0 CD 00 95 04 0822*       call printHexA
049CD4             0823*   
049CD4 CD 00 01 04 0824*       call printInline
049CD8 0D 0A 23 61 0825*       asciz "\r\n#ani: "
       6E 69 3A 20 
       00          
049CE1 DD 7E 21    0826*       ld a,(ix+sprite_num_animations)
049CE4 CD 00 95 04 0827*       call printHexA
049CE8             0828*   
049CE8 CD 00 01 04 0829*       call printInline
049CEC 0D 0A 61 6E 0830*       asciz "\r\nani : "
       69 20 3A 20 
       00          
049CF5 DD 7E 22    0831*       ld a,(ix+sprite_animation)
049CF8 CD 00 95 04 0832*       call printHexA
049CFC             0833*   
049CFC CD 00 01 04 0834*       call printInline
049D00 0D 0A 61 6E 0835*       asciz "\r\nanit: "
       69 74 3A 20 
       00          
049D09 DD 7E 23    0836*       ld a,(ix+sprite_animation_timer)
049D0C CD 00 95 04 0837*       call printHexA
049D10             0838*   
049D10 CD 00 01 04 0839*       call printInline
049D14 0D 0A 6D 76 0840*       asciz "\r\nmvt : "
       74 20 3A 20 
       00          
049D1D DD 7E 24    0841*       ld a,(ix+sprite_move_timer)
049D20 CD 00 95 04 0842*       call printHexA
049D24             0843*   
049D24 CD 00 01 04 0844*       call printInline
049D28 0D 0A 6D 76 0845*       asciz "\r\nmvs : "
       73 20 3A 20 
       00          
049D31 DD 7E 25    0846*       ld a,(ix+sprite_move_step)
049D34 CD 00 95 04 0847*       call printHexA
049D38             0848*   
049D38 CD 00 01 04 0849*       call printInline
049D3C 0D 0A 70 74 0850*       asciz "\r\npts : "
       73 20 3A 20 
       00          
049D45 DD 7E 26    0851*       ld a,(ix+sprite_points)
049D48 CD 00 95 04 0852*       call printHexA
049D4C             0853*   
049D4C CD 00 01 04 0854*       call printInline
049D50 0D 0A 64 6D 0855*       asciz "\r\ndmg : "
       67 20 3A 20 
       00          
049D59 DD 7E 27    0856*       ld a,(ix+sprite_shield_damage)
049D5C CD 00 95 04 0857*       call printHexA
049D60             0858*   
049D60 CD 00 01 04 0859*       call printInline
049D64 0D 0A 66 72 0860*       asciz "\r\nfrm : "
       6D 20 3A 20 
       00          
049D6D DD 7E 28    0861*       ld a,(ix+sprite_frame)
049D70 CD 00 95 04 0862*       call printHexA
049D74             0863*   
049D74 CD 1C 01 04 0864*       call printNewLine
049D78             0865*   
049D78             0866*       ; call waitKeypress
049D78 C9          0867*       ret
049D79             0868*   
049D79             0869*   dump_tile_record:
049D79 CD 00 01 04 0870*       call printInline
049D7D 69 64 20 20 0871*       asciz "id  : "
       3A 20 00    
049D84 DD 7E 00    0872*       ld a,(ix+tile_id)
049D87 CD 00 95 04 0873*       call printHexA
049D8B             0874*   
049D8B CD 00 01 04 0875*       call printInline
049D8F 0D 0A 78 20 0876*       asciz "\r\nx   :"
       20 20 3A 00 
049D97 DD 27 01    0877*       ld hl,(ix+tile_x)
049D9A CD 78 02 04 0878*       call print_s168_hl
049D9E             0879*   
049D9E CD 00 01 04 0880*       call printInline
049DA2 0D 0A 79 20 0881*       asciz "\r\ny   :"
       20 20 3A 00 
049DAA DD 27 04    0882*       ld hl,(ix+tile_y)
049DAD CD 78 02 04 0883*       call print_s168_hl
049DB1             0884*   
049DB1             0885*       ; call printInline
049DB1             0886*       ; asciz "\r\nxv  :"
049DB1             0887*       ; ld hl,(ix+tile_xvel)
049DB1             0888*       ; call print_s168_hl
049DB1             0889*   
049DB1             0890*       ; call printInline
049DB1             0891*       ; asciz "\r\nyv  :"
049DB1             0892*       ; ld hl,(ix+tile_yvel)
049DB1             0893*       ; call print_s168_hl
049DB1             0894*   
049DB1             0895*       ; call printInline
049DB1             0896*       ; asciz "\r\nv   :"
049DB1             0897*       ; ld hl,(ix+tile_vel)
049DB1             0898*       ; call print_s168_hl
049DB1             0899*   
049DB1             0900*       ; call printInline
049DB1             0901*       ; asciz "\r\nhdg :"
049DB1             0902*       ; ld hl,(ix+tile_heading)
049DB1             0903*       ; call print_s168_hl
049DB1             0904*   
049DB1             0905*       ; call printInline
049DB1             0906*       ; asciz "\r\nori :"
049DB1             0907*       ; ld hl,(ix+tile_orientation)
049DB1             0908*       ; call print_s168_hl
049DB1             0909*   
049DB1 CD 00 01 04 0910*       call printInline
049DB5 0D 0A 74 79 0911*       asciz "\r\ntyp : "
       70 20 3A 20 
       00          
049DBE DD 7E 16    0912*       ld a,(ix+tile_type)
049DC1 CD 00 95 04 0913*       call printHexA
049DC5             0914*   
049DC5 CD 00 01 04 0915*       call printInline
049DC9 0D 0A 42 49 0916*       asciz "\r\nBId : "
       64 20 3A 20 
       00          
049DD2 DD 27 17    0917*       ld hl,(ix+tile_base_bufferId)
049DD5 CD 27 01 04 0918*       call printHex24
049DD9             0919*   
049DD9 CD 00 01 04 0920*       call printInline
049DDD 0D 0A 6D 50 0921*       asciz "\r\nmPg : "
       67 20 3A 20 
       00          
049DE6 DD 27 1A    0922*       ld hl,(ix+tile_move_program)
049DE9 CD 27 01 04 0923*       call printHex24
049DED             0924*   
049DED CD 00 01 04 0925*       call printInline
049DF1 0D 0A 63 6F 0926*       asciz "\r\ncol : "
       6C 20 3A 20 
       00          
049DFA DD 7E 1D    0927*       ld a,(ix+tile_collisions)
049DFD CD F5 02 04 0928*       call printBin8
049E01             0929*   
049E01 CD 00 01 04 0930*       call printInline
049E05 0D 0A 73 7A 0931*       asciz "\r\nszx : "
       78 20 3A 20 
       00          
049E0E DD 7E 1E    0932*       ld a,(ix+tile_dim_x)
049E11 CD 00 95 04 0933*       call printHexA
049E15             0934*   
049E15 CD 00 01 04 0935*       call printInline
049E19 0D 0A 73 7A 0936*       asciz "\r\nszy : "
       79 20 3A 20 
       00          
049E22 DD 7E 1F    0937*       ld a,(ix+tile_dim_y)
049E25 CD 00 95 04 0938*       call printHexA
049E29             0939*   
049E29 CD 00 01 04 0940*       call printInline
049E2D 0D 0A 23 6F 0941*       asciz "\r\n#ori: "
       72 69 3A 20 
       00          
049E36 DD 7E 20    0942*       ld a,(ix+tile_num_orientations)
049E39 CD 00 95 04 0943*       call printHexA
049E3D             0944*   
049E3D CD 00 01 04 0945*       call printInline
049E41 0D 0A 23 61 0946*       asciz "\r\n#ani: "
       6E 69 3A 20 
       00          
049E4A DD 7E 21    0947*       ld a,(ix+tile_num_animations)
049E4D CD 00 95 04 0948*       call printHexA
049E51             0949*   
049E51 CD 00 01 04 0950*       call printInline
049E55 0D 0A 61 6E 0951*       asciz "\r\nani : "
       69 20 3A 20 
       00          
049E5E DD 7E 22    0952*       ld a,(ix+tile_animation)
049E61 CD 00 95 04 0953*       call printHexA
049E65             0954*   
049E65 CD 00 01 04 0955*       call printInline
049E69 0D 0A 61 6E 0956*       asciz "\r\nanit: "
       69 74 3A 20 
       00          
049E72 DD 7E 23    0957*       ld a,(ix+tile_animation_timer)
049E75 CD 00 95 04 0958*       call printHexA
049E79             0959*   
049E79 CD 00 01 04 0960*       call printInline
049E7D 0D 0A 6D 76 0961*       asciz "\r\nmvt : "
       74 20 3A 20 
       00          
049E86 DD 7E 24    0962*       ld a,(ix+tile_move_timer)
049E89 CD 00 95 04 0963*       call printHexA
049E8D             0964*   
049E8D CD 00 01 04 0965*       call printInline
049E91 0D 0A 6D 76 0966*       asciz "\r\nmvs : "
       73 20 3A 20 
       00          
049E9A DD 7E 25    0967*       ld a,(ix+tile_move_step)
049E9D CD 00 95 04 0968*       call printHexA
049EA1             0969*   
049EA1 CD 00 01 04 0970*       call printInline
049EA5 0D 0A 70 74 0971*       asciz "\r\npts : "
       73 20 3A 20 
       00          
049EAE DD 7E 26    0972*       ld a,(ix+tile_points)
049EB1 CD 00 95 04 0973*       call printHexA
049EB5             0974*   
049EB5 CD 00 01 04 0975*       call printInline
049EB9 0D 0A 64 6D 0976*       asciz "\r\ndmg : "
       67 20 3A 20 
       00          
049EC2 DD 7E 27    0977*       ld a,(ix+tile_shield_damage)
049EC5 CD 00 95 04 0978*       call printHexA
049EC9             0979*   
049EC9 CD 00 01 04 0980*       call printInline
049ECD 0D 0A 66 72 0981*       asciz "\r\nfrm : "
       6D 20 3A 20 
       00          
049ED6 DD 7E 28    0982*       ld a,(ix+tile_frame)
049ED9 CD 00 95 04 0983*       call printHexA
049EDD             0984*   
049EDD CD 1C 01 04 0985*       call printNewLine
049EE1 CD 1C 01 04 0986*       call printNewLine
049EE5             0987*   
049EE5             0988*       ; call waitKeypress
049EE5 C9          0989*       ret
049EE6             0990*   
049EE6             0991*   dump_player_record:
049EE6 DD 21 2A A1 0992*       ld ix,player_begin
       04          
049EEB             0993*   
049EEB CD 00 01 04 0994*       call printInline
049EEF 69 64 20 20 0995*       asciz "id  : "
       3A 20 00    
049EF6 DD 7E 00    0996*       ld a,(ix+sprite_id)
049EF9 CD 00 95 04 0997*       call printHexA
049EFD             0998*   
049EFD CD 00 01 04 0999*       call printInline
049F01 0D 0A 78 20 1000*       asciz "\r\nx   :"
       20 20 3A 00 
049F09 DD 27 01    1001*       ld hl,(ix+sprite_x)
049F0C CD 78 02 04 1002*       call print_s168_hl
049F10             1003*   
049F10 CD 00 01 04 1004*       call printInline
049F14 0D 0A 79 20 1005*       asciz "\r\ny   :"
       20 20 3A 00 
049F1C DD 27 04    1006*       ld hl,(ix+sprite_y)
049F1F CD 78 02 04 1007*       call print_s168_hl
049F23             1008*   
049F23 CD 00 01 04 1009*       call printInline
049F27 0D 0A 78 76 1010*       asciz "\r\nxv  :"
       20 20 3A 00 
049F2F DD 27 07    1011*       ld hl,(ix+sprite_xvel)
049F32 CD 78 02 04 1012*       call print_s168_hl
049F36             1013*   
049F36 CD 00 01 04 1014*       call printInline
049F3A 0D 0A 79 76 1015*       asciz "\r\nyv  :"
       20 20 3A 00 
049F42 DD 27 0A    1016*       ld hl,(ix+sprite_yvel)
049F45 CD 78 02 04 1017*       call print_s168_hl
049F49             1018*   
049F49 CD 00 01 04 1019*       call printInline
049F4D 0D 0A 76 20 1020*       asciz "\r\nv   :"
       20 20 3A 00 
049F55 DD 27 0D    1021*       ld hl,(ix+sprite_vel)
049F58 CD 78 02 04 1022*       call print_s168_hl
049F5C             1023*   
049F5C CD 00 01 04 1024*       call printInline
049F60 0D 0A 68 64 1025*       asciz "\r\nhdg :"
       67 20 3A 00 
049F68 DD 27 10    1026*       ld hl,(ix+sprite_heading)
049F6B CD 78 02 04 1027*       call print_s168_hl
049F6F             1028*   
049F6F CD 00 01 04 1029*       call printInline
049F73 0D 0A 6F 72 1030*       asciz "\r\nori :"
       69 20 3A 00 
049F7B DD 27 13    1031*       ld hl,(ix+sprite_orientation)
049F7E CD 78 02 04 1032*       call print_s168_hl
049F82             1033*   
049F82 CD 00 01 04 1034*       call printInline
049F86 0D 0A 74 79 1035*       asciz "\r\ntyp : "
       70 20 3A 20 
       00          
049F8F DD 7E 16    1036*       ld a,(ix+sprite_type)
049F92 CD 00 95 04 1037*       call printHexA
049F96             1038*   
049F96 CD 00 01 04 1039*       call printInline
049F9A 0D 0A 42 49 1040*       asciz "\r\nBId : "
       64 20 3A 20 
       00          
049FA3 DD 27 17    1041*       ld hl,(ix+sprite_base_bufferId)
049FA6 CD 27 01 04 1042*       call printHex24
049FAA             1043*   
049FAA CD 00 01 04 1044*       call printInline
049FAE 0D 0A 6D 50 1045*       asciz "\r\nmPg : "
       67 20 3A 20 
       00          
049FB7 DD 27 1A    1046*       ld hl,(ix+sprite_move_program)
049FBA CD 27 01 04 1047*       call printHex24
049FBE             1048*   
049FBE CD 00 01 04 1049*       call printInline
049FC2 0D 0A 63 6F 1050*       asciz "\r\ncol : "
       6C 20 3A 20 
       00          
049FCB DD 7E 1D    1051*       ld a,(ix+sprite_collisions)
049FCE CD F5 02 04 1052*       call printBin8
049FD2             1053*   
049FD2             1054*       ; call printInline
049FD2             1055*       ; asciz "\r\nszx : "
049FD2             1056*       ; ld a,(ix+sprite_dim_x)
049FD2             1057*       ; call printHexA
049FD2             1058*   
049FD2             1059*       ; call printInline
049FD2             1060*       ; asciz "\r\nszy : "
049FD2             1061*       ; ld a,(ix+sprite_dim_y)
049FD2             1062*       ; call printHexA
049FD2             1063*   
049FD2             1064*       ; call printInline
049FD2             1065*       ; asciz "\r\n#ori: "
049FD2             1066*       ; ld a,(ix+sprite_num_orientations)
049FD2             1067*       ; call printHexA
049FD2             1068*   
049FD2             1069*       ; call printInline
049FD2             1070*       ; asciz "\r\n#ani: "
049FD2             1071*       ; ld a,(ix+sprite_num_animations)
049FD2             1072*       ; call printHexA
049FD2             1073*   
049FD2             1074*       ; call printInline
049FD2             1075*       ; asciz "\r\nani : "
049FD2             1076*       ; ld a,(ix+sprite_animation)
049FD2             1077*       ; call printHexA
049FD2             1078*   
049FD2             1079*       ; call printInline
049FD2             1080*       ; asciz "\r\nanit: "
049FD2             1081*       ; ld a,(ix+sprite_animation_timer)
049FD2             1082*       ; call printHexA
049FD2             1083*   
049FD2             1084*       ; call printInline
049FD2             1085*       ; asciz "\r\nmvt : "
049FD2             1086*       ; ld a,(ix+sprite_move_timer)
049FD2             1087*       ; call printHexA
049FD2             1088*   
049FD2             1089*       ; call printInline
049FD2             1090*       ; asciz "\r\nmvs : "
049FD2             1091*       ; ld a,(ix+sprite_move_step)
049FD2             1092*       ; call printHexA
049FD2             1093*   
049FD2             1094*       ; call printInline
049FD2             1095*       ; asciz "\r\npts : "
049FD2             1096*       ; ld a,(ix+sprite_points)
049FD2             1097*       ; call printHexA
049FD2             1098*   
049FD2             1099*       ; call printInline
049FD2             1100*       ; asciz "\r\ndmg : "
049FD2             1101*       ; ld a,(ix+sprite_shield_damage)
049FD2             1102*       ; call printHexA
049FD2             1103*   
049FD2             1104*       ; call printInline
049FD2             1105*       ; asciz "\r\nfrm : "
049FD2             1106*       ; ld a,(ix+sprite_frame)
049FD2             1107*       ; call printHexA
049FD2             1108*   
049FD2             1109*       ; call printNewLine
049FD2             1110*       ; call printNewLine
049FD2             1111*   
049FD2             1112*       ; call waitKeypress
049FD2 C9          1113*       ret
049FD3             0080    
049FD3 FF FF FF FF 0081        align 256
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF          
04A000             0082    
04A000             0083    ; --- MAIN PROGRAM FILE ---
04A000             0084    main:
04A000             0085    ; start a new game
04A000 21 F7 84 04 0086        ld hl,game_init
04A004 22 00 84 04 0087        ld (game_state),hl
04A008             0088    main_loop:
04A008             0089    ; update the global timestamp
04A008 CD F9 14 04 0090        call timestamp_tick
04A00C             0091    ; do gamestate logic
04A00C CD 03 84 04 0092        call do_game
04A010             0093    ; wait for the next vblank mitigate flicker and for loop timing
04A010 CD BF 16 04 0094        call vdu_vblank
04A014             0095    ; poll keyboard for escape keypress
04A014 3E 08       0096        ld a, $08 ; code to send to MOS
04A016 5B CF       0097        rst.lil $08 ; get IX pointer to System Variables
04A018 DD 7E 05    0098        ld a, (ix + $05) ; get ASCII code of key pressed
04A01B FE 1B       0099        cp 27 ; check if 27 (ascii code for ESC)
04A01D CA 25 A0 04 0100        jp z, main_end ; if pressed, jump to exit
04A021             0101    ; escape not pressed so loop
04A021 C3 08 A0 04 0102        jp main_loop
04A025             0103    
04A025             0104    main_end:
04A025 CD 05 16 04 0105        call vdu_cursor_on
04A029 C9          0106        ret
04A02A             0107    ; end main
04A02A             0108    
04A02A             0109        include "tables.inc"
04A02A             0001*   ; #### THIS IS THE SPACE ALLOCATED TO THE SPRITE TABLE ####
04A02A             0002*   table_base: equ $
04A02A             0003*   player_weapons_begin: equ table_base
04A02A             0004*   player_lasers_begin: equ player_weapons_begin
04A02A             0005*   player_lasers_end: equ table_record_size*player_lasers_max+player_lasers_begin
04A02A             0006*   player_weapons_end: equ table_record_size*player_lasers_max+player_weapons_begin
04A02A             0007*   player_begin: equ player_weapons_end
04A02A             0008*   player_end: equ table_record_size+player_begin
04A02A             0009*   enemy_sprites_begin: equ player_end
04A02A             0010*   seekers_base: equ enemy_sprites_begin
04A02A             0011*   seekers_end: equ table_record_size*seekers_max+seekers_base
04A02A             0012*   fireballs_base: equ seekers_end
04A02A             0013*   fireballs_end: equ table_record_size*fireballs_max+fireballs_base
04A02A             0014*   enemy_sprites_end: equ fireballs_end
04A02A             0015*   explosions_base: equ enemy_sprites_end
04A02A             0016*   explosions_end: equ table_record_size*explosions_max+explosions_base
04A02A             0017*   table_end: equ explosions_end
04A02A             0018*   
04A02A             0019*   table_num_records: equ table_end-table_base/table_record_size
04A02A             0020*   table_num_enemy_records: equ enemy_sprites_end-enemy_sprites_begin/table_record_size
04A02A             0021*   
04A02A             0022*   ; ### THIS IS THE SPACE ALLOCATED TO THE ACTIVE TILES TABLE ###
04A02A             0023*   tile_table_base: equ table_end
04A02A             0024*   tile_table_end: equ 256*tile_table_record_size+tile_table_base
