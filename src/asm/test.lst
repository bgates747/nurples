PC     Output      Line
040000             0001       assume adl=1
040000             0002       org 0x040000
040000 C3 48 00 04 0003       jp start
040004 FF FF FF FF 0004       align 64
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
       FF FF FF FF 
040040 4D 4F 53    0005       db "MOS"
040043 00          0006       db 00h
040044 01          0007       db 01h
040045             0008   
040045 00 00 00    0009   scratch: dl 0
040048             0010   start:
040048 F5          0011       push af
040049 C5          0012       push bc
04004A D5          0013       push de
04004B DD E5       0014       push ix
04004D FD E5       0015       push iy
04004F             0016   
04004F             0017   ; MAIN PROGRAM
04004F ED 73 45 00 0018       ld (scratch),sp
       04          
040054 2A 45 00 04 0019       ld hl,(scratch)
040058 CD E4 00 04 0020       call printHexUHL
04005C CD A9 00 04 0021       call printNewLine
040060             0022   
040060 52 F5       0023       push.s af
040062 ED 73 45 00 0024       ld (scratch),sp
       04          
040067 2A 45 00 04 0025       ld hl,(scratch)
04006B CD E4 00 04 0026       call printHexUHL
04006F CD A9 00 04 0027       call printNewLine
040073 52 F1       0028       pop.s af
040075             0029   
040075 F5          0030       push af
040076 ED 73 45 00 0031       ld (scratch),sp
       04          
04007B 2A 45 00 04 0032       ld hl,(scratch)
04007F CD E4 00 04 0033       call printHexUHL
040083 CD A9 00 04 0034       call printNewLine
040087 F1          0035       pop af
040088             0036   ; END MAIN PROGRAM
040088             0037   
040088             0038   exit:
040088 FD E1       0039       pop iy
04008A DD E1       0040       pop ix
04008C D1          0041       pop de
04008D C1          0042       pop bc
04008E F1          0043       pop af
04008F 21 00 00 00 0044       ld hl,0
040093 C9          0045       ret
040094             0046   
040094             0047   ; BASIC DEBUG FUNCTIONS
040094             0048   
040094             0049   ; put the value in HLU into the accumulator
040094             0050   ; destroys: af
040094             0051       MACRO HLU_TO_A
040094             0052       push hl ; 4 cycles
040094             0053       inc sp ; 1 cycle
040094             0054       pop af ; 4 cycles
040094             0055       dec sp ; 1 cycle
040094             0056       ; 10 cycles total
040094             0057       ENDMACRO
040094             0058   
040094             0059   ; Print a zero-terminated string
040094             0060   ; HL: Pointer to string
040094             0061   printString:
040094 C5          0062       PUSH BC
040095 01 00 00 00 0063       LD BC,0
040099 3E 00       0064       LD A,0
04009B 5B DF       0065       RST.LIL 18h
04009D C1          0066       POP BC
04009E C9          0067       RET
04009F             0068   ; print a VDU sequence
04009F             0069   ; HL: Pointer to VDU sequence - <1 byte length> <data>
04009F             0070   sendVDUsequence:
04009F C5          0071       PUSH BC
0400A0 01 00 00 00 0072       LD BC, 0
0400A4 4E          0073       LD C, (HL)
0400A5 5B DF       0074       RST.LIL 18h
0400A7 C1          0075       POP BC
0400A8 C9          0076       RET
0400A9             0077   ; Print Newline sequence to VDP
0400A9             0078   ; destroys bc
0400A9             0079   printNewLine:
0400A9 F5          0080       push af ; for some reason rst.lil 10h sets carry flag
0400AA 3E 0D       0081       LD A, '\r'
0400AC 5B D7       0082       RST.LIL 10h
0400AE 3E 0A       0083       LD A, '\n'
0400B0 5B D7       0084       RST.LIL 10h
0400B2 F1          0085       pop af
0400B3 C9          0086       RET
0400B4             0087   
0400B4             0088   ; Print a 24-bit HEX number
0400B4             0089   ; HLU: Number to print
0400B4             0090   printHex24:
0400B4             0091       HLU_TO_A
0400B4 E5          0001M1     push hl ; 4 cycles
0400B5 33          0002M1     inc sp ; 1 cycle
0400B6 F1          0003M1     pop af ; 4 cycles
0400B7 3B          0004M1     dec sp ; 1 cycle
0400B8             0005M1     ; 10 cycles total
0400B8 CD C2 00 04 0092       CALL printHex8
0400BC             0093   ; Print a 16-bit HEX number
0400BC             0094   ; HL: Number to print
0400BC             0095   printHex16:
0400BC 7C          0096       LD A,H
0400BD CD C2 00 04 0097       CALL printHex8
0400C1 7D          0098       LD A,L
0400C2             0099   ; Print an 8-bit HEX number
0400C2             0100   ; A: Number to print
0400C2             0101   printHex8:
0400C2 4F          0102       LD C,A
0400C3 1F          0103       RRA
0400C4 1F          0104       RRA
0400C5 1F          0105       RRA
0400C6 1F          0106       RRA
0400C7 CD CC 00 04 0107       CALL @F
0400CB 79          0108       LD A,C
0400CC             0109   @@:
0400CC E6 0F       0110       AND 0Fh
0400CE C6 90       0111       ADD A,90h
0400D0 27          0112       DAA
0400D1 CE 40       0113       ADC A,40h
0400D3 27          0114       DAA
0400D4 5B D7       0115       RST.LIL 10h
0400D6 C9          0116       RET
0400D7             0117   
0400D7             0118   printHexA:
0400D7 F5          0119       push af
0400D8 C5          0120       push bc
0400D9 CD C2 00 04 0121       call printHex8
0400DD 3E 20       0122       ld a,' '
0400DF 5B D7       0123       rst.lil 10h
0400E1 C1          0124       pop bc
0400E2 F1          0125       pop af
0400E3 C9          0126       ret
0400E4             0127   
0400E4             0128   printHexUHL:
0400E4 F5          0129       push af
0400E5 C5          0130       push bc
0400E6 E5          0131       push hl
0400E7 CD B4 00 04 0132       call printHex24
0400EB E1          0133       pop hl
0400EC C1          0134       pop bc
0400ED F1          0135       pop af
0400EE C9          0136       ret
